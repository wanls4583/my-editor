(function(){"use strict";var e={899:function(e,t,i){var s=i(144),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("Window")],1)},n=[],o=function(){var e=this,t=e._self._c;return t("div",{ref:"window",staticClass:"my-window",class:{"my-theme-dark":"dark"===e.themeType,"my-theme-light":"light"===e.themeType},style:{"padding-top":e._topBarHeight,"padding-bottom":e._statusHeight},on:{contextmenu:function(e){e.preventDefault(),e.stopPropagation()},mousedown:e.onWindMouseDown}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.sidebarVisible,expression:"sidebarVisible"}],staticClass:"my-left-warp",style:{width:e.leftWidth+"px"}},[t("activity-bar",{ref:"activityBar"}),t("div",{staticStyle:{"flex-grow":"1"}},[t("side-bar",{directives:[{name:"show",rawName:"v-show",value:"files"===e.activity,expression:"activity === 'files'"}],ref:"sideBar"}),t("file-content-search",{directives:[{name:"show",rawName:"v-show",value:"search"===e.activity,expression:"activity === 'search'"}]})],1),t("div",{staticClass:"my-sash-v",staticStyle:{position:"absolute",right:"-4px"},on:{mousedown:e.onLeftSashBegin}})],1),t("div",{ref:"rightWrap",staticClass:"my-right-wrap"},[t("editor-bar",{directives:[{name:"show",rawName:"v-show",value:e.editorList.length,expression:"editorList.length"}],attrs:{editorList:e.editorList}}),t("div",{staticClass:"my-editor-groups"},[e._l(e.editorList,(function(e){return[t("editor",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"item.active"}],key:e.id,ref:"editor"+e.id,refInFor:!0,attrs:{active:e.active,"tab-data":e}})]}))],2),e.terminalVisible&&e.terminalList.length?[t("div",{staticClass:"my-sash-h",on:{mousedown:e.onTerminalSashBegin}}),t("div",{staticClass:"my-terminal-groups",style:{height:e.terminalHeight+"px"}},[t("terminal-bar",{attrs:{terminalList:e.terminalList}}),e._l(e.terminalList,(function(e){return[t("terminal",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"item.active"}],key:e.id,ref:"terminal"+e.id,refInFor:!0,attrs:{active:e.active,id:e.id,path:e.path}})]}))],2)]:e._e()],2),t("title-bar",{ref:"titleBar",attrs:{height:e.topBarHeight}}),t("status-bar",{directives:[{name:"show",rawName:"v-show",value:e.statusbarVisible,expression:"statusbarVisible"}],ref:"statusBar",attrs:{height:e.statusHeight}}),t("cmd-panel"),t("Dialog",{directives:[{name:"show",rawName:"v-show",value:e.dialogVisible,expression:"dialogVisible"}],attrs:{btns:e.dialogBtns,content:e.dialogContent,icon:this.dialogIcon,"icon-color":this.dialogIconColor,overlay:!0,title:e.dialogTilte},on:{close:e.closeDialog}})],1)},a=[],l=function(){var e=this,t=e._self._c;return t("div",{ref:"editor",staticClass:"my-editor-wrap",on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)},mouseenter:e.showScrollBar,mouseleave:e.hideScrollBar,mousemove:e.showScrollBar,selectstart:function(e){e.preventDefault()},wheel:function(t){return t.stopPropagation(),e.onWheel.apply(null,arguments)}}},[t("div",{staticClass:"my-num-wrap"},[t("div",{staticClass:"my-num",staticStyle:{position:"relative",visibility:"hidden"}},[e._v(e._s(e.diffObj.maxLine||e.maxLine))]),t("div",{ref:"numScroller",staticClass:"my-num-scroller"},[t("div",{ref:"numContent",staticClass:"my-num-content",style:{height:e._maxContentHeight,top:e._top}},e._l(e.renderNums,(function(i){return t("div",{staticClass:"my-num",class:{"my-active":e.nowCursorPos.line===i.num},style:{top:i.top}},[t("span",{staticClass:"num"},[e._v(e._s(i._num))]),i.fold?t("span",{staticClass:"my-fold my-center-center",class:["iconfont","open"==i.fold?"my-fold-open icon-down1":"my-fold-close icon-right"],on:{click:function(t){return e.onToggleFold(i.num)}}}):e._e(),"diff"!==e.type?[i.diffType?t("span",{staticClass:"my-diff-num",class:[i.diffType],on:{click:function(t){return e.onShowDiff(i.num)}}}):e._e()]:e._e()],2)})),0)])]),t("div",{staticClass:"my-content-wrap"},[t("div",{ref:"scroller",staticClass:"my-scroller",on:{scroll:e.onScroll}},[t("div",{ref:"content",staticClass:"my-content",style:{width:e._contentMinWidth+"px",height:e._maxContentHeight,left:e._left,top:e._top},on:{mousedown:e.onContentMdown,mouseleave:e.onContentMLeave,mousemove:e.onContentMmove,selectend:function(t){return t.preventDefault(),e.onSelectend.apply(null,arguments)}}},[t("div",{ref:"lineView",staticClass:"my-lines-view"},e._l(e.renderObjs,(function(i){return t("div",{staticClass:"my-line",class:[e._diffBg(i.num)],style:{top:i.top},attrs:{"data-line":i.num,id:e._lineId(i.num)}},[t("div",{staticClass:"my-code",class:["close"==i.fold?"fold-close":"",i.bgClass],attrs:{"data-line":i.num},domProps:{innerHTML:e._s(i.html)}})])})),0),t("div",{ref:"cursorView",staticClass:"my-cursor-view"},[e._l(e.renderCursorObjs,(function(i){return e._l(i,(function(i){return t("span",{staticClass:"my-cursor",style:{height:e._lineHeight,left:i.left,top:i.top,visibility:e._cursorVisible}})}))}))],2),t("div",{staticClass:"my-bg-view"},[e._l(e.renderSelectionObjs,(function(i){return t("div",{staticClass:"my-select-bg",class:{"my-active":i.active,"my-search-bg":i.isFsearch},style:{top:i.top,left:i.left,width:i.width,height:e._lineHeight}})})),e.activeLineBg?t("div",{staticClass:"my-line-bg",style:{height:e._lineHeight,top:e._activeLineTop}}):e._e(),e._bracketStartVisible?t("div",{staticClass:"my-bracket-match",style:e._bracketStartStyle}):e._e(),e._bracketEndVisible?t("div",{staticClass:"my-bracket-match",style:e._bracketEndStyle}):e._e()],2),t("div",{staticClass:"my-indent-view"},e._l(e.renderObjs,(function(i){return t("div",{staticClass:"my-indent-line",style:{height:e._lineHeight,top:i.top},domProps:{innerHTML:e._s(e._tabLines(i.tabNum))}})})),0),t("auto-tip",{directives:[{name:"show",rawName:"v-show",value:e.autoTipList&&e.autoTipList.length,expression:"autoTipList && autoTipList.length"}],ref:"autoTip",attrs:{styles:e.autoTipStyle,tipList:e.autoTipList},on:{change:e.onClickAuto}})],1),t("textarea",{ref:"textarea",staticClass:"my-textarea",style:{top:e._textAreaPos.top,left:e._textAreaPos.left,height:e._lineHeight},on:{blur:e.onBlur,compositionend:e.onCompositionend,compositionstart:e.onCompositionstart,copy:function(t){return t.preventDefault(),e.onCopy.apply(null,arguments)},cut:function(t){return t.preventDefault(),e.onCut.apply(null,arguments)},focus:e.onFocus,input:e.onInput,keydown:e.onKeydown,paste:function(t){return t.preventDefault(),e.onPaste.apply(null,arguments)}}}),t("h-scroll-bar",{staticClass:"my-editor-scrollbar-h",class:{"my-scroll-visible":e.scrollVisible},attrs:{"scroll-left":e.scrollLeft,width:e._contentMinWidth},on:{scroll:e.onHBarScroll}}),e._leftShadow?t("div",{staticClass:"my-scroller-shadow-left"}):e._e(),e._rightShadow?t("div",{staticClass:"my-scroller-shadow-right"}):e._e()],1),t("search-dialog",{directives:[{name:"show",rawName:"v-show",value:e.searchVisible,expression:"searchVisible"}],ref:"searchDialog",attrs:{count:e.searchCount,now:e.searchNow},on:{close:e.onCloseSearch,next:function(t){return e.onSearchNext()},prev:function(t){return e.onSearchPrev()},replace:e.replace,replaceAll:e.replaceAll,search:e.onSearch}})],1),e.minimapVisible?t("div",{staticClass:"my-minimap-wrap"},[t("minimap",{ref:"minimap",attrs:{"content-height":e.contentHeight,"now-line":e.startLine,"scroll-top":e.scrollTop}})],1):e._e(),t("v-scroll-bar",{staticClass:"my-editor-scrollbar-v",class:{"my-scroll-visible":e.scrollVisible},attrs:{height:e.contentHeight,"scroll-top":e.scrollTop},on:{scroll:e.onVBarScroll}}),t("editor-menu",{ref:"menu"}),t("tip",{directives:[{name:"show",rawName:"v-show",value:e.tipContent,expression:"tipContent"}],ref:"tip",attrs:{content:e.tipContent,styles:e.tipStyle}}),e.diffVisible?t("div",{ref:"diff",staticClass:"my-diff-editor",style:{top:e.diffTop+"px",height:e.diffHeight+"px"}},[t("div",{staticClass:"my-diff-bar"},[t("span",{staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.tabData.name))]),t("div",{staticClass:"bar-item my-hover-danger",on:{click:e.onCloseDiff}},[t("span",{staticClass:"iconfont icon-close",staticStyle:{"font-size":"18px"}})])]),t("editor",{staticStyle:{flex:"1"},attrs:{active:!0,"diff-obj":e.toShowdiffObj,"tab-data":e.diffTabData,type:"diff"}}),t("div",{staticClass:"my-sash-h",on:{mousedown:e.onDiffBottomSashBegin}})],1):e._e()],1)},h=[],c=i(509),d=i(755),u=i.n(d);const m=window.require("fs"),p=window.require("fs-extra"),g=window.require("path");class f{static readClipboard(){return window.clipboardData?new Promise((e=>{e(clipboardData.getData("Text"))})):navigator.clipboard?navigator.clipboard.readText():void 0}static writeClipboard(e){window.clipboardData?clipboardData.setData("Text",e):navigator.clipboard&&navigator.clipboard.writeText(e)}static getNum(e){e=String(e),e=e.replace(/[^0123456789\.]/g,"");var t=/^\d+(\.\d*)?$/,i=t.exec(e),s=i&&i[0]||"";return s&&(s=Number(i[0])),s}static space(e){for(var t="",i=0;i<e;i++)t+=" ";return t}static sortNum(e){e.sort((function(e,t){return Number(e)-Number(t)}))}static debounce(e,t){var i=null;return function(){clearTimeout(i),i=setTimeout((function(){e()}),t)}}static throttle(e,t){var i=null;return function(){i||(i=setTimeout((function(){e()}),t))}}static getCharWidth(e,t){var i="------------------------------------------------------------------------------------",s="一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一",r="char-width-"+f.getUUID(),n="char-width-"+f.getUUID(),o=u()(t.replace("[dom]",`<span style="display:inline-block" id="${r}">${i}</span>`)),a=u()(t.replace("[dom]",`<span style="display:inline-block" id="${n}">${s}</span>`));u()(e).append(o).append(a);var l=u()(`#${r}`)[0].scrollWidth/i.length,h=u()(`#${r}`)[0].clientHeight,c=window.getComputedStyle?window.getComputedStyle(u()(`#${r}`)[0],null).fontSize:o[0].currentStyle.fontSize,d=u()(`#${n}`)[0].scrollWidth/s.length;return o.remove(),a.remove(),{charWidth:l,fullAngleCharWidth:d,charHight:h,fontSize:c}}static getStrWidth(e,t,i,s,r,n){s=s||4,"undefined"!=typeof r&&(e=e.substr(r)),"undefined"!=typeof n&&(e=e.substring(0,n-r));var o=e.match(f.FULL_ANGLE_REG),a=e.length*t,l=e.match(/\t/g);return l=l&&l.length||0,o=o&&o.length||0,o&&(o-=l,a=o*i+(e.length-o)*t,a+=l*t*(s-1)),a}static getStrExactWidth(e,t,i){if(f.getStrExactWidth.count=f.getStrExactWidth.count||0,f.getStrExactWidth.count++,!e)return 0;var s="str-width-"+f.getUUID(),r=u()(`<div class="my-line my-temp-text" style="visibility:hidden">\n        <div class="my-code" id="${s}">${a(e)}</div>\n        </div>`);u()(i).append(r);var n=u()("#"+s)[0],o=n.clientWidth;return u()(".my-temp-text").remove(),o;function a(e){let i=Math.floor(e.length/100),s=[];for(let t=0;t<i;t++){let i=100*t;s.push(f.htmlTrans(e.slice(i,i+100)))}return i*=100,i<e.length&&s.push(f.htmlTrans(e.slice(i))),`<span>${s.join("</span><span>").replace(/\t/g,f.space(t||4))}</span>`}}static htmlTrans(e){return e=e.replace(/\&\#/g,"&amp;#"),e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}static deepAssign(e,t,i){return s(e,t,i,new Map);function s(e,t,i,r){for(var n in i=i||[],t){var o=t[n];if(i.indexOf(n)>-1)e[n]=o;else if("object"!==typeof o||o instanceof RegExp||null===o||o.nodeName&&o.nodeType)e[n]=o;else if(r.has(o))e[n]=r.get(o);else{let t=null;o instanceof Array?(t=e[n]||[],r.set(o,t),e[n]=s(t,o,i,new Map(r))):(t=e[n]||{},r.set(o,t),e[n]=s(t,o,i,new Map(r)))}}return e}}static comparePos(e,t){return e.line>t.line||e.line==t.line&&e.column>t.column?1:e.line==t.line&&e.column==t.column?0:-1}static diffObj(e,t){return JSON.stringify(e)!==JSON.stringify(t)}static createWorker(e){var t=`(${e.toString()})()`,i=new Blob([t]),s=window.URL.createObjectURL(i),r=new Worker(s);return r}static defineProperties(e,t,i){let s={};i.forEach((e=>{s[e]={get:function(){return"function"==typeof t[e]?t[e].bind(t):t[e]}}})),Object.defineProperties(e,s)}static readFile(e){return new Promise(((t,i)=>{m.readFile(e,{encoding:"utf8"},((e,s)=>e?i(e):t(s)))}))}static writeFile(e,t){return new Promise(((i,s)=>{p.ensureFile(e).then((()=>{m.writeFile(e,t,{encoding:"utf8"},(e=>e?s(e):i()))}))}))}static writeFileSync(e,t){p.ensureFileSync(e),m.writeFileSync(e,t,{encoding:"utf8"})}static loadJsonFile(e){return f.readFile(e).then((e=>(e=e.toString(),e=(0,c.Z)(e),e=e.replaceAll(/\,(?=\s*(?:(?:\r\n|\n|\r))*\s*[\]\}])/g,""),e=e&&JSON.parse(e)||{},e)))}static loadJsonFileSync(e){let t=m.readFileSync(e,{encoding:"utf8"});return t=t.toString(),t=(0,c.Z)(t),t=t.replaceAll(/\,(?=\s*(?:(?:\r\n|\n|\r))*\s*[\]\}])/g,""),t=t&&JSON.parse(t)||{},t}static checkGitRep(e){while(e.length>3){if(m.existsSync(g.join(e,".git")))return!0;e=g.dirname(e)}}static getIgnore(e){while(e.length>3){if(m.existsSync(g.join(e,".gitignore")))return g.join(e,".gitignore");e=g.dirname(e)}}static fuzzyMatch(e,t,i){let s={},r={},n=0,o=0,a="",l="",h=!1,c={},d=0,u=[],m=null,p=t.toLowerCase();if(e===t)return i?{score:100,indexs:[]}:null;g();for(let f=0;f<t.length;f++){let e=t[f],i=p[f];if(s[i]&&(!a||r[a+i]||r[i+a]&&h))if(!c[i]||c[i]<s[i]){if(c[i]=c[i]?c[i]+1:1,u.push(f),"_"===i||"$"===i?o+=10:h&&(o+=5,r[a+i]&&(o+=1,v(l,e)&&h&&(o+=5))),b(i))return m;r[i+a]&&!r[a+i]||(a=i,l=e),h=!0}else o--,h=i===a;else!d&&o>-9?o-=3:o--,h=i===a}function g(){if(f.fuzzyMatch.cache&&f.fuzzyMatch.cache.word===e)return s=f.fuzzyMatch.cache.wordMap,r=f.fuzzyMatch.cache.towMap,void(n=f.fuzzyMatch.cache.wordLength);let t="";for(let i=0;i<e.length;i++){let n=e[i].toLowerCase();s[n]=s[n]?s[n]+1:1,i>0&&(r[t+n]=!0),t=n}n=Object.keys(s).length,f.fuzzyMatch.cache={word:e,wordMap:s,towMap:r,wordLength:n}}function v(e,t){let i=e.charCodeAt(0),s=t.charCodeAt(0);return i<97&&s>=97||s<97&&i>=97}function b(e){if(c[e]===s[e]&&++d===n)return m={score:o,indexs:u},!0}}static getUUID(e){e=e||16;for(var t="",i=0;i<e;i++)t+=(16*Math.random()|0).toString(16);return t}static getLanguageById(e,t){for(let i=0;i<e.length;i++)if(e[i].language===t)return e[i]}static getLanguageByScopeName(e,t){for(let i=0;i<e.length;i++)if(e[i].scopeName===t)return e[i]}static getWordPattern(e){let t=globalData.defaultWordPattern;if(e=f.getLanguageById(globalData.languageList,e),e){let i=globalData.sourceWordMap[e.scopeName];i=i&&i.pattern,t=i||t}return new RegExp(t)}static getIconByPath({fileType:e,filePath:t,opened:i,isRoot:s}){let r=/[^\\\/]+$/.exec(t),n="",o="",a=globalData.nowIconData,l=globalData.nowTheme.type;return r=r&&r[0],r&&(n=/(?<=\.)[^\.]+$/.exec(r),o=/(?<=\.)[^\.]+\.[^\.]+$/.exec(r),n=n&&n[0],o=o&&o[0]),"light"!==l&&"contrast light"!==l||(a=a.light),"dir"===e?i?a.folderNamesExpanded&&a.folderNamesExpanded[r]?a.folderNamesExpanded[r]:s&&a.rootFolderExpanded?a.rootFolderExpanded:a.folderExpanded||"":a.folderNames&&a.folderNames[r]?a.folderNames[r]:s&&a.rootFolder?a.rootFolder:a.folder||"":a.fileNames&&a.fileNames[r]?a.fileNames[r]:a.fileExtensions&&a.fileExtensions[o]?a.fileExtensions[o]:a.fileExtensions&&a.fileExtensions[n]?a.fileExtensions[n]:a.file||""}static getIconByExtensions(e){let t=globalData.nowIconData;if("light"===globalData.nowTheme.type&&(t=globalData.nowIconData.light),t&&t.fileExtensions)for(let i=0;i<e.length;i++){let s=e[i].slice(1);if(t.fileExtensions[s])return t.fileExtensions[s]}return t&&t.file||""}static getIdFromPath(e,t){let i="";try{let s=m.statSync(e);i=`file-${s.dev}-${s.ino}${t?"-"+s.mtimeMs:""}`}catch(s){i=f.getUUID()}return i}static getTabById(e,t){for(let i=0;i<e.length;i++)if(e[i].id===t)return e[i]}static getTabByPath(e,t){for(let i=0;i<e.length;i++)if(e[i].path===t)return e[i]}static getFileItemByPath(e,t,i){let s=[];for(let n=0;n<e.length;n++){let o=e[n];if(i){if(o.path===i)return r(o)}else if(o.path===t)s.push(o);else if(t.startsWith(o.path)){let e=r(o);e&&s.push(e)}}if(!i)return s;function r(e){let i=e.children;for(let s=0;s<i.length;s++){let e=i[s];if(t===e.path)return e;if(t.startsWith(e.path))return r(e)}}}static getFileStatus(e){let t="";for(let o in globalData.fileStatus)if(e.startsWith(o)){t=o;break}let i=globalData.fileStatus[t]||{},s=i[e]||"",r=s,n="";if(s=f.getStatus(s),!s&&globalData.dirStatus[t]){let i=globalData.dirStatus[t];for(let t=0;t<i.length;t++)if(e.startsWith(i[t].path)){s=i[t].status;break}}return n=f.getFileStatusColor(s),{status:s,originStatus:r,statusColor:n}}static getStatus(e){f.getStatus.statusMap=f.getStatus.statusMap||{};let t=f.getStatus.statusMap[e];if(t)return t;let i=0;t="";for(let s=0;s<e.length;s++)f.STATUS_LEVEMAP[e[s]]>i&&(i=f.STATUS_LEVEMAP[e[s]],t=e[s]);return f.getStatus.statusMap[e]=t,t}static getStatusLevel(e){return e=f.getStatus(e),f.STATUS_LEVEMAP[e]}static getFileStatusColor(e){let t={},i="";for(let s=0;s<e.length;s++)t[e[s]]=!0;return t["R"]?i="my-status-rename":t["?"]?i="my-status-untracked":t["D"]?i="my-status-deleted":t["M"]?i="my-status-modified":t["A"]&&(i="my-status-added"),i}static getMemnuPos(e,t,i){let s=0,r=0,n={},o=u()(t),a=o.parent(),l=i?u()(i):a,h=l.offset(),c=a.offset();return s=o[0].clientWidth,r=o[0].clientHeight,r+e.clientY>h.top+l[0].clientHeight?n.top=e.clientY-c.top-r+"px":n.top=e.clientY-c.top+"px",s+e.clientX>h.left+l[0].clientWidth?n.left=e.clientX-c.left-s+"px":n.left=e.clientX-c.left+"px",n}static getMatchHtml(e,t){let i=0,s="";for(let r=0;r<t.length;r++){let n=t[r];if(n>=e.length)break;i<n&&(s+=`<span class="my-unmatch-char">${f.htmlTrans(e.slice(i,n))}</span>`),s+=`<span class="my-match-char">${f.htmlTrans(e[n])}</span>`,i=n+1}return i<e.length&&(s+=`<span class="my-unmatch-char">${f.htmlTrans(e.slice(i))}</span>`),s}}Array.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},Array.prototype.empty=function(){return this.length=0,this.splice(),this},Array.prototype.insert=function(e,t){if(t&&this.length){let i=0,s=this.length-1;while(i<s){let r=Math.floor((i+s)/2);t(e,this[r])>0?i=r+1:s=r}t(e,this[i])<0&&i--,this.splice(i+1,0,e)}else this.push(e)},String.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},f.FULL_ANGLE_REG=/[\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF\uFFF9-\uFFFC]|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f.KEYCODE={DELETE:46,BACKSPACE:8},f.HISTORY_COMMAND={DELETE:"delete",INSERT:"insert",MOVEUP:"moveLineUp",MOVEDOWN:"moveLineDown",COPY_UP:"copyLineUp",COPY_DOWN:"copyLineDown",DELETE_COPY_UP:"deleteCopyLineUp",DELETE_COPY_DOWN:"deleteCopyLineDown",REPLACE:"replace",INSERT_LINE:"insertLine",DELETE_LINE:"deleteLine",REPLACE:"replace",TAB_TO_SPACE:"tabToSpace",SPACE_TO_TAB:"spaceToTab"},f.CONST_DATA={LINE_COMMENT:"line-comment",BLOCK_COMMENT:"block-comment",BRACKET:"bracket",TAG:"tag"},f.STATUS_LEVEMAP={A:1,M:2,D:3,"?":4,R:5};var v=f;const b=new s.ZP;var y=b,C=class{constructor(){this.taskId=1,this.uiTaskId=1,this.queue=[],this.uiQueue=[],this.frameTime=15,this.channel=new MessageChannel,this.channel.port2.onmessage=e=>{"run"===e.data&&this.run()},this.uiRun()}addUiTask(e){let t=this.uiTaskId++;return e={__id__:t,__task__:e},this.uiQueue.push(e),t}removeUiTask(e){this.uiQueue=this.uiQueue.filter((t=>t.__id__!==e))}uiRun(){this.uiQueue.forEach((e=>{e.__task__()})),this.uiTimestamp=Date.now(),setTimeout((()=>{this.uiRun()}),this.frameTime),this.pending&&(this.pending=!1,this.channel.port1.postMessage("run"))}addTask(e,{level:t=1,delay:i=0,loop:s=!1}={}){let r=this.taskId++;e={__id__:r,__task__:e,__time__:Date.now(),level:t,delay:i,loop:s},s&&e.__task__();for(let n=this.queue.length-1;n>=0;n--)if(this.queue[n].level>=e.level){this.queue.splice(n+1,0,e),e=null;break}return e&&this.queue.unshift(e),this.channel.port1.postMessage("run"),r}removeTask(e){this.queue=this.queue.filter((t=>t.__id__!==e))}run(){let e=Date.now(),t=1/0,i=!1;if(e-this.uiTimestamp>=this.frameTime)this.pending=!0;else{for(var s=0;s<this.queue.length;s++){let r=this.queue[s],n=e-r.__time__;!i&&n>=r.delay?(r.loop?(r.__time__=e,t=Math.min(t,r.delay)):(this.queue.splice(s,1),s--),r.__task__()):t=Math.min(t,n)}this.queue.length&&(t>4?setTimeout((()=>{this.run()}),0):this.channel.port1.postMessage("run"))}}},w={TOKEN_TYPE:{TEXT:"text",SOURCE:"source",TAG_NAME:"tag-name",ATTR_NAME:"attr-name",STRING:"string",WORD:"word",CSS:"css",CSS_VALUE:"css-value",CSS_PROPERTY:"css-property",CSS_SELECTOR:"css-selector",CSS_TAG:"css-tag",CSS_CLASS:"css-class",CSS_ATTR:"css-attr",CSS_PSEUDO:"css-pseudo",EMMET_HTML:"emmet-html",EMMET_CSS:"emmet-css"},TASK:{UI:3}};const x=window.require("@electron/remote"),T=window.require("fs"),k=window.require("path"),L=x.app.getAppPath(),S={value:"Monokai",type:"dark",path:k.join(L,"main/extensions/theme-monokai/themes/monokai-color-theme.json")},P={value:"material-icon-theme",path:k.join(L,"main/extensions/theme-material-icon/dist/material-icons.json")},E={terminal:!1,minimap:!0,sidebar:!0,statusbar:!0},I=/[\\\/](node_modules|dist|\.git|\.vscode|\.idea|\.DS_Store)(?=[\\\/]|$)/,_=/^npm-debug.log|^yarn-debug.log|^yarn-error.log|^pnpm-debug.log|\.suo|\.ntvs|\.njsproj|\.sln|\.sw/,D="(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>/\\?\\s]+)",M=k.join(x.app.getPath("userData"),"userData/file_tree.my"),$=k.join(x.app.getPath("userData"),"userData/config.my"),F=k.join(x.app.getPath("userData"),"userData/cache"),O=k.join(x.app.getPath("userData"),"userData/tab.my"),B=k.join(x.app.getPath("userData"),"userData/tab_terminal.my"),A={scheduler:new C,enum:w,dirname:L,configPath:$,fileTreePath:M,cachePath:F,tabPath:O,terminalTabPath:B,skipSearchDirs:I,skipSearchFiles:_,defaultWordPattern:D,nowTheme:S,nowIconTheme:P,views:E,zoomLevel:0,scopeIdMap:{},scopeReg:null,colors:{},nowIconData:{},themes:[],iconThemes:[],languageList:[],scopeFileList:[],scopeTokenList:[],grammars:{},sourceWordMap:{},fileTree:[],openedFileList:[],fileStatus:{},dirStatus:{},fileDiff:{},terminalList:[],editorList:[],nowEditorId:null,nowFileItem:null,$mainWin:null};if(T.existsSync($))try{let e=v.loadJsonFileSync($);Object.assign(A.nowTheme,e.nowTheme),Object.assign(A.nowIconTheme,e.nowIconTheme),Object.assign(A.views,e.views),A.zoomLevel=e.zoomLevel||0}catch(Er){console.log(Er)}var H=A,N=i(190),R=i(930);const W=window.require("fs"),j=window.require("path"),V={stringToken:/(\.|^)string(\.|$)/};var z=class{constructor(e,t){this.editor=e,this.context=t,this.currentLine=1,this.initRegistry(),this.initLanguage(e.language)}initRegistry(){const e=W.readFileSync(j.join(H.dirname,"main/lib/onig.wasm")).buffer,t=R.loadWASM(e).then((()=>({createOnigScanner(e){return new R.OnigScanner(e)},createOnigString(e){return new R.OnigString(e)}})));this.registry=new N.Registry({onigLib:t,loadGrammar:e=>{let t=v.getLanguageByScopeName(H.scopeFileList,e);return t?t.configPath?v.loadJsonFile(t.configPath).then((e=>(this.sourceFoldMap[t.scopeName]={},H.sourceWordMap[t.scopeName]=e.wordPattern,this.hasTextGrammar=this.hasTextGrammar||t.scopeName.startsWith("text"),this.initLanguageConifg(this.sourceFoldMap[t.scopeName],e),v.readFile(t.path).then((e=>N.parseRawGrammar(e.toString(),t.path)))))):v.readFile(t.path).then((e=>N.parseRawGrammar(e.toString(),t.path))):null}})}initLanguage(e){if(this.language!==e){if(this.language=e,this.grammar=null,this.foldType=1,this.sourceFoldMap={},this.scopeMap={},this.hasTextGrammar=!1,this.currentLine=1,e=v.getLanguageById(H.languageList,e),this.scopeName=e&&e.scopeName||"",this.scopeName){if(!H.grammars[this.scopeName])return this.registry.loadGrammar(this.scopeName).then((e=>{this.grammar=e,H.grammars[this.scopeName]={grammar:e,sourceFoldMap:this.sourceFoldMap,scopeIdMap:this.scopeMap,hasTextGrammar:this.hasTextGrammar},this.tokenizeVisibleLins()}));{let e=H.grammars[this.scopeName];this.grammar=e.grammar,this.sourceFoldMap=e.sourceFoldMap,this.scopeMap=e.scopeIdMap,this.hasTextGrammar=e.hasTextGrammar}}return this.tokenizeVisibleLins(),Promise.resolve()}}initLanguageConifg(e,t){let i=[];e.__comments__={lineComment:"",blockComment:[]},t.comments&&(t.comments.lineComment&&(i.push(t.comments.lineComment),e[t.comments.lineComment]=0,e.__comments__.lineComment=t.comments.lineComment),t.comments.blockComment&&(i.push(t.comments.blockComment[0]),i.push(t.comments.blockComment[1]),e[t.comments.blockComment[0]]=-this.foldType,e[t.comments.blockComment[1]]=this.foldType,e.__comments__.blockComment=t.comments.blockComment,e.__endCommentReg__=new RegExp(t.comments.blockComment[1].replace(/[\{\}\(\)\[\]\&\?\+\*\\]/g,"\\$&"),"g"),this.foldType++)),t.brackets&&t.brackets.forEach((t=>{e[t[0]]?e[t[1]]||(i.push(t[1]),e[t[1]]=-e[t[0]]):e[t[1]]?e[t[0]]||(i.push(t[0]),e[t[0]]=-e[t[1]]):(i.push(t[0]),i.push(t[1]),e[t[0]]=-this.foldType,e[t[1]]=this.foldType,this.foldType++)})),i=i.join("|"),i=i.replace(/[\{\}\(\)\[\]\&\?\+\*\\]/g,"\\$&"),e.__foldReg__=new RegExp(i,"g")}destroy(){this.editor=null,this.context=null,cancelIdleCallback(this.tokenizeLinesTimer),H.scheduler.removeTask(this.tokenizeLinesTask)}onInsertContentAfter(e,t){H.scheduler.removeTask(this.tokenizeLinesTask),e<=this.currentLine&&(this.currentLine=e),this.editor.$nextTick((()=>{this.tokenizeVisibleLins()}))}onDeleteContentAfter(e,t){H.scheduler.removeTask(this.tokenizeLinesTask),t<=this.currentLine&&(this.currentLine=t),this.editor.$nextTick((()=>{this.tokenizeVisibleLins()}))}tokenizeVisibleLins(){let e=this.tokenizeVisibleLinsId+1||1;this.tokenizeVisibleLinsId=e,this.editor.$nextTick((()=>{if(this.tokenizeVisibleLinsId!==e)return;let t=this.editor.startLine,i=this.editor.startLine+this.editor.maxVisibleLines;i=this.editor.folder.getRealLine(i),t=t<this.currentLine?this.currentLine:t,i>=t&&this.tokenizeLines(t,i,(()=>{t=this.editor.startLine-2e3,t=t<1?1:t,i=this.editor.folder.getRealLine(i+10*this.editor.maxVisibleLines),t>this.currentLine?this.tokenizeLines(t,i,(()=>{this.tokenizeLines(this.currentLine)})):this.tokenizeLines(this.currentLine)}))}))}tokenizeLines(e,t,i){let s=5,r=0,n=e,o=Date.now();if(t=t||this.editor.maxLine,t=t>this.editor.maxLine?this.editor.maxLine:t,cancelIdleCallback(this.tokenizeLinesTimer),H.scheduler.removeTask(this.tokenizeLinesTask),!this.scopeName||this.grammar){while(e<=t){let t=this.context.htmls[e-1];if(!t.tokens){let i=this.tokenizeLine(e);if(t.tokens=i.tokens,t.folds=i.folds,t.stateFold=i.stateFold,y.$emit("render-line",{editorId:this.editor.editorId,lineId:t.lineId}),(!t.states||t.states.equals&&!t.states.equals(i.states)||t.states.toString()!==i.states.toString())&&(t.states=i.states,t=this.context.htmls[e],t&&(t.tokens=null,t.html="")),r++,r>=s||Date.now()-o>=5){e++;break}}if(e-n>1e3)break;e++}n===this.currentLine&&(this.currentLine=e),e<=t?this.tokenizeLinesTask=H.scheduler.addTask((()=>{this.tokenizeLines(e,t,i)})):i&&i()}else this.tokenizeLinesTimer=requestIdleCallback((()=>{this.tokenizeLines(e,t,i)}))}tokenizeLine(e){let t=this.context.htmls[e-1].text,i=[];if(t.length>1e4||!this.scopeName||e<=this.editor.diffObj.deletedLength)return{tokens:[{scopes:["plain"],startIndex:0,endIndex:t.length}],folds:[],states:N.INITIAL};let s=null;s=this.editor.diffObj.states?e===this.editor.diffObj.deletedLength+1?this.editor.diffObj.states:this.context.htmls[e-2].states||N.INITIAL:this.context.htmls[e-2]&&this.context.htmls[e-2].states||N.INITIAL;let r=this.grammar.tokenizeLine(t,s),n=this.addFold(e,r.tokens,i);return r.tokens.peek().endIndex=t.length,{tokens:r.tokens,states:r.ruleStack,folds:i,stateFold:n}}createHtml(e,t){let i=[],s=null;e||(e=[{startIndex:0,endIndex:t.length,scopes:["plain"]}],e=this.splitLongToken(e));for(let n=0;n<e.length;n++){let t=e[n],o="",a="";"plain"===t.scopes[0]?o="my-plain":"selected"===t.scopes[0]?o="my-select-fg":(a=this.getScopeId(t),o=a&&`my-scope-${a}`||""),s&&r(s.scopeId,a)&&t.endIndex-s.startIndex<100?s.endIndex=t.endIndex:(s={scopeId:a,selector:o,startIndex:t.startIndex,endIndex:t.endIndex},i.push(s))}return i.map((e=>{let i=t.substring(e.startIndex,e.endIndex);return`<span class="${e.selector}" data-column="${e.startIndex}" data-end="${e.endIndex}">${v.htmlTrans(i)}</span>`})).join("").replace(/\t/g,this.editor.space);function r(e,t){return e=H.scopeIdMap[e],t=H.scopeIdMap[t],e=e&&e.settingsStr||"",t=t&&t.settingsStr||"",e===t}}getScopeId(e){let t=null,i=e.scopes;if(e.scopeId)return e.scopeId;e.scope=i.join(" ");e:for(let s=i.length-1;s>=0;s--){let r=i[s];if(r in this.scopeMap){if(this.scopeMap[r]){t=this.scopeMap[r];break}}else for(let i=0;i<H.scopeTokenList.length;i++){let s=H.scopeTokenList[i],n=s.scopes.peek();if(r.indexOf(n)>-1&&s.regexp.test(e.scope)){t=s.scopeId,this.scopeMap[r]=t;break e}this.scopeMap[r]=null}}return e.scopeId=t,t}addFold(e,t,i){let s="",r=0,n=!1,o=this.context.htmls[e-1].text,a=e>1?this.context.htmls[e-2].stateFold:null;t.forEach((e=>{V.stringToken.test(e.scopes.join("."))&&(e.isString=!0)}));e:for(let l=0;l<t.length;l++){let h=t[l],c="",d=null;for(let n=h.scopes.length-1;n>=0;n--)if(d=this.sourceFoldMap[h.scopes[n]],d){if(c=h.scopes[n],s||l===t.length-1){if(c!==s||l===t.length-1){let c=l===t.length-1?h.endIndex:h.startIndex,u=this.addBracket({tokens:t,line:e,foldMap:d,folds:i,startIndex:r,endIndex:c,stateFold:a,lineText:o});if(u&&u.type===v.CONST_DATA.LINE_COMMENT)break e;s=h.scopes[n],r=h.startIndex}}else s=h.scopes[n],r=h.startIndex;break}this.addTagFold({token:h,foldMap:d,folds:i,lineText:o})&&(n=!0)}return n&&i.sort(((e,t)=>e.startIndex-t.startIndex)),i.length?i.peek().type===v.CONST_DATA.BLOCK_COMMENT?i.peek():null:a}addBracket(e){let t=e.tokens,i=e.foldMap,s=e.folds,r=e.startIndex,n=e.endIndex,o=e.stateFold,a=e.lineText.slice(r,n),l=i.__foldReg__,h=null,c=null;c=s.length?s.peek():o,c&&c.type===v.CONST_DATA.BLOCK_COMMENT&&c.side<0&&(l=i.__endCommentReg__);while(h=l.exec(a)){let e=v.CONST_DATA.BRACKET;if(i.__comments__.lineComment===h[0]?e=v.CONST_DATA.LINE_COMMENT:i.__comments__.blockComment[0]!==h[0]&&i.__comments__.blockComment[1]!==h[0]||(e=v.CONST_DATA.BLOCK_COMMENT),!d(h))if(s.push({startIndex:r+h.index,endIndex:r+h.index+h[0].length,side:i[h[0]],type:e}),e===v.CONST_DATA.BLOCK_COMMENT&&i[h[0]]<0)i.__endCommentReg__.lastIndex=l.lastIndex,l.lastIndex=0,l=i.__endCommentReg__;else if(e===v.CONST_DATA.LINE_COMMENT)break}return l.lastIndex=0,s.length&&s.peek();function d(e){let i=e.index;for(let s=0;s<t.length;s++){if(t[s].startIndex<=i&&t[s].endIndex>i){if(t[s].isString)return!0;break}if(t[s].startIndex>i)break}return!1}}addTagFold(e){let t=e.token,i=e.folds,s=e.foldMap,r=e.lineText;if(this.hasTextGrammar&&t.scopes.peek().startsWith("entity.name.tag")){let e=r.slice(t.startIndex,t.endIndex),n=0;return s[e]?n=s[e]:(n=this.foldType++,s[e]=n),"<"===r[t.startIndex-1]&&(n=-n),i.push({startIndex:t.startIndex,endIndex:t.endIndex,side:n,type:v.CONST_DATA.TAG}),!0}}splitLongToken(e){let t=[];return e.forEach((e=>{let i=e.endIndex-e.startIndex+1;if(i>100){let s=e.startIndex,r=Math.floor(i/100);for(let i=0;i<r;i++){let r=100*i,n=100*(i+1);t.push({startIndex:r+s,endIndex:n+s,scopes:e.scopes})}r*=100,r<i&&t.push({startIndex:r+s,endIndex:e.endIndex,scopes:e.scopes})}else t.push(e)})),t}clearScopeMap(){this.scopeMap={};for(let e in H.grammars)e===this.scopeName?H.grammars[e].scopeIdMap=this.scopeMap:H.grammars[e].scopeIdMap={}}};const Y=window.require("path"),K=window.require("child_process"),U={css:!0,scss:!0,less:!0,html:!0,javascript:!0};let q=null;var G=class{constructor(e,t){this.editor=e,this.context=t,this.initLanguage(e.language),y.$on("lint-worker-done",this.workerFn=e=>{e.parseId===this.parseId&&(this.editor.setErrors(e.results),this.parseId="")})}initLanguage(e){this.language!==e&&(this.language=e,this.editor.setErrors([]),this.parse())}onInsertContentAfter(e,t){this.parse()}onDeleteContentAfter(e,t){this.parse()}destroy(){this.editor=null,this.context=null,clearTimeout(this.runTimer),y.$off("lint-worker-done",this.workerFn),q&&(q.kill(),q=null)}parse(){function e(){const e=this.context.getAllText();this.parseId=v.getUUID(),q.send({text:e,parseId:this.parseId,language:this.language})}U[this.language]&&(q||this.createProcess(),clearTimeout(this.runTimer),this.runTimer=setTimeout((()=>{e.call(this)}),500))}createProcess(){q=K.fork(Y.join(H.dirname,"main/process/lint/index.js")),q.on("message",(e=>{y.$emit("lint-worker-done",e)})),q.on("close",(()=>{this.createProcess()}))}};const Z=window.require("path"),X=window.require("child_process");let J=null;var Q=class{constructor(e,t){this.editor=e,this.context=t,y.$on("format-worker-done",this.workerFn=e=>{e.workerId===this.workerId&&(this.context.reload(e.text),this.editor.cursor.setCursorPos(e.cursorPos),this.workerId="")})}onInsertContentAfter(e,t){}onDeleteContentAfter(e,t){}destroy(){this.editor=null,this.context=null,clearTimeout(this.runTimer),y.$off("format-worker-done",this.workerFn),J&&(J.kill(),J=null)}run(){function e(){const e=this.context.getAllText();this.workerId=v.getUUID(),J.send({text:e,workerId:this.workerId,cursorPos:this.editor.nowCursorPos,language:this.editor.language})}J||this.createProcess(),clearTimeout(this.runTimer),this.runTimer=setTimeout((()=>{e.call(this)}),50)}createProcess(){J=X.fork(Z.join(H.dirname,"main/process/format/index.js")),J.on("message",(e=>{y.$emit("format-worker-done",e)})),J.on("close",(()=>{this.createProcess()}))}};const ee=window.require("path"),te=window.require("child_process");let ie=null;var se=class{constructor(e,t){this.editor=e,this.context=t,y.$on("diff-worker-done",this.workerFn=e=>{e.workerId===this.workerId&&(this.editor.setDiffObjs(e.result),this.workerId="")})}onInsertContentAfter(e,t){this.run()}onDeleteContentAfter(e,t){this.run()}destroy(){this.editor=null,this.context=null,clearTimeout(this.runTimer),y.$off("diff-worker-done",this.workerFn),ie&&(ie.kill(),ie=null)}run(){function e(){const e=this.context.getAllText();this.workerId=v.getUUID(),ie.send({text:e,filePath:this.editor.tabData.path,workerId:this.workerId})}ie||this.createProcess(),clearTimeout(this.runTimer),this.runTimer=setTimeout((()=>{e.call(this)}),500)}createProcess(){ie=te.fork(ee.join(H.dirname,"main/process/git/diff.js")),ie.on("message",(e=>{y.$emit("diff-worker-done",e)}))}},re=i(412);const ne=window.require("path"),oe={stringToken:/(?:\.|^)(?:string|regexp)(?:\.|$)/,tagToken:/meta\.tag/,tagNameToken:/entity\.name\.tag/,tagAttrName:/attribute\-name/,cssValueToken:/property\-list|property\-value|separator/,cssPropertyToken:/meta\.property\-name/,cssSelectorToken:/meta\.selector/,cssAttributeToken:/attribute\-selector/,cssClassToken:/attribute\-name\.class/,cssPseudoToken:/pseudo\-element/,styleCss:/([^\:\;\"\'\s]+)\s*\:\s*([^\:\;]+)?$/,styleCssProperty:/(?:^|[\;\"\'])([^\:\;]+)$/};class ae{constructor(e,t){this.editor=e,this.context=t,this.doneMap={},this.results=[],this.wordPattern=v.getWordPattern(this.editor.language),this.wordPattern=new RegExp(`^(${this.wordPattern.source})$`)}reset(){this.currentLine=1,this.results=[],this.doneMap={}}destroy(){this.reset(),this.editor=null,this.context=null}stop(){cancelIdleCallback(this.searchTimer)}search(){this.stop(),this.searchTimer=requestIdleCallback((()=>{this._search()}))}emmet(){if(this.editor.autoTipList&&this.editor.autoTipList.length)return void o.call(this);let e=this.context.htmls[this.editor.nowCursorPos.line-1],t=this.getTokenIndex(this.editor.nowCursorPos),i=e.tokens[t],s=i&&e.text.slice(i.startIndex,this.editor.nowCursorPos.column),r=null,n="";if(s){let o=i.scopes.peek();if(o.startsWith("text."))r=(0,re.Kl)(s),n=w.TOKEN_TYPE.EMMET_HTML;else if(this._isCssToken(i)){if(this._isCssPropertyToken(i))r=(0,re.Kl)(s,s.length,{type:"stylesheet"});else if(this._isCssValueToken(i)){let i=e.tokens[t-1];i&&this._isCssPropertyToken(i)&&(s=e.text.slice(i.startIndex,i.endIndex)+s,r=(0,re.Kl)(s,s.length,{type:"stylesheet"}))}n=w.TOKEN_TYPE.EMMET_CSS}}function o(){"space"===this.editor.indent&&/^\s*$/.exec(e.text.slice(0,this.editor.nowCursorPos.column))?this.context.insertContent(this.editor.space):this.context.insertContent("\t")}r?this.context.replaceTip({word:r.abbreviation,result:r.abbreviation,type:n}):o.call(this)}_search(){let e=this.context.htmls[this.editor.nowCursorPos.line-1],t=this.getTokenIndex(this.editor.nowCursorPos),i=e.tokens[t],s=i&&e.text.slice(i.startIndex,this.editor.nowCursorPos.column);if(this.reset(),this.editor.setAutoTip(null),s)if(this._isTextToken(i)){let e=i.scopes.peek();if(e.startsWith("text."))this._searchEmmet(s);else if(this._isTagNameToken(i))this._searchTagName(s);else if(this._isAttrNameToken(i)){let e=this._getPreTagName(t,this.editor.nowCursorPos.line);e&&this._searchTagAttrName(s,e)}}else if(this._isCssToken(i))if(this._isCssPropertyToken(i))this._searchCssProperty(s);else if(this._isCssValueToken(i)){let i=e.tokens[t-1];if(i&&this._isCssPropertyToken(i)){let i=e.tokens[t-1];i&&this._isCssPropertyToken(i)&&(s=e.text.slice(i.startIndex,i.endIndex)+s,this._searchCssProperty(s))}else{let e=this._getPreCssProperty(t,this.editor.nowCursorPos.line);e&&this._searchCssValue(s,e)}}else this._isCssSelectorToken(i)?(this._isTagNameToken(i)?this._searchCssTag(s):s.indexOf(":")>-1&&this._searchCssPseudo(s),this._searchSelector(s,i)):this._isTagToken(i)&&this._searchStyle(s,i);else this._isSourceToken(i)&&this.wordPattern.test(s)&&this._searchWord(s,i)}_searchWord(e,t){this._searchDocument((i=>{i.tokens.forEach((s=>{if(s===t)return;let r=i.text.slice(s.startIndex,s.endIndex);if(this.wordPattern.test(r)){if(this._isTextToken(s)||this._isStringToken(s))return;this._addTip({word:e,value:r,type:w.TOKEN_TYPE.WORD})}}))}))}_searchSelector(e,t){this._isCssClassToken(t)&&"."!==e&&(e="."+e),this._searchDocument((i=>{i.tokens.forEach((s=>{if(s!==t&&this._isCssSelectorToken(s)){let r=i.text.slice(s.startIndex,s.endIndex);if(!this.wordPattern.test(r))return;this._isCssClassToken(s)&&(r="."+r),"."===e?this._isCssClassToken(s)&&".."!==r&&this._addTip({word:e,value:r,type:w.TOKEN_TYPE.CSS_CLASS,skipMatch:!0}):this._isCssClassToken(t)?this._isCssClassToken(s)&&this._addTip({word:e,value:r,type:w.TOKEN_TYPE.CSS_CLASS}):this._addTip({word:e,value:r,type:w.TOKEN_TYPE.CSS_SELECTOR})}}))}),!0)}_searchDocument(e,t){let i=this.currentLine,s=Date.now(),r=0;while(i<=this.context.htmls.length){let t=this.context.htmls[i-1];if(i++,t.tokens&&(e(t),r++,r%5==0&&Date.now()-s>=20))break}this.currentLine=i,this._showTip(t),i<=this.context.htmls.length&&(this.searchTimer=requestIdleCallback((()=>{this._searchDocument(e,t)})))}_searchTagName(e){const t=this.getHtmlData();t.tags.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.TAG_NAME})})),this.results.length||this._addTip({word:e,value:e,type:w.TOKEN_TYPE.TAG_NAME,skipMatch:!0}),this._showTip()}_searchTagAttrName(e,t){const i=this.getHtmlData();let s=i.tagMap[t];s=s&&s.attributes,s&&s.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.ATTR_NAME,after:'=""'})})),i.globalAttributes.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.ATTR_NAME,after:'=""'})})),this._showTip()}_searchCssTag(e){const t=this.getHtmlData();t.tags.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_TAG})}))}_searchCssPseudo(e){const t=this.getCssData(),i=e.split(":").peek().trim();t.pseudoClasses.forEach((t=>{i?this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_PSEUDO}):this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_PSEUDO,skipMatch:!0})})),t.pseudoElements.forEach((t=>{i?this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_PSEUDO}):this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_PSEUDO,skipMatch:!0})}))}_searchStyle(e,t){let i=this.editor.nowCursorPos.column,s=this.context.htmls[this.editor.nowCursorPos.line-1],r=null;if(e=s.text.slice(t.startIndex,i),r=oe.styleCss.exec(e),r&&r[1]){let e=r[1],t=r[2]||"";this._searchCssValue(t,e)}else r=oe.styleCssProperty.exec(e),r&&r[1]&&this._searchCssProperty(r[1])}_searchCssProperty(e){const t=this.getCssData();if(t.properties.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_PROPERTY,after:": "})})),!this.results.length){const t=(0,re.Kl)(e,e.length,{type:"stylesheet"});t&&t.abbreviation&&this._addTip({word:t.abbreviation,value:t.abbreviation,type:w.TOKEN_TYPE.EMMET_CSS,skipMatch:!0})}this._showTip()}_searchCssValue(e,t){const i=this.getCssData();let s=i.propertyMap[t];if(s=s&&s.values,s){let t=e.trim();":"===t||""===t?(s.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_VALUE,before:" ",after:";",skipMatch:!0})})),this._showTip(!0)):(s.forEach((t=>{this._addTip({word:e,value:t.name,type:w.TOKEN_TYPE.CSS_VALUE,after:";"})})),this._showTip())}}_searchEmmet(e){const t=(0,re.Kl)(e);t&&t.abbreviation&&(this._addTip({word:t.abbreviation,value:t.abbreviation,type:w.TOKEN_TYPE.EMMET_HTML,skipMatch:!0}),this._showTip())}_setTokenType(e){e.isSourceToken=!1,e.isCssToken=!1,e.isTextToken=!1,e.isTagToken=!1,e.isTagAttrNameToken=!1,e.scope=e.scope||e.scopes.join(" ");for(let t=e.scopes.length-1;t>=0;t--){let i=e.scopes[t];if(i.startsWith("source.")){e.isSourceToken=!0,i.startsWith("source.css")&&(e.isCssToken=!0);break}if(i.startsWith("text.")){e.isTextToken=!0,e.isTagAttrNameToken=oe.tagAttrName.test(e.scope);break}}e.isTagToken=oe.tagToken.test(e.scope),e.isTagNameToken=oe.tagNameToken.test(e.scope),e.isStringToken=oe.stringToken.test(e.scope),e.isCssToken&&(e.isCssValueToken=oe.cssValueToken.test(e.scope),e.isCssPropertyToken=oe.cssPropertyToken.test(e.scope),e.isCssSelectorToken=oe.cssSelectorToken.test(e.scope),e.isCssClassToken=oe.cssClassToken.test(e.scope),e.isCssAttributeToken=oe.cssAttributeToken.test(e.scope),e.isCssPseudoToken=oe.cssPseudoToken.test(e.scope))}_isTextToken(e){return void 0===e.isTextToken&&this._setTokenType(e),e.isTextToken}_isSourceToken(e){return void 0===e.isSourceToken&&this._setTokenType(e),e.isSourceToken}_isCssToken(e){return void 0===e.isCssToken&&this._setTokenType(e),e.isCssToken}_isCssPropertyToken(e){return void 0===e.isCssPropertyToken&&this._setTokenType(e),e.isCssPropertyToken}_isCssValueToken(e){return void 0===e.isCssValueToken&&this._setTokenType(e),e.isCssValueToken}_isCssSelectorToken(e){return void 0===e.isCssSelectorToken&&this._setTokenType(e),e.isCssSelectorToken}_isCssClassToken(e){return void 0===e.isCssClassToken&&this._setTokenType(e),e.isCssClassToken}_isCssAttributeToken(e){return void 0===e.isCssAttributeToken&&this._setTokenType(e),e.isCssAttributeToken}_isCssPseudoToken(e){return void 0===e.isCssPseudoToken&&this._setTokenType(e),e.isCssPseudoToken}_isStringToken(e){return void 0===e.isStringToken&&this._setTokenType(e),e.isStringToken}_isTagToken(e){return void 0===e.isTagToken&&this._setTokenType(e),e.isTagToken}_isTagNameToken(e){return void 0===e.isTagNameToken&&this._setTokenType(e),e.isTagNameToken}_isAttrNameToken(e){return void 0===e.isTagAttrNameToken&&this._setTokenType(e),e.isTagAttrNameToken}_getPreTagName(e,t){let i="",s=0;e:while(t>=1){let r=this.context.htmls[t-1];if(!r.tokens)break;e=e>-1?e:r.tokens.length;for(let t=e-1;t>=0;t--){let e=r.tokens[t];if(this._isTagNameToken(e)){i=r.text.slice(e.startIndex,e.endIndex);break e}if(s++,s>100)break e}t--,e=-1}return i}_getPreCssProperty(e,t){let i="",s=0;e:while(t>=1){let r=this.context.htmls[t-1];if(!r.tokens)break;e=e>-1?e:r.tokens.length;for(let t=e-1;t>=0;t--){let e=r.tokens[t];if(this._isCssPropertyToken(e)){i=r.text.slice(e.startIndex,e.endIndex);break e}if(s++,s>100||!this._isCssValueToken(e))break e}t--,e=-1}return i}_addTip(e){let t=null,i=e.fullMatch;if(i=void 0===i||i,!this.doneMap[e.value]||e.skipDone)if(t=e.skipMatch?{indexs:[],score:0}:v.fuzzyMatch(e.word.trim(),e.value,i),t){let i={result:e.value,word:e.word||"",desc:e.desc||"",type:e.type||"",before:e.before||"",after:e.after||"",icon:this.getIcon(e.scope),indexs:t.indexs,score:t.score};this.results.push(i),this.doneMap[e.value]=i}else this.doneMap[e.value]=!0}_showTip(e){let t=null,i=e?200:10;this.results.sort(((e,t)=>t.score-e.score)),t=this.results.slice(0,i),this.editor.setAutoTip(t)}checkEmmetValid(e){let t="";if(oe.invalidEmmetParen.exec(e))return!1;while(e!==(t=e.replace(oe.paremEmmet,"a")))e=t;return!!oe.emmet.exec(e)}getTokenIndex(e){let t=this.context.htmls[e.line-1].tokens;if(t)for(let i=0;i<t.length;i++)if(t[i].startIndex<e.column&&t[i].endIndex>=e.column)return i;return-1}getHtmlData(){if(this.htmlData)return this.htmlData;{const e=window.require(ne.join(H.dirname,"main/data/browsers.html-data"));return this.htmlData=e,e.tagMap={},e.tags.forEach((t=>{e.tagMap[t.name]=t})),this.htmlData}}getCssData(){if(this.cssData)return this.cssData;{const e=window.require(ne.join(H.dirname,"main/data/browsers.css-data"));return this.cssData=e,e.propertyMap={},e.properties.forEach((t=>{e.propertyMap[t.name]=t})),this.cssData}}getIcon(e){return""}}var le=ae;class he{constructor(e){this.dataList=new Array(e+1),this.linkList=new Array(e+2),this.num=0,this.next=null,this.prev=null,this.pNode=null}}class ce{constructor(e,t){this.max=t||4,this.root=null,this.head=null,this.size=0,this.compare=e||function(e,t){return e-t}}insert(e){if(!this.root){let t=new he(this.max);return t.dataList[0]=e,t.num++,this.root=t,this.head=t,this.size++,void(this.arrayCache=null)}let t=this._search(e,!0),i=null,s=Math.floor(this.max/2)||1,r=this.iterator(t,e);if(this.findIndex(t,e)>-1)return r;this.size++,this.arrayCache=null;while(t){let r=t.linkList,o=t.dataList;for(let i=0;i<t.num;i++){let s=o[i];if(this.compare(e,s)<0){n(o,r,i);break}i===t.num-1&&n(o,r,i+1)}if(t.num++,t.num<=this.max)break;let a=new he(this.max),l=t.linkList[0];e=o[s],l||(t.next&&(t.next.prev=a),a.next=t.next,t.next=a,a.prev=t,a.pNode=t.pNode),i=a;for(let e=l?s+1:s,i=0;e<t.num;e++,i++)a.dataList[i]=o[e],a.linkList[i+1]=r[e+1],a.linkList[i+1]&&(a.linkList[i+1].pNode=a),o[e]=null,r[e+1]=null,a.num++;if(t.num=s,l&&(t.dataList[t.num]=null,a.linkList[0]=t.linkList[t.num+1],a.linkList[0]&&(a.linkList[0].pNode=a),t.linkList[t.num+1]=null),!t.pNode){this.root=new he(this.max),this.root.dataList[0]=e,this.root.linkList[0]=t,this.root.linkList[1]=a,this.root.num=1,t.pNode=this.root,a.pNode=this.root;break}t=t.pNode}return r;function n(s,r,n){for(let e=t.num;e>=n+1;e--)s[e]=s[e-1],r[e+1]=r[e];s[n]=e,r[n+1]=i,i&&(i.pNode=t)}}delete(e){let t=this,i=this._search(e),s=null,r=Math.floor(this.max/2)||1;if(i){let t=i.dataList,r=this.findIndex(i,e);s=t[r];for(let e=r;e<i.num;e++)t[e]=t[e+1];if(i.num--,this.size--,this.arrayCache=null,!this.size)return this.root=null,s}while(i&&i.num<r&&i.pNode){let e=i.pNode,t=e.linkList.indexOf(i),s=e.linkList[t-1],l=e.linkList[t+1],h=i.linkList[0];s&&s.num>r?(o(i,1),h?(i.dataList[0]=e.dataList[t-1],i.linkList[0]=s.linkList[s.num],e.dataList[t-1]=s.dataList[s.num-1]):(i.dataList[0]=s.dataList[s.num-1],e.dataList[t-1]=i.dataList[0]),i.linkList[0]&&(i.linkList[0].pNode=i),e.dataList[t-1]=s.dataList[s.num-1],s.dataList[s.num-1]=null,s.linkList[s.num]=null,s.num--,i.num++):l&&l.num>r?(h?(i.dataList[i.num]=e.dataList[t],i.linkList[i.num+1]=l.linkList[0],e.dataList[t]=l.dataList[0]):(i.dataList[i.num]=l.dataList[0],e.dataList[t]=l.dataList[1]),i.linkList[i.num+1]&&(i.linkList[i.num+1].pNode=i),a(l,1),l.num--,i.num++):l?n(i.pNode,t,i,l):s&&n(i.pNode,t-1,s,i)}return s;function n(e,s,r,n){let l=r.linkList[0]?1:0;o(n,r.num+l);for(let t=0;t<r.num;t++)n.dataList[t]=r.dataList[t],n.linkList[t+1]=r.linkList[t+1],n.linkList[t+1]&&(n.linkList[t+1].pNode=n);n.linkList[0]=r.linkList[0],n.linkList[0]&&(n.linkList[0].pNode=n),l&&(n.dataList[r.num]=e.dataList[s]),a(e,1,s),n.num+=r.num+l,e.num--,l||(t.head===r?(t.head=n,t.head.prev=null):(r.prev.next=n,n.prev=r.prev)),e.num?i=e:(t.root=n,t.root.pNode=null,i=null)}function o(e,t){for(let i=e.num-1;i>=0;i--)e.dataList[t+i]=e.dataList[i],e.linkList[t+i+1]=e.linkList[i+1];e.linkList[t]=e.linkList[0]}function a(e,t,i){i=i||0;for(let s=i;s<e.num;s++)e.dataList[s]=e.dataList[s+t],e.linkList[s]=e.linkList[s+t];e.linkList[e.num]=e.linkList[e.num+t]}}search(e,t,i){let s=this._search(e,i,t);return s&&(s=this.iterator(s,e,t)),s}findIndex(e,t){for(let i=0;i<e.num;i++)if(0===this.compare(t,e.dataList[i]))return i;return-1}iterator(e,t,i){let s=e.num,r=e.num,n=e.num;i=i||this.compare;for(let l=0;l<e.num;l++){let n=e.dataList[l],o=i(t,n);if(o<=0){r=l,s=l;break}}return{next:o,prev:a,reset:function(){s=r,e=n}};function o(){return s<e.num?e.dataList[s++]:e.next?(e=e.next,s=0,e.dataList[s]):null}function a(){return s--,s>=0?e.dataList[s]:e.prev?(e=e.prev,s=e.num-1,e.dataList[s]):(s++,null)}}forEach(e){let t=this.toArray();for(let i=0;i<t.length;i++)e(t[i],i)}toArray(){if(this.arrayCache)return this.arrayCache;let e=[],t=this.head;while(t){let i=t.dataList;for(let s=0;s<t.num;s++)e.push(i[s]);t=t.next}return this.arrayCache=e,e}get(e){let t=this.head,i=-1;while(t){let s=t.dataList;for(let r=0;r<t.num;r++)if(i++,i==e)return s[r];t=t.next}return null}empty(){this.root=null,this.head=null,this.size=0,this.arrayCache=null}_search(e,t,i){let s=this.root;i=i||this.compare;while(s){let r=s.linkList,n=s.dataList;for(let o=0;o<s.num;o++){let a=i(e,n[o]);if(0===a){if(r[o+1]){s=r[o+1];break}return s}if(!(a>0)){if(r[o]){s=r[o];break}return t?s:null}if(!n[o+1]||i(e,n[o+1])<0){if(r[o+1]){s=r[o+1];break}return t?s:null}}}}}var de=ce;const ue=function(e,t){return e.start.line-t.start.line},me=["br","hr","area","base","img","input","link","meta","basefont","param","col","frame","embed","keygen","source"],pe={};me.forEach((e=>{pe[e]=!0}));var ge=class{constructor(e,t){this.editor=e,this.context=t,this.folds=new de(ue)}destroy(){this.editor=null,this.context=null,this.folds.empty()}onInsertContentAfter(e,t){let i=this.folds.toArray(),s=1/0;for(let r=0;r<i.length;r++){let t=i[r];if(!(t.start.line<e.line)){s=r;break}t.end.line>e.line&&this.editor.unFold(t.start.line)}if(t.line>e.line){i[s]&&i[s].start.line===e.line&&(this.editor.unFold(e.line),s++);for(let r=s;r<i.length;r++)i[r].start.line+=t.line-e.line,i[r].end.line+=t.line-e.line}}onDeleteContentAfter(e,t){let i=this.folds.toArray(),s=1/0;for(let r=0;r<i.length;r++){let n=i[r],o=n.start.line,a=n.end.line;if(!(o<=e.line)){s=r;break}o<e.line?(o>=t.line&&o<e.line||o<t.line&&a>t.line)&&this.editor.unFold(o):e.line>t.line&&this.editor.unFold(o)}if(e.line>t.line)for(let r=s;r<i.length;r++)i[r].start.line+=t.line-e.line,i[r].end.line+=t.line-e.line}foldLine(e){let t=this.getRangeFold(e);if(t){for(let e=t.start.line+1;e<t.end.line;e++){let i=this.getFoldByLine(e);i&&i.end.line>t.end.line&&this.editor.unFold(e)}this.folds.insert(t)}return t}unFold(e){let t=this.getFoldByLine(e);return t&&this.folds.delete(t),t}getFoldByLine(e){let t=this.folds.search(e,((e,t)=>e-t.start.line));return t&&t.next()}getLineInFold(e){let t=this.folds.search(e,((e,t)=>e-t.start.line),!0);if(t){let i=t.prev();if(i&&i.start.line<e&&i.end.line>e)return this.getLineInFold(i.start.line)||i}return!1}getRangeFold(e,t){let i=[],s=e,r=this.context.htmls[s-1],n=null;if(r.folds&&r.folds.length)for(let o=0;o<r.folds.length;o++){let e=r.folds[o];if(e.side<=0)i.push(e);else if(e.side>0)for(let t=i.length-1;t>=0;t--)if(i[t].side+e.side===0){i.splice(t,1);break}}if(i.length){let o="";if(n=i.peek(),n=Object.assign({line:s},n),o=r.text.slice(n.startIndex,n.endIndex),pe[o])return!1;if(n.type===v.CONST_DATA.LINE_COMMENT){let i=s,r=null;e=s+1;while(e<=this.context.htmls.length){let n=this.context.htmls[e-1],o=n.text.trimLeft(),a=n.text.length-o.length,l=n.folds&&n.folds[0];if(!l||l.type!==v.CONST_DATA.LINE_COMMENT||l.startIndex!==a)break;if(i=e,r=l,t&&i-s>1)return!0;e++}return t?i-s>1:{start:n,end:Object.assign({line:i},r)}}return this.getRangeFoldByStartFold(n,t)}return!1}getRangeFoldByStartFold(e,t){let i=e.line,s=[],r=null;while(i<=this.context.htmls.length&&(!t||i-e.line<=1)){let n=this.context.htmls[i-1];if(n.folds&&n.folds.length)for(let o=0;o<n.folds.length;o++){let a=n.folds[o];if(!(i===e.line&&a.startIndex<=e.startIndex))if(a.side===e.side)s.push(a);else if(e.side+a.side===0){if(0===s.length)return r={start:e,end:Object.assign({line:i},a)},t?i-e.line>1:r;s.pop()}}i++}return t?i-e.line>1:r}getBracketMatch(e,t){function i(e,t,s,r){let n=null,o=0,a=Date.now();while(s>=1){let i=this.context.htmls[s-1].folds;if(!i)return r(null);for(let o=i.length-1;o>=0;o--){let a=i[o];if(a.type!==v.CONST_DATA.TAG)if(a.side>0&&(s<e.line||a.endIndex<e.column))t.push(a);else if(a.side<0&&(s<e.line||a.startIndex<=e.column)){let e=!1;while(t.length)if(t.pop().side+a.side===0){e=!0;break}if(!e)return n=Object.assign({line:s},a),n=this.getRangeFoldByStartFold(n),void r(n)}}if(s--,o++,o>=50||Date.now()-a>2)break}s>=1&&e.line-s<5e3&&(this.getBracketMatchTask=H.scheduler.addTask((()=>{i.call(this,e,t,s,r)})))}e={line:e.line,column:e.column},H.scheduler.removeTask(this.getBracketMatchTask),i.call(this,e,[],e.line,t)}getRealLine(e){let t=0,i=1,s=1,r=this.folds.toArray();while(t<r.length&&i<e){let n=r[t];if(!(i+n.start.line-s<e))break;i+=n.start.line+1-s,s=n.end.line,t++;while(t<r.length&&r[t].end.line<=n.end.line)t++}return s+=e-i,s}getRelativeLine(e){let t=e,i=0,s=this.folds.toArray();while(i<s.length){let r=s[i];if(!(e>=r.end.line))break;t-=r.end.line-r.start.line-1,i++;while(i<s.length&&s[i].end.line<=r.end.line)i++}return t}},fe=class{constructor(e,t,i){this.editor=e,this.context=t,this.selecter=i,this.wordPattern=v.getWordPattern(this.editor.language),this.wholeWordPattern=new RegExp(`^(${this.wordPattern.source})$`),this.wordPattern=new RegExp(this.wordPattern.source,"g")}search(e){let t=null,i=0,s=0,r=this.hasCache(),n=null;if(e=e||{},r)t=this.getFromCache(e.direct,e.increase);else{if(n=e&&e.config||this.getSearchConfig(),!n||!n.text)return{now:0,count:0};t=this._search(n)}return t&&t.result&&(this.editor.searcher===this||e.increase?r?(this.editor.cursor.addCursorPos(t.result.end),this.selecter.addActive(t.result.end)):(0===this.selecter.activedRanges.size?this.editor.cursor.setCursorPos(t.result.end):this.initIndexs(),this.selecter.addRange(t.results)):r?(this.selecter.setActive(t.result.end),this.editor.cursor.setCursorPos(t.result.end),this.editor.searcher.clearSearch()):(this.selecter.addRange(t.results),this.clearActive()),i=t.now,s=t.results.length),{now:i,count:s}}_search(e){let t=null,i=null,s=null,r=null,n=null,o=[],a={},l=null,h=1,c=0,d=0,u=this.context.getAllText(),m=e.text.split(/\n/),p=e.text.replace(/\\|\.|\*|\+|\-|\?|\(|\)|\[|\]|\{|\}|\^|\$|\~|\!|\&|\|/g,"\\$&");this.wholeWordPattern.test(e.text)&&e.wholeWord&&(p="(?:\\b|(?<=[^0-9a-zA-Z]))"+p+"(?:\\b|(?=[^0-9a-zA-Z]))"),t=new RegExp("[^\n]*?("+p+")|[^\n]*?\n",e.matchCase?"mg":"img"),e=e||{};while(i=t.exec(u))i[1]?(s={line:h,column:c+i[0].length-i[1].length},r={line:h+m.length-1,column:m.length>1?m.peek().length:c+i[0].length},h=r.line,c=r.column,l={start:s,end:r},o.push(l),!n&&v.comparePos(r,this.editor.nowCursorPos)>=0&&(n=l,d=o.length-1,a[o.length-1]=!0)):(h++,c=0);return o.length?(!n&&o.length&&(d=0,n=o[0]),this.cacheData={config:e,results:o,indexs:a,index:d},{now:this.cacheData.index+1,results:o,result:n}):null}initIndexs(){let e=this.selecter.activedRanges.toArray();this.cacheData.indexs={},e.forEach((e=>{for(let t=0;t<this.cacheData.results.length;t++){let i=this.cacheData.results[t];if(0===v.comparePos(e.start,i.start)){this.cacheData.index=t,this.cacheData.indexs[t]=!0;break}}}))}refreshSearch(e){if(this.hasCache()||e)return new Promise((t=>{let i=this.refreshSearch.id+1||1;this.refreshSearch.id=i,this.editor.$nextTick((()=>{this.refreshSearch.id===i&&((this.hasCache()||e)&&(e=e||this.cacheData.config,this.clearSearch(),this.search({config:e})),t())}))}))}hasCache(){return!!this.cacheData}clearSearch(e){e?this.selecter.clearInactiveRange():this.selecter.clearRange(),this.cacheData=null}clearActive(){this.cacheData&&(this.cacheData.index=-1,this.cacheData.indexs={},this.selecter.clearActive())}setPrevActive(e){let t=this.cacheData.results,i=this.cacheData.index;this.cacheData.index=t.length-1;for(let s=t.length-1;s>=0;s--){let r=t[s],n=v.comparePos(r.end,e);if(n<0||-1===i&&0===n){this.cacheData.index=s;break}}}setNextActive(e){let t=this.cacheData.results,i=this.cacheData.index;this.cacheData.index=0;for(let s=0;s<t.length;s++){let r=t[s],n=v.comparePos(r.end,e);if(n>0||-1===i&&0===n){this.cacheData.index=s;break}}}removeNow(){this.cacheData.results.splice(this.cacheData.index,1),this.cacheData.index--}clone(e){this.cacheData=e,e&&this.selecter.addRange(e.results)}getCacheData(){return this.cacheData}getNowRange(){return this.cacheData.results[this.cacheData.index]}getFromCache(e,t){let i=this.cacheData.results,s=null,r=0;if(this.editor.fSearcher!==this||t){let t=this.cacheData.indexs,n=0;n="up"===e?-1:1,r=this.cacheData.index+n,r==i.length?r=0:r<0&&(r=i.length-1),t[r]?r=this.cacheData.index:(s=i[r],t[r]=!0,this.cacheData.index=r)}else"up"===e?this.setPrevActive(this.editor.nowCursorPos):this.setNextActive(this.editor.nowCursorPos),r=this.cacheData.index,s=this.cacheData.results[r],this.cacheData.indexs={i:!0};return{now:r+1,result:s,results:i}}getConfig(){if(this.cacheData)return Object.assign({},this.cacheData.config)}getSearchConfig(){let e=null,t=!1,i="",s=this.editor.searcher.selecter.getRangeByCursorPos(this.editor.nowCursorPos);return this.editor.searcher===this&&this.selecter.ranges.size>0?null:(s?i=this.context.getRangeText(s.start,s.end):(i=this.getNowWord().text,t=!0),i&&(e={text:i,wholeWord:t,matchCase:t}),e)}getNowWord(){let e=this.context.htmls[this.editor.nowCursorPos.line-1].text,t="",i=this.editor.nowCursorPos.column,s=i,r=i,n=null;while(n=this.wordPattern.exec(e)){if(n.index<=i&&n.index+n[0].length>=i){s=n.index,r=n.index+n[0].length,t=n[0];break}if(n.index>i)break}return this.wordPattern.lastIndex=0,{text:t,range:{start:{line:this.editor.nowCursorPos.line,column:s},end:{line:this.editor.nowCursorPos.line,column:r}}}}};const ve=function(e,t){let i=v.comparePos(e.start,t.start);return 0===i?v.comparePos(e.end,t.end):i};var be=class{constructor(e,t){this.editor=e,this.context=t,this.ranges=new de(ve),this.activedRanges=new de(ve)}destroy(){this.editor=null,this.context=null,this.ranges.empty(),this.activedRanges.empty()}getRange(e){let t=this.ranges.search(e);return t&&t.next()}getRangeByLine(e){let t=[],i=this.ranges.search({line:e,column:0},((e,t)=>v.comparePos(e,t.end)),!0);if(i){let s=i.next();while(s){if(s.start.line===e||s.end.line===e)t.push(s);else if(s.start.line>e)break;s=i.next()}}return t}getRangeByCursorPos(e){let t=this.ranges.search(e,((e,t)=>0===v.comparePos(e,t.start)||0===v.comparePos(e,t.end)?0:v.comparePos(e,t.start)));return t&&t.next()}getRangeWithCursorPos(e){let t=this.ranges.search(e,((e,t)=>v.comparePos(e,t.start)),!0);if(t){let i=t.prev();if(i&&v.comparePos(i.end,e)>=0)return i;if(t.reset(),i=t.next(),i&&0==v.comparePos(i.start,e))return i}return!1}select(e,t){this.editor.cursor.multiCursorPos.forEach((i=>{let s=this.getRangeByCursorPos(i);if(s){let r=s.start,n=s.end;this.editor.cursor.moveCursor(i,e,t),"left"===e?v.comparePos(i,s.start)<0?r=i:n=i:v.comparePos(i,s.end)>0?n=i:r=i,this.updateRange(s,{start:r,end:n})}else{let r=Object.assign({},i),n=this.editor.cursor.moveCursor(i,e,t);s=this.createRange(r,n),s&&this.addRange({start:r,end:n})}})),this.editor.renderSelectedBgAsync()}selectAll(){let e={line:this.context.htmls.length,column:this.context.htmls.peek().text.length};this.editor.setData("forceCursorView",!1),this.editor.cursor.setCursorPos(e),this.setRange({line:1,column:0},e),this.editor.renderSelectedBgAsync()}selectAllOccurence(){this.editor.cursor.clearCursorPos(),this.ranges.forEach((e=>{this.editor.cursor.addCursorPos(e.end),e.active||(e.active=!0,this.activedRanges.insert(e))})),this.editor.renderSelectedBgAsync()}addActive(e){let t=this.getRangeByCursorPos(e);t&&!t.active&&(t.active=!0,this.activedRanges.insert(t)),this.editor.renderSelectedBgAsync()}addRange(e){let t=[],i=e instanceof Array?e:[e];return i.forEach((e=>{let i=e.start,s=e.end,r=v.comparePos(i,s);if(r>0){let e=i;i=s,s=e}else if(!r)return;let n=this.editor.cursor.getCursorsByLineColumn(i.line,i.column)||this.editor.cursor.getCursorsByLineColumn(s.line,s.column);e={start:{line:i.line,column:i.column},end:{line:s.line,column:s.column},active:!!n};let o=this.getRange(e);o?(o.active||(o.active=n,this.activedRanges.insert(o)),t.push(o)):(this.ranges.insert(e),n&&this.activedRanges.insert(e),t.push(e),this.filterRange(e))})),this.editor.renderSelectedBgAsync(),e instanceof Array?t:t[0]}removeRange(e){e=this.ranges.delete(e),e&&(e.active&&this.activedRanges.delete(e),this.editor.cursor.removeCursor(e.start),this.editor.cursor.removeCursor(e.end),this.editor.renderSelectedBgAsync())}setRange(e,t){let i=v.comparePos(e,t);if(i>0){let i=e;e=t,t=i}else if(!i)return;let s=this.editor.cursor.getCursorsByLineColumn(e.line,e.column)||this.editor.cursor.getCursorsByLineColumn(t.line,t.column),r={start:Object.assign({},e),end:Object.assign({},t),active:!!s};return this.clearRange(),this.ranges.insert(r),s&&this.activedRanges.insert(r),this.editor.renderSelectedBgAsync(),r}setActive(e){let t=this.getRangeByCursorPos(e);this.activedRanges.forEach((e=>{e.active=!1})),this.activedRanges.empty(),t&&(t.active=!0,this.activedRanges.insert(t)),this.editor.renderSelectedBgAsync()}updateRange(e,t){let i=t.start,s=t.end,r=v.comparePos(i,s);if(r>0){let e=i;i=s,s=e}else if(!r)return!1;this.ranges.delete(e),e.start.line=i.line,e.start.column=i.column,e.end.line=s.line,e.end.column=s.column,this.ranges.insert(e),this.filterRange(e),this.editor.renderSelectedBgAsync()}filterRange(e){let t=this.ranges.search(e),i=[],s=t.prev();s&&v.comparePos(s.end,e.start)>0&&i.push(s),t.reset(),t.next(),s=t.next(),s&&v.comparePos(e.end,s.start)>0&&i.push(s),i.forEach((e=>{this.ranges.delete(e),this.activedRanges.delete(e),this.editor.cursor.removeCursor(e.start),this.editor.cursor.removeCursor(e.end)}))}createRange(e,t){let i=v.comparePos(e,t);if(i>0){let i=e;e=t,t=i}return 0===i?null:{start:e,end:t}}clearRange(){this.ranges.empty(),this.activedRanges.empty(),this.editor.renderSelectedBgAsync()}clearActive(){this.activedRanges.forEach((e=>{e.active=!1})),this.activedRanges.empty(),this.editor.renderSelectedBgAsync()}clearInactiveRange(){this.activedRanges.size?(this.ranges.forEach((e=>{e.active||this.ranges.delete(e)})),this.editor.renderSelectedBgAsync()):this.clearRange()}clone(e,t){t=t||[];let i={start:Object.assign({},e.start),end:Object.assign({},e.end)};return t.forEach((t=>{i[t]=e[t]})),i}};const ye={space:/\s/};var Ce=class{constructor(e,t){this.editor=e,this.context=t,this.multiCursorPos=new de(v.comparePos),this.multiKeyCode="ctrl",this.wordPattern=v.getWordPattern(this.editor.language),this.rightWrodPattern=new RegExp(`^(${this.wordPattern.source})`),this.leftWrodPattern=new RegExp(`(${this.wordPattern.source})$`)}destroy(){this.editor=null,this.context=null,this.multiCursorPos.empty()}addCursorPos(e){let t=this.getCursorsByLineColumn(e.line,e.column);return t?(this.editor.setNowCursorPos(t),t):(e={line:e.line,column:e.column},this.multiCursorPos.insert(e),this.editor.setNowCursorPos(e),e)}addCursorAbove(){this.multiCursorPos.forEach((e=>{if(e.line>1){let t=e.moveWidth||this.editor.getStrWidth(this.context.htmls[e.line-1].text,0,e.column),i=this.editor.getColumnByWidth(this.context.htmls[e.line-2].text,t),s=this.addCursorPos({line:e.line-1,column:i});s.moveWidth=t,this.editor.setNowCursorPos(s)}}))}addCursorBelow(){this.multiCursorPos.forEach((e=>{if(e.line<this.context.htmls.length){let t=e.moveWidth||this.editor.getStrWidth(this.context.htmls[e.line-1].text,0,e.column),i=this.editor.getColumnByWidth(this.context.htmls[e.line].text,t),s=this.addCursorPos({line:e.line+1,column:i});s.moveWidth=t,this.editor.setNowCursorPos(s)}}))}addCursorLineEnds(){this.editor.selecter.activedRanges.size&&(this.clearCursorPos(),this.editor.selecter.activedRanges.forEach((e=>{let t=e.start.line,i=e.end.line;while(t<i)this.addCursorPos({line:t,column:this.context.htmls[t-1].text.length}),t++;this.editor.setNowCursorPos(this.addCursorPos({line:i,column:this.context.htmls[i-1].text.length}))})),this.editor.searcher.clearSearch())}setCursorPos(e){if(e={line:e.line,column:e.column},1==this.multiCursorPos.size){let t=this.multiCursorPos.get(0);if(0===v.comparePos(t,e))return t}return this.multiCursorPos.empty(),this.multiCursorPos.insert(e),this.editor.setNowCursorPos(e),e}updateCursorPos(e,t,i){let s=this.getCursorsByLineColumn(e.line,e.column);return s===e&&this.multiCursorPos.delete(e),e.line=t,e.column=i,this.multiCursorPos.insert(e),e===this.editor.nowCursorPos?this.editor.setNowCursorPos(this.editor.nowCursorPos):this.editor.renderCursor(),e}removeCursor(e){e=this.getCursorsByLineColumn(e.line,e.column),e&&(e.del=!0,this.multiCursorPos.delete(e),e===this.editor.nowCursorPos&&this.editor.setNowCursorPos(null),this.editor.renderCursor())}removeCursorInRange(e){let t=this.multiCursorPos.search(e.start,null,!0);if(t){let i=null,s=[];while(i=t.next()){let t=v.comparePos(i,e.end);if(t>=0)break;v.comparePos(i,e.start)>0&&s.push(i)}s.forEach((e=>{e.del=!0,this.multiCursorPos.delete(e)})),this.editor.renderCursor()}}clearCursorPos(){this.multiCursorPos.forEach((e=>{e.del=!0})),this.multiCursorPos.empty(),this.editor.setNowCursorPos(null)}getCursorsByLine(e){let t=[],i=null,s=this.multiCursorPos.search({line:e,column:0},null,!0);if(s)while(i=s.next())if(i.line===e)t.push(i);else if(i.line>e)break;return t}getCursorsByLineColumn(e,t){let i=this.multiCursorPos.search({line:e,column:t});return i&&i.next()}moveCursor(e,t,i,s){let r=this.context.htmls[e.line-1].text,n=e.line,o=e.column;if("up"!==t&&"down"!==t&&(e.moveWidth=0),"home"===t)o=0;else if("end"===t)o=this.context.htmls[n-1].text.length;else if("up"===t){if(n>1){let t=e.moveWidth||this.editor.getStrWidth(r,0,o);e.moveWidth=t,n--,r=this.context.htmls[n-1].text,o=this.editor.getColumnByWidth(r,t)}}else if("down"===t){if(n<this.context.htmls.length){let t=e.moveWidth||this.editor.getStrWidth(r,0,o);e.moveWidth=t,n++,r=this.context.htmls[n-1].text,o=this.editor.getColumnByWidth(r,t)}}else if("left"===t){while(0===o&&n>1)n--,r=this.context.htmls[n-1].text,o=r.length;if(o>0)if(i){while(o&&r[o-1].match(ye.space))o--;if(o>0){let e=null,t=o;o--,r=r.slice(0,t),e=this.leftWrodPattern.exec(r),e&&(o=e.index)}}else e.line===n&&o--}else{while(o===r.length&&n<this.context.htmls.length)n++,o=0,r=this.context.htmls[n-1].text;if(o<r.length)if(i){while(o<r.length&&r[o].match(ye.space))o++;o<r.length&&(r=r.slice(o),r=this.rightWrodPattern.exec(r),r&&0==r.index?o+=r[0].length:o++)}else e.line===n&&o++}return!s&&this.updateCursorPos(e,n,o),{line:n,column:o}}switchMultiKeyCode(){this.multiKeyCode="ctrl"===this.multiKeyCode?"alt":"ctrl"}},we=class{constructor(e,t){this.editor=e,this.context=t,this.history=[],this.history.index=0}destroy(){this.editor=null,this.context=null,this.history=[]}undo(){if(this.history.index>0){let e=this.history[this.history.index-1];if(this.doCommand(e),this.history.index--,e.serial){let t=this.history[this.history.index-1];t&&t.serial===e.serial&&this.undo()}this.history.index===this.savedIndex&&y.$emit("editor-saved",this.editor.editorId)}}redo(){if(this.history.index<this.history.length){let e=this.history[this.history.index];if(this.history.index++,this.doCommand(e),e.serial){let t=this.history[this.history.index];t&&t.serial===e.serial&&this.redo()}this.history.index===this.savedIndex&&y.$emit("editor-saved",this.editor.editorId)}}doCommand(e){let t=e.type||(e instanceof Array?e[0].type:e.type);switch(t){case v.HISTORY_COMMAND.DELETE:this.editor.cursor.clearCursorPos(),this.context.deleteContent("left",e);break;case v.HISTORY_COMMAND.INSERT:if(this.editor.cursor.clearCursorPos(),e instanceof Array){var i=[];e.forEach((e=>{i.push(e.text)})),this.context.insertContent(i,e)}else this.context.insertContent(e.text,e);break;case v.HISTORY_COMMAND.DELETE_LINE:this.editor.cursor.clearCursorPos(),this.context.deleteLine(e);break;case v.HISTORY_COMMAND.INSERT_LINE:this.editor.cursor.clearCursorPos(),this.context.insertLine(e);break;case v.HISTORY_COMMAND.MOVEUP:this.editor.cursor.clearCursorPos(),this.context.moveLineUp(e);break;case v.HISTORY_COMMAND.MOVEDOWN:this.editor.cursor.clearCursorPos(),this.context.moveLineDown(e);break;case v.HISTORY_COMMAND.COPY_DOWN:this.editor.cursor.clearCursorPos(),this.context.copyLineDown(e);break;case v.HISTORY_COMMAND.DELETE_COPY_DOWN:this.editor.cursor.clearCursorPos(),this.context.deleteCopyLineDown(e);break;case v.HISTORY_COMMAND.COPY_UP:this.editor.cursor.clearCursorPos(),this.context.copyLineUp(e);break;case v.HISTORY_COMMAND.DELETE_COPY_UP:this.editor.cursor.clearCursorPos(),this.context.deleteCopyLineUp(e);break;case v.HISTORY_COMMAND.REPLACE:this.editor.cursor.clearCursorPos(),this.context.replace(e.text,e.cursorPos,e);break;case v.HISTORY_COMMAND.TAB_TO_SPACE:this.context.convertTabToSpace(e);break;case v.HISTORY_COMMAND.SPACE_TO_TAB:this.context.convertSpaceToTab(e);break}}pushHistory(e){while(this.history.length>this.history.index)this.history.pop();let t=this.history[this.history.index-1];if(e=this.sortComand(e),!(e instanceof Array)||e.length){if(t instanceof Array&&e instanceof Array&&t.length===e.length&&Date.now()-this.pushHistoryTime<2e3)if(i(t)&&i(e)&&s.call(this,t[0],e[0]))for(let i=0;i<t.length;i++)r(t[i],e[i]);else this.history.push(e);else s.call(this,t,e)?r(t,e):this.history.push(e);this.history.index=this.history.length,this.pushHistoryTime=Date.now()}function i(e){for(let t=1;t<e.length;t++)if(e[t].type!==e[t-1].type)return!1;return!0}function s(e,t){if((t.type==v.HISTORY_COMMAND.DELETE||t.type==v.HISTORY_COMMAND.INSERT)&&e&&e.type==t.type&&e.preCursorPos.line==t.cursorPos.line&&Date.now()-this.pushHistoryTime<2e3){if(e.type==v.HISTORY_COMMAND.DELETE&&0==v.comparePos(e.cursorPos,t.preCursorPos))return!0;if(e.type==v.HISTORY_COMMAND.INSERT&&(0==v.comparePos(e.cursorPos,t.preCursorPos)||0==v.comparePos(e.cursorPos,t.cursorPos)))return!0}}function r(e,t){e.type===v.HISTORY_COMMAND.DELETE?(t.preCursorPos.column-=e.cursorPos.column-e.preCursorPos.column,e.preCursorPos=t.preCursorPos,e.cursorPos=t.cursorPos):(e.cursorPos=t.cursorPos,t.keyCode===v.KEYCODE.DELETE?e.text=e.text+t.text:e.text=t.text+e.text)}}updateHistory(e){let t=this.history.index;e instanceof Array?e.forEach(((e,i)=>{e.keyCode=this.history[t-1][i].keyCode})):e.keyCode=this.history[t-1].keyCode,this.history[t-1]=this.sortComand(e)}sortComand(e){return e instanceof Array&&e.sort(((e,t)=>(e=e.cursorPos,t=t.cursorPos,e.line===t.line?e.column-t.column:e.line-t.line))),e}save(){this.savedIndex=this.history.index}clear(){this.history.empty(),this.history.index=0,this.savedIndex=0}};const xe={endTag:/(?=\<\/)/};class Te{constructor(e){this.editor=e,this.lineId=1,this.serial=1,this.reset()}reset(){this.htmls=[],this.fgLines=[],this.lineIdMap=new Map,this.htmls.push({lineId:this.lineId++,text:"",html:"",width:0,tabNum:-1,tokens:[],folds:[],states:[],stateFold:null}),this.lineIdMap.set(this.htmls[0].lineId,this.htmls[0])}setData(e,t){"function"!==typeof this[e]&&(this[e]=t)}destroy(){this.reset(),this.editor=null,this.allText="",cancelIdleCallback(this.setLineWidthTimer)}insertContent(e,t){let i=null,s=[],r=!1;if(t)t.forEach((e=>{s.push(e.cursorPos)}));else{if(this.editor.selecter.activedRanges.size){let e=this.deleteContent();e.serial=this.serial++,r=e.serial}s=this.editor.cursor.multiCursorPos.toArray()}return i=this._insertMultiContent(e,s,t),i.serial=r,t?(i.serial=t.serial,i.length&&this.editor.history.updateHistory(i)):this.editor.history.pushHistory(i),this.editor.setNowCursorPos(this.editor.cursor.multiCursorPos.get(0)),this.editor.fSearcher.refreshSearch(),i}_insertMultiContent(e,t,i){let s=null,r=null,n=[],o=e instanceof Array?e:e.split(/\r\n|\n/),a=0,l=0;return this.editor.cursor.clearCursorPos(),"\n"===e&&(o=["\n"]),t.forEach(((h,c)=>{let d=o.length===t.length?o[c]:e,u=i&&i[c]||{},m=u.margin||"right",p=u.active||!1,g={line:h.line,column:h.column};e&&(g.line+=a,s&&g.line===s.line?g.column+=l:l=0,r=this._insertContent(d,g,!i),n.push(r),s=r.cursorPos,r.margin=m,r.active=p,a+=r.cursorPos.line-r.preCursorPos.line,l+=r.cursorPos.column-r.preCursorPos.column,"right"===m?this.editor.cursor.addCursorPos(r.cursorPos):this.editor.cursor.addCursorPos(r.preCursorPos),p&&this.editor.selecter.addRange({start:r.preCursorPos,end:r.cursorPos}))})),n}_insertContent(e,t,i){let s=this.htmls[t.line-1],r=s.text,n=Object.assign({},t);if(t.moveWidth=0,e=e.split(/\r\n|\n/),e=e.map((e=>(e={lineId:this.lineId++,text:e,html:"",width:0,tabNum:-1,tokens:null,folds:null,states:null,stateFold:null},this.lineIdMap.set(e.lineId,e),e))),e.length>1){if(!e[0].text&&t.column===r.length&&i){let i=a.call(this,r,this.editor.folder.getRangeFold(t.line,!0));i&&(e[1].text=i+e[1].text.trimLeft())}n.column=e[e.length-1].text.length,e[0].text=r.slice(0,t.column)+e[0].text,e[e.length-1].text=e[e.length-1].text+r.slice(t.column),this.htmls=this.htmls.slice(0,t.line-1).concat(e).concat(this.htmls.slice(t.line))}else n.column+=e[0].text.length,e[0].text=r.slice(0,t.column)+e[0].text+r.slice(t.column),this.htmls.splice(t.line-1,1,e[0]);n.line+=e.length-1,this.editor.setData("maxLine",this.htmls.length),this.editor.lint.onInsertContentAfter(t.line,n.line),this.editor.tokenizer.onInsertContentAfter(t.line,n.line),this.editor.folder.onInsertContentAfter(Object.assign({},t),Object.assign({},n)),this.setLineWidth(e),this.editor.setErrors([]),this.editor.setAutoTip(null),this.editor.render(!0),this.contentChanged(),"!!"!==this.editor.tabData.status&&this.editor.differ.run();let o={type:v.HISTORY_COMMAND.DELETE,cursorPos:Object.assign({},n),preCursorPos:Object.assign({},t)};return o;function a(e,t){let i=0,s="",r=/^\s+/.exec(e);r&&(i=/\t+/.exec(r[0]),i=i&&i[0].length||0,i+=Math.ceil((r[0].length-i)/this.editor.tabSize)),i+=t?1:0;for(let n=0;n<i;n++)"tab"===this.editor.indent?s+="\t":s+=this.editor.space;return s}}deleteContent(e,t){let i=[],s=[];return t?s=t.map((e=>{let t={start:e.preCursorPos,end:e.cursorPos,margin:e.margin,active:e.active};return t})):this.editor.cursor.multiCursorPos.forEach((e=>{let t=this.editor.selecter.getRangeByCursorPos(e);t?(0===v.comparePos(t.start,e)?t.margin="left":t.margin="right",s.push(t)):s.push(e)})),i=this._deleteMultiContent(s,e),t?(i.serial=t.serial,this.editor.history.updateHistory(i),i.forEach((e=>{this.editor.cursor.addCursorPos(e.cursorPos)}))):i.length&&this.editor.history.pushHistory(i),this.editor.setNowCursorPos(this.editor.cursor.multiCursorPos.get(0)),this.editor.searcher.clearSearch(),this.editor.fSearcher.refreshSearch(),i}_deleteMultiContent(e,t){let i=[],s=null,r=null,n=0,o=0;return this.editor.cursor.clearCursorPos(),e.forEach((e=>{e.start&&e.end?l.call(this,e):a.call(this,e)})),i;function a(e){let a={line:e.line,column:e.column};a.line-=n,r&&a.line===r.line?a.column-=o:o=0,s=this._deleteContent(a,t),s.text&&i.push(s),r=s.cursorPos,n+=s.preCursorPos.line-r.line,o+=s.preCursorPos.column-r.column,this.editor.cursor.addCursorPos({line:r.line,column:r.column})}function l(e){let a=e.start,l=e.end;a.line-=n,l.line-=n,r&&a.line===r.line?(a.column-=o,a.line===l.line?l.column-=o:o=0):o=0,s=this._deleteContent(e,t),s.text&&i.push(s),r=s.cursorPos,n+=s.preCursorPos.line-r.line,o+=s.preCursorPos.column-r.column,this.editor.cursor.addCursorPos({line:r.line,column:r.column})}}_deleteContent(e,t){let i=null,s="right"===t?"left":"right";e.moveWidth=0,e.start&&e.end&&(i=e,e=i.end,s=i.margin);let r=null,n=this.htmls[e.line-1],o=n.text,a="",l=[n.lineId],h=Object.assign({},e),c=Object.assign({},e);if(i){let e=i.end,t=this.htmls[e.line-1];r=i.start,n=this.htmls[r.line-1],o=n.text,a=this.getRangeText(i.start,i.end),1==r.line&&e.line==this.editor.maxLine?(l=[this.editor.maxWidthObj.lineId],this.lineIdMap.clear()):l=this.htmls.slice(r.line-1,e.line).map((e=>(this.lineIdMap.delete(e.lineId),e.lineId))),this.lineIdMap.set(n.lineId,n),r.line==e.line?(o=o.slice(0,r.column)+o.slice(e.column),n.text=o):(o=o.slice(0,r.column),n.text=o,o=t.text,o=o.slice(e.column),n.text+=o,this.htmls.splice(r.line,e.line-r.line)),c.line=r.line,c.column=r.column}else if("right"===t)e.column==o.length?e.line<this.htmls.length&&(this.lineIdMap.delete(this.htmls[e.line].lineId),o=n.text+this.htmls[e.line].text,this.htmls.splice(e.line,1),a="\n",h={line:e.line-1,column:0}):(a=o[e.column],o=o.slice(0,e.column)+o.slice(e.column+1),h={line:e.line,column:e.column+1}),n.text=o;else{if(0==e.column){if(e.line>1){let t=this.htmls[e.line-2].text.length;this.lineIdMap.delete(this.htmls[e.line-2].lineId),o=this.htmls[e.line-2].text+o,this.htmls.splice(e.line-2,1),a="\n",c.line=e.line-1,c.column=t}}else a=o[e.column-1],o=o.slice(0,e.column-1)+o.slice(e.column),c.column=e.column-1;n.text=o}n.width=this.editor.getStrWidth(n.text),n.tabNum=-1,n.html="",n.tokens=null,n.folds=null,n.states=null,n.stateFold=null,this.editor.setData("maxLine",this.htmls.length),this.editor.lint.onDeleteContentAfter(h.line,c.line),this.editor.tokenizer.onDeleteContentAfter(h.line,c.line),this.editor.folder.onDeleteContentAfter(Object.assign({},h),Object.assign({},c)),this.editor.setErrors([]),this.editor.setAutoTip(null),this.editor.render(!0),this.contentChanged(),"!!"!==this.editor.tabData.status&&this.editor.differ.run(),n.width>=this.editor.maxWidthObj.width?this.editor.setData("maxWidthObj",{lineId:n.lineId,text:n.text,width:n.width}):l.indexOf(this.editor.maxWidthObj.lineId)>-1&&this.setMaxWidth();let d={type:v.HISTORY_COMMAND.INSERT,cursorPos:Object.assign({},c),preCursorPos:Object.assign({},h),text:a,direct:t,margin:s,active:i&&i.active};return d}insertLineUp(){let e=[],t={},i=!1;this.editor.cursor.multiCursorPos.forEach((s=>{t.line!==s.line&&(1===s.line?(e.push({line:s.line,column:0}),i=!0):e.push({line:s.line-1,column:this.htmls[s.line-2].text.length})),t=s})),this.editor.history.pushHistory(this._insertMultiContent("\n",e)),i&&this.editor.cursor.updateCursorPos(this.editor.cursor.multiCursorPos.get(0),1,0)}insertLineDown(){let e=[],t={};this.editor.cursor.multiCursorPos.forEach((i=>{t.line!==i.line&&e.push({line:i.line,column:this.htmls[i.line-1].text.length}),t=i})),this.editor.history.pushHistory(this._insertMultiContent("\n",e))}deleteWord(e){if(this.editor.selecter.size>0)this.deleteContent(e);else{let t=null,i=[];this.editor.cursor.multiCursorPos.forEach((s=>{if("left"===e){let r={line:s.line,column:s.column},n=this.editor.cursor.moveCursor(s,e,!0,!0);t&&0===v.comparePos(t.start,n)?t.end=r:v.comparePos(n,r)<0&&(t={start:n,end:r},i.push(t))}else if("right"===e){let r={line:s.line,column:s.column},n=this.editor.cursor.moveCursor(s,e,!0,!0);if(t&&0===v.comparePos(t.end,n))return;v.comparePos(n,r)>0&&(t={start:r,end:n},i.push(t))}})),i.length&&this.editor.history.pushHistory(this._deleteMultiContent(i,e))}}moveLineUp(e){this.moveLine(e,"up")}moveLineDown(e){this.moveLine(e,"down")}moveLine(e,t){let i=[],s=[],r=0,n=null,o=null;e?(o=e.searchConifg,i=e.cursorPos):(o=this.editor.searcher.getConfig(),i=[],this.editor.cursor.multiCursorPos.toArray().forEach((e=>{let s=this.editor.selecter.getRangeByCursorPos(e),r=!0,o=s?s.start.line:e.line;if(n){let e=n.end?n.end.line:n.line;e+1!==o&&e!==o||(s&&this.editor.selecter.removeRange(s),r=!1)}if(r){var a=s&&s.end.line||o;1===o&&"up"===t||a===this.editor.maxLine&&"down"===t?r=!1:(s?(s.margin=0===v.comparePos(s.start,e)?"left":"right",n=s):n=e,i.push(n))}})));while(r<i.length){let e=i[r],n=e.start?e:null;this._moveLine(e,t);let o="down"===t?1:-1;n?(n.start.line=n.start.line+o,n.end.line=n.end.line+o):e.line=e.line+o,s.push(n?this.editor.selecter.clone(n,["margin"]):Object.assign({},e)),r++}if(!s.length)return;this.editor.searcher.clearSearch(),this.editor.cursor.clearCursorPos(),s.forEach((e=>{e.start?(this.editor.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.editor.selecter.addRange(e)):this.editor.cursor.addCursorPos(e)}));let a={type:"down"===t?v.HISTORY_COMMAND.MOVEUP:v.HISTORY_COMMAND.MOVEDOWN,cursorPos:s,searchConifg:o};e?(this.editor.history.updateHistory(a),this.editor.searcher.refreshSearch(e.searchConifg)):(this.editor.history.pushHistory(a),this.editor.searcher.refreshSearch(o)),this.editor.fSearcher.refreshSearch()}_moveLine(e,t){let i=e.start?e:null,s=0,r=0,n="";i?(n=this.htmls.slice(i.start.line-1,i.end.line).map((e=>e.text)).join("\n"),"down"===t?(s=i.start.line,r=i.end.line+1,n=this.htmls[r-1].text+"\n"+n):(s=i.start.line-1,r=i.end.line,n=n+"\n"+this.htmls[s-1].text)):(s=e.line-("down"===t?0:1),r=s+1,n=this.htmls[r-1].text+"\n"+this.htmls[s-1].text);let o={line:s,column:0},a={line:r,column:this.htmls[r-1].text.length};this._deleteContent({start:o,end:a}),this._insertContent(n,o)}copyLineUp(e){this.copyLine(e,"up")}copyLineDown(e){this.copyLine(e,"down")}copyLine(e,t){let i=[],s=[],r=[],n=null,o=[],a=null;e?(a=e.searchConifg,i=e.cursorPos):(a=this.editor.searcher.getConfig(),i=[],this.editor.cursor.multiCursorPos.toArray().forEach((e=>{let t=this.editor.selecter.getRangeByCursorPos(e),s=t&&t.start.line||e.line,r=!0;if(n){let e=n.end?n.end.line:n.line;e===s&&(r=!1)}r&&(t?(t.margin=0===v.comparePos(t.start,e)?"left":"right",n=t):n=e,i.push(n))}))),i.forEach((e=>{let t=0,i="";e.end?(t=e.start.line-1,i=this.htmls.slice(e.start.line-1,e.end.line).map((e=>e.text)).join("\n")):(t=e.line-1,i=this.htmls[e.line-1].text),t=t<1?1:t,i="\n"+i,o.push(i),s.push({line:t,column:this.htmls[t-1].text.length})})),this._insertMultiContent(o,s).forEach(((e,s)=>{let n=0,o=i[s];if(n=e.cursorPos.line,"down"===t&&(n+=o.start?o.end.line-o.start.line+1:1),o.start){let e=o.end.line-o.start.line;o.end.line=n,o.start.line=n-e}else o.line=n;r.push(o.start?this.editor.selecter.clone(o,["margin"]):Object.assign({},o))})),this.editor.searcher.clearSearch(),this.editor.cursor.clearCursorPos(),r.forEach((e=>{e.start?(this.editor.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.editor.selecter.addRange(e)):this.editor.cursor.addCursorPos(e)}));let l={type:"down"===t?v.HISTORY_COMMAND.DELETE_COPY_DOWN:v.HISTORY_COMMAND.DELETE_COPY_UP,cursorPos:r,searchConifg:a};e?(this.editor.history.updateHistory(l),this.editor.searcher.refreshSearch(e.searchConifg)):(this.editor.history.pushHistory(l),this.editor.searcher.refreshSearch(a)),this.editor.fSearcher.refreshSearch()}deleteCopyLineUp(e){this.deleteCopyLine(e,"up")}deleteCopyLineDown(e){this.deleteCopyLine(e,"down")}deleteCopyLine(e,t){let i=[],s=[],r=[];i=e.cursorPos,i.forEach((e=>{let t=0,i=0,r=null,n=0,o=0;e.end?(t=e.start.line-1,i=e.end.line):(t=e.line-1,i=e.line),o=this.htmls[i-1].text.length,t<1?(t=1,i<this.editor.maxLine&&(i++,o=0)):n=this.htmls[t-1].text.length,r={start:{line:t,column:n},end:{line:i,column:o}},s.push(r)})),this._deleteMultiContent(s).forEach(((e,s)=>{let n=i[s];if(n.start){let i=n.end.line-n.start.line;"up"===t?(n.start.line=e.cursorPos.line+(1===n.start.line?0:1),n.end.line=n.start.line+i):(n.end.line=e.cursorPos.line,n.start.line=n.end.line-i)}else n.line="up"===t?e.cursorPos.line+(1===n.line?0:1):e.cursorPos.line;r.push(n.start?this.editor.selecter.clone(n,["margin"]):Object.assign({},n))})),this.editor.searcher.clearSearch(),this.editor.cursor.clearCursorPos(),r.forEach((e=>{e.start?(this.editor.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.editor.selecter.addRange(e)):this.editor.cursor.addCursorPos(e)}));let n={type:"down"===t?v.HISTORY_COMMAND.COPY_UP:v.HISTORY_COMMAND.COPY_DOWN,cursorPos:r,searchConifg:e.searchConifg};this.editor.history.updateHistory(n),this.editor.searcher.refreshSearch(e.searchConifg),this.editor.fSearcher.refreshSearch()}insertLine(e){let t=e.searchConifg,i=e.cursorPos,s=e.text,r=[];i.forEach((e=>{let t=e.start?e.start.line-1:e.line-1;t=t<1?1:t,r.push({line:t,column:this.htmls[t-1].text.length})})),this._insertMultiContent(s,r),this.editor.searcher.clearSearch(),this.editor.cursor.clearCursorPos(),i.forEach((e=>{e.start?(this.editor.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.editor.selecter.addRange(e)):this.editor.cursor.addCursorPos(e)}));let n={type:v.HISTORY_COMMAND.DELETE_LINE,cursorPos:i,searchConifg:t};this.editor.history.updateHistory(n),this.editor.searcher.refreshSearch(e.searchConifg),this.editor.fSearcher.refreshSearch()}deleteLine(e){let t=[],i=[],s=[],r=null,n=[],o=null;e?(o=e.searchConifg,t=e.cursorPos):(o=this.editor.searcher.getConfig(),this.editor.cursor.multiCursorPos.forEach((e=>{let i=this.editor.selecter.getRangeByCursorPos(e),s=i&&i.start.line||e.line,n=!0;if(r){let e=r.end?r.end.line:r.line;e===s&&(n=!1)}n&&(i?(i.margin=0===v.comparePos(i.start,e)?"left":"right",r=i):r=e,t.push(r))}))),t.forEach((e=>{let t=0,s=0,r=null,o=0,a=0;e.end?(t=e.start.line-1,s=e.end.line):(t=e.line-1,s=e.line),a=this.htmls[s-1].text.length,t<1?(t=1,s<this.editor.maxLine&&(s++,a=0)):o=this.htmls[t-1].text.length,r={start:{line:t,column:o},end:{line:s,column:a}},n.push(this.getRangeText(r.start,r.end)),i.push(r)})),this._deleteMultiContent(i).forEach(((e,i)=>{let r=t[i],n=e.cursorPos.line,o=t[i].column;r.start&&(o="left"===r.margin?r.start.column:r.end.column),o=o>this.htmls[n-1].text.length?this.htmls[n-1].text.length:o,s.push({line:n,column:o})})),this.editor.searcher.clearSearch(),this.editor.cursor.clearCursorPos(),s.forEach((e=>{this.editor.cursor.addCursorPos(e)}));let a={type:v.HISTORY_COMMAND.INSERT_LINE,cursorPos:t,text:n,searchConifg:o};e?(this.editor.history.updateHistory(a),this.editor.searcher.refreshSearch(e.searchConifg)):this.editor.history.pushHistory(a),this.editor.fSearcher.refreshSearch()}reload(e){let t={start:{line:1,column:0},end:{line:this.htmls.length,column:this.htmls.peek().text.length}};this.editor.searcher.clearSearch(),this.replace(e,[t])}replace(e,t){let i=null,s=this.serial++;return i=this._deleteMultiContent(t),i.serial=s,i.length&&this.editor.history.pushHistory(i),i=this._insertMultiContent(e,this.editor.cursor.multiCursorPos.toArray()),i.serial=s,i.length&&this.editor.history.pushHistory(i),this.editor.fSearcher.refreshSearch()}replaceTip(e){let t=e.word||"",i=e.after||"",s=e.before||"",r=s+o(e)+i,n=null;function o(e){let t="";if(e.type===w.TOKEN_TYPE.EMMET_HTML||e.type===w.TOKEN_TYPE.EMMET_CSS)try{const i={};e.type===w.TOKEN_TYPE.EMMET_CSS&&(i.type="stylesheet"),t=(0,re.ZP)(e.result,i)}catch(Er){t=e.result}else e.type===w.TOKEN_TYPE.TAG_NAME?t+=e.result+`></${e.result}>`:t=e.result;return t}function a(){let e=[];return this.editor.cursor.multiCursorPos.forEach((i=>{let s=null;s={start:{line:i.line,column:i.column-t.length},end:{line:i.line,column:i.column}},e.push(s)})),e}function l(){if(e.type===w.TOKEN_TYPE.TAG_NAME||e.type===w.TOKEN_TYPE.EMMET_HTML){let e=xe.endTag.exec(r);if(e){let t=r.slice(e.index),i=t.split("\n"),s=this.editor.cursor.multiCursorPos.toArray();for(let e=s.length-1;e>=0;e--){let t=h.call(this,i,s[e]);this.editor.cursor.updateCursorPos(s[e],t.line,t.column)}}}else e.type===w.TOKEN_TYPE.ATTR_NAME&&this.editor.cursor.multiCursorPos.forEach((e=>{this.editor.cursor.moveCursor(e,"left")}))}function h(e,t){let i=t.line,s=t.column;return 1===e.length?s-=e[0].length:(i-=e.length-1,s=this.htmls[i-1].text.length-e[0].length),{line:i,column:s}}r!==t&&(n=a.call(this),this.replace(r,n),l.call(this),e.type===w.TOKEN_TYPE.CSS_PROPERTY&&this.editor.autocomplete.search())}convertTabToSpace(e){let t=!1,i=this.editor.tabSize,s=this.editor.space;function r(e){let t=0,i=/^\s+/.exec(e);if(i){i=i[0];for(let e=0;e<i.length;e++)"\t"===i[e]&&t++}return t}function n(e){let t=this.htmls[e.line-1].text.slice(0,e.column),s=r(t);s&&(s*=i-1,e.column+=s)}e&&(i=e.tabSize,s=e.space),this.editor.cursor.multiCursorPos.forEach((e=>{n.call(this,e)})),this.editor.selecter.ranges.forEach((e=>{n.call(this,e.start),n.call(this,e.end)})),this.editor.fSelecter.ranges.forEach((e=>{n.call(this,e.start),n.call(this,e.end)})),this.editor.folder.folds.forEach((e=>{let t=this.htmls[e.start.line-1].text,s=r(t);s&&(s*=i-1,e.start.startIndex+=s,e.start.endIndex+=s),t=this.htmls[e.end.line-1].text,s=r(t),s&&(s*=i-1,e.end.startIndex+=s,e.end.endIndex+=s)})),this.htmls.forEach((e=>{let n=r(e.text);n*=i-1,n>0&&(e.tokens&&e.tokens.forEach(((e,t)=>{t>0&&(e.startIndex+=n),e.endIndex+=n})),e.folds&&e.folds.forEach((e=>{e.startIndex+=n,e.endIndex+=n})),e.stateFold&&(e.stateFold.startIndex+=n,e.stateFold.endIndex+=n),e.text=e.text.replace(/(?<=^\s*)\t/g,s),e.html="",e.tabNum=-1,t=!0)})),t&&(this.contentChanged(),y.$emit("indent-change","space"),"!!"!==this.editor.tabData.status&&this.editor.differ.run(),this.editor.render(),e?this.editor.history.updateHistory({type:v.HISTORY_COMMAND.SPACE_TO_TAB,tabSize:i,space:s}):this.editor.history.pushHistory({type:v.HISTORY_COMMAND.SPACE_TO_TAB,tabSize:i,space:s}))}convertSpaceToTab(e){let t=!1,i=this.editor.tabSize,s=this.editor.space;e&&(i=e.tabSize,s=e.space);let r=new RegExp(`^(\\t|${s})+`),n=new RegExp(`(?<=^\\s*)${s}`,"g");function o(e){let t=0,i=e.match(n);return t=i&&i.length,t}function a(e){let t=this.htmls[e.line-1].text,n=t.slice(0,e.column),a=o(n);if(a*=i-1,a){let i=r.exec(n)[0].length;e.column>i&&t.slice(i,i+4)===s?e.column=i-a+1:e.column-=a}}this.editor.cursor.multiCursorPos.forEach((e=>{a.call(this,e)})),this.editor.selecter.ranges.forEach((e=>{a.call(this,e.start),a.call(this,e.end)})),this.editor.fSelecter.ranges.forEach((e=>{a.call(this,e.start),a.call(this,e.end)})),this.editor.folder.folds.forEach((e=>{let t=this.htmls[e.start.line-1].text,s=o(t);s&&(s*=i-1,e.start.startIndex-=s,e.start.endIndex-=s),t=this.htmls[e.end.line-1].text,s=o(t),s&&(s*=i-1,e.end.startIndex-=s,e.end.endIndex-=s)})),this.htmls.forEach((e=>{let s=o(e.text);s*=i-1,s>0&&(e.tokens&&e.tokens.forEach(((e,t)=>{t>0&&(e.startIndex-=s),e.endIndex-=s})),e.folds&&e.folds.forEach((e=>{e.startIndex-=s,e.endIndex-=s})),e.stateFold&&(e.stateFold.startIndex-=s,e.stateFold.endIndex-=s),e.text=e.text.replace(n,"\t"),e.html="",e.tabNum=-1,t=!0)})),t&&(this.contentChanged(),y.$emit("indent-change","tab"),"!!"!==this.editor.tabData.status&&this.editor.differ.run(),this.editor.render(),e?this.editor.history.updateHistory({type:v.HISTORY_COMMAND.TAB_TO_SPACE,tabSize:i,space:s}):this.editor.history.pushHistory({type:v.HISTORY_COMMAND.TAB_TO_SPACE,tabSize:i,space:s}))}contentChanged(){this.allText="",y.$emit("editor-content-change",{id:this.editor.editorId,path:this.editor.tabData.path})}setMaxWidth(){let e=0,t=Date.now(),i={line:this.htmls[0].lineId,width:0};function s(){while(e<this.htmls.length){let s=this.htmls[e];if(s.width>i.width&&(i={lineId:s.lineId,text:s.text,width:s.width}),e++,Date.now()-t>20)break}e<this.htmls.length?this.setMaxWidthTimer=setTimeout((()=>{s.call(this)}),20):this.editor.setData("maxWidthObj",i)}clearTimeout(this.setMaxWidthTimer),s.call(this)}setLineWidth(e){let t=0,i=this.editor.maxWidthObj;function s(){let r=Date.now(),n=0,o=5;while(t<e.length){let s=e[t];if(this.lineIdMap.has(s.lineId)){let e=this.editor.getStrWidth(s.text);s.width=e,e>i.width&&(i={lineId:s.lineId,text:s.text,width:e})}if(t++,n++,n>=o&&Date.now()-r>=5)break}this.editor.setData("maxWidthObj",i),t<e.length&&(this.setLineWidthTask=H.scheduler.addTask((()=>{s.call(this)})))}H.scheduler.removeTask(this.setLineWidthTask),s.call(this)}getRangeText(e,t){var i=this.htmls[e.line-1].text;if(e.line!=t.line){let s=[];i=i.slice(e.column),s=this.htmls.slice(e.line,t.line-1),s=s.map((e=>e.text)),i+=s.length?"\n"+s.join("\n"):"",t.line<=this.editor.maxLine&&(i+="\n"+this.htmls[t.line-1].text.slice(0,t.column))}else i=i.slice(e.column,t.column);return i}getCopyText(e){let t="",i=null,s=[];if(this.editor.cursor.multiCursorPos.forEach((e=>{let t=this.editor.selecter.getRangeByCursorPos(e),r=null;t?s.push(t):i&&e.line===i.line||(r=e.line>1?{line:e.line-1,column:this.htmls[e.line-2].text.length}:{line:e.line,column:0},t={start:r,end:{line:e.line,column:this.htmls[e.line-1].text.length}},s.push(t),i=e)})),s.forEach((e=>{let i=this.getRangeText(e.start,e.end);t="\n"===i[0]?t+=i:t+="\n"+i})),e){let e=this._deleteMultiContent(s);e.length&&this.editor.history.pushHistory(e),this.editor.searcher.clearSearch(),this.editor.fSearcher.refreshSearch()}return t.slice(1)}getAllText(){return this.allText||(this.allText=this.htmls.map((e=>e.text)).join("\n")),this.allText}}Te.contexts={};var ke=Te,Le=class{constructor(e,t){this.editor=e,this.context=t}onKeydown(e){if(e.ctrlKey&&e.shiftKey){switch(e.code){case"Enter":e.preventDefault(),this.context.insertLineUp();break;case"ArrowLeft":e.preventDefault(),this.editor.selecter.select("left",!0);break;case"ArrowUp":e.preventDefault(),this.context.moveLineUp();break;case"ArrowRight":e.preventDefault(),this.editor.selecter.select("right",!0);break;case"ArrowDown":e.preventDefault(),this.context.moveLineDown();break;case"KeyD":e.preventDefault(),this.context.copyLineUp();break;case"KeyH":e.preventDefault(),y.$emit("editor-format",H.nowEditorId);break;case"KeyK":e.preventDefault(),this.context.deleteLine();break;case"KeyL":e.preventDefault(),this.editor.cursor.addCursorLineEnds();break}return!1}if(e.ctrlKey&&e.altKey)switch(e.code){case"ArrowUp":e.preventDefault(),this.editor.cursor.addCursorAbove();break;case"ArrowDown":e.preventDefault(),this.editor.cursor.addCursorBelow();break}else if(e.altKey&&e.shiftKey)switch(e.code){case"ArrowDown":e.preventDefault(),this.context.copyLineDown();break}else if(e.ctrlKey)switch(e.code){case"Enter":e.preventDefault(),this.context.insertLineDown();break;case"ArrowLeft":e.preventDefault(),t.call(this,"left",!0);break;case"ArrowRight":e.preventDefault(),t.call(this,"right",!0);break;case"KeyA":e.preventDefault(),this.editor.selecter.selectAll();break;case"KeyD":e.preventDefault(),this.editor.searchWord("down");break;case"KeyF":e.preventDefault(),this.editor.openSearch();break;case"KeyH":e.preventDefault(),this.editor.openSearch(!0);break;case"KeyZ":e.preventDefault(),this.editor.history.undo();break;case"KeyY":e.preventDefault(),this.editor.history.redo();break;case"Delete":e.preventDefault(),this.context.deleteWord("right"),this.editor.autocomplete.search();break;case"Backspace":e.preventDefault(),this.context.deleteWord("left"),this.editor.autocomplete.search();break}else if(e.shiftKey)switch(e.code){case"ArrowLeft":e.preventDefault(),this.editor.selecter.select("left");break;case"ArrowUp":e.preventDefault(),this.editor.selecter.select("up");break;case"ArrowRight":e.preventDefault(),this.editor.selecter.select("right");break;case"ArrowDown":e.preventDefault(),this.editor.selecter.select("down");break}else switch(e.code){case"Tab":e.preventDefault(),this.editor.autocomplete.emmet();break;case"ArrowLeft":e.preventDefault(),t.call(this,"left");break;case"End":e.preventDefault(),t.call(this,"end");break;case"Home":e.preventDefault(),t.call(this,"home");break;case"ArrowUp":e.preventDefault(),this.editor.autoTipList&&this.editor.autoTipList.length?this.editor.prevAutoTip():t.call(this,"up");break;case"ArrowRight":e.preventDefault(),t.call(this,"right");break;case"ArrowDown":e.preventDefault(),this.editor.autoTipList&&this.editor.autoTipList.length?this.editor.nextAutoTip():t.call(this,"down");break;case"Enter":this.editor.autoTipList&&this.editor.autoTipList.length&&(e.preventDefault(),this.editor.selectAutoTip());break;case"Delete":e.preventDefault(),this.context.deleteContent("right"),this.editor.autocomplete.search();break;case"Backspace":e.preventDefault(),this.context.deleteContent("left"),this.editor.autocomplete.search();break}function t(e,t){this.editor.selecter.getRangeByCursorPos(this.editor.nowCursorPos)||this.editor.cursor.multiCursorPos.forEach((i=>{this.editor.cursor.moveCursor(i,e,t)})),this.editor.setAutoTip(null),this.editor.searcher.clearSearch(),this.editor.fSearcher.clearActive()}}},Se=function(){var e=this,t=e._self._c;return t("Menu",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})},Pe=[],Ee=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.allMenuList.length,expression:"allMenuList.length"}],ref:"scroller",staticClass:"my-menu my-shadow my-border",style:e.styles,on:{mousedown:function(e){e.stopPropagation()},mouseenter:e.showScrollBar,mouseleave:e.hideScrollBar,mousemove:e.showScrollBar,wheel:function(t){return t.stopPropagation(),e.onWheel.apply(null,arguments)}}},[t("div",{staticClass:"my-menu-scroller",style:{height:e.menuHeight+"px"}},[t("div",{ref:"content",staticClass:"my-menu-content",style:{top:-e.deltaTop+"px"}},[e._l(e.renderList,(function(i){return[t("div",{staticClass:"my-menu-item my-center-between my-hover",class:{"my-active":e.checkable&&i.active,disabled:i.disabled},on:{mousedown:function(t){return e.onClick(i)},mouseover:function(t){return e.onHover(i)}}},[t("div",{staticClass:"my-menu-left"},[e.leftSelect?t("span",{staticClass:"my-menu-left-select"},[i.selected?t("span",{staticClass:"my-icon my-icon-check"}):e._e()]):e._e(),t("span",{class:[i.icon]}),i._name?t("span",{staticClass:"my-menu-title",domProps:{innerHTML:e._s(i._name)}}):t("span",{staticClass:"my-menu-title"},[e._v(e._s(i.name))]),i._desc?t("span",{staticClass:"my-menu-desc",domProps:{innerHTML:e._s(i._desc)}}):t("span",{staticClass:"my-menu-desc"},[e._v(e._s(i.desc))])]),t("div",{staticClass:"my-center-start"},[i.shortcut?t("div",{staticClass:"my-menu-shortcut"},["ignore"!=i.shortcut?t("span",[e._v(e._s(i.shortcut))]):e._e()]):e._e(),i.selected&&!e.leftSelect?t("span",{staticClass:"my-icon my-icon-check",staticStyle:{"margin-left":"15px"}}):e._e()])]),i.seprator?t("div",{staticClass:"my-separator"}):e._e()]}))],2),t("v-scroll-bar",{class:{"my-scroll-visible":e.scrollVisible},attrs:{height:e.contentHeight,"scroll-top":e.scrollTop},on:{scroll:e.onScroll}})],1)])},Ie=[],_e=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e._vScrollAble,expression:"_vScrollAble"}],ref:"bar",staticClass:"my-scroll-bar-v",class:{"my-scroll-clicked":e.vSliderClicked},on:{mousedown:e.onVBarDown}},[t("div",{staticClass:"my-scroll-slider",style:{height:e._vSliderHeight+"px",top:e._vSliderTop+"px"},on:{mousedown:e.onVsliderDown}})])},De=[],Me={name:"VScrollBar",props:{height:{type:Number,default:0},scrollTop:{type:Number,default:0}},data(){return{barHeight:0,vSliderClicked:!1}},computed:{_vSliderHeight(){let e=this.barHeight/this.height*this.barHeight;return e>20?e:20},_vSliderTop(){let e=this.barHeight-this._vSliderHeight,t=this.height-this.barHeight;return this.scrollTop*e/t},_vScrollAble(){return this.height>this.barHeight}},created(){},mounted(){this.barHeight=this.$refs.bar.clientHeight,this.initResizeEvent(),this.initEvent()},destroyed(){this.unbindEvent(),globalData.scheduler.removeUiTask(this.moveHsliderTask)},methods:{initResizeEvent(){const e=new ResizeObserver((e=>{this.$refs.bar&&this.$refs.bar.clientHeight&&(this.barHeight=this.$refs.bar.clientHeight)}));e.observe(this.$refs.bar)},initEvent(){this.initEventFn1=e=>{this.onDocumentMouseMove(e)},this.initEventFn2=e=>{this.onDocumentMouseUp(e)},document.addEventListener("mousemove",this.initEventFn1),document.addEventListener("mouseup",this.initEventFn2)},unbindEvent(){document.removeEventListener("mousemove",this.initEventFn1),document.removeEventListener("mouseup",this.initEventFn2)},getScrollTop(e){let t=this.barHeight-this._vSliderHeight,i=this.height-this.barHeight;return e*(i/t)},onVBarDown(e){if(!this.vSliderClicked){let t=e.offsetY-this._vSliderHeight/2;t>this.barHeight-this._vSliderHeight&&(t=this.barHeight-this._vSliderHeight),t=t<0?0:t,this.$emit("scroll",this.getScrollTop(t)),this.$nextTick((()=>{this.onVsliderDown(e)}))}},onVsliderDown(e){this.vSliderMouseObj=e,this.startVSliderTop=this._vSliderTop,this.vSliderClicked=!0},onDocumentMouseMove(e){if(this.vSliderMouseObj){let t=this.barHeight-this._vSliderHeight,i=e.clientY-this.vSliderMouseObj.clientY,s=this.startVSliderTop;s+=i,s=s<0?0:s,s=s>t?t:s,this.startVSliderTop+=i,this.vSliderMouseObj=e,this.moveScrollTop=this.getScrollTop(s),this.moveScrollTop&&!this.moveVsliderTask&&(this.moveVsliderTask=globalData.scheduler.addUiTask((()=>{this.moveScrollTop>=0&&this.moveScrollTop!==this.scrollTop?(this.$emit("scroll",this.moveScrollTop),this.moveScrollTop=-1):(globalData.scheduler.removeUiTask(this.moveVsliderTask),this.moveVsliderTask=null)})))}},onDocumentMouseUp(e){globalData.scheduler.removeUiTask(this.moveVsliderTask),this.vSliderClicked=!1,this.vSliderMouseObj=null,this.moveVsliderTask=null}}},$e=Me,Fe=i(1),Oe=(0,Fe.Z)($e,_e,De,!1,null,null,null),Be=Oe.exports,Ae={name:"Menu",props:{menuList:{type:Array,default:[]},styles:{type:Object},leftSelect:{type:Boolean,default:!1},checkable:{type:Boolean,default:!0},hoverCheck:{type:Boolean,default:!1},top:{type:Number,default:0}},components:{VScrollBar:Be},data(){return{index:-1,itemHeight:30,menuHeight:0,contentHeight:0,deltaTop:0,scrollTop:0,startLine:1,maxVisibleLines:1,groups:0,scrollVisible:!1,allMenuList:[],renderList:[]}},watch:{menuList(){this.initMenu()},index(){this.$nextTick((()=>{this.scrollToIndex()}))},scrollTop(){this.$emit("scroll",this.scrollTop)},top(){this.top!==this.scrollTop&&this.setStartLine(this.checkScrollTop(this.top))}},created(){this.initMenu()},mounted(){this.keydownFn=e=>{this.$refs.content.clientHeight&&(38===e.keyCode?this.setCheckedByIndex(this.index-1):40===e.keyCode?this.setCheckedByIndex(this.index+1):13===e.keyCode&&this.index>-1&&this.onClick(this.allMenuList[this.index]))},u()(window).on("keydown",this.keydownFn)},destroyed(){u()(window).unbind("keydown",this.keydownFn)},methods:{initMenu(){let e=-1,t=this.menuList;this.groups=0,this.index=-1,this.allMenuList=[],this.originMenuList=[],!t[0]||t[0]instanceof Array||(t=[t]),t.forEach(((i,s)=>{for(let r=0;r<i.length;r++){let n=i[r],o={name:n.name,desc:n.desc,icon:n.icon,shortcut:n.shortcut,selected:n.selected,active:n.active,nameIndexs:n.nameIndexs,descIndexs:n.descIndexs,index:++e};r===i.length-1&&s<t.length-1&&(o.seprator=!0),n.active&&-1===this.index&&(this.index=e),this.allMenuList.push(o),this.originMenuList.push(n)}this.groups++})),this.setTreeHeight(),this.setStartLine(this.checkScrollTop(this.top))},render(){this.renderList=this.allMenuList.slice(this.startLine-1,this.startLine-1+this.maxVisibleLines),this.renderList.forEach((e=>{e.desc&&!e._desc&&(e._desc=v.getMatchHtml(e.desc,e.descIndexs||[])),e.nameIndexs&&e.nameIndexs.length&&!e._name&&(e._name=v.getMatchHtml(e.name,e.nameIndexs))}))},setMenuList(e){this.allMenuList=e,this.setTreeHeight(),this.setStartLine(this.checkScrollTop(this.top))},scrollToIndex(){let e=this.index*this.itemHeight-this.menuHeight/2;e>this.contentHeight-this.menuHeight?e=this.contentHeight-this.menuHeight:e<0&&(e=0),this.setStartLine(e)},showScrollBar(){this.scrollVisible=!0},hideScrollBar(){this.scrollVisible=!1},checkScrollTop(e){return e>this.contentHeight-this.menuHeight&&(e=this.contentHeight-this.menuHeight),e=e<0?0:e,e},setTreeHeight(){this.contentHeight=this.allMenuList.length*this.itemHeight+11*(this.groups-1),this.menuHeight=this.contentHeight,this.menuHeight=this.menuHeight>500?500:this.menuHeight,this.maxVisibleLines=Math.ceil(500/this.itemHeight)+1},setStartLine(e){this.startLine=Math.floor(e/this.itemHeight)+1,this.scrollTop=e,this.deltaTop=e%this.itemHeight,this.render()},setCheckedByIndex(e){e<0?e=this.allMenuList.length-1:e>this.allMenuList.length-1&&(e=0),this.clearChecked(),this.allMenuList[e].active=!0,this.index=e,this.render()},clearChecked(){this.allMenuList.forEach((e=>{e.active=!1}))},onClick(e){e.disabled||(this.setCheckedByIndex(e.index),this.$emit("change",this.originMenuList[e.index]))},onHover(e){this.hoverCheck&&this.checkable&&this.setCheckedByIndex(e.index)},onWheel(e){this.scrollDeltaY=e.deltaY,this.scrollDeltaY&&!this.wheelTask&&(this.wheelTask=globalData.scheduler.addUiTask((()=>{if(this.scrollDeltaY){try{let e=this.scrollTop+this.scrollDeltaY;this.onScroll(this.checkScrollTop(e))}catch(e){console.log(e)}this.scrollDeltaY=0}else globalData.scheduler.removeUiTask(this.wheelTask),this.wheelTask=null})))},onScroll(e){this.setStartLine(e)}}},He=Ae,Ne=(0,Fe.Z)(He,Ee,Ie,!1,null,null,null),Re=Ne.exports,We={name:"EditorMenu",components:{Menu:Re},data(){return{menuList:[[{name:"Reveal in File Explorer",op:"revealInFileExplorer",shortcut:"ignore"}],[{name:"Format Document",op:"format",shortcut:"Ctrl+Shift+H"}],[{name:"Cut",op:"cut",shortcut:"Ctrl+X"},{name:"Copy",op:"copy",shortcut:"Ctrl+C"},{name:"Paste",op:"paste",shortcut:"Ctrl+V"}]],menuVisible:!1,menuStyle:{}}},created(){this.initEventBus()},destroyed(){this.unbindEvent()},methods:{initEventBus(){this.initEventBusFn={},y.$on("close-menu",this.initEventBusFn["close-menu"]=()=>{this.menuVisible=!1})},unbindEvent(){y.$off("close-menu",this.initEventBusFn["close-menu"])},show(e){this.menuVisible=!0,this.$nextTick((()=>{this.menuStyle=v.getMemnuPos(e,this.$refs.menu.$el,this.$parent.$refs.scroller)}))},onMenuChange(e){let t=this.$parent;switch(e.op){case"revealInFileExplorer":y.$emit("reveal-in-file-explorer",t.tabData.path);break;case"cut":case"copy":v.writeClipboard(this.myContext.getCopyText("cut"===menu.op));break;case"paste":t.$refs.textarea.focus(),v.readClipboard().then((e=>{t.myContext.insertContent(e)}));break;case"format":y.$emit("editor-format",t.tabData.id);break}this.menuVisible=!1}}},je=We,Ve=(0,Fe.Z)(je,Se,Pe,!1,null,null,null),ze=Ve.exports,Ye=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-search",on:{contextmenu:[function(e){e.preventDefault()},function(e){e.stopPropagation()}],mousedown:function(e){e.stopPropagation()},selectstart:function(e){e.stopPropagation()}}},[t("div",{staticClass:"my-search-left active-click",staticStyle:{"border-radius":"0"},attrs:{tabindex:"-1"},on:{click:e.showReplace}},[t("span",{staticClass:"iconfont",class:{"icon-down1":e.replaceVisible,"icon-right":!e.replaceVisible},staticStyle:{"font-size":"14px"},attrs:{title:"Toggle Replace mode"}})]),t("div",{staticStyle:{"flex-grow":"1"}},[t("div",{staticClass:"my-search-top"},[t("div",{staticClass:"my-search-input",class:{"my-active":e.input1Focus}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],ref:"input1",style:{height:e.input1Height+"px"},attrs:{spellcheck:"false",type:"text"},domProps:{value:e.text},on:{blur:function(t){e.input1Focus=!1},focus:function(t){e.input1Focus=!0},input:[function(t){t.target.composing||(e.text=t.target.value)},e.onInput],keydown:e.onKeydown}}),t("span",{staticClass:"my-search-suffix",class:{"my-active":e.matchCase},attrs:{title:"Match Case(Alt+C)"},on:{click:e.changeCase}},[e._v("Aa")]),t("span",{staticClass:"my-search-suffix iconfont icon-whole-word",class:{"my-active":e.wholeWord},attrs:{title:"Match Whole Word(Alt+W)"},on:{click:e.changeWhole}})]),e.count?t("div",[t("span",[e._v(e._s(e.now))]),t("span",[e._v(" of ")]),t("span",[e._v(e._s(e.count))])]):t("span",{staticClass:"no-result",class:{"my-active":e.text}},[e._v("No results")])]),e.replaceVisible?t("div",{staticClass:"my-search-bottom",staticStyle:{"margin-top":"5px"}},[t("div",{staticClass:"my-search-input",class:{"my-active":e.input2Focus}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.replaceText,expression:"replaceText"}],ref:"input2",style:{height:e.input2Height+"px"},attrs:{spellcheck:"false",type:"text"},domProps:{value:e.replaceText},on:{blur:function(t){e.input2Focus=!1},focus:function(t){e.input2Focus=!0},keydown:e.onKeyDown2,input:function(t){t.target.composing||(e.replaceText=t.target.value)}}})]),t("span",{staticClass:"iconfont icon-replace active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{tabindex:"-1",title:"Replace(Enter)"},on:{click:e.replace}}),t("span",{staticClass:"iconfont icon-replace-all active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{tabindex:"-1",title:"Replace All(Ctrl+Alt+Enter)"},on:{click:e.replaceAll}})]):e._e()]),t("div",{staticClass:"my-search-right"},[t("span",{staticClass:"iconfont icon-up active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{tabindex:"-1",title:"Previous Match(Shift Enter)"},on:{blur:function(t){e.preFocus=!1},click:e.searchPrev,focus:function(t){e.preFocus=!0}}}),t("span",{staticClass:"iconfont icon-down active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{tabindex:"-1",title:"Next Match(Enter)"},on:{blur:function(t){e.nextFocus=!1},click:e.searchNext,focus:function(t){e.nextFocus=!0}}}),t("span",{staticClass:"iconfont icon-close active-click",attrs:{title:"Close"},on:{click:e.close}})])])},Ke=[],Ue={name:"Search",props:{now:{type:Number,default:1},count:{type:Number,default:0}},data(){return{text:"",replaceText:"",replaceVisible:!1,wholeWord:!1,matchCase:!1,searchPrevActive:!1,searchNextActive:!1,input1Focus:!1,input2Focus:!1,preFocus:!1,nextFocus:!1,input1Height:30,input2Height:30}},watch:{text(){let e=this.text.split(/\n/);this.input1Height=20*e.length+10},replaceText(){let e=this.replaceText.split(/\n/);this.input2Height=20*e.length+10}},created(){u()(document).on("keydown",this.keydownFn=e=>{13!==e.keyCode&&100!==e.keyCode||(this.preFocus?this.searchPrev():this.nextFocus&&this.searchNext())})},destroyed(){u()(document).unbind("keydown",this.keydownFn)},methods:{initData(e){for(let t in e)this[t]=e[t]},getData(){return{text:this.text,wholeWord:this.wholeWord,matchCase:this.matchCase}},search(){let e=this.search.id||1;this.search.id=e,this.$nextTick((()=>{this.search.id===e&&this.$emit("search",{text:this.text,matchCase:this.matchCase,wholeWord:this.wholeWord})}))},changeCase(){this.matchCase=!this.matchCase,this.focus(),this.onInput()},changeWhole(){this.wholeWord=!this.wholeWord,this.focus(),this.onInput()},showReplace(){this.replaceVisible=!this.replaceVisible},searchNext(){this.count&&this.$emit("next")},searchPrev(){this.count&&this.$emit("prev")},replace(){this.count&&this.$emit("replace",{text:this.replaceText})},replaceAll(){this.count&&this.$emit("replaceAll",{text:this.replaceText})},close(){this.$emit("close")},focus(){this.$refs.input1.focus(),requestAnimationFrame((()=>{this.$refs.input1.focus()}))},directBlur(){this.searchPrevActive=!1,this.searchNextActive=!1},onKeydown(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.$emit("next"))},onKeyDown2(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.count&&(e.ctrlKey&&e.altKey?this.replaceAll():this.replace()))},onInput(){clearTimeout(this.searchTimer),this.searchTimer=setTimeout((()=>{this.search()}),100)}}},qe=Ue,Ge=(0,Fe.Z)(qe,Ye,Ke,!1,null,null,null),Ze=Ge.exports,Xe=function(){var e=this,t=e._self._c;return t("div",{ref:"auto",staticClass:"my-auto my-shadow my-border my-scroll-overlay my-scroll-mini",style:e.styles,on:{mousedown:function(e){e.stopPropagation()},wheel:function(e){e.stopPropagation()}}},[t("div",e._l(e.tipList,(function(i){return t("div",{staticClass:"my-auto-item my-center-between",class:{"my-active":i.active},on:{mousedown:function(t){return e.onClick(i)}}},[t("div",{staticClass:"my-center-between"},[t("div",{staticClass:"my-auto-icon my-center-center iconfont",class:[i.icon]}),t("div",{staticClass:"my-auto-content"},[t("span",{domProps:{innerHTML:e._s(e._html(i))}})])]),t("div",{staticClass:"my-auto-desc"},[e._v(e._s(i.desc))])])})),0)])},Je=[],Qe={name:"AutoTip",props:{tipList:{type:Array,default:[]},styles:{type:Object}},data(){return{nowIndex:0,itemHeight:25}},computed:{_html(){return e=>v.getMatchHtml(e.result,e.indexs)}},watch:{nowIndex(){let e=this.$refs.auto,t=(this.nowIndex+1)*this.itemHeight;e&&t>e.clientHeight+e.scrollTop?e.scrollTop=t-e.clientHeight:e&&t<e.scrollTop+this.itemHeight&&(e.scrollTop=t-this.itemHeight)}},created(){},methods:{onClick(e){this.$emit("change",e)},prev(){let e=this.getActiveIndex();this.tipList[e].active=!1,e-=1,e=e<0?this.tipList.length-1:e,this.tipList[e].active=!0,this.nowIndex=e},next(){let e=this.getActiveIndex();this.tipList[e].active=!1,e+=1,e=e>this.tipList.length-1?0:e,this.tipList[e].active=!0,this.nowIndex=e},getActiveIndex(){for(let e=0;e<this.tipList.length;e++)if(this.tipList[e].active)return e}}},et=Qe,tt=(0,Fe.Z)(et,Xe,Je,!1,null,"d75f5a9e",null),it=tt.exports,st=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-tip",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},[t("div",{staticClass:"my-tip-content"},[t("div",{domProps:{innerHTML:e._s(e.content)}})])])},rt=[],nt={name:"Tip",props:{content:String,styles:{type:Object}},data(){return{}},created(){},methods:{}},ot=nt,at=(0,Fe.Z)(ot,st,rt,!1,null,null,null),lt=at.exports,ht=function(){var e=this,t=e._self._c;return t("div",{ref:"wrap",staticClass:"my-minimap",on:{mousedown:e.onMinimapDown}},[t("canvas",{ref:"leftDiffCanvas",staticClass:"my-minimap-canvas-left",attrs:{height:e.height,width:e.leftWidth}}),t("canvas",{ref:"canvas",staticClass:"my-minimap-canvas-center",attrs:{height:e.height,width:e.width}}),t("canvas",{ref:"rightDiffCanvas",staticClass:"my-minimap-canvas-right",attrs:{height:e.height,width:e.rightWidth}}),t("div",{ref:"block",staticClass:"my-minimap-block",style:{top:e.blockTop+"px",height:e.blockHeight+"px",opacity:e.blockClicked?"0.8":""},on:{mousedown:e.onBlockMDown}})])},ct=[];function dt(){let e={},t={},i={},s=null,r=null,n=null,o=null,a=null,l=null,h=null,c=null,d=null,u=null,m=null,p=null,g=null,f=null,v=null,b=null,y=null,C=null,w=null,x=null,T=null;function k({top:t,lineObj:s}){let r=e[s.lineId],n=s.tokens;if(A(r,s.text,s.preRuleId))for(let e=0;e<r.imgData.data.length;e++)y.data[y.index++]=r.imgData.data[e];else e[s.lineId]={text:s.text,preRuleId:s.preRuleId,imgData:o()};function o(){let e=4*i.width,t=z(i.colors["editor.foreground"]),r=new Array(i.charHight).fill(0),o=[],l=new ImageData(i.width,i.charHight);if(r=r.map((()=>{let t=new Array(e).fill(0);return t.index=0,t})),n){n=j(n);for(let o=0;o<n.length;o++){let l=n[o],h=s.text.slice(l.startIndex,l.endIndex);if(h=W(h),t=z(i.colors["editor.foreground"]),l.scopeId){let e=i.scopeIdMap[l.scopeId];e&&e.settings&&e.settings.foreground&&(t=z(e.settings.foreground))}if(a({buffers:r,text:h,color:t}),r[0].index>=e)break}}else a({buffers:r,text:W(s.text),color:t});r.forEach((e=>{o=o.concat(e)}));for(let i=0;i<l.data.length;i++)l.data[i]=o[i],y.data[y.index++]=l.data[i];return l}function a({buffers:e,text:t,color:s}){let r=4*i.width;for(let i=0;i<t.length;i++){if(" "!=t[i]){let n=V(t[i],s);for(let t=0;t<n.height;t++)for(let i=0;i<n.width;i++){let s=n[t][i],o=e[t];o.index<=r-4&&(o[o.index]=s[0],o[o.index+1]=s[1],o[o.index+2]=s[2],o[o.index+3]=s[3],o.index+=4)}}else e.forEach((e=>{e.index+=4}));if(e[0].index>=r)break}}}function L(e){y.index=0,o.clearRect(0,0,i.width,i.height),e.forEach((e=>{k(e)}));for(let t=y.index;t<y.data.length;t++)y.data[t]=0;o.putImageData(y,0,0),o.globalCompositeOperation="destination-over",v&&o.drawImage(v,0,0),C&&o.drawImage(C,0,0),B()}function S(e){o.clearRect(0,0,i.width,i.height);for(let t in e){let s=e[t];y.index=4*Math.round(i.width*s.top),k(e[t])}o.putImageData(y,0,0),v&&o.drawImage(v,0,0),C&&o.drawImage(C,0,0)}function P(){x.data.fill(0),a.clearRect(0,0,i.leftWidth,i.height),d.length&&(d.forEach((e=>{let t=Y(e.type);"D"===e.type?$({imgData:x,left:2,top:e.top,width:4,height:e.height,rgb:t}):$({imgData:x,left:3,top:e.top,width:2,height:e.height,rgb:t})})),a.putImageData(x,0,0)),d=null}function E(){T.data.fill(0),l.clearRect(0,0,i.rightWidth,i.height),u&&(u.forEach((e=>{let t=Y(e.type);$({imgData:T,left:0,top:e.top,width:5,height:e.height,rgb:t})})),l.putImageData(T,0,0),b&&l.drawImage(b,0,0),w&&l.drawImage(w,0,0)),u=null}function I(){let e=m.results.map((e=>({rgb:z(i.colors["minimap.selectionHighlight"]),top:e}))),t=m.fResults.map((e=>({rgb:z(i.colors["minimap.findMatchHighlight"]),top:e})));if(e=e.concat(t),e.length){let t=new ImageData(i.width,i.height);for(let s=0;s<e.length;s++){let r=e[s];$({imgData:t,left:0,top:r.top,width:i.width,height:i.charHight,rgb:r.rgb})}createImageBitmap(t).then((e=>{o.clearRect(0,0,i.width,i.height),o.putImageData(y,0,0),o.drawImage(e,0,0),v&&o.drawImage(v,0,0),C=e}))}else C&&(o.clearRect(0,0,i.width,i.height),o.putImageData(y,0,0),v&&o.drawImage(v,0,0),C=null);m=null}function _(){if(p.length){let e=z(i.colors["minimap.findMatchHighlight"]),t=new ImageData(i.width,i.height);for(let s=0;s<p.length;s++)$({imgData:t,left:5,top:p[s],width:5,height:2*i.charHight,rgb:e});createImageBitmap(t).then((e=>{l.clearRect(0,0,i.rightWidth,i.height),l.putImageData(T,0,0),l.drawImage(e,0,0),b&&l.drawImage(b,0,0),w=e}))}else w&&(l.clearRect(0,0,i.rightWidth,i.height),l.putImageData(T,0,0),b&&l.drawImage(b,0,0),w=null);p=null}function D(){let e=K(),t=new ImageData(i.width,i.height);e[3]&&(e=e.slice(),e[3]+=Math.floor(102),e[3]=e[3]>255?255:e[3]);for(let s=0;s<g.length;s++)$({imgData:t,left:0,top:g[s],width:i.width,height:i.charHight,rgb:e});createImageBitmap(t).then((e=>{o.clearRect(0,0,i.width,i.height),o.putImageData(y,0,0),C&&o.drawImage(C,0,0),o.drawImage(e,0,0),v=e})),g=null}function M(){let e=K(!0),t=new ImageData(i.width,i.height);for(let s=0;s<f.length;s++)$({imgData:t,left:0,top:f[s],width:i.width,height:i.charHight,rgb:e});createImageBitmap(t).then((e=>{l.clearRect(0,0,i.rightWidth,i.height),l.putImageData(T,0,0),l.drawImage(e,0,0),w&&l.drawImage(w,0,0),b=e})),f=null}function $({imgData:e,left:t,top:i,width:s,height:r,rgb:n}){let o=4*(e.width*i+t),a=o;for(let h=0;h<r;h++){for(let e=0;e<s;e++)l(o,n),o+=4;a+=4*e.width,o=a}function l(t,i){t<e.data.length&&(e.data[t]=i[0],e.data[t+1]=i[1],e.data[t+2]=i[2],e.data[t+3]=i[3]||255)}}function F(){cancelAnimationFrame(F.timer),F.timer=requestAnimationFrame((()=>{try{i.width&&i.height&&i.charHight&&o&&(h?(L(h),h=null):c&&(S(c),c=null),g&&D(),f&&M(),m&&I(),p&&_(),d&&P(),u&&E())}catch(Er){console.log(Er)}}))}function O(e){e?t[e.lineObj.lineId]=e:(t={},h.forEach((e=>{t[e.lineObj.lineId]=e})))}function B(){let t={};h.forEach((i=>{t[i.lineObj.lineId]=e[i.lineObj.lineId]})),e=t}function A(e,t,i){if(e&&e.text===t&&e.preRuleId===i)return!0}function H(e){e.canvas&&(s=e.canvas,o=s.getContext("2d")),e.leftDiffCanvas&&(r=e.leftDiffCanvas,a=r.getContext("2d")),e.rightDiffCanvas&&(n=e.rightDiffCanvas,l=n.getContext("2d"))}function N(o){function a(){e={},t={},h=null,c=null,i.width&&i.height&&(y=new ImageData(i.width,i.height)),i.leftWidth&&i.height&&(x=new ImageData(i.leftWidth,i.height)),i.rightWidth&&i.height&&(T=new ImageData(i.rightWidth,i.height))}void 0!==o.height&&o.height!==i.height&&(s.height=o.height,r.height=o.height,n.height=o.height),void 0!==o.width&&o.width!==i.width&&(s.width=o.width),void 0!==o.leftWidth&&o.leftWidth!==i.leftWidth&&(r.width=o.leftWidth),void 0!==o.rightWidth&&o.rightWidth!==i.rightWidth&&(n.width=o.rightWidth),Object.assign(i,o),a()}function R({lineId:e,lineObj:i}){return e?i=t[e].lineObj:t[i.lineId]=i,i}function W(e){return e=e.replace(/\t/g,i.space),e}function j(e){let t=[],s=null;for(let i=0;i<e.length;i++){let n=e[i],o=n.scopeId;s&&r(s.scopeId,o)?s.endIndex=n.endIndex:(s={scopeId:o,startIndex:n.startIndex,endIndex:n.endIndex},t.push(s))}return t;function r(e,t){return e=i.scopeIdMap[e],t=i.scopeIdMap[t],e=e&&e.settingsStr||"",t=t&&t.settingsStr||"",e===t}}function V(e,t){let s=V[e];if(!V[e]){let t=new OffscreenCanvas(i.charHight,i.charHight),r=t.getContext("2d"),n=1;r.font=`bold ${i.charHight}px Consolas`,r.textBaseline="top",r.fillText(e,0,0),s=r.getImageData(0,0,t.width,t.height).data;let o=[];for(let e=0;e<i.charHight;e++){let t=new Array(n).fill(0).map((()=>[0,0,0,0]));for(let r=0;r<n;r++){let n=4*(e*i.charHight+r);0!==s[n+3]&&(s[n+3]+=Math.floor(102),s[n+3]=s[n+3]>255?255:s[n+3],t[r]=[...s.slice(n,n+4)])}o.push(t)}s=o,s.width=n,s.height=i.charHight,V[e]=s}for(let i=0;i<s.height;i++)for(let e=0;e<s.width;e++){let r=s[i][e];r[0]=t[0],r[1]=t[1],r[2]=t[2]}return s}function z(e){if(!z[e]){let t=[];for(let i=1;i<=e.length-2;i+=2)t.push(Number("0x"+e[i]+e[i+1]));z[e]=t}return z[e]}function Y(e){let t=i.colors["editor.foreground"];switch(e){case"A":t=i.colors["gitDecoration.addedResourceForeground"];break;case"M":t=i.colors["gitDecoration.modifiedResourceForeground"];break;case"D":t=i.colors["gitDecoration.deletedResourceForeground"];break}return z(t)}function K(e){let t=i.colors["editor.lineHighlightBackground"];return e&&(t=i.colors["editor.foreground"]),t=z("transparent"!==t?t:i.colors["editor.lineHighlightBorder"]),t}self.onmessage=function(e){let t=e.data,i=t.event;switch(t=t.data,i){case"init":H(t);break;case"set-data":N(t);break;case"render-line":let e=t,i=R(e);e.lineObj=i,c=c||{},c[i.lineId]=e,O(e);break;case"render":h=t,h.map((e=>{e.lineObj=R(e)})),O(),c=null;break;case"render-diff":d=t;break;case"render-diff-all":u=t;break;case"render-cursor":g=t;break;case"render-cursor-all":f=t;break;case"render-selected-bg":m=t;break;case"render-selected-all":p=t;break}F()}}window.require("path");var ut={name:"Minimap",components:{},props:{contentHeight:Number,scrollTop:Number,nowLine:Number},data(){return{startLine:1,maxVisibleLines:1,canvasHeight:0,width:0,leftWidth:8,rightWidth:14,height:0,blockHeight:0,scale:.1,top:0,blockTop:0,blockClicked:!1}},watch:{scrollTop(){this.setStartLine()},contentHeight(){this.setStartLine()},nowLine(){this.setTop()}},created(){this.worker=v.createWorker(dt),this.renderedIdMap={}},mounted(){let e=this.$refs.canvas.transferControlToOffscreen(),t=this.$refs.leftDiffCanvas.transferControlToOffscreen(),i=this.$refs.rightDiffCanvas.transferControlToOffscreen();this.worker.postMessage({event:"init",data:{canvas:e,leftDiffCanvas:t,rightDiffCanvas:i}},[e,t,i]),this.setSize(),this.initWorkerData("theme"),this.initEvent()},destroyed(){this.worker.terminate(),this.unbindEvent(),clearTimeout(this.renderTimer),H.scheduler.removeUiTask(this.moveTask)},methods:{initWorkerData(e){let t={};"size"!==e&&e||Object.assign(t,{charHight:this.$parent.charObj.charHight*this.scale,space:this.$parent.space,width:this.width,height:this.height,leftWidth:this.leftWidth,rightWidth:this.rightWidth,scale:this.scale}),"theme"!==e&&e||(this.preCursorResult=null,this.preAllCursorResult=null,this.preAllSearchResult=null,Object.assign(t,{colors:H.colors,scopeIdMap:H.scopeIdMap})),this.renderedIdMap={},this.worker.postMessage({event:"set-data",data:t})},initEvent(){this.initEvent.fn1=e=>{this.$parent.active&&this.onDocumentMmove(e)},this.initEvent.fn2=e=>{this.$parent.active&&this.onDocumentMouseUp(e)},u()(document).on("mousemove",this.initEvent.fn1),u()(document).on("mouseup",this.initEvent.fn2),this.initResizeEvent(),this.initEventBus()},initEventBus(){y.$on("render-line",this.initEventBus.fn1=e=>{this.$parent.editorId===e.editorId&&this.renderLine(e.lineId)})},initResizeEvent(){const e=new ResizeObserver((e=>{this.$refs.wrap&&this.$refs.wrap.clientHeight&&requestAnimationFrame((()=>{this.setSize(),this.setStartLine(),this.render()}))}));e.observe(this.$refs.wrap)},unbindEvent(){u()(document).unbind("mousemove",this.initEvent.fn1),u()(document).unbind("mouseup",this.initEvent.fn2),y.$off("render-line",this.initEventBus.fn1)},setSize(){this.width=this.$refs.wrap.clientWidth-22,this.height=this.$refs.wrap.clientHeight,this.width=this.width<0?0:this.width,this.height=this.height<0?0:this.height,this.blockHeight=this.height*this.scale,this.canvasHeight=this.height/this.scale,this.maxVisibleLines=Math.ceil(this.canvasHeight/this.$parent.charObj.charHight)+1,this.initWorkerData("size")},setStartLine(){let e=this.contentHeight-this.canvasHeight,t=this.contentHeight-this.height,i=0;e=e<0?0:e,i=t?this.scrollTop*(e/t):0,i=i>e?e:i,this.startLine=Math.floor(i/this.$parent.charObj.charHight),this.startLine++,this.startLine=this.$parent.folder.getRealLine(this.startLine),this.top=i%this.$parent.charObj.charHight,this.setTop()},setTop(){let e=(this.$parent.folder.getRelativeLine(this.nowLine)-this.$parent.folder.getRelativeLine(this.startLine))*this.$parent.charObj.charHight-this.top;this.blockTop=e*this.scale},render(){this.renderTimer||(this.renderTimer=setTimeout((()=>{this.renderLines(),this.renderDiff(),this.renderSelectedBg(),this.renderTimer=null}),15))},renderLines(){let e=[],t={};for(let i=this.startLine,s=0;i<=this.$parent.myContext.htmls.length&&s<this.maxVisibleLines;s++){let s=this.$parent.folder.getFoldByLine(i),r=this.$parent.myContext.htmls[i-1],n=this.$parent.myContext.htmls[i-2],o=n&&n.states&&n.states.ruleId||null,a=this.renderedIdMap[r.lineId],l=null;l=this.compairCache(a,r.text,o)?{top:(i-this.startLine)*this.$parent.charObj.charHight*this.scale,lineId:r.lineId}:this.getRenderObj(i),t[r.lineId]={num:i,text:r.text,preRuleId:o},e.push(l),s?i=s.end.line:i++}this.renderedIdMap=t,this.worker.postMessage({event:"render",data:e})},renderLine(e){let t=this.renderedIdMap[e];if(t){let i=this.$parent.myContext.htmls[t.num-1],s=this.$parent.myContext.htmls[t.num-2],r=s&&s.states&&s.states.ruleId||null;if(i&&i.lineId===e){let e=this.getRenderObj(t.num);this.worker.postMessage({event:"render-line",data:e}),this.renderedIdMap[i.lineId]={num:t.num,text:i.text,preRuleId:r}}}},renderSelectedBg(){let e=[],t=[];this.$parent.tabSize;for(let i=this.startLine,s=0;i<=this.$parent.myContext.htmls.length&&s<this.maxVisibleLines;s++){let r=this.$parent.folder.getFoldByLine(i),n=(this.$parent.myContext.htmls[i-1].text,s*this.$parent.charObj.charHight*this.scale);this.$parent.fSelecter.getRangeByLine(i).length||this.$parent.selecter.getRangeWithCursorPos({line:i,column:0})?t.push(n):(this.$parent.fSelecter.getRangeByLine(i).length||this.$parent.selecter.getRangeWithCursorPos({line:i,column:0}))&&e.push(n),r?i=r.end.line:i++}this.worker.postMessage({event:"render-selected-bg",data:{results:e,fResults:t}})},renderAllSearchdBg(){let e=this.$parent.fSelecter.ranges.toArray(),t=[],i={},s=-1;this.getEndLine();for(let r=0;r<e.length;r++){let n=e[r].start;if(n.line!==i.line&&!this.$parent.folder.getLineInFold(n.line)){let e=this.$parent.folder.getRelativeLine(n.line),i=Math.round((e-1)*this.$parent.charObj.charHight/this.contentHeight*this.height);i-s>=4&&(s=i,t.push(i))}i=n}this.preAllSearchResult+""!==t+""&&(this.preAllSearchResult=t,this.worker.postMessage({event:"render-selected-all",data:t}))},renderDiff(){let e=[],t=0;if(this.$parent.diffRanges){t=this.getEndLine();for(let s=0;s<this.$parent.diffRanges.length;s++){let r=this.$parent.diffRanges[s];if(r=Object.assign({},r),r.length="D"===r.type?1:r.added.length,r.line<this.startLine&&(r.length-=this.startLine-r.line,r.line=this.startLine),r.length>0){let t=this.$parent.folder.getLineInFold(r.line);t?"D"!==r.type&&r.line+r.length-1>=t.end.line&&(r.length-=t.end.line-r.line,r.line=t.end.line,e.push(i.call(this,r))):e.push(i.call(this,r))}else if(r.line>t)break}}function i(e){let i={};return e=this.getDiffObj(e),e.length=e.line+e.length-1>t?t-e.line+1:e.length,i.type=e.type,i.top=(e.line-this.startLine)*this.$parent.charObj.charHight*this.scale,i.height=this.$parent.charObj.charHight*e.length*this.scale,i.top=Math.ceil(i.top),i.height=Math.ceil(i.height),i}this.worker.postMessage({event:"render-diff",data:e})},renderAllDiff(e){let t=[],i=this.height/this.contentHeight*this.height;if(i=i>20?i:20,this.$parent.diffRanges)for(let r=0;r<this.$parent.diffRanges.length;r++){let e=this.$parent.diffRanges[r],i=this.$parent.folder.getLineInFold(e.line);e=Object.assign({},e),e.length="D"===e.type?1:e.added.length,i?"D"!==e.type&&e.line+e.length-1>=i.end.line&&(e.length-=i.end.line-e.line,e.line=i.end.line,t.push(s.call(this,e))):t.push(s.call(this,e))}function s(e){let t={},s=(this.height-i)/(this.contentHeight-this.height);return e=this.getDiffObj(e),t.type=e.type,t.top=(e.line-1)*this.$parent.charObj.charHight*s,t.height=this.$parent.charObj.charHight*e.length*s,t.height=t.height<4?4:t.height,t.top=Math.ceil(t.top),t.height=Math.ceil(t.height),t}this.worker.postMessage({event:"render-diff-all",data:t}),e&&this.renderDiff()},renderCursor(){let e=this.$parent.cursor.multiCursorPos.toArray(),t=[],i={},s=this.getEndLine();for(let r=0;r<e.length;r++){let n=e[r];if(n.line>=this.startLine&&n.line<=s){if(n.line!==i.line&&!this.$parent.folder.getLineInFold(n.line)){let e=this.$parent.folder.getRelativeLine(n.line),i=(e-this.startLine)*this.$parent.charObj.charHight*this.scale;t.push(i)}}else if(n.line>s)break;i=n}this.preCursorResult+""!==t+""&&(this.preCursorResult=t,this.worker.postMessage({event:"render-cursor",data:t}))},renderAllCursor(){let e=this.$parent.cursor.multiCursorPos.toArray(),t=[],i=-1,s={};this.getEndLine();for(let r=0;r<e.length;r++){let n=e[r];if(n.line!==s.line&&!this.$parent.folder.getLineInFold(n.line)){let e=this.$parent.folder.getRelativeLine(n.line),s=Math.round((e-1)*this.$parent.charObj.charHight/this.contentHeight*this.height);i!==s&&(i=s,t.push(s))}s=n}this.preAllCursorResult+""!==t+""&&(this.preAllCursorResult=t,this.worker.postMessage({event:"render-cursor-all",data:t}))},getEndLine(){let e=0;for(let t=this.startLine,i=0;t<=this.$parent.myContext.htmls.length&&i<this.maxVisibleLines;i++){let i=this.$parent.folder.getFoldByLine(t);e=t,i?t=i.end.line:t++}return e},getRenderObj(e){let t=(e-this.startLine)*this.$parent.charObj.charHight*this.scale,i=this.$parent.myContext.htmls[e-1],s=this.$parent.myContext.htmls[e-2],r=s&&s.states&&s.states.ruleId||null;return!i.html&&i.tokens&&i.tokens.forEach((e=>{this.$parent.tokenizer.getScopeId(e)})),{top:t,lineObj:{lineId:i.lineId,text:i.text,preRuleId:r,tokens:i.tokens&&i.tokens.map((e=>({startIndex:e.startIndex,endIndex:e.endIndex,scopeId:e.scopeId})))}}},getDiffObj(e){let t=this.$parent.folder.getRelativeLine(e.line),i=e.length;if(i>1){let t=e.line+i-1,s=(e.line,0),r=this.$parent.folder.folds.toArray();for(let i=0;i<r.length;i++){let n=r[i];if(!(n.end.line<=e.line)){if(n.start.line>=t)break;s+=n.end.line-n.start.line,n.start.line<e.line&&(s-=e.line-n.start.line),n.end.line>t&&(s-=n.end.line-t)}}i-=s}return{line:t,type:e.type,length:i}},compairCache(e,t,i){if(e&&e.text===t&&e.preRuleId===i)return!0},onMinimapDown(e){if(e.target===this.$refs.block)return;let t=this.contentHeight-this.height,i=Math.floor(e.offsetY/(this.$parent.charObj.charHight*this.scale));i=(this.startLine+i-1)*this.$parent.charObj.charHight-this.height/2,i=i>t?t:i,i=i<0?0:i,this.$parent.setStartLine(i)},onBlockMDown(e){this.startBlockMouseObj=e,this.bTop=this.blockTop,this.blockClicked=!0},onDocumentMmove(e){if(this.startBlockMouseObj){let t=this.contentHeight-this.height,i=this.height-this.blockHeight,s=e.clientY-this.startBlockMouseObj.clientY,r=this.bTop;i>this.contentHeight*this.scale-this.blockHeight&&(i=this.contentHeight*this.scale-this.blockHeight),r+=s,r=r<0?0:r,r=r>i?i:r,this.bTop+=s,this.startBlockMouseObj=e,this.moevScrollTop=r*(t/i),this.moevScrollTop&&!this.moveTask&&(this.moveTask=H.scheduler.addUiTask((()=>{this.moevScrollTop>=0&&this.moevScrollTop!==this.scrollTop?(this.$parent.setStartLine(this.moevScrollTop),this.moevScrollTop=-1):(H.scheduler.removeUiTask(this.moveTask),this.moveTask=null)})))}},onDocumentMouseUp(e){H.scheduler.removeUiTask(this.moveTask),this.startBlockMouseObj=null,this.moveTask=null,this.blockClicked=!1}}},mt=ut,pt=(0,Fe.Z)(mt,ht,ct,!1,null,null,null),gt=pt.exports,ft=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e._hScrollAble,expression:"_hScrollAble"}],ref:"bar",staticClass:"my-scroll-bar-h",class:{"my-scroll-clicked":e.hSliderClicked},on:{mousedown:e.onHBarDown}},[t("div",{staticClass:"my-scroll-slider",style:{width:e._hSliderWidth+"px",left:e._vSliderLeft+"px"},on:{mousedown:e.onHsliderDown}})])},vt=[],bt={name:"HScrollBar",props:{width:{type:Number,default:0},scrollLeft:{type:Number,default:0}},data(){return{barWidth:0,hSliderClicked:!1}},computed:{_hSliderWidth(){let e=this.barWidth/this.width*this.barWidth;return e>20?e:20},_vSliderLeft(){let e=this.barWidth-this._hSliderWidth,t=this.width-this.barWidth;return this.scrollLeft*e/t},_hScrollAble(){return this.width>this.barWidth}},created(){},mounted(){this.barWidth=this.$refs.bar.clientWidth,this.initResizeEvent(),this.initEvent()},destroyed(){this.unbindEvent(),globalData.scheduler.removeUiTask(this.moveHsliderTask)},methods:{initResizeEvent(){const e=new ResizeObserver((e=>{this.$refs.bar&&this.$refs.bar.clientWidth&&(this.barWidth=this.$refs.bar.clientWidth)}));e.observe(this.$refs.bar)},initEvent(){this.initEventFn1=e=>{this.onDocumentMouseMove(e)},this.initEventFn2=e=>{this.onDocumentMouseUp(e)},document.addEventListener("mousemove",this.initEventFn1),document.addEventListener("mouseup",this.initEventFn2)},unbindEvent(){document.removeEventListener("mousemove",this.initEventFn1),document.removeEventListener("mouseup",this.initEventFn2)},getScrollLeft(e){let t=this.barWidth-this._hSliderWidth,i=this.width-this.barWidth;return e*(i/t)},onHBarDown(e){if(!this.hSliderClicked){let t=e.offsetX-this._hSliderWidth/2;t>this.barWidth-this._hSliderWidth&&(t=this.barWidth-this._hSliderWidth),t=t<0?0:t,this.$emit("scroll",this.getScrollLeft(t)),this.$nextTick((()=>{this.onHsliderDown(e)}))}},onHsliderDown(e){this.vSliderMouseObj=e,this.startVSliderLeft=this._vSliderLeft,this.hSliderClicked=!0},onDocumentMouseMove(e){if(this.vSliderMouseObj){let t=this.barWidth-this._hSliderWidth,i=e.clientX-this.vSliderMouseObj.clientX,s=this.startVSliderLeft;s+=i,s=s<0?0:s,s=s>t?t:s,this.startVSliderLeft+=i,this.vSliderMouseObj=e,this.moveScrollLeft=this.getScrollLeft(s),this.moveScrollLeft&&!this.moveHsliderTask&&(this.moveHsliderTask=globalData.scheduler.addUiTask((()=>{this.moveScrollLeft>=0&&this.moveScrollLeft!==this.scrollLeft?(this.$emit("scroll",this.moveScrollLeft),this.moveScrollLeft=-1):(globalData.scheduler.removeUiTask(this.moveHsliderTask),this.moveHsliderTask=null)})))}},onDocumentMouseUp(e){globalData.scheduler.removeUiTask(this.moveHsliderTask),this.hSliderClicked=!1,this.vSliderMouseObj=null,this.moveHsliderTask=null}}},yt=bt,Ct=(0,Fe.Z)(yt,ft,vt,!1,null,null,null),wt=Ct.exports;const xt=ke.contexts,Tt={A:"add",M:"modify",D:"delete"};var kt={name:"Editor",components:{SearchDialog:Ze,Menu:Re,AutoTip:it,Tip:lt,Minimap:gt,VScrollBar:Be,HScrollBar:wt,EditorMenu:ze},props:{type:String,tabData:Object,active:{type:Boolean,default:!1},diffObj:{type:Object,default:()=>({diff:null,deletedLength:0,beforeLine:0,maxLine:0,states:null})}},data(){return{cursorVisible:!0,cursorFocus:!0,language:"",theme:"",indent:"tab",tabSize:4,startLine:1,endLine:1,cursorLeft:0,scrollLeft:0,scrollTop:0,deltaTop:0,maxVisibleLines:1,maxLine:1,maxContentHeight:0,contentHeight:0,errorMap:{},errors:[],autoTipList:[],renderObjs:[],renderNums:[],renderCursorObjs:[],renderSelectionObjs:[],renderedLineMap:{},renderedIdMap:{},renderNumsIdMap:{},diffRanges:null,diffTabData:null,tipContent:null,searchVisible:!1,selectedFg:!1,activeLineBg:!0,searchNow:1,searchCount:0,diffVisible:!1,diffHeight:200,diffTop:0,diffMarginTop:0,toShowdiffObj:null,scrollVisible:!1,minimapVisible:!1,scrollerArea:{width:0,height:0},nowCursorPos:{line:1,column:0},bracketMatch:{start:{},end:{}},tipStyle:{top:"0px",left:"0px"},autoTipStyle:{top:"50%",left:"50%"},maxWidthObj:{lineId:null,text:"",width:0},charObj:{charWidth:7.15,fullAngleCharWidth:15,charHight:20}}},computed:{_lineId(){return e=>"line-"+this.tabData.id+"-"+e},_top(){return-(this.scrollTop-this.deltaTop)+"px"},_left(){return-this.scrollLeft+"px"},_diffBg(){return e=>"diff"===this.type?e>this.diffObj.deletedLength?"my-diff-inserted":"my-diff-removed":""},_leftShadow(){return this.scrollLeft>0},_rightShadow(){return this.scrollLeft+this.scrollerArea.width<this._contentMinWidth},_lineHeight(){return this.charObj.charHight+"px"},_activeLineTop(){return(this.folder.getRelativeLine(this.nowCursorPos.line)-1)*this.charObj.charHight-this.deltaTop+"px"},_cursorVisible(){return this.cursorVisible&&this.cursorFocus?"visible":"hidden"},_contentMinWidth(){let e=0;return this.$refs.content&&(e=v.getStrExactWidth(this.maxWidthObj.text,this.tabSize,this.$refs.content),e+=this.charObj.fullAngleCharWidth),e=this.scrollerArea.width>e?this.scrollerArea.width:e,e},_contentHeight(){return this.contentHeight+"px"},_maxContentHeight(){return 2*this.maxContentHeight+"px"},_textAreaPos(){let e=this.cursorLeft,t=0;if(this.nowCursorPos){let e=this.nowCursorPos.line<this.startLine?this.startLine:this.nowCursorPos.line;t=(this.folder.getRelativeLine(e)-this.startLine+1)*this.charObj.charHight,t>this.scrollerArea.height-2*this.charObj.charHight&&(t=this.scrollerArea.height-2*this.charObj.charHight)}return e>this.scrollerArea.width-this.charObj.fullAngleCharWidth?e=this.scrollerArea.width-this.charObj.fullAngleCharWidth:e<this.charObj.fullAngleCharWidth&&(e=this.charObj.fullAngleCharWidth),{top:t+"px",left:e+"px"}},_tabLines(){return e=>{let t="";for(let i=1;i<=e;i++){let e=(i-1)*this.tabSize*this.charObj.charWidth+"px";t+=`<span style="left:${e}" class="my-indent"></span>`}return t}},_bracketStartVisible(){return this.bracketMatch&&this.bracketMatch.start.line>=this.startLine&&this.bracketMatch.start.line<=this.endLine},_bracketEndVisible(){return this.bracketMatch&&this.bracketMatch.end.line>=this.startLine&&this.bracketMatch.end.line<=this.endLine},_bracketStartStyle(){return{left:this.bracketMatch.start.left,top:this.bracketMatch.start.top,width:this.bracketMatch.start.width,height:this._lineHeight}},_bracketEndStyle(){return{left:this.bracketMatch.end.left,top:this.bracketMatch.end.top,width:this.bracketMatch.end.width,height:this._lineHeight}},space(){return v.space(this.tabSize)},myContext(){return xt[this.tabData.id]},editAble(){return"diff"!==this.type}},watch:{language:function(e){this.myContext.htmls.forEach((e=>{e.tokens=null,e.folds=null,e.stateFold=null,e.states=null,e.html=""})),this.lint.initLanguage(e),this.tokenizer.initLanguage(e)},theme:function(){this.myContext.htmls.forEach((e=>{e.html="",e.tokens&&e.tokens.forEach((e=>{e.scopeId=""}))})),this.selectedFg=!!H.colors["editor.selectionForeground"],this.tokenizer.clearScopeMap(),this.$refs.minimap&&this.$refs.minimap.initWorkerData("theme"),this.render()},tabSize:function(e){this.myContext.htmls.forEach((e=>{e.tabNum=-1,e.html=""})),this.$refs.minimap&&this.$refs.minimap.initWorkerData("size"),this.render(),this.maxWidthObj={lineId:null,text:"",width:0},this.myContext.setLineWidth(this.myContext.htmls)},maxLine:function(e){this.setContentHeight(),this.$nextTick((()=>{this.setScrollerArea()}))},active:function(e){e?this.showEditor():this.autocomplete.stop()},diffRanges:function(e){this.setNumExtraData()},nowCursorPos:{handler:function(e){y.$emit("cursor-change",{line:e?e.line:"?",column:e?e.column:"?"}),this.renderBracketMatch()},deep:!0}},created(){this.initData(),this.initEvent(),this.initEventBus()},mounted(){this.initResizeEvent(),this.active&&(this.showEditor(),"diff"===this.type&&this.showDiff())},destroyed(){this.unbindEvent(),this.myContext.destroy(),this.tokenizer.destroy(),this.lint.destroy(),this.history.destroy(),this.selecter.destroy(),this.fSelecter.destroy(),this.cursor.destroy(),this.autocomplete.destroy(),this.folder.destroy(),xt[this.tabData.id]=null,this.tokenizer=null,this.lint=null,this.history=null,this.selecter=null,this.fSelecter=null,this.cursor=null,this.autocomplete=null,this.folder=null,this.renderedLineMap=null,this.renderedIdMap=null,this.errorMap=null,this.errors=null,this.autoTipList=null,this.renderObjs=null,this.renderNums=null,this.renderCursorObjs=null,this.renderSelectionObjs=null,this.renderedLineMap=null,this.renderedIdMap=null,this.renderNumsIdMap=null,this.diffRanges=null,this.diffTabData=null,this.tipContent=null,cancelAnimationFrame(this.focusTimer),cancelAnimationFrame(this.renderTimer),clearTimeout(this.curserTimer),clearTimeout(this.renderSelectedBgTimer),clearTimeout(this.bracketMatchTimer),clearTimeout(this.setAutoTip.hideTimer),clearTimeout(this.compositionendTimer),H.scheduler.removeUiTask(this.moveTask),H.scheduler.removeUiTask(this.wheelTask)},methods:{initData(){this.editorId=this.tabData.id,xt[this.editorId]=new ke(this),this.maxWidthObj.lineId=this.myContext.htmls[0].lineId,this.tokenizer=new z(this,this.myContext),this.lint=new G(this,this.myContext),this.formatter=new Q(this,this.myContext),this.differ=new se(this,this.myContext),this.autocomplete=new le(this,this.myContext),this.folder=new ge(this,this.myContext),this.history=new we(this,this.myContext),this.selecter=new be(this,this.myContext),this.searcher=new fe(this,this.myContext,this.selecter),this.fSelecter=new be(this,this.myContext),this.fSearcher=new fe(this,this.myContext,this.fSelecter),this.shortcut=new Le(this,this.myContext),this.cursor=new Ce(this,this.myContext),this.cursor.addCursorPos(this.nowCursorPos),this.wordPattern=v.getWordPattern(this.language),this.wordPattern=new RegExp(`^(${this.wordPattern.source})`),this.selectedFg=!!H.colors["editor.selectionForeground"],this.minimapVisible="diff"!==this.type&&H.views.minimap},initRenderData(){this.charObj=v.getCharWidth(this.$refs.content,'<div class="my-line"><div class="my-code">[dom]</div></div>'),this.maxVisibleLines=Math.ceil(this.$refs.scroller.clientHeight/this.charObj.charHight)+1},initEvent(){this.initEventFn1=e=>{this.active&&this.onDocumentMmove(e)},this.initEventFn2=e=>{this.active&&this.onDocumentMouseUp(e)},u()(document).on("mousemove",this.initEventFn1),u()(document).on("mouseup",this.initEventFn2)},initResizeEvent(){const e=new ResizeObserver((e=>{this.active&&this.$nextTick((()=>{this.$refs.scroller&&this.showEditor()}))}));e.observe(this.$refs.editor)},initEventBus(){this.initEventBusFn={},y.$on("language-change",this.initEventBusFn["language-change"]=e=>{this.tabData.id===e.id&&(this.active&&(this.language=e.language),this._language=e.language)}),y.$on("tab-size-change",this.initEventBusFn["tab-size-change"]=e=>{this.active&&(this.tabSize=e)}),y.$on("indent-change",this.initEventBusFn["indent-change"]=e=>{this.active&&(this.indent=e)}),y.$on("convert-to-space",this.initEventBusFn["convert-to-space"]=()=>{this.active&&this.myContext.convertTabToSpace()}),y.$on("convert-to-tab",this.initEventBusFn["convert-to-tab"]=()=>{this.active&&this.myContext.convertSpaceToTab()}),y.$on("close-menu",this.initEventBusFn["close-menu"]=()=>{this.autoTipList=null,this.autocomplete.stop()}),y.$on("theme-changed",this.initEventBusFn["theme-changed"]=e=>{this.active&&(this.theme=e),this._theme=e}),y.$on("git-diff",this.initEventBusFn["git-diff"]=e=>{this.active&&e&&e.path===this.tabData.path&&this.differ.run()}),y.$on("git-statused",this.initEventBusFn["git-statused"]=e=>{if(this.tabData.path===e.path){let e=null;e=v.getFileStatus(this.tabData.path),this.preStatus!==e.originStatus&&(this.active&&this.differ.run(),this.preStatus=e.originStatus)}}),y.$on("render-line",this.initEventBusFn["render-line"]=e=>{this.editorId===e.editorId&&this.renderLine(e.lineId)}),y.$on("file-saved",this.initEventBusFn["file-saved"]=e=>{this.tabData.path===e&&this.history.save()}),y.$on("file-opened",this.initEventBusFn["file-opened"]=e=>{this.tabData.path!==e&&this.tabData.tempPath!==e||this.history.clear()}),y.$on("editor-format",this.initEventBusFn["editor-format"]=e=>{e===this.tabData.id&&this.formatter.run()}),y.$on("minimap-toggle",this.initEventBusFn["minimap-toggle"]=()=>{this.minimapVisible=!this.minimapVisible,this.active&&this.$nextTick((()=>{this.$refs.minimap&&this.$refs.minimap.renderAllDiff(!0),this.render()}))}),y.$on("window-close",this.initEventBusFn["window-close"]=()=>{try{this.lint.worker&&this.lint.worker.kill(),this.formatter.worker&&this.formatter.worker.kill()}catch(Er){}})},unbindEvent(){u()(document).unbind("mousemove",this.initEventFn1),u()(document).unbind("mouseup",this.initEventFn2),y.$off("language-change",this.initEventBusFn["language-change"]),y.$off("tab-size-change",this.initEventBusFn["tab-size-change"]),y.$off("indent-change",this.initEventBusFn["indent-change"]),y.$off("convert-to-tab",this.initEventBusFn["convert-to-tab"]),y.$off("convert-to-space",this.initEventBusFn["convert-to-space"]),y.$off("close-menu",this.initEventBusFn["close-menu"]),y.$off("theme-changed",this.initEventBusFn["theme-changed"]),y.$off("git-diff",this.initEventBusFn["git-diff"]),y.$off("git-statused",this.initEventBusFn["git-statused"]),y.$off("render-line",this.initEventBusFn["render-line"]),y.$off("file-saved",this.initEventBusFn["file-saved"]),y.$off("file-opened",this.initEventBusFn["file-opened"]),y.$off("editor-format",this.initEventBusFn["editor-format"]),y.$off("minimap-toggle",this.initEventBusFn["minimap-toggle"]),y.$off("window-close",this.initEventBusFn["window-close"])},showEditor(){this.$refs.scroller.clientHeight&&(this.language=this._language||"",this.theme=this._theme||"",this.initRenderData(),this.setScrollerArea(),this.setContentHeight(),this.render(),this.focus(),"diff"!==this.type&&(this.differ.run(),this.preStatus=this.tabData.status))},showDiff(){let e=1,t=0;if(this.language=this.diffObj.language,this._language=this.diffObj.language,this.myContext.insertContent(this.diffObj.diff.deleted.concat(this.diffObj.diff.added).join("\n")),this.diffObj.diff.added.length){let i=this.diffObj.line-this.diffObj.diff.line;e=this.diffObj.deletedLength+i+1,t=this.diffObj.diff.added[i].length}else e=this.diffObj.deletedLength,t=this.diffObj.diff.deleted.peek().length;this.$nextTick((()=>{let i=(e-1)*this.charObj.charHight;if(i=i>0?i:0,i>this.contentHeight-this.scrollerArea.height){let e=i-(this.contentHeight-this.scrollerArea.height);i=this.contentHeight-this.scrollerArea.height,this.$parent.diffMarginTop=-e,this.$parent.setDiffTop()}this.setStartLine(i),this.cursor.setCursorPos({line:e,column:t})}))},showCursor(){if(this.cursorFocus=!0,!this.cursor.multiCursorPos.size)return void(this.hasShowCursor=!1);if(this.hasShowCursor)return;this.hasShowCursor=!0,this.cursorVisible=!0;let e=()=>{clearTimeout(this.curserTimer),this.curserTimer=setTimeout((()=>{this.cursorVisible=!this.cursorVisible,e()}),500)};e()},hideCursor(){clearTimeout(this.curserTimer),this.hasShowCursor=!1,this.cursorFocus=!1},showScrollBar(){this.scrollVisible=!0},hideScrollBar(){this.scrollVisible=!1},focus(){cancelAnimationFrame(this.focusTimer),this.focusTimer=requestAnimationFrame((()=>{this.$refs.textarea&&this.$refs.textarea.focus()}))},render(e){cancelAnimationFrame(this.renderTimer),this.renderBracketMatch(),this.renderTimer=requestAnimationFrame((()=>{this.renderLines(),this.renderSelectedBg(),this.renderError(),this.renderCursor(e),this.$refs.minimap&&this.$refs.minimap.render()}))},renderLines(){let e=[];this.endLine=0,this.renderedLineMap=[],this.renderedIdMap=[],this.renderNumsIdMap=[];for(let i=0,s=this.startLine;i<this.maxVisibleLines&&s<=this.myContext.htmls.length;i++){let t=this.myContext.htmls[s-1],i=this.getRenderObj(t,s),r=this.folder.getFoldByLine(s);e.push(s),this.endLine=s,this.renderedLineMap[s]=i,this.renderedIdMap[t.lineId]=i,r?s=r.end.line:s++}function t(){let t={},i=[],s=this.renderObjs;this.renderObjs=[],s.forEach(((i,s)=>{this.renderedLineMap[i.num]&&s<e.length&&(this.renderObjs[s]=this.renderedLineMap[i.num],this.renderedLineMap[i.num].index=s,t[i.num]=!0)})),e.forEach((e=>{t[e]||i.push(e)})),e.forEach(((e,t)=>{if(!this.renderObjs[t]){let e=this.renderedLineMap[i.pop()];this.renderObjs[t]=e,e.index=t}})),this.renderNums=this.renderObjs.map((e=>{let t={lineId:e.lineId,num:e.num,top:e.top,fold:e.fold};return this.renderNumsIdMap[e.lineId]=t,t})),this.setNumExtraData()}t.call(this)},renderLine(e){let t=this.renderedIdMap[e],i=this.renderNumsIdMap[e];if(t){let s=this.myContext.htmls[t.num-1];if(s&&s.lineId===e){let e=t.bgClass;Object.assign(t,this.getRenderObj(s,t.num)),t.bgClass=e,i.fold=t.fold,this.$set(this.renderObjs,t.index,t),this.$set(this.renderNums,t.index,i),this.renderSelectionToken(t.num),this.renderError(t.num)}}},renderSelectedBgAsync(){this.renderSelectedBgTimer||(this.renderSelectedBgTimer=setTimeout((()=>{this.renderSelectedBg(!0),this.$refs.minimap&&this.$refs.minimap.renderSelectedBg(),this.$refs.minimap&&this.$refs.minimap.renderAllSearchdBg(),this.renderSelectedBgTimer=null}),15))},renderSelectedBg(e){clearTimeout(this.renderSelectedBgTimer),this.renderSelectedBgTimer=null,this.activeLineBg=!0,this.clearSelectionToken(),e&&this.renderObjs.forEach(((e,t)=>{e.bgClass="",this.$set(this.renderObjs,t,e)})),this.fSelecter.ranges.forEach((e=>{this._renderWholeLineBg(e,!0)})),this.selecter.ranges.forEach((e=>{let t=this.fSelecter.getRangeByCursorPos(e.start);this.searchVisible?!t&&e.active&&this._renderWholeLineBg(e):this._renderWholeLineBg(e)})),this.$nextTick((()=>{this.renderSelectionObjs=[],this.fSelecter.ranges.forEach((e=>{this._renderSelectedBg(e,!0)})),this.selecter.ranges.forEach((e=>{let t=this.fSelecter.getRangeByCursorPos(e.start);this.searchVisible?!t&&e.active&&this._renderSelectedBg(e):this._renderSelectedBg(e)}))}))},_renderWholeLineBg(e,t){let i=this.startLine,s=this.endLine,r=e.start,n=e.end,o=!1;if(i=i>r.line+1?i:r.line+1,s=s<n.line-1?s:n.line-1,o=i<=this.startLine&&s>=this.startLine,o=o||i>=this.startLine&&s<=this.endLine,o=o||i<=this.endLine&&s>=this.endLine,o)for(let a=0;a<this.renderObjs.length;a++){let t=this.renderObjs[a];t.num>=i&&t.num<=s&&(t.bgClass="my-select-bg",e.active&&(t.bgClass+=" my-active"),e.active&&e.isFsearch&&this.selectedFg&&(t.bgClass+=" my-select-fg"),this.$set(this.renderObjs,a,t))}r.line!==this.nowCursorPos.line&&n.line!==this.nowCursorPos.line||(this.activeLineBg=!1)},_renderSelectedBg(e,t){let i=e.start,s=e.end,r=this.myContext.htmls[i.line-1].text,n=r.length;if(this.renderedLineMap[i.line]){let o=this.renderedLineMap[i.line];i.left=this.getExactLeft(i),i.line==s.line?(i.width=this.getExactLeft(s)-i.left||10,i.width+="px"):(i.width=this.getExactLeft({line:i.line,column:r.length})-i.left||10,i.width+="px"),i.left+="px",this.renderSelectionObjs.push({left:i.left,top:o.top,width:i.width,active:e.active,isFsearch:t}),s.line==i.line&&(n=s.column),e.active&&this._renderSelectionToken(i.line,i.column,n)}if(s.line>i.line&&this.renderedLineMap[s.line]){let i=this.renderedLineMap[s.line];s.left="0px",r=this.myContext.htmls[s.line-1].text,s.width=this.getExactLeft(s)||10,s.width+="px",this.renderSelectionObjs.push({left:s.left,top:i.top,width:s.width,active:e.active,isFsearch:t}),e.active&&this._renderSelectionToken(s.line,0,s.column)}},renderSelectionToken(e){if(!this.selectedFg)return;let t=this.selecter.getRangeByLine(e);t.forEach((t=>{if(t.active){let i=t.start.column,s=t.end.column;t.start.line===e?t.end.line>t.start.line&&(s=this.myContext.htmls[t.start.line-1].text.length):i=0,this._renderSelectionToken(e,i,s)}}))},_renderSelectionToken(e,t,i){if(!this.selectedFg)return;let s=this.myContext.htmls[e-1],r=s.tokens,n=["selected"],o=[];r||(r=[{startIndex:0,endIndex:lineText.length,scopes:["plain"]}],r=this.tokenizer.splitLongToken(r)),this.myContext.fgLines.push(e);for(let a=0;a<r.length;a++){let e=r[a];if(e.startIndex<=t&&e.endIndex>t){if(e.startIndex<t&&o.push({startIndex:e.startIndex,endIndex:t,scopes:e.scopes}),e.endIndex>i){o.push({startIndex:t,endIndex:i,scopes:n}),o.push({startIndex:i,endIndex:e.endIndex,scopes:e.scopes}),o=o.concat(r.slice(a+1));break}o.push({startIndex:t,endIndex:e.endIndex,scopes:n})}else if(e.startIndex>t&&e.endIndex<=i)o.push({startIndex:e.startIndex,endIndex:e.endIndex,scopes:n});else{if(e.startIndex<i&&e.endIndex>i){o.push({startIndex:e.startIndex,endIndex:i,scopes:n}),o.push({startIndex:i,endIndex:e.endIndex,scopes:e.scopes}),o=o.concat(r.slice(a+1));break}if(e.startIndex>=i){o=o.concat(r.slice(a));break}o.push(e)}}s.html=this.tokenizer.createHtml(o,s.text),this.renderedIdMap[s.lineId].html=s.html,this.$nextTick((()=>{s.fgTokens=o}))},renderBracketMatch(){clearTimeout(this.bracketMatchTimer),this.bracketMatchTimer=setTimeout((()=>{this.bracketMatch=null,this.folder.getBracketMatch(this.nowCursorPos,(e=>{let t=null,i=null;this.bracketMatch=e,this.bracketMatch&&(t=this.myContext.htmls[this.bracketMatch.start.line-1],i=this.bracketMatch.start,i.width=this.getStrWidth(t.text,i.startIndex,i.endIndex)+"px",i.left=this.getStrWidth(t.text,0,i.startIndex)+"px",i.top=(this.folder.getRelativeLine(i.line)-1)*this.charObj.charHight-this.deltaTop+"px",t=this.myContext.htmls[this.bracketMatch.end.line-1],i=this.bracketMatch.end,i.width=this.getStrWidth(t.text,i.startIndex,i.endIndex)+"px",i.left=this.getStrWidth(t.text,0,i.startIndex)+"px",i.top=(this.folder.getRelativeLine(i.line)-1)*this.charObj.charHight-this.deltaTop+"px")}))}),100)},clearSelectionToken(){this.renderObjs.forEach((e=>{e.selected=!1})),this.myContext.fgLines.forEach((e=>{this._clearSelectionToken(e)})),this.myContext.fgLines.empty()},_clearSelectionToken(e){let t=this.myContext.htmls[e-1],i=this.renderedLineMap[e];t&&t.fgTokens&&(t.fgTokens=null,i&&(i.html=this.tokenizer.createHtml(t.tokens,t.text)),t.html="")},renderCursor(e){let t=this;function i(e){let i=[];t.cursor.getCursorsByLine(e.num).forEach((t=>{i.push({top:e.top,left:s(t)})})),t.renderCursorObjs.push(i)}function s(e){let i=0;if(!e.del)return i=t.getExactLeft(e),t.scrollToCursor&&e===t.nowCursorPos&&(i>t.scrollerArea.width+t.scrollLeft-t.charObj.fullAngleCharWidth?t.scrollLeft=i+t.charObj.fullAngleCharWidth-t.scrollerArea.width:i<t.scrollLeft&&(t.scrollLeft=i-1)),e===t.nowCursorPos&&(t.cursorLeft=i-t.scrollLeft),i+"px"}this.scrollToCursor=e,this.renderCursorTimer||(this.renderCursorTimer=requestAnimationFrame((()=>{this.renderCursorTimer=null,this.renderCursorObjs=[],this.renderObjs.forEach((e=>{i(e)})),this.cursorVisible=!0,this.$refs.minimap&&(this.$refs.minimap.renderCursor(),this.$refs.minimap.renderAllCursor())})))},renderError(e){function t(){let t=u()(this.$refs.content),r={};t.find("span.my-token-error").remove(),this.errors.forEach((t=>{let n=t.line+","+t.originColumn,o=null;if(!(e&&t.line!==e||r[n])){if(r[n]=!0,o=this.myContext.htmls[t.line-1],t.endLine||(t.endLine=t.line),t.column>=o.text.length&&(t.column=o.text.length-1),!t.endColumn){let e=null;(e=this.wordPattern.exec(o.text.slice(t.column)))?t.endColumn=t.column+e[0].length:t.endColumn=t.column+1}if(t.endColumn>o.text.length&&(t.endColumn=o.text.length),t.line===t.endLine)i.call(this,t.line,t.column,t.endColumn,n);else{i.call(this,t.line,t.column,o.text.length,n),i.call(this,t.endLine,0,t.endColumn,n);for(let e=t.line+1;e<t.endLine;e++)s.call(this,e,n)}}}))}function i(e,t,i,s){if(e<this.startLine||e>=this.startLine+this.maxVisibleLines||e>this.maxLine)return;let r=0,n=this.myContext.htmls[e-1],o=u()(this.$refs.content),a=o.find(`div.my-code[data-line="${e}"]`).children("span");for(let c=0;c<a.length;c++){let e=a[c].getAttribute("data-column"),i=a[c].getAttribute("data-end");if(e<=t&&i>=i){r=a[c].offsetLeft+this.getStrWidth(n.text,e,t);break}}let l=this.getStrWidth(n.text,t,i)||this.charObj.charWidth,h=`<span class="my-token-error" style="width:${l}px;left:${r}px" data-key="${s}"></span>`;o.find(`div.my-line[data-line="${e}"]`).append(h)}function s(e,t){if(e<this.startLine||e>=this.startLine+this.maxVisibleLines||e>this.maxLine)return;let i=u()(this.$refs.content),s=`<span class="my-token-error" style="width:100%;left:0px" data-key="${t}"></span>`;i.find(`div.my-line[data-line="${e}"]`).append(s)}this.$nextTick((()=>{t.call(this)}))},foldLine(e){let t=this.folder.foldLine(e);this.focus(),t&&(this.cursor.multiCursorPos.forEach((i=>{if(i.line>e&&i.line<t.end.line){let t=this.myContext.htmls[e-1];i.line=e,i.column=t.text.length}})),this.setContentHeight(),this.render(),this.$refs.minimap&&this.$refs.minimap.renderAllDiff())},unFold(e){this.focus(),this.folder.unFold(e)&&(this.setContentHeight(),this.render(),this.$refs.minimap&&this.$refs.minimap.renderAllDiff())},openSearch(e){let t=this.$refs.searchDialog;if(!this.searchVisible||!this.fSelecter.activedRanges.size&&this.cursorFocus){if(this.cursorFocus){let e=this.fSearcher.getSearchConfig();if(e)t.initData({matchCase:e.matchCase,wholeWord:e.wholeWord,text:e.text});else if(this.searchVisible)return}this.searchVisible=!0,this.fSearcher.clearSearch(),this.searchText({config:t.getData()}),t.initData({replaceVisible:!!e}),t.focus()}},searchWord(e){let t=null;if(this.searcher.search({direct:e}),this.searchVisible){if(0===this.fSelecter.activedRanges.size){let i=this.fSearcher.getSearchConfig();i&&(this.fSearcher.clearSearch(),t=this.fSearcher.search({direct:e,increase:!0}))}else t=this.fSearcher.search({direct:e,increase:!0});t&&(this.searchNow=t.now,this.searchCount=t.count)}},searchText(e){let t=this.fSearcher.search(e);t?(this.searchNow=t.now,this.searchCount=t.count):this.searchCount=0},replace(e){if(this.fSelecter.activedRanges.size){let t=this.fSearcher.getNowRange();this.myContext.replace(e.text,[t]).then((()=>{this.searchText()}))}else this.searchText()},replaceAll(e){this.fSelecter.ranges.size&&this.myContext.replace(e.text,this.fSelecter.ranges.toArray()).then((()=>{this.fSearcher.clearSearch(),this.searchCount=0}))},prevAutoTip(){this.$refs.autoTip.prev()},nextAutoTip(){this.$refs.autoTip.next()},selectAutoTip(){let e=this.$refs.autoTip.getActiveIndex();this.onClickAuto(this.autoTipList[e])},moveSelection(e,t,i){let s=this,r=i||this.folder.getRelativeLine(this.nowCursorPos.line),n=this.nowCursorPos.column,o=0;function a(e,t){let i=r,a=n;switch(e){case"up":o+=t,i=Math.floor(o/s.charObj.charHight),i=r-i,a=0;break;case"down":o+=t,i=Math.floor(o/s.charObj.charHight),i=r+i;break;case"left":o+=t,a=Math.floor(o/s.charObj.charWidth),a=n-a;break;case"right":o+=t,a=Math.floor(o/s.charObj.charWidth),a=n+a;break}i=s.folder.getRealLine(i),i=i<1?1:i>s.maxLine?s.maxLine:i,a="down"===e?s.myContext.htmls[i-1].text.length:a<0?0:a>s.myContext.htmls[i-1].text.length?s.myContext.htmls[i-1].text.length:a,s.mouseStartObj.cursorPos=s.cursor.setCursorPos({line:i,column:a}),s.mouseStartObj.preRange=s.selecter.setRange(s.mouseStartObj.start,{line:i,column:a})}H.scheduler.removeUiTask(this.moveTask),this.moveTask=H.scheduler.addUiTask((()=>{a(e,t)}))},scrollToLine(e){let t=(e-1)*this.charObj.charHight-this.scrollerArea.height/2;t=t>0?t:0,this.setStartLine(t)},setData(e,t){"function"!==typeof this[e]&&(this[e]=t)},setDiffObjs(e){this.diffRanges=e,this.$refs.minimap&&this.$refs.minimap.renderAllDiff(!0)},setNumExtraData(){this.renderNums=this.renderNums.map((e=>{if("diff"===this.type)e._num=e.num-this.diffObj.deletedLength>0?e.num-this.diffObj.deletedLength+this.diffObj.beforeLine:"";else{let t=this.getPrevDiff(this.diffRanges,e.num),i=t&&Tt[t.type]||"";"delete"===i&&(t.line===e.num+1?i+="-bottom":i+="-top"),e.diffType=i&&"my-diff-"+i||"",e._num=e.num}return e}))},setNowCursorPos(e){if(this.nowCursorPos=e||{line:1,column:0},e){let t=this.setNowCursorPosId+1||1;this.setNowCursorPosId=t,this.$nextTick((()=>{if(this.setNowCursorPosId!=t)return;let i=this.folder.getRelativeLine(e.line+1)*this.charObj.charHight;if(i>this.scrollTop+this.scrollerArea.height)i=i>this.contentHeight?this.contentHeight:i,this.setStartLine(i-this.scrollerArea.height);else if(e.line<=this.startLine){let t=(this.folder.getRelativeLine(e.line)-1)*this.charObj.charHight;this.setStartLine(t)}this.$nextTick((()=>{this.active&&this.renderCursor(!0)}))}))}},setScrollerArea(){this.scrollerArea={height:this.$refs.scroller.clientHeight,width:this.$refs.scroller.clientWidth},this.maxContentHeight=10*this.scrollerArea.height},setContentHeight(){let e=this.myContext.htmls.length,t=0;e=this.folder.getRelativeLine(e),t=e*this.charObj.charHight,this.scrollerArea.height&&("diff"===this.type?t+=14:t+=this.scrollerArea.height-this.charObj.charHight),this.contentHeight=t},setDiffTop(){let e=(this.folder.getRelativeLine(this.diffLine)-1)*this.charObj.charHight-this.scrollTop;this.diffTop=e+this.diffMarginTop,this.diffTop-30<-this.scrollTop&&(this.diffTop=30-this.scrollTop)},setStartLine(e,t){let i=1,s=this.contentHeight-this.scrollerArea.height;e=e<0?0:e,s=s<0?0:s,e>s&&(e=s),!t&&Math.abs(e-this.scrollTop)<1||(i=Math.floor(e/this.charObj.charHight),i++,this.deltaTop=Math.floor(e/this.maxContentHeight)*this.maxContentHeight,this.startLine=this.folder.getRealLine(i),this.scrollTop=e,this.diffLine&&this.setDiffTop(),this.tokenizer.tokenizeVisibleLins(),this.render())},setErrors(e){function t(e,t){let i=0;while(i<t.length){let s=t[i].line,r=[];while(i<t.length&&t[i].line===s){let n=s+","+t[i].column;t[i].originColumn=t[i].column,r.push(t[i].reason),e[n]?e[n]+="<br>"+t[i].reason:e[n]=t[i].reason,i++}s=s||this.htmls.length,e[s]=r.join("<br>")}}this.errorMap={},this.errors=e,t.call(this,this.errorMap,e),this.renderError()},setAutoTip(e){clearTimeout(this.setAutoTip.hideTimer),e&&e.length?(e.forEach((e=>{e.active=!1})),this.autoTipList=e,this.autoTipList[0].active=!0,this.$nextTick((()=>{let e=this.$refs.autoTip.$el.clientWidth,t=this.$refs.autoTip.$el.clientHeight;this.autoTipStyle.top=this.folder.getRelativeLine(this.nowCursorPos.line)*this.charObj.charHight-this.deltaTop,this.autoTipStyle.left=this.getExactLeft(this.nowCursorPos),this.autoTipStyle.top+t>this.deltaTop+this.$refs.scroller.clientHeight&&(this.autoTipStyle.top-=t+this.charObj.charHight),this.autoTipStyle.left+e>this.scrollLeft+this.scrollerArea.width&&(this.autoTipStyle.left-=e),this.autoTipStyle.top+="px",this.autoTipStyle.left+="px"}))):this.setAutoTip.hideTimer=setTimeout((()=>{this.autoTipList=null}),60)},getRenderObj(e,t){let i=this.getTabNum(t),s="",r=(this.folder.getRelativeLine(t)-1)*this.charObj.charHight-this.deltaTop+"px";this.folder.getFoldByLine(t)?s="close":this.folder.getRangeFold(t,!0)&&(s="open");let n=e.html;if(!n){let t=e.tokens&&this.tokenizer.splitLongToken(e.tokens);n=this.tokenizer.createHtml(t,e.text),e.tokens&&(e.tokens=t,e.html=n)}return{lineId:e.lineId,html:n,num:t,top:r,tabNum:i,fold:s,bgClass:"",isFsearch:!1,selected:!1,selection:[],cursorList:[]}},getTabNum(e){let t=this.myContext.htmls[e-1],i=t.text,s=/[^\s]/,r=0;if(t.tabNum>-1)return t.tabNum;if(s.exec(i)){let e=/^\s+/.exec(i);e&&(r=/\t+/.exec(e[0]),r=r&&r[0].length||0,r+=Math.ceil((e[0].length-r)/this.tabSize))}else{let t=e-1;while(t>=1){if(s.exec(this.myContext.htmls[t-1].text)){r=this.getTabNum(t),this.folder.getRangeFold(t,!0)&&r++;break}t--}}return t.tabNum=r,r},getStrWidth(e,t,i){return v.getStrWidth(e,this.charObj.charWidth,this.charObj.fullAngleCharWidth,this.tabSize,t,i)},getStrWidthByLine(e,t,i){return this.getStrWidth(this.myContext.htmls[e-1].text,t,i)},getColumnByWidth(e,t){let i,s,r,n,o=0,a=e.length;while(o<a){if(i=Math.floor((o+a)/2),s=this.getStrWidth(e,0,i),r=e[i-1]&&this.getStrWidth(e[i-1])/2,n=e[i]&&this.getStrWidth(e[i])/2||r,s>=t&&s-t<r||t>=s&&t-s<n){o=i;break}s>t?a=i:o=i+1}return o},getPosByEvent(e){let t=u()(e.target),i=(t.attr("data-line")||t.parent().attr("data-line"))-0,s=t.attr("data-column"),r=t.attr("data-end");if(!i){if(e.target!==this.$refs.content)return null;i=this.myContext.htmls.length}let n=this.myContext.htmls[i-1];n.fgTokens||n.tokens;return s?(s-=0,r-=0,s+=this.getColumnByWidth(n.text.slice(s,r),e.offsetX)):s=n.text.length,{line:i,column:s}},getExactLeft(e){let t=this.myContext.htmls[e.line-1],i=document.getElementById(this._lineId(e.line)),s=0,r=null;i=i&&i.querySelector("div.my-code").children||[];for(let n=0;n<i.length;n++){let t=i[n].getAttribute("data-column");if(!(t<=e.column))break;s=t,r=i[n]}return r?r.offsetLeft+this.getStrWidth(t.text.slice(s,e.column)):0},getPrevDiff(e,t){if(!e)return null;for(let i=0;i<e.length;i++){let s=e[i];if(!(s.line<=t))return s.line===t+1&&t===this.maxLine?s:null;if("D"===s.type){if(s.line===t)return s}else if(s.line+s.added.length>t)return s}},onContextmenu(e){"diff"!==this.type?this.$refs.menu.show(e):this.focus()},onClickAuto(e){this.myContext.replaceTip(e),this.autoTipList=null,this.focus()},onToggleFold(e){this.folder.getFoldByLine(e)?this.unFold(e):this.foldLine(e)},onContentMdown(e){if(3==e.which)return;let t=this.getPosByEvent(e),i=null;if(this.mouseStartObj={time:Date.now(),start:t},e.ctrlKey&&"ctrl"===this.cursor.multiKeyCode||e.altKey&&"alt"===this.cursor.multiKeyCode){let e=this.selecter.getRangeWithCursorPos(t);e&&this.selecter.removeRange(e),i=this.cursor.addCursorPos(t)}else i=this.cursor.setCursorPos(t),3!==e.which&&this.searcher.clearSearch();3!=e.which&&(this.fSearcher.clearActive(),this.mouseUpTime&&Date.now()-this.mouseUpTime<200&&(this.mouseStartObj.doubleClick=!0,this.searchWord())),this.mouseStartObj.cursorPos=i,this.searcher.clearSearch(!0),this.focus()},onErrorMousemove(e,t){let i=document.getElementById(`${this._lineId(t)}`).querySelectorAll("span.my-token-error")||[],s=e.clientX-u()(this.$refs.content).offset().left;for(let n=0;n<i.length;n++){let t=i[n],o=t.clientWidth,a=t.offsetLeft;if(s>=a&&s<=a+o){r.call(this,e,t.getAttribute("data-key"));break}}function r(e,t){let i=u()(this.$refs.editor),s=u()(this.$refs.tip.$el),r=i.offset(),n=e.clientY-r.top,o=e.clientX-r.left;this.tipContent=this.errorMap[t],this.$nextTick((()=>{n+s[0].clientHeight>this.scrollerArea.height&&(n=this.scrollerArea.height-s[0].clientHeight),this.tipStyle={left:o+10+"px",top:n+10+"px"}}))}},onContentMmove(e){if(this.mouseStartObj&&Date.now()-this.mouseStartObj.time>100){let t=this.getPosByEvent(e);if(t&&v.comparePos(t,this.mouseStartObj.cursorPos)){let e=this.selecter.getRangeWithCursorPos(t);e&&this.selecter.removeRange(e),this.cursor.removeCursor(this.mouseStartObj.cursorPos),this.mouseStartObj.cursorPos=this.cursor.addCursorPos({line:t.line,column:t.column}),this.mouseStartObj.preRange?this.selecter.updateRange(this.mouseStartObj.preRange,{start:this.mouseStartObj.start,end:t}):this.mouseStartObj.preRange=this.selecter.addRange({start:this.mouseStartObj.start,end:t}),this.cursor.removeCursorInRange(this.mouseStartObj.preRange)}}function t(e){let t=u()(e.target),i=t.parent().attr("data-line");this.tipContent="",i&&this.onErrorMousemove(e,i)}t.call(this,e)},onContentMLeave(){this.tipContent=""},onDocumentMmove(e){let t=u()(this.$refs.scroller).offset();if(this.mouseStartObj&&Date.now()-this.mouseStartObj.time>100){let i=Math.ceil((this.scrollTop+e.clientY-t.top)/this.charObj.charHight);i=i<1?1:i,i=i>this.maxLine?this.maxLine:i,e.clientY>t.top+this.scrollerArea.height?this.moveSelection("down",e.clientY-t.top-this.scrollerArea.height):e.clientY<t.top?this.moveSelection("up",t.top-e.clientY):e.clientX<t.left?this.moveSelection("left",t.left-e.clientX,i):e.clientX>t.left+this.scrollerArea.width?this.moveSelection("right",e.clientX-t.left-this.scrollerArea.width,i):H.scheduler.removeUiTask(this.moveTask)}if(this.diffBottomSashMouseObj){let t=this.diffHeight+=e.clientY-this.diffBottomSashMouseObj.clientY;t<this.charObj.charHight+16&&(t=this.charObj.charHight+16),t+this.diffTop>this.scrollerArea.height&&(t=this.scrollerArea.height-this.diffTop),this.diffHeight=t,this.diffBottomSashMouseObj=e}},onDocumentMouseUp(e){H.scheduler.removeUiTask(this.moveTask),this.moveTask=null,this.mouseStartObj=null,this.diffBottomSashMouseObj=null,this.mouseUpTime=Date.now(),this.$refs.searchDialog&&this.$refs.searchDialog.directBlur()},onDiffBottomSashBegin(e){this.diffBottomSashMouseObj=e},onScroll(){this.$refs.numScroller.scrollTop=0,this.$refs.scroller.scrollTop=0,this.$refs.scroller.scrollLeft=0},onWheel(e){this.scrollDeltaY=e.deltaY,this.scrollDeltaX=e.deltaX,!this.scrollDeltaY&&!this.scrollDeltaX||this.wheelTask||(this.wheelTask=H.scheduler.addUiTask((()=>{if(this.scrollDeltaY){try{this.setStartLine(this.scrollTop+this.scrollDeltaY)}catch(e){console.log(e)}this.scrollDeltaY=0}else if(this.scrollDeltaX){let e=this.scrollLeft+this.scrollDeltaX;e>this._contentMinWidth-this.scrollerArea.width&&(e=this._contentMinWidth-this.scrollerArea.width),e=e<0?0:e,this.scrollLeft=e,this.scrollDeltaX=0}else H.scheduler.removeUiTask(this.wheelTask),this.wheelTask=null})))},onVBarScroll(e){this.setStartLine(e)},onHBarScroll(e){this.scrollLeft=e},onCompositionstart(){this.editAble&&(clearTimeout(this.compositionendTimer),this.compositionstart=!0)},onCompositionend(){if(this.compositionstart){let e=this.$refs.textarea.value||"";e&&(this.myContext.insertContent(e),this.autocomplete.search(),this.$refs.textarea.value="")}this.compositionendTimer=setTimeout((()=>{this.compositionstart=!1}),100)},onInput(){if(this.editAble&&!this.compositionstart){let e=this.$refs.textarea.value||"";e&&(this.myContext.insertContent(e),this.autocomplete.search(),this.$refs.textarea.value="")}},onCopy(e){let t=window.clipboardData?"Text":"text/plain",i=e.clipboardData||window.clipboardData;i.setData(t,this.myContext.getCopyText())},onCut(e){let t=window.clipboardData?"Text":"text/plain",i=e.clipboardData||window.clipboardData;i.setData(t,this.myContext.getCopyText(this.editAble))},onPaste(e){if(!this.editAble)return;let t=window.clipboardData?"Text":"text/plain",i=e.clipboardData||window.clipboardData,s="";s=i.getData(t),this.myContext.insertContent(s)},onFocus(){this.showCursor()},onBlur(){this.hideCursor()},onKeydown(e){this.editAble&&this.shortcut.onKeydown(e)},onSearch(e){this.fSearcher.clearSearch(),this.searchText({config:e})},onSearchNext(){this.searchText({direct:"next"})},onSearchPrev(){this.searchText({direct:"up"})},onCloseSearch(){this.focus(),this.fSelecter.activedRanges.size&&this.searcher.clone(this.fSearcher.getCacheData()),this.fSearcher.clearSearch(),this.searchVisible=!1},onShowDiff(e){let t=this.getPrevDiff(this.diffRanges,e);this.diffLine=e,this.diffVisible=!1,this.diffMarginTop=0,this.diffHeight=(t.added.length+t.deleted.length)*this.charObj.charHight+16,this.diffHeight=this.diffHeight>200?200:this.diffHeight,this.setDiffTop(),this.$nextTick((()=>{this.diffVisible=!0,this.diffTabData=Object.assign({},this.tabData),this.diffTabData.id="diff-"+this.tabData.id,this.toShowdiffObj={maxLine:this.maxLine,language:this.language,states:t.line>1?this.myContext.htmls[t.line-2].states:null,diff:t,line:e,beforeLine:t.line-1,deletedLength:t.deleted.length}}))},onCloseDiff(){this.diffVisible=!1}}},Lt=kt,St=(0,Fe.Z)(Lt,l,h,!1,null,null,null),Pt=St.exports,Et=function(){var e=this,t=e._self._c;return t("div",{ref:"editorBar",staticClass:"my-editor-bar",on:{selectstart:function(e){e.preventDefault()}}},[t("div",{staticClass:"bar-scroller my-scroll-overlay my-scroll-mini"},e._l(e.editorList,(function(i){return t("div",{staticClass:"bar-item my-hover",class:[i.active?"my-active":""],attrs:{title:i.path},on:{click:function(t){return e.onClickItem(i.id)},contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu(t,i.id)}}},[t("div",{staticClass:"bar-content",class:[i.icon]},[t("span",{class:[i.statusColor]},[t("span",{staticClass:"bar-text"},[e._v(e._s(i.name))]),"!!"!==i.status?t("span",{staticClass:"bar-status"},[e._v(e._s(i.status))]):e._e()]),t("div",{staticClass:"bar-icon"},[t("span",{directives:[{name:"show",rawName:"v-show",value:i.saved,expression:"item.saved"}],staticClass:"bar-close-icon iconfont icon-close",attrs:{title:"close"},on:{click:function(t){return t.stopPropagation(),e.onClose(i.id)}}}),t("span",{directives:[{name:"show",rawName:"v-show",value:!i.saved,expression:"!item.saved"}],staticClass:"bar-dot"})])])])})),0),t("editor-bar-menu",{ref:"editorBarMenu"})],1)},It=[],_t=function(){var e=this,t=e._self._c;return t("div",{ref:"wrap"},[t("Menu",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})],1)},Dt=[],Mt={name:"EditorBarMenu",components:{Menu:Re},data(){return{menuList:[[{name:"Close",op:"close",shortcut:"Ctrl+F4"},{name:"Close to the Left",op:"closeToLeft"},{name:"Close to the Right",op:"closeToRight"},{name:"Close Saved",op:"closeSaved",shortcut:"Ctrl+K U"},{name:"Close Other",op:"closeOther"},{name:"Close All",op:"closeAll",shortcut:"Ctrl+K W"}]],menuVisible:!1,menuStyle:{left:"10px",top:"40px"}}},created(){this.initEventBus()},methods:{initEventBus(){y.$on("close-menu",(()=>{this.menuVisible=!1}))},show(e,t){this.tabId=t,this.menuVisible=!0;let i=u()(this.$refs.wrap).parent();this.$nextTick((()=>{let t=i.offset(),s=this.$refs.menu.$el.clientWidth;s+e.clientX>t.left+i[0].clientWidth?this.menuStyle.left=e.clientX-t.left-s+"px":this.menuStyle.left=e.clientX-t.left+"px",this.menuStyle.top=e.clientY-t.top+"px"}))},onMenuChange(e){switch(e.op){case"close":y.$emit("editor-close",this.tabId);break;case"closeToLeft":y.$emit("editor-close-to-left",this.tabId);break;case"closeToRight":y.$emit("editor-close-to-right",this.tabId);break;case"closeSaved":y.$emit("editor-close-saved",this.tabId);break;case"closeOther":y.$emit("editor-close-other",this.tabId);break;case"closeAll":y.$emit("editor-close-all",this.tabId);break}this.menuVisible=!1}}},$t=Mt,Ft=(0,Fe.Z)($t,_t,Dt,!1,null,null,null),Ot=Ft.exports,Bt=class{constructor(e){this.editorBar=e}onKeydown(e){if(e.ctrlKey)if(this.pressK)switch(this.pressK=!1,e.keyCode){case 85:e.preventDefault(),this.editorBar.$emit("close-saved");break;case 87:e.preventDefault(),this.editorBar.$emit("close-all");break}else switch(e.keyCode){case 75:e.preventDefault(),this.pressK=!0;break;case 115:e.preventDefault(),this.editorBar.$emit("close");break}}};window.require("path");var At={name:"EditorBar",components:{EditorBarMenu:Ot},props:{editorList:{type:Array}},data(){return{list:[]}},provide(){return{rootList:this.list}},created(){this.shortcut=new Bt(this),this.initEventBus(),u()(window).on("keydown",(e=>{this.shortcut.onKeydown(e)}))},methods:{initEventBus(){y.$on("editor-changed",(e=>{this.scrollToView()})),y.$on("git-statused",(e=>{for(let t=0;t<this.editorList.length;t++){let i=this.editorList[t],s=null,r="";if(i.path===e.path){s=v.getFileStatus(i.path),r=s.statusColor,s=s.status,i.status!==s&&(i.status=s,i.statusColor=r,this.$set(this.editorList,t,i));break}}})),y.$on("file-renamed",(e=>{for(let t=0;t<this.editorList.length;t++){let i=this.editorList[t];if(i.path===e.path){i.status="D",i.statusColor=v.getFileStatusColor("D"),this.$set(this.editorList,t,i);break}}}))},scrollToView(){function e(){let e=u()(this.$refs.editorBar).find("div.my-active");e.length&&e[0].scrollIntoView()}e.call(this),setTimeout((()=>{e.call(this)}),300)},onClickItem(e){y.$emit("editor-change",e)},onClose(e){y.$emit("editor-close",e)},onContextmenu(e,t){this.$refs.editorBarMenu.show(e,t)}}},Ht=At,Nt=(0,Fe.Z)(Ht,Et,It,!1,null,null,null),Rt=Nt.exports,Wt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-title-bar my-width-100",style:{height:e.height+"px"},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[t("div",{staticClass:"my-height-100 my-center-between"},[t("div",{staticClass:"menu-bar"},[t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("fileMenuVisible")}}},[t("span",[e._v("File")]),e.fileMenuVisible?t("Menu",{attrs:{hoverCheck:!0,menuList:e.fileMenuList,styles:{left:0,top:e._top}},on:{change:e.onFileMenuChange}}):e._e()],1),t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("editMenuVisible")}}},[t("span",[e._v("Edit")]),e.editMenuVisible?t("Menu",{attrs:{hoverCheck:!0,menuList:e.editMenuList,styles:{left:0,top:e._top}},on:{change:e.onEditMenuChange}}):e._e()],1),t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("selectionMenuVisible")}}},[t("span",[e._v("Selection")]),e.selectionMenuVisible?t("Menu",{attrs:{hoverCheck:!0,menuList:e.selectionMenuList,styles:{left:0,top:e._top}},on:{change:e.onSelectionMenuChange}}):e._e()],1),t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("viewMenuVisible")}}},[t("span",[e._v("View")]),e.viewMenuVisible?t("Menu",{attrs:{hoverCheck:!0,"left-select":!0,menuList:e.viewMenuList,styles:{left:0,top:e._top}},on:{change:e.onViewMenuChange}}):e._e()],1),t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("preferenceMenuVisible")}}},[t("span",[e._v("Preference")]),e.preferenceMenuVisible?t("Menu",{attrs:{hoverCheck:!0,menuList:e.preferenceMenuList,styles:{left:0,top:e._top}},on:{change:e.onPreferenceMenuChange}}):e._e()],1)]),"app"===e.mode?t("div",{staticClass:"bar-right"},[t("div",{staticClass:"bar-item my-hover",staticStyle:{width:"35px",height:"35px"},on:{click:e.onMinimize}},[t("span",{staticClass:"iconfont icon-zuixiaohua"})]),e.maximize?t("div",{staticClass:"bar-item my-hover",staticStyle:{width:"35px",height:"35px"},on:{click:e.onUnmaximize}},[t("span",{staticClass:"iconfont icon-huanyuan"})]):t("div",{staticClass:"bar-item my-hover",staticStyle:{width:"35px",height:"35px"},on:{click:e.onMaximize}},[t("span",{staticClass:"iconfont icon-zuidahua"})]),t("div",{staticClass:"bar-item my-hover-danger",staticStyle:{width:"35px",height:"35px"},on:{click:e.onClose}},[t("span",{staticClass:"iconfont icon-close",staticStyle:{"font-size":"18px"}})])]):e._e()])])},jt=[],Vt=class{constructor(){}onKeydown(e){if(e.ctrlKey)if(this.pressK)switch(this.pressK=!1,e.keyCode){case 79:e.preventDefault(),y.$emit("folder-open");break}else switch(e.keyCode){case 75:e.preventDefault(),this.pressK=!0;break;case 78:e.preventDefault(),y.$emit("file-open");break;case 79:e.preventDefault(),y.$emit("file-open",null,!0);break}}};const zt=window.require("@electron/remote"),Yt=zt&&zt.getCurrentWindow();var Kt={name:"TitleBar",props:{height:{type:Number,default:25}},components:{Menu:Re},data(){return{fileMenuVisible:!1,editMenuVisible:!1,selectionMenuVisible:!1,viewMenuVisible:!1,terminalMenuVisible:!1,preferenceMenuVisible:!1,maximize:!1,mode:zt?"app":"web",fileMenuList:[[{name:"New File",op:"newFile",shortcut:"Ctrl+N"}],[{name:"Add Folder to Workspace",op:"addFolder"},{name:"Save Workspace As",op:"saveWorkspaceAs"}],[{name:"Save",op:"saveFile",shortcut:"Ctrl+S"},{name:"Save As",op:"saveFileAs",shortcut:"Ctrl+Shift+S"}]],editMenuList:[[{name:"Undo",op:"undo",shortcut:"Ctrl+Z"},{name:"Redo",op:"redo",shortcut:"Ctrl+Y"}],[{name:"Cut",op:"cut",shortcut:"Ctrl+X"},{name:"Copy",op:"copy",shortcut:"Ctrl+C"},{name:"Paste",op:"paste",shortcut:"Ctrl+V"}],[{name:"Delete Line",op:"deleteLine",shortcut:"Ctrl+Shift+K"}],[{name:"Find",op:"find",shortcut:"Ctrl+F"},{name:"Replace",op:"replace",shortcut:"Ctrl+H"}],[{name:"Find in Files",op:"findInFiles",shortcut:"Ctrl+Shift+F"},{name:"Replace in Files",op:"replaceInFiles",shortcut:"Ctrl+Shift+H"}]],selectionMenuList:[[{name:"Select All",op:"selectAll",shortcut:"Ctrl+A"}],[{name:"Copy Line Up",op:"copyLineUp",shortcut:"Ctrl+Shift+D"},{name:"Copy Line Down",op:"copyLineDown",shortcut:"Alt+Shift+Down"},{name:"Move Line Up",op:"moveLineUp",shortcut:"Ctrl+Shift+Up"},{name:"Move Line Down",op:"moveLineDown",shortcut:"Ctrl+Shift+Down"},{name:"Go to Line",op:"gotoLine",shortcut:"Ctrl+G"}],[{name:"Add Cursor Above",op:"addCursorAbove",shortcut:"Ctrl+Alt+Up"},{name:"Add Cursor Below",op:"addCursorBelow",shortcut:"Ctrl+Alt+Down"},{name:"Add Cursor to Line Ends",op:"addCursorLineEnds",shortcut:"Ctrl+Shift+L"},{name:"Add Next Occurence",op:"addNextOccurence",shortcut:"Ctrl+D"},{name:"Add Previous Occurence",op:"addPrevOccurence",shortcut:"Shift+D"},{name:"Select All Occurence",op:"selectAllOccurence"}],[{name:"Switch Alt+Click to Multi-Cursor",op:"switchMultiKeyCode",keyCode:"ctrl"}]],viewMenuList:[[{name:"Command Palette",op:"commandPanel",shortcut:"Ctrl+P"},{name:"Terminal",op:"toggleTerminal",shortcut:"Ctrl+`",selected:globalData.views.terminal},{name:"Minimap",op:"toggleMinimap",shortcut:"Ctrl+Shift+M",selected:globalData.views.minimap},{name:"Sidebar",op:"toggleSidebar",shortcut:"Ctrl+Shift+L",selected:globalData.views.sidebar},{name:"Statusbar",op:"toggleStatusbar",shortcut:"Ctrl+Shift+B",selected:globalData.views.statusbar}]],terminalMenuList:[[{name:"New Terminal",op:"newTerminal"}]],preferenceMenuList:[[{name:"Color Theme",op:"changeTheme"},{name:"Icon Theme",op:"changeIconTheme"}]]}},computed:{_top(){return this.height+2+"px"}},created(){"app"===this.mode&&this.fileMenuList.splice(1,0,[{name:"Open File",op:"openFile",shortcut:"Ctrl+O"},{name:"Open Folder",op:"openFolder",shortcut:"Ctrl+K Ctrl+O"},{name:"Open Workspace",op:"openWorkspace"}]),this.shortcut=new Vt(this),this.initEventBus(),u()(window).on("keydown",(e=>{this.shortcut.onKeydown(e)}))},mounted(){"app"===this.mode&&(this.maximize=Yt.isMaximized())},methods:{initEventBus(){y.$on("close-menu",(()=>{this.fileMenuVisible=!1,this.editMenuVisible=!1,this.selectionMenuVisible=!1,this.viewMenuVisible=!1,this.terminalMenuVisible=!1,this.preferenceMenuVisible=!1})),y.$on("terminal-toggle",(()=>{this.viewMenuList[0][1].selected=!this.viewMenuList[0][1].selected,globalData.views.terminal=!globalData.views.terminal})),y.$on("minimap-toggle",(()=>{this.viewMenuList[0][2].selected=!this.viewMenuList[0][2].selected,globalData.views.minimap=!globalData.views.minimap})),y.$on("sidebar-toggle",(()=>{this.viewMenuList[0][3].selected=!this.viewMenuList[0][3].selected,globalData.views.sidebar=!globalData.views.sidebar})),y.$on("statusbar-toggle",(()=>{this.viewMenuList[0][4].selected=!this.viewMenuList[0][4].selected,globalData.views.statusbar=!globalData.views.statusbar}))},showMemu(e){y.$emit("close-menu"),this[e]=!0},onMinimize(){Yt.minimize()},onMaximize(){Yt.maximize(),this.maximize=!0},onUnmaximize(){Yt.unmaximize(),this.maximize=!1},onClose(){Yt.close()},onFileMenuChange(e){switch(e.op){case"newFile":y.$emit("file-open");break;case"addFolder":y.$emit("folder-add");break;case"saveWorkspaceAs":y.$emit("workspace-save-as");break;case"saveFile":y.$emit("file-save",{id:globalData.nowEditorId});break;case"saveFileAs":y.$emit("file-save-as",{id:globalData.nowEditorId});break;case"openFile":y.$emit("file-open",null,!0);break;case"openFolder":y.$emit("folder-open");break;case"openWorkspace":y.$emit("workspace-open");break}requestAnimationFrame((()=>{this.fileMenuVisible=!1}))},onEditMenuChange(e){let t=globalData.$mainWin.getNowEditor(),i=globalData.$mainWin.getNowContext();switch(e.op){case"findInFiles":y.$emit("find-in-folder");break;case"replaceInFiles":y.$emit("find-in-folder",{replace:!0});break}if(t){switch(e.op){case"undo":t.history.undo(),t.focus();break;case"redo":t.history.redo(),t.focus();break;case"cut":v.writeClipboard(i.getCopyText(!0)),t.focus();break;case"copy":v.writeClipboard(i.getCopyText()),t.focus();break;case"paste":v.readClipboard().then((e=>{i.insertContent(e)})),t.focus();break;case"deleteLine":i.deleteLine(),t.focus();break;case"find":t.openSearch(),t.focus();break;case"replace":t.openSearch(!0),t.focus();break}requestAnimationFrame((()=>{this.editMenuVisible=!1}))}else this.editMenuVisible=!1},onSelectionMenuChange(e){let t=globalData.$mainWin.getNowEditor(),i=globalData.$mainWin.getNowContext();switch(e.op){case"gotoLine":y.$emit("menu-close"),y.$emit("cmd-search-open",{input:":"});break}if(t){switch(e.op){case"selectAll":t.selecter.selectAll();break;case"copyLineUp":i.copyLineUp();break;case"copyLineDown":i.copyLineDown();break;case"moveLineUp":i.moveLineUp();break;case"moveLineDown":i.moveLineDown();break;case"addCursorAbove":t.cursor.addCursorAbove();break;case"addCursorBelow":t.cursor.addCursorBelow();break;case"addCursorLineEnds":t.cursor.addCursorLineEnds();break;case"addNextOccurence":t.searchWord("down");break;case"addPrevOccurence":t.searchWord("up");break;case"selectAllOccurence":t.selecter.selectAllOccurence();break;case"switchMultiKeyCode":t.cursor.switchMultiKeyCode(),e.keyCode=t.cursor.multiKeyCode,e.name=`Switch ${"alt"===e.keyCode?"Ctrl":"Alt"}+Click to Multi-Cursor`;break}t.focus(),requestAnimationFrame((()=>{this.selectionMenuVisible=!1}))}else this.selectionMenuVisible=!1},onPreferenceMenuChange(e){switch(e.op){case"changeTheme":y.$emit("cmd-menu-theme-open");break;case"changeIconTheme":y.$emit("cmd-menu-icon-theme-open")}requestAnimationFrame((()=>{this.preferenceMenuVisible=!1}))},onViewMenuChange(e){switch(e.op){case"commandPanel":y.$emit("cmd-search-open");break;case"toggleTerminal":y.$emit("terminal-toggle");break;case"toggleMinimap":y.$emit("minimap-toggle");break;case"toggleSidebar":y.$emit("sidebar-toggle");break;case"toggleStatusbar":y.$emit("statusbar-toggle");break}requestAnimationFrame((()=>{this.viewMenuVisible=!1}))},onTerminalMenuChange(e){switch(e.op){case"newTerminal":y.$emit("terminal-new");break}requestAnimationFrame((()=>{this.terminalMenuVisible=!1}))}}},Ut=Kt,qt=(0,Fe.Z)(Ut,Wt,jt,!1,null,null,null),Gt=qt.exports,Zt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-status-bar my-width-100",style:{height:e.height+"px"},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[t("div",{staticClass:"my-height-100 my-center-between"},[t("div",{staticClass:"bar-left"},[e.hasEditor?t("div",{staticClass:"bar-item"},[t("span",[e._v("Line "+e._s(e.line)+", Column "+e._s(e.column))])]):e._e()]),t("div",{staticClass:"bar-right"},[e.hasEditor?t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showTabsize.apply(null,arguments)}}},[t("span",[e._v("Tab Size:"+e._s(e.tabSize))])]):e._e(),e.hasEditor?t("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showLanguage.apply(null,arguments)}}},[t("span",[e._v(e._s(e.nowLanguage))])]):e._e()])])])},Xt=[],Jt={name:"StatusBar",props:{height:{type:Number,default:25}},components:{Menu:Re},data(){return{line:1,column:0,tabSize:4,indent:"tab",language:"",hasEditor:!1,languageList:H.languageList,tabMenu:[[{op:"changeIndent",name:"Indent Using Spacee",value:"space"},{op:"changeIndent",name:"Indent Using Tabs",value:"tab"}],[{op:"convertTabToSpace",name:"Convert Indentation to Spaces"},{op:"convertSpaceToTab",name:"Convert Indentation to Tabs"}]]}},computed:{nowLanguage(){for(let e=0;e<this.languageList.length;e++)if(this.languageList[e].value===this.language)return this.languageList[e].name}},created(){this.initEventBus();let e=[];for(let t=1;t<=8;t++)e.push({op:"changeTabSize",name:`Tab Width：${t}`,value:t});this.tabMenu.unshift(e)},mounted(){},methods:{initEventBus(){y.$on("editor-changed",(e=>{e?(this.language=e.language,this.tabSize=e.tabSize,this.indent=e.indent,this.line=e.line,this.column=e.column,this.hasEditor=!0):this.hasEditor=!1})),y.$on("cursor-change",(e=>{this.line=e.line,this.column=e.column})),y.$on("language-change",(e=>{this.language=e.language})),y.$on("tab-size-change",(e=>{this.tabSize=e})),y.$on("indent-change",(e=>{this.indent=e}))},showTabsize(){let e=this.tabMenu.map(((e,t)=>e.map((e=>(e=Object.assign({},e),0===t?e.selected=e.value===this.tabSize:1===t&&(e.selected=e.value===this.indent),e)))));y.$emit("close-menu"),y.$emit("cmd-menu-open",{cmdList:e,hoverCheck:!1})},showLanguage(){let e=H.nowEditorId&&H.$mainWin.getNowEditor().language,t=H.languageList.map((t=>{let i=v.getIconByExtensions(t.extensions||[]);return i=i?`my-file-icon my-file-icon-${i}`:"",{icon:i,name:t.name+(t.language?`（${t.language}）`:""),value:t.value,op:"selectLanguage",active:e===t.value,selected:e===t.value}}));y.$emit("close-menu"),y.$emit("cmd-menu-open",{cmdList:t})}}},Qt=Jt,ei=(0,Fe.Z)(Qt,Zt,Xt,!1,null,null,null),ti=ei.exports,ii=function(){var e=this,t=e._self._c;return t("div",{ref:"sideBar",staticClass:"my-side-bar",on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)},selectstart:function(e){e.preventDefault()}}},[t("div",{staticClass:"my-height-100",staticStyle:{overflow:"hidden"},style:{opacity:e.opacity}},[t("div",{staticClass:"side-bar-title my-shadow"},[e._v("EXPLORER")]),t("side-tree",{ref:"tree"})],1),e.renameVisible?t("div",{staticClass:"my-rename-overlay"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newFileNmme,expression:"newFileNmme"}],ref:"input",staticClass:"my-rename-input",style:e.inputStyle,attrs:{spellcheck:"false",type:"text"},domProps:{value:e.newFileNmme},on:{blur:e.onBlur,keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onConfirm.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.onCancel.apply(null,arguments)}],input:function(t){t.target.composing||(e.newFileNmme=t.target.value)}}})]):e._e(),t("SideBarMenu",{ref:"sideBarMenu"}),t("SideTreMenu",{ref:"sideTreeMenu"})],1)},si=[],ri=function(){var e=this,t=e._self._c;return t("div",{ref:"wrap",staticClass:"side-tree-warp",on:{mouseenter:e.showScrollBar,mouseleave:e.hideScrollBar,mousemove:e.showScrollBar,wheel:function(t){return t.stopPropagation(),e.onWheel.apply(null,arguments)}}},[t("div",{staticClass:"side-tree"},[t("div",{staticClass:"side-tree-content",style:{top:-e.deltaTop+"px"}},e._l(e.renderList,(function(i){return t("div",{staticClass:"tree-item",attrs:{id:i.id},on:{click:function(t){return t.stopPropagation(),e.onClickItem(i)}}},[t("div",{staticClass:"tree-item-title my-center-start",class:[i.active?"my-active":"",e.cutPath===i.path?"tree-item-cut":""],style:{"padding-left":e._paddingLeft(i)},attrs:{title:i.path},on:{contextmenu:function(t){return t.stopPropagation(),t.preventDefault(),e.onContextmenu(t,i)}}},["dir"===i.type?[i.open?t("span",{staticClass:"my-icon my-icon-down"}):t("span",{staticClass:"my-icon my-icon-right"})]:e._e(),t("div",{staticClass:"tree-item-content",class:[i.icon,i.statusColor],style:{"margin-left":i.marginLeft}},[t("div",{staticClass:"my-center-between",staticStyle:{width:"100%",overflow:"hidden"}},[t("span",{staticClass:"tree-item-text"},[e._v(e._s(i.name))]),"file"===i.type&&"!!"!=i.status?t("span",{staticStyle:{margin:"0 5px 0 10px","flex-shrink":"0"}},[e._v(e._s(i.status))]):e._e()])])],2)])})),0)]),t("v-scroll-bar",{staticClass:"my-scroll-small",class:{"my-scroll-visible":e.scrollVisible},attrs:{height:e.treeHeight,"scroll-top":e.scrollTop},on:{scroll:e.onScroll}})],1)},ni=[];const oi=window.require("fs"),ai=window.require("path"),li=window.require("child_process").spawnSync;let hi=null,ci=[],di={};var ui={name:"SideTree",components:{VScrollBar:Be},data(){return{itemHeight:30,itemPadding:20,renderList:[],fileWatchs:[],startLine:1,maxVisibleLines:100,cutPath:"",scrollTop:0,treeHeight:0,domHeight:0,deltaTop:0,scrollVisible:!1,fileStatusMap:{}}},computed:{_paddingLeft(){return function(e){return e.deep*this.itemPadding-10+"px"}}},created(){this.initEventBus(),this.watchFileStatus(),this.watchFolder(),this.setOpendList(),H.$fileTree=this},mounted(){this.domHeight=this.$refs.wrap.clientHeight,this.maxVisibleLines=Math.ceil(this.domHeight/this.itemHeight)+1,this.render()},methods:{initResizeEvent(){const e=new ResizeObserver((e=>{this.$refs.wrap&&this.$refs.wrap.clientHeight&&(this.domHeight=this.$refs.wrap.clientHeight,this.render())}));e.observe(this.$refs.wrap)},initEventBus(){y.$on("icon-changed",(()=>{ci.forEach((e=>{e.icon=""})),this.render()})),y.$on("theme-changed",(()=>{ci.forEach((e=>{e.icon=""})),this.render()})),y.$on("editor-changed",(e=>{let t=e&&e.path;!t||hi&&hi.path===t?!t&&hi&&(hi.active=!1,hi=null):(hi&&(hi.active=!1),this.focusItem(t))})),y.$on("file-create-tree",(e=>{this.newFileOrDir(e,"file")})),y.$on("folder-create-tree",(e=>{this.newFileOrDir(e,"dir")})),y.$on("file-copy",(e=>{this.cutPath=""})),y.$on("file-cut",(e=>{this.cutPath=e.path})),y.$on("file-paste",(e=>{this.cutPath=""})),y.$on("git-statused",(e=>{this.render()})),y.$on("git-ignored",(e=>{di[e.path]=e.ignore,this.render()})),y.$on("folder-opened",(()=>{this.refreshWorkSpace()})),y.$on("folder-added",(()=>{this.refreshWorkSpace()})),y.$on("folder-removed",(()=>{this.refreshWorkSpace()})),y.$on("workspace-opened",(()=>{this.$nextTick((()=>{this.refreshWorkSpace()}))})),y.$on("file-tree-loaded",(e=>{H.fileTree.empty(),this.initOpendDiring=!0,this.initOpendDirList(e)}))},initOpendDirList(e){if(e.length){let i=e.shift(),s=i.parentPath&&v.getFileItemByPath(H.fileTree,i.path,i.rootPath);s?t.call(this,s):(s=this.createRootItem(i.path),H.fileTree.push(s),i.open?t.call(this,s):this.initOpendDirList(e))}else this.refreshWorkSpace(),this.preLoadFolder(),this.initOpendDiring=!1;function t(t){this.openFolder(t).then((()=>{this.initOpendDirList(e)}))}},render(){cancelAnimationFrame(this.renderTimer),this.renderTimer=requestAnimationFrame((()=>{let e={};this.renderList=ci.slice(this.startLine-1,this.startLine-1+this.maxVisibleLines),this.renderList.forEach((t=>{H.nowIconData&&(t.icon=v.getIconByPath({filePath:t.path,fileType:t.type,opened:t.open,isRoot:!t.parentPath}),t.icon=t.icon?`my-file-icon my-file-icon-${t.icon}`:""),t.gitIgnore&&di[t.gitIgnore]&&t.relativePath&&di[t.gitIgnore].ignores(t.relativePath)?(t.status="!!",t.statusColor="my-status-ignore"):(t.status=v.getFileStatus(t.path),t.statusColor=t.status.statusColor,t.status=t.status.status),"file"===t.type&&("file"===e.type?t.marginLeft=e.marginLeft:e.path===t.parentPath&&(t.marginLeft="10px")),e=t}))}))},preLoadFolder(){function e(e){if(e.length){let i=e.shift();i.loaded?t.call(this,i,e):this.readdir(i).then((()=>{t.call(this,i,e)}))}}function t(t,i){t.children.forEach((e=>{"dir"===e.type&&e.deep<=4&&!H.skipSearchDirs.test(e.path)&&i.push(e)})),Date.now()-this.preLoadFolderStartTime<3e4&&(this.preLoadFolderTask=H.scheduler.addTask((()=>{e.call(this,i)})))}H.scheduler.removeTask(this.preLoadFolderTask),cancelIdleCallback(this.preLoadFolderTimer),this.preLoadFolderTimer=requestIdleCallback((()=>{this.preLoadFolderStartTime=Date.now(),e.call(this,H.fileTree.slice())}))},createItems(e,t){let i=[];return t.forEach(((t,s)=>{let r=ai.join(e.path,t);if(!oi.existsSync(r))return;let n=oi.statSync(r),o={id:v.getIdFromPath(r),name:t,path:r,parentPath:e.path,rootPath:e.rootPath,gitRootPath:e.gitRootPath,gitIgnore:e.gitIgnore,relativePath:ai.join(e.relativePath,t),gitRelativePath:e.gitRootPath&&ai.join(e.gitRelativePath,t)||"",deep:e.deep+1,active:!1,children:[]};n.isFile()?o.type="file":(o.type="dir",o.open=!1),i.push(o)})),this.sortFileList(i)},createRootItem(e){let t={id:v.getIdFromPath(e),name:ai.basename(e),path:e,parentPath:"",relativePath:"",rootPath:e,deep:0,active:!1,children:[],type:"dir",open:!1};return t},readdir(e){return new Promise(((t,i)=>{e.loaded=!1,e.children=[],oi.readdir(e.path,{encoding:"utf8"},((i,s)=>{if(i)return t([]);e.loaded||(s=this.createItems(e,s),e.loaded=!0,e.children=s,Object.freeze(s)),t(e.children)}))}))},refreshDir(e){function t(){let t=e.children||[];this.readdir(e).then((()=>{let i={};t.forEach((e=>{i[e.id]=e})),e.children=e.children.map((e=>{let t=i[e.id];return t?(t.path!=e.path&&(t.name=e.name,this.updateParentPath(t,e.parentPath)),t):e})),e.open&&(this.closeFolder(e),this.openFolder(e)),e.gitRootPath||this.watchFileStatus(e.children),this.render()}))}this.refreshFolderTimer=this.refreshFolderTimer||{},clearTimeout(this.refreshFolderTimer[e.id]),this.refreshFolderTimer[e.id]=setTimeout((()=>{oi.existsSync(e.path)&&t.call(this)}),100)},refreshGitIgnore(e){this.refreshGitIgnoreTimer=this.refreshGitIgnoreTimer||{},clearTimeout(this.refreshGitIgnoreTimer[e]),this.refreshGitIgnoreTimer[e]=setTimeout((()=>{y.$emit("git-ignore",e)}),100)},refreshWorkSpace(){this.watchFileStatus(),this.watchFolder(),this.setOpendList(),this.render()},async newFileOrDir(e,t){this.newId="new"+v.getUUID();for(let i=0;i<this.renderList.length;i++){let s=this.renderList[i];if(s.path===e){let e={id:this.newId,name:"",type:t,parentPath:s.path,deep:s.deep+1};s.open||await this.onClickItem(s),e.icon=v.getIconByPath({filePath:"",fileType:t,opened:!1,isRoot:!1}),e.icon=e.icon?`my-file-icon my-file-icon-${e.icon}`:"",this.renderList.splice(i+1,0,e),this.$nextTick((()=>{y.$emit("file-rename-input",e)}));break}}},closeFolder(e){if(!e.open)return;let t=ci.indexOf(e)+1,i=t;while(i<ci.length&&ci[i].deep>e.deep)i++;ci.splice(t,i-t),this.setTreeHeight(),e.open=!1,this.setStartLine(this.checkScrollTop(this.scrollTop))},openFolder(e){return new Promise(((i,s)=>{if(!e.loaded)return this.readdir(e).then((()=>{t.call(this),i()}));t.call(this),i()}));function t(){if(!e.open){let t=ci.indexOf(e);ci=ci.slice(0,t+1).concat(this.getRenderList(e.children,e.deep)).concat(ci.slice(t+1)),H.openedFileList=ci,e.open=!0,this.setTreeHeight()}this.setStartLine(this.checkScrollTop(this.scrollTop))}},watchFileStatus(e){e=e||H.fileTree,e.forEach((e=>{if("dir"===e.type&&!e.gitRootPath&&oi.existsSync(e.path))if(0===e.deep&&v.checkGitRep(e.path)||e.deep>0&&oi.existsSync(ai.join(e.path,".git"))){let t=v.getIgnore(e.path);this.updateGitRootPath(e,e.path,t),y.$emit("git-status-start",e.path),t&&this.refreshGitIgnore(t)}else this.watchFileStatus(e.children)}))},watchFolder(){this.removeFileWatcher(),H.fileTree.forEach((e=>{let t=oi.watch(e.path,{recursive:!0},((t,i)=>{if(i){if("rename"===t){let t=ai.dirname(ai.join(e.path,i)),s=v.getFileItemByPath(H.fileTree,t);s.forEach((e=>{(e.children.length||e.open)&&this.refreshDir(e)}))}".gitignore"===i&&this.refreshGitIgnore(ai.join(e.path,".gitignore"))}}));this.fileWatchs.push(t)}))},removeFileWatcher(){this.fileWatchs.forEach((e=>{e.close()}))},updateParentPath(e,t){e.path=ai.join(t,e.name),e.parentPath=t,t=e.path,e.children.forEach((e=>{this.updateParentPath(e,t)}))},updateGitRootPath(e,t,i){e.gitRootPath=t,e.gitIgnore=i,e.gitRelativePath=ai.relative(t,e.path),e.children.forEach((e=>{this.updateGitRootPath(e,t,i)}))},sortFileList(e){return e.sort(((e,t)=>"dir"===e.type&&"file"===t.type?-1:"file"===e.type&&"dir"===t.type||e.name>t.name?1:e.name<t.name?-1:0)),e},showScrollBar(){this.scrollVisible=!0},hideScrollBar(){this.scrollVisible=!1},focusItem(e){function t(e,i){for(let s=0;s<i.length;s++){let r=i[s];if(r.path===e){let e=ci.indexOf(r)*this.itemHeight-this.domHeight/2;hi&&(hi.active=!1),r.active=!0,hi=r,H.nowFileItem=r,this.setStartLine(this.checkScrollTop(e));break}if(e.startsWith(r.path)){r.open?t.call(this,e,r.children):this.openFolder(r).then((()=>{t.call(this,e,r.children)}));break}}}clearTimeout(this.focusItemTimer),this.focusItemTimer=setTimeout((()=>{if(this.initOpendDiring)return void this.focusItem(e);let i=H.fileTree.slice().sort(((e,t)=>t.path.length-e.path.length));t.call(this,e,i)}),15)},checkScrollTop(e){return e>this.treeHeight-this.domHeight&&(e=this.treeHeight-this.domHeight),e=e<0?0:e,e},setStartLine(e){this.startLine=Math.floor(e/this.itemHeight)+1,this.scrollTop=e,this.deltaTop=e%this.itemHeight,this.render()},setTreeHeight(){this.treeHeight=ci.length*this.itemHeight},setOpendList(){ci=this.getRenderList(H.fileTree,0),H.openedFileList=ci,this.setTreeHeight()},getRenderList(e,t){let i=[];return s(e,t),i;function s(e,t){e.forEach((e=>{e.deep=t+1,i.push(e),e.open&&e.children.length&&s(e.children,e.deep)}))}},getNowHash(e){return li("git",["log","-1","--format=%H"],{cwd:e}).stdout.toString()},onClickItem(e){e.active?"dir"===e.type&&(e.open?this.closeFolder(e):this.openFolder(e)):(hi&&(hi.active=!1),e.active=!0,hi=e,H.nowFileItem=e,"dir"===e.type?e.loaded?e.open?this.closeFolder(e):this.openFolder(e):this.openFolder(e).then((()=>{e.gitRootPath||this.watchFileStatus(e.children)})):y.$emit("file-open",e))},onWheel(e){this.scrollDeltaY=e.deltaY,this.scrollDeltaY&&!this.wheelTask&&(this.wheelTask=H.scheduler.addUiTask((()=>{if(this.scrollDeltaY){try{let e=this.scrollTop+this.scrollDeltaY;e>this.treeHeight-this.domHeight&&(e=this.treeHeight-this.domHeight),e=e<0?0:e,this.onScroll(e)}catch(e){console.log(e)}this.scrollDeltaY=0}else H.scheduler.removeUiTask(this.wheelTask),this.wheelTask=null})))},onScroll(e){this.setStartLine(e)},onContextmenu(e,t){this.$parent.$refs.sideTreeMenu.show(e,t)}}},mi=ui,pi=(0,Fe.Z)(mi,ri,ni,!1,null,null,null),gi=pi.exports,fi=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"wrap"},[t("Menu",{ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})],1)},vi=[],bi={components:{Menu:Re},data(){return{list:[],menuList:[],menuVisible:!1,menuStyle:{left:"10px",top:"40px"}}},provide(){return{rootList:this.list}},created(){this.initEventBus()},methods:{initEventBus(){y.$on("close-menu",(()=>{this.menuVisible=!1}))},show(e){let t=u()(this.$refs.wrap).parent();this.menuVisible=!0,this.$nextTick((()=>{let i=0,s=0;i=this.$refs.menu.$el.clientWidth,s=this.$refs.menu.$el.clientHeight;let r=t.offset();s+e.clientY>r.top+t.height()?this.menuStyle.top=e.clientY-r.top-s+"px":this.menuStyle.top=e.clientY-r.top+"px",this.menuStyle.left=e.clientX-r.left+"px"}))},onMenuChange(e){switch(e.op){}this.menuVisible=!1}}},yi=bi,Ci=(0,Fe.Z)(yi,fi,vi,!1,null,null,null),wi=Ci.exports,xi=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"wrap"},[t("Menu",{ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})],1)},Ti=[];const ki=window.require("path");var Li={name:"SideTreMenu",components:{Menu:Re},data(){return{rootMenu:[[{name:"New File",op:"newFile"},{name:"New Folder",op:"newFolder"},{name:"Reveal in File Explorer",op:"revealInFileExplorer"},{name:"Find in Folder",op:"findInFolder"},{name:"Open in Terminal",op:"openInTerminal"}],[{name:"Add Folder to Workspace",op:"addFolder"},{name:"Remove Folder from Workspace",op:"removeFolder"}],[{name:"Copy",op:"copy"},{name:"Paste",op:"paste"}],[{name:"Copy Path",op:"copyPath"},{name:"Copy Relative Path",op:"copyRelativePath"}]],dirMenu:[[{name:"New File",op:"newFile"},{name:"New Folder",op:"newFolder"},{name:"Reveal in File Explorer",op:"revealInFileExplorer"},{name:"Find in Folder",op:"findInFolder"},{name:"Open in Terminal",op:"openInTerminal"}],[{name:"Cut",op:"cut"},{name:"Copy",op:"copy"},{name:"Paste",op:"paste"}],[{name:"Copy Path",op:"copyPath"},{name:"Copy Relative Path",op:"copyRelativePath"}],[{name:"Reaname",op:"rename"},{name:"Delete",op:"delete"}]],fileMenu:[[{name:"Reveal in File Explorer",op:"revealInFileExplorer"},{name:"Open in Terminal",op:"openInTerminal"}],[{name:"Cut",op:"cut"},{name:"Copy",op:"copy"}],[{name:"Copy Path",op:"copyPath"},{name:"Copy Relative Path",op:"copyRelativePath"}],[{name:"Reaname",op:"rename"},{name:"Delete",op:"delete"}]],menuList:[],menuVisible:!1,menuStyle:{left:"10px",top:"40px"}}},provide(){},created(){this.initEventBus()},methods:{initEventBus(){y.$on("close-menu",(()=>{this.menuVisible=!1}))},show(e,t){let i=u()(this.$refs.wrap).parent();this.menuVisible=!0,this.treeItem=t,"dir"===t.type?t.parentPath?this.menuList=this.dirMenu:this.menuList=this.rootMenu:this.menuList=this.fileMenu,this.$nextTick((()=>{let t=0;t=this.$refs.menu.$el.clientHeight;let s=i.offset();t+e.clientY>s.top+i.height()?this.menuStyle.top=e.clientY-s.top-t+"px":this.menuStyle.top=e.clientY-s.top+"px",this.menuStyle.left=e.clientX-s.left+"px"}))},onMenuChange(e){let t="",i=Object.assign({},this.treeItem);switch(e.op){case"newFile":y.$emit("file-create-tree",i.path);break;case"newFolder":y.$emit("folder-create-tree",i.path);break;case"revealInFileExplorer":y.$emit("reveal-in-file-explorer",i.path);break;case"findInFolder":t=ki.relative(i.rootPath,i.path),t=ki.join(ki.basename(i.rootPath),t),t="."+ki.sep+t,y.$emit("find-in-folder",{path:t});break;case"openInTerminal":t="",t="file"===this.treeItem.type?ki.dirname(this.treeItem.path):this.treeItem.path,y.$emit("terminal-new",t);break;case"addFolder":y.$emit("folder-add");break;case"removeFolder":y.$emit("folder-remove",i.path);break;case"cut":y.$emit("file-cut",i);break;case"copy":y.$emit("file-copy",i);break;case"paste":y.$emit("file-paste",i);break;case"copyPath":v.writeClipboard(i.path);break;case"copyRelativePath":t=i.name;while(i.parent&&i.parent.parent)t=ki.join(i.parent.name,t),i=i.parent;v.writeClipboard(t);break;case"rename":y.$emit("file-rename-input",i);break;case"delete":y.$emit("file-delete",i);break}this.menuVisible=!1}}},Si=Li,Pi=(0,Fe.Z)(Si,xi,Ti,!1,null,null,null),Ei=Pi.exports,Ii={components:{SideTree:gi,SideBarMenu:wi,SideTreMenu:Ei},data(){return{newFileNmme:"",renameVisible:!1,inputStyle:{},opacity:1}},mounted(){this.initEvent()},methods:{initEvent(){y.$on("file-rename-input",(e=>{this.fileObj=e,this.newFileNmme=e.name,this.renameVisible=!0,this.opacity=.5,this.setInputPosition(e.id),this.$nextTick((()=>{setTimeout((()=>{this.$refs.input&&(this.$refs.input.focus(),this.$refs.input.select())}),100)}))}))},setInputPosition(e){let t=u()("#"+e),i=t.find(".tree-item-text"),s=i.offset().left-52,r=t.offset().top-35;this.inputStyle={left:s+"px",top:r+"px",right:0}},confirmInput(){const e=window.require("path");if(this.newFileNmme&&this.newFileNmme!=this.fileObj.name)if(this.fileObj.path)y.$emit("file-rename",this.fileObj.path,this.newFileNmme);else{let t=e.join(this.fileObj.parentPath,this.newFileNmme);"dir"===this.fileObj.type?y.$emit("folder-create",t):y.$emit("file-create",t)}else this.fileObj.path||this.$refs.tree.render();this.onCancel()},onBlur(){this.confirmInput()},onConfirm(){this.confirmInput()},onCancel(){this.newFileNmme="",this.renameVisible=!1,this.opacity=1},onContextmenu(e){}}},_i=Ii,Di=(0,Fe.Z)(_i,ii,si,!1,null,null,null),Mi=Di.exports,$i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-activity-bar",on:{contextmenu:function(e){e.preventDefault(),e.stopPropagation()}}},[t("div",{staticClass:"bar-item",class:{"my-active":"files"===e.activity},on:{click:function(t){return e.onChange("files")}}},[t("i",{staticClass:"my-icon my-icon-files"})]),t("div",{staticClass:"bar-item",class:{"my-active":"search"===e.activity},on:{click:function(t){return e.onChange("search")}}},[t("i",{staticClass:"my-icon my-icon-search"})])])},Fi=[],Oi={name:"ActivityBar",components:{},data(){return{activity:"files"}},watch:{activity(){y.$emit("activity-change",this.activity)}},mounted(){this.initEvent()},methods:{initEvent(){y.$on("find-in-folder",(()=>{this.activity="search"}))},onChange(e){this.activity=e}}},Bi=Oi,Ai=(0,Fe.Z)(Bi,$i,Fi,!1,null,null,null),Hi=Ai.exports,Ni=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-side-search"},[t("div",{staticClass:"my-search-wrap"},[t("div",{staticClass:"my-search-condition"},[t("div",{staticClass:"side-search-title my-shadow"},[e._v("SEARCH")]),t("div",{staticStyle:{position:"relative",padding:"0 10px 0 20px"}},[t("div",{staticClass:"my-search-left active-click",staticStyle:{"border-radius":"0"},attrs:{tabindex:"-1"},on:{click:function(t){e.replaceVisible=!e.replaceVisible}}},[t("span",{staticClass:"iconfont",class:{"icon-down1":e.replaceVisible,"icon-right":!e.replaceVisible},staticStyle:{"font-size":"14px"},attrs:{title:"Toggle Replace mode"}})]),t("div",{staticClass:"my-search-input",class:{"my-active":e.input1Focus}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],ref:"input1",style:{height:e.input1Height+"px"},attrs:{placeholder:"Search",spellcheck:"false",type:"text"},domProps:{value:e.text},on:{blur:function(t){e.input1Focus=!1},focus:function(t){e.input1Focus=!0},keydown:e.onKeyDown1,input:function(t){t.target.composing||(e.text=t.target.value)}}}),t("span",{staticClass:"my-search-suffix",class:{"my-active":e.matchCase},attrs:{title:"Match Case(Alt+C)"},on:{click:e.changeCase}},[e._v("Aa")]),t("span",{staticClass:"my-search-suffix iconfont icon-whole-word",class:{"my-active":e.wholeWord},attrs:{title:"Match Whole Word(Alt+W)"},on:{click:e.changeWhole}})]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.replaceVisible,expression:"replaceVisible"}],staticClass:"my-center-start",staticStyle:{"margin-top":"10px"}},[t("div",{staticClass:"my-search-input",class:{"my-active":e.input2Focus},staticStyle:{"flex-grow":"1"}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.replaceText,expression:"replaceText"}],ref:"input2",style:{height:e.input2Height+"px"},attrs:{placeholder:"Replace",spellcheck:"false",type:"text"},domProps:{value:e.replaceText},on:{blur:function(t){e.input2Focus=!1},focus:function(t){e.input2Focus=!0},keydown:e.onKeyDown2,input:function(t){t.target.composing||(e.replaceText=t.target.value)}}})]),t("span",{staticClass:"iconfont icon-replace-all active-click",class:{"enabled-color":e.results.length>0,"disabled-color":0==e.results.length},staticStyle:{"margin-left":"10px"},attrs:{tabindex:"-1",title:"Replace All(Ctrl+Alt+Enter)"},on:{click:e.replaceAll}})])]),t("div",{staticStyle:{padding:"0 10px 0 20px"}},[t("div",{staticStyle:{"line-height":"30px"}},[e._v("files to include")]),t("div",{staticClass:"my-search-input",class:{"my-active":e.input3Focus}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.includePath,expression:"includePath"}],ref:"input2",style:{height:e.input3Height+"px"},attrs:{spellcheck:"false",type:"text"},domProps:{value:e.includePath},on:{blur:function(t){e.input3Focus=!1},focus:function(t){e.input3Focus=!0},keydown:e.onKeyDown3,input:function(t){t.target.composing||(e.includePath=t.target.value)}}})]),t("div",{staticStyle:{"line-height":"30px"}},[e._v("files to include")]),t("div",{staticClass:"my-search-input",class:{"my-active":e.input4Focus}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.excludePath,expression:"excludePath"}],ref:"input2",style:{height:e.input4Height+"px"},attrs:{spellcheck:"false",type:"text"},domProps:{value:e.excludePath},on:{blur:function(t){e.input4Focus=!1},focus:function(t){e.input4Focus=!0},keydown:e.onKeyDown4,input:function(t){t.target.composing||(e.excludePath=t.target.value)}}})]),t("div",{staticClass:"my-center-between",staticStyle:{height:"30px","line-height":"30px"}},[e.count?t("span",[e._v(e._s(e.count)+" results in "+e._s(e.results.length)+" files")]):e._e(),e.count&&e.searching?t("span",{staticClass:"stop-search",on:{click:e.stopSeach}},[e._v("stop")]):e._e()])])]),t("file-content-search-results",{ref:"results",attrs:{list:e.results}})],1),e.replacing?t("div",{staticClass:"my-search-replacing"}):e._e()])},Ri=[],Wi=function(){var e=this,t=e._self._c;return t("div",{ref:"wrap",staticClass:"my-results-scroller",on:{mouseenter:e.showScrollBar,mouseleave:e.hideScrollBar,mousemove:e.showScrollBar,scroll:e.onScroll,wheel:function(t){return t.stopPropagation(),e.onWheel.apply(null,arguments)}}},[t("div",{staticClass:"my-results-content",style:{top:-e.deltaTop+"px"}},e._l(e.renderList,(function(i){return t("div",{staticClass:"tree-item",on:{click:function(t){return t.stopPropagation(),e.onClickItem(i)}}},[t("div",{staticClass:"tree-item-title my-center-start",class:[i.active?"my-active":""],style:{"padding-left":e._paddingLeft(i)},attrs:{title:1===i.deep?i.path:i.text},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[1===i.deep?[i.open?t("span",{staticClass:"left-icon iconfont icon-down1"}):t("span",{staticClass:"left-icon iconfont icon-right"})]:e._e(),t("div",{staticClass:"tree-item-content my-center-start",class:[i.icon]},[t("span",{staticClass:"tree-item-text",staticStyle:{"margin-left":"4px"},domProps:{innerHTML:e._s(i.html)}}),1===i.deep?t("span",{staticClass:"my-search-count"},[e._v(e._s(i.children.length))]):e._e()])],2)])})),0),t("v-scroll-bar",{staticClass:"my-scroll-small",class:{"my-scroll-visible":e.scrollVisible},attrs:{height:e.treeHeight,"scroll-top":e.scrollTop},on:{scroll:e.onScroll}})],1)},ji=[];let Vi=null,zi=[];var Yi={name:"FileContentSearchResults",data(){return{itemHeight:30,itemPadding:16,renderList:[],startLine:1,scrollTop:0,deltaTop:0,treeHeight:0,maxVisibleLines:100,scrollVisible:!1}},components:{VScrollBar:Be},computed:{_paddingLeft(){return function(e){return e.deep*this.itemPadding+"px"}}},created(){this.initEventBus()},mounted(){this.domHeight=this.$refs.wrap.clientHeight,this.maxVisibleLines=Math.ceil(this.domHeight/this.itemHeight)+1,this.render(),this.initResizeEvent()},methods:{initResizeEvent(){const e=new ResizeObserver((e=>{this.$refs.wrap&&this.$refs.wrap.clientHeight&&(this.domHeight=this.$refs.wrap.clientHeight,this.maxVisibleLines=Math.ceil(this.domHeight/this.itemHeight)+1,this.render())}));e.observe(this.$refs.wrap)},initEventBus(){y.$on("icon-changed",(()=>{zi.forEach((e=>{e.icon=""})),this.render()})),y.$on("theme-changed",(()=>{zi.forEach((e=>{e.icon=""})),this.render()})),y.$on("editor-changed",(e=>{let t=e&&e.path;!t||Vi&&Vi.path===t?!t&&Vi&&(Vi.active=!1,Vi=null):(Vi&&(Vi.active=!1),this.focusItem(t))}))},showScrollBar(){this.scrollVisible=!0},hideScrollBar(){this.scrollVisible=!1},render(){cancelAnimationFrame(this.renderTimer),this.renderTimer=requestAnimationFrame((()=>{this.renderList=zi.slice(this.startLine-1,this.startLine-1+this.maxVisibleLines),this.renderList.forEach((e=>{if(H.nowIconData&&1==e.deep&&(e.icon=v.getIconByPath({filePath:e.path,fileType:"file"}),e.icon=e.icon?`my-file-icon my-file-icon-${e.icon}`:""),!e.html){let t=this.getHtml(e);e.html=t.html,e.text=t.text}}))}))},addResults(e){e.forEach((e=>{Object.freeze(e.children)})),zi=zi.concat(this.getRenderList(e,0)),this.setTreeHeight(),this.render()},clear(){zi=[],this.setTreeHeight(),this.render()},focusItem(e){let t=0;function i(e){for(let s=t;s<zi.length;s++){let r=zi[s];if(r.path===e){let e=this.itemHeight*s-this.domHeight/2;e>this.treeHeight-this.domHeight?e=this.treeHeight-this.domHeight:e<0&&(e=0),this.setStartLine(e),r.active||this.onClickItem(r);break}if(e.startsWith(r.path)&&!r.open){t=s+1,this.onClickItem(r).then((()=>{i.call(this,e)}));break}}}i.call(this,e)},checkScrollTop(e){return e>this.treeHeight-this.domHeight&&(e=this.treeHeight-this.domHeight),e=e<0?0:e,e},setStartLine(e){this.startLine=Math.floor(e/this.itemHeight)+1,this.scrollTop=e,this.deltaTop=e%this.itemHeight,this.render()},setTreeHeight(){this.treeHeight=zi.length*this.itemHeight},getRenderList(e,t){let i=[];return s(e,t),i;function s(e,t){e.forEach((e=>{e.deep=t+1,i.push(e),e.open&&e.children.length&&s(e.children,e.deep)}))}},getHtml(e){let t="",i="";return 1===e.deep?t=e.name:(i=e.text,t=e.html),{html:t,text:i}},onClickItem(e){return e.active||(Vi&&(Vi.active=!1),e.active=!0,Vi=e),1==e.deep?(e.open=!e.open,t.call(this,e)):e.deep>1&&y.$emit("file-open",e),Promise.resolve();function t(e){if(e.children.length){if(e.open){let t=zi.indexOf(e);zi=zi.slice(0,t+1).concat(this.getRenderList(e.children,e.deep)).concat(zi.slice(t+1))}else{let t=zi.indexOf(e)+1,i=t;while(i<zi.length&&zi[i].path===e.path)i++;zi.splice(t,i-t)}this.setTreeHeight(),this.setStartLine(this.checkScrollTop(this.scrollTop))}}},onWheel(e){this.scrollDeltaY=e.deltaY,this.scrollDeltaY&&!this.wheelTask&&(this.wheelTask=H.scheduler.addUiTask((()=>{if(this.scrollDeltaY){try{let e=this.scrollTop+this.scrollDeltaY;this.setStartLine(this.checkScrollTop(e))}catch(e){console.log(e)}this.scrollDeltaY=0}else H.scheduler.removeUiTask(this.wheelTask),this.wheelTask=null})))},onScroll(e){this.setStartLine(e)}}},Ki=Yi,Ui=(0,Fe.Z)(Ki,Wi,ji,!1,null,null,null),qi=Ui.exports;const Gi=window.require("path"),Zi=window.require("child_process");var Xi={components:{FileContentSearchResults:qi},data(){return{text:"",replaceText:"",replaceVisible:!0,wholeWord:!1,matchCase:!1,input1Focus:!1,input2Focus:!1,input3Focus:!1,input4Focus:!1,replacing:!1,searching:!1,input1Height:30,input2Height:30,input3Height:30,input4Height:30,includePath:"",excludePath:"",results:[],count:0}},watch:{text(){let e=this.text.split(/\n/);this.input1Height=20*e.length+10,this.search()},includePath(){this.search()},excludePath(){this.search()},replaceText(){let e=this.replaceText.split(/\n/);this.input2Height=20*e.length+10}},created(){this.wholeWordPattern=new RegExp(`^(${globalData.defaultWordPattern.source})$`),this.initEvent()},mounted(){},methods:{initEvent(){y.$on("find-in-folder",(e=>{e=e||{},e.path&&(this.includePath=e.path),e.replace&&(this.replaceVisible=!0),requestAnimationFrame((()=>{this.$refs.input1.focus()}))}))},createSearch(){let e=Zi.fork(Gi.join(globalData.dirname,"main/process/search/index.js")),t=[];return e.on("message",(e=>{"end"===e?this.stopSeach():e.results.forEach((e=>{if(e.open=!1,e.active=!1,this.count+=1,t.push(e),e.path){let i={id:e.id,name:e.name,path:e.path,children:t,open:!0};this.results.push(i),this.addQueue.push(i),t.forEach((t=>{t.id=e.id,t.name=e.name,t.path=e.path})),t=[],this.addResults()}}))})),e},addResults(){this.addTimer||(this.addTimer=setTimeout((()=>{this.$refs.results.addResults(this.addQueue),this.addQueue=[],this.addTimer=null}),60))},search(){clearTimeout(this.searchTimer),this.stopSeach(),this.results=[],this.addQueue=[],this.count=0,!this.includePath||!this.text||this.excludePath&&this.includePath.startsWith(this.excludePath)||(this.searchTimer=setTimeout((()=>{this.searching=!0,this.searchingText=this.text,this.searcher=this.createSearch(),this.searcher.send({path:this.parsePath(this.includePath),excludePath:this.parsePath(this.excludePath),matchCase:this.matchCase,wholeWord:this.wholeWord,text:this.text}),this.$refs.results.clear()}),300))},stopSeach(){if(this.searching=!1,this.searcher){let e=this.searcher;this.searcher=null,e.kill()}},changeCase(){this.matchCase=!this.matchCase,this.search()},changeWhole(){this.wholeWord=!this.wholeWord,this.search()},replaceAll(){if(!this.results.length||this.searching)return;let e=this.text.replace(/\\|\.|\*|\+|\-|\?|\(|\)|\[|\]|\{|\}|\^|\$|\~|\!|\&|\|/g,"\\$&");function t(i){if(!i.length)return this.replacing=!1,void this.search();let s=i.shift().path;v.readFile(s).then((r=>{r=r.replace(e,this.replaceText),v.writeFile(s,r).then((()=>{t.call(this,i)}))}))}!/\n/.test(e)&&this.wholeWordPattern.test(e)&&this.wholeWord&&(e="(?:\\b|(?<=[^0-9a-zA-Z]))"+e+"(?:\\b|(?=[^0-9a-zA-Z]))"),e=new RegExp(e,this.matchCase?"igm":"gm"),this.replacing=!0,t.call(this,this.results)},parsePath(e){const t=globalData.fileTree;if(e=e||"",!e)return e;let i=/^\.[\\\/]([^\\\/]+)(?:[\\\/]|$)/.exec(e);if(i){let s=i&&i[1]||"";for(let r=0;r<t.length;r++)if(s===t[r].name){e=Gi.join(t[r].path,e.slice(i[1].length+2));break}}try{e=Gi.normalize(e),e=Gi.parse(e),e=Gi.join(e.dir,e.base)}catch(Er){e=""}return e},onKeyDown1(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.search())},onKeyDown2(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.search())},onKeyDown3(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.search())},onKeyDown4(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.search())}}},Ji=Xi,Qi=(0,Fe.Z)(Ji,Ni,Ri,!1,null,null,null),es=Qi.exports,ts=function(){var e=this,t=e._self._c;return t("div",[e.overlay?t("div",{staticClass:"my-dialog-overlay"}):e._e(),t("div",{staticClass:"my-dialog",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},[t("div",{staticClass:"dialog-title"},[t("div",{domProps:{innerHTML:e._s(e.title)}}),t("span",{staticClass:"dialog-close iconfont icon-close",on:{click:e.onClose}})]),t("div",{staticClass:"dialog-content"},[e.icon?t("span",{class:[e.icon],staticStyle:{"margin-right":"5px",width:"30px",height:"30px"}}):e._e(),t("div",[t("div",{domProps:{innerHTML:e._s(e.content)}})])]),t("div",{staticClass:"dialog-btns"},[e._l(e.btns,(function(i){return t("div",{staticClass:"dialog-btn",on:{click:function(t){return e.onClickBtn(i)}}},[e._v(e._s(i.name))])})),t("div",{staticClass:"dialog-btn",on:{click:function(t){return e.onClose()}}},[e._v(e._s(e.cancelText||"取消"))])],2)])])},is=[],ss={name:"Dialog",props:{title:String,content:String,btns:Array,overlay:Boolean,styles:Object,icon:String,iconColor:String,cancelText:String},data(){return{}},created(){},methods:{onClickBtn(e){e.callback()},onClose(){this.$emit("close")}}},rs=ss,ns=(0,Fe.Z)(rs,ts,is,!1,null,null,null),os=ns.exports,as=function(){var e=this,t=e._self._c;return e.visible?t("div",{staticClass:"my-cmd-panel my-list",on:{mousedown:function(e){e.stopPropagation()}}},[t("div",[t("div",{staticClass:"my-cmd-search"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],ref:"input",attrs:{spellcheck:"false",type:"text"},domProps:{value:e.searchText},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnter.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.onCancel.apply(null,arguments)}],input:function(t){t.target.composing||(e.searchText=t.target.value)}}})]),t("div",[t("Menu",{ref:"menu",staticStyle:{position:"relative"},attrs:{checkable:e.checkable,"hover-check":e.hoverCheck,menuList:e.cmdList,top:e.scrollTop},on:{change:e.onChange,scroll:e.onScroll}})],1)])]):e._e()},ls=[],hs=i(670),cs=i.n(hs);const ds=window.require("path"),us={foreground:"color",background:"background-color",fontStyle:"font-style"};var ms=class{constructor(){}loadTheme(e){let t={tokenColors:[],colors:{}};return i.call(this,e.path).then((()=>{let i="";this.setDefaultColor(t,e.type),i=this.parseCss(t),this.insertCss(i),H.nowTheme={value:e.value,type:e.type,path:e.path},y.$emit("theme-changed",e.value)}));function i(e){return v.loadJsonFile(e).then((t=>{if(t.include)return i.call(this,ds.join(e,"../"+t.include)).then((()=>{s(t)}));s(t)}))}function s(e){e.tokenColors&&t.tokenColors.push(...e.tokenColors),e.colors&&Object.assign(t.colors,e.colors)}}loadIconTheme(e){if(!e.path)return H.nowIconTheme={value:e.value},H.nowIconData=null,y.$emit("icon-changed"),Promise.resolve();let t=H.languageList,i={};return t.forEach((e=>{e.extensions&&(i[e.value]=e.extensions.map((e=>e.slice(1))))})),s.call(this,e.path);function s(t){return v.loadJsonFile(t).then((i=>{let s=i.fonts||[],n="";s.forEach((e=>{let i="@font-face{\nsrc:";e.src.forEach(((s,r)=>{let n=ds.join(t,"../"+s.path);n=n.replace(/\\/g,"/"),i+=`url('my-file://${n}')`,i+=` format('${s.format}')`,i+=r<e-s.length-1?", ":""})),i+=";\n",i+=`font-family:${e.id};\n`,i+=`font-style:${e.style};\n`,i+=`font-weight:${e.weight};\n`,i+="}\n",n+=i,n+=".my-file-icon::before{\n",n+=`font-family:${e.id};\n`,n+=`font-size:${e.size};\n`,n+="}\n"}));for(let e in i.iconDefinitions){if(n+=`.my-file-icon-${e}::before{\n`,e=i.iconDefinitions[e],e.fontCharacter)n+="top:2px;",n+=`content:"${e.fontCharacter}";\n`,n+=`color:${e.fontColor};\n`;else if(e.iconPath){let i=ds.join(t,"../"+e.iconPath);i=i.replace(/\\/g,"/"),n+='content:"";',n+=`background-image:url(my-file://${i})`}n+="}\n"}this.insertFont(n),i.fileNames=i.fileNames||{},i.fileExtensions=i.fileExtensions||{},r(i),H.nowIconTheme={value:e.value,path:e.path},H.nowIconData=i,y.$emit("icon-changed",e.value)}))}function r(e){if(e.languageIds&&n(e.languageIds,e.fileExtensions),e.light){e.light.fileExtensions=e.light.fileExtensions||{},e.light.fileNames=e.light.fileNames||{},e.light.folderNames=e.light.folderNames||{},e.light.folderNamesExpanded=e.light.folderNamesExpanded||{},e.light.languageIds&&n(e.light.languageIds,e.light.fileExtensions);for(let t in e.fileExtensions)e.light.fileExtensions[t]=e.light.fileExtensions[t]||e.fileExtensions[t];for(let t in e.fileNames)e.light.fileNames[t]=e.light.fileNames[t]||e.fileNames[t];for(let t in e.folderNames)e.light.folderNames[t]=e.light.folderNames[t]||e.folderNames[t];for(let t in e.folderNamesExpanded)e.light.folderNamesExpanded[t]=e.light.folderNamesExpanded[t]||e.folderNamesExpanded[t]}else e.light={fileExtensions:e.fileExtensions,fileNames:e.fileNames,folderNames:e.folderNames,folderNamesExpanded:e.folderNamesExpanded}}function n(e,t){for(let s in e){let r=i[s],n=e[s];r&&r.forEach((e=>{t[e]=n}))}}}parseCss(e){let t="",i=1,s=[],r=/\./g,n=/\s+/g;if(e.colors){t+=":root{\n";for(let i in e.colors)t+=`--my-${i.replace(/\./g,"-")}: ${e.colors[i]};\n`;t+="}\n"}return e.tokenColors&&e.tokenColors.forEach((e=>{if(!e.scope)return;let r=[],n="",a="",l=e.scope instanceof Array?e.scope.join(","):e.scope;l=l.replace(/\s+/g," "),l=l.split(/\s*\,\s*/);for(let t in e.settings)n+=`${us[t]}:${e.settings[t]};\n`,e.settings[t]&&(a+=`${t}:${e.settings[t]};`);l.forEach(((t,n)=>{r.push(`.my-scope-${i}`),s.push({scopeId:i,scope:t,scopes:t.split(" "),level:o(t),settings:e.settings,settingsStr:a}),i++})),t+=`${r.join(",")}{\n${n}\n}`})),s.sort(((e,t)=>t.level-e.level)),H.scopeIdMap={},s.forEach((e=>{H.scopeIdMap[e.scopeId]=e,e.scopes.length>1?e.regexp=e.scopes.join("(?:\\.[^\\.\\s]+)*?(?:\\s[^\\s]+)*? "):e.regexp=e.scope,e.regexp=new RegExp(e.regexp)})),H.scopeTokenList=s,H.colors=e.colors,t;function o(e){let t=e.match(r),i=e.match(n);return t=t&&t.length||0,i=i&&1e3*i.length||0,t+i}}insertCss(e){H.themeStyle?H.themeStyle.innerText="":(H.themeStyle=document.createElement("style"),H.themeStyle.type="text/css"),H.themeStyle.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(H.themeStyle)}insertFont(e){H.iconStyle?H.iconStyle.innerText="":(H.iconStyle=document.createElement("style"),H.iconStyle.type="text/css"),H.iconStyle.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(H.iconStyle)}setDefaultColor(e,t){let i="transparent",s="",r="",n="",o="",a="",l="light"===t||"contrast light"===t,h="contrast light"===t||"contrast dark"===t;function c(){e.colors["foreground"]||(e.colors["editor.foreground"]?e.colors["foreground"]=cs()(e.colors["editor.foreground"]).alpha(.8).css():e.colors["foreground"]=l?"#575757":"rgb(221, 221, 221)"),e.colors["errorForeground"]||(e.colors["errorForeground"]="#ff0000"),e.colors["background"]||(e.colors["editor.background"]?e.colors["background"]=cs()(e.colors["editor.background"]).alpha(.8).css():e.colors["background"]=l?"#fff":h?"#000":"rgba(60,60,60)"),e.colors["focusBorder"]||(e.colors["focusBorder"]=h?l?"#0f4a85":"#f38518":"#0066b8"),e.colors["contrastBorder"]||(e.colors["contrastBorder"]=h?l?"#0f4a85":"#6fc3df":i),e.colors["contrastActiveBorder"]||(e.colors["contrastActiveBorder"]=h?e.colors["focusBorder"]:i),e.colors["widget.shadow"]||(e.colors["widget.shadow"]=h?i:l?"rgba(0,0,0,0.16)":"rgba(0,0,0,0.36)"),e.colors["sash.hoverBorder"]||(e.colors["sash.hoverBorder"]=h?e.colors["contrastActiveBorder"]:e.colors["focusBorder"]),e.colors["selection.background"]||(e.colors["selection.background"]=e.colors["focusBorder"]),r=e.colors["background"],s=e.colors["foreground"],n=e.colors["focusBorder"],o=e.colors["contrastBorder"],a=e.colors["contrastActiveBorder"]}function d(){e.colors["scrollbar.shadow"]||(e.colors["scrollbar.shadow"]=i),e.colors["scrollbarSlider.background"]||(e.colors["scrollbarSlider.background"]=h?cs()(o).alpha(.6).css():l?"rgba(100, 100, 100, 0.4)":"rgba(121, 121, 121, 0.4);"),e.colors["scrollbarSlider.hoverBackground"]||(e.colors["scrollbarSlider.hoverBackground"]=h?cs()(o).alpha(.8).css():l?"rgba(100, 100, 100, 0.7)":"rgba(100, 100, 100, 0.7);"),e.colors["scrollbarSlider.activeBackground"]||(e.colors["scrollbarSlider.activeBackground"]=h?o:l?"rgba(0, 0, 0, 0.6)":"rgba(191, 191, 191, 0.4);")}function u(){e.colors["titleBar.border"]||(e.colors["titleBar.border"]=o),e.colors["titleBar.activeForeground"]||(e.colors["titleBar.activeForeground"]=s),e.colors["titleBar.activeBackground"]||(h?e.colors["titleBar.activeBackground"]=i:l&&(e.colors["titleBar.activeBackground"]="rgb(221, 221, 221)")),e.colors["menubar.selectionForeground"]||(e.colors["menubar.selectionForeground"]=s),e.colors["menubar.selectionBackground"]||(e.colors["menubar.selectionBackground"]=h?i:l?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)"),e.colors["menubar.selectionBorder"]||(e.colors["menubar.selectionBorder"]=h?a:i)}function m(){e.colors["dropdown.background"]||(e.colors["dropdown.background"]=h?r:l?"#eee":"rgba(37,37,38)"),e.colors["dropdown.foreground"]||(e.colors["dropdown.foreground"]=s),e.colors["dropdown.border"]||(e.colors["dropdown.border"]=o)}function p(){e.colors["list.highlightForeground"]||(e.colors["list.highlightForeground"]=h?o:s),e.colors["list.activeSelectionBackground"]||(h?e.colors["list.activeSelectionBackground"]=i:(e.colors["list.activeSelectionBackground"]="#0066b8",e.colors["list.activeSelectionForeground"]="#fff")),e.colors["list.activeSelectionForeground"]||(e.colors["list.activeSelectionForeground"]=h?s:l?"rgba(51, 51, 51)":"rgba(255, 255, 255)"),e.colors["list.hoverForeground"]||(e.colors["list.hoverForeground"]=s),e.colors["list.hoverBackground"]||(e.colors["list.hoverBackground"]=h?i:l?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)"),e.colors["quickInputList.focusBackground"]||(e.colors["list.inactiveFocusBackground"]?e.colors["quickInputList.focusBackground"]=e.colors["list.inactiveFocusBackground"]:h?e.colors["quickInputList.focusBackground"]=i:(e.colors["quickInputList.focusBackground"]="#0066b8",e.colors["quickInputList.focusForeground"]="#fff")),e.colors["quickInputList.focusForeground"]||(e.colors["list.inactiveFocusForeground"]?e.colors["quickInputList.focusForeground"]=e.colors["list.inactiveFocusForeground"]:e.colors["quickInputList.focusForeground"]=e.colors["list.activeSelectionForeground"])}function g(){e.colors["menu.foreground"]||(e.colors["menu.foreground"]=h?s:l?"rgba(51, 51, 51)":"rgba(255, 255, 255)"),e.colors["menu.background"]||(e.colors["menu.background"]=e.colors["dropdown.background"]),e.colors["menu.border"]||(e.colors["menu.border"]=o),e.colors["menu.selectionForeground"]||(e.colors["menu.selectionForeground"]=e.colors["list.activeSelectionForeground"]),e.colors["menu.selectionBackground"]||(e.colors["menu.selectionBackground"]=e.colors["list.activeSelectionBackground"]),e.colors["menu.selectionBorder"]||(e.colors["menu.selectionBorder"]=a),e.colors["menu.separatorBackground"]||(e.colors["menu.separatorBackground"]=h?o:l?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.2)")}function f(){e.colors["statusBar.foreground"]||(e.colors["statusBar.foreground"]=h?s:"#fff"),e.colors["statusBar.background"]||(e.colors["statusBar.background"]=l&&!h?"rgb(0, 122, 204)":i),e.colors["statusBar.border"]||(e.colors["statusBar.border"]=o),e.colors["statusBarItem.hoverBackground"]||(e.colors["statusBarItem.hoverBackground"]=i),e.colors["statusBarItem.activeBackground"]||(e.colors["statusBarItem.activeBackground"]=i)}function v(){e.colors["sideBar.foreground"]||(e.colors["sideBar.foreground"]=s),e.colors["sideBarTitle.foreground"]||(e.colors["sideBarTitle.foreground"]=s),e.colors["sideBar.background"]||(e.colors["sideBar.background"]=h?i:l?"#eee":"rgba(37,37,38)"),e.colors["sideBar.border"]||(e.colors["sideBar.border"]=o)}function b(){e.colors["editor.foreground"]||(e.colors["editor.foreground"]=s),e.colors["editor.background"]||(e.colors["editor.background"]=h?r:l?"#fff":"rgb(30,30,30)"),e.colors["editorLineNumber.foreground"]||(e.colors["editorLineNumber.foreground"]=cs()(e.colors["editor.foreground"]).alpha(.5).css()),e.colors["editorLineNumber.activeForeground"]||(e.colors["editorLineNumber.activeForeground"]=e.colors["editor.foreground"]),e.colors["editorCursor.foreground"]||(e.colors["editorCursor.foreground"]=e.colors["editor.foreground"]),e.colors["editor.selectionForeground"]||h&&(e.colors["editor.selectionForeground"]=s),e.colors["editor.selectionBackground"]||(e.colors["editor.selectionBackground"]=h?n:cs()(n).alpha(.8).css()),e.colors["editor.selectionHighlightBackground"]||(e.colors["editor.selectionHighlightBackground"]=i),e.colors["editor.selectionHighlightBorder"]||(h?e.colors["editor.selectionHighlightBorder"]=a:e.colors["editor.selectionHighlightBackground"]===i&&(e.colors["editor.selectionHighlightBorder"]=n)),e.colors["editor.findMatchBackground"]||(e.colors["editor.findMatchBackground"]=e.colors["editor.selectionBackground"]),e.colors["editor.findMatchBorder"]||(e.colors["editor.findMatchBorder"]=i),e.colors["editor.findMatchHighlightBackground"]||(e.colors["editor.findMatchHighlightBackground"]=e.colors["editor.selectionHighlightBackground"]),e.colors["editor.findMatchHighlightBorder"]||(e.colors["editor.findMatchHighlightBorder"]=e.colors["editor.selectionHighlightBorder"]),e.colors["editor.lineHighlightBackground"]||(e.colors["editor.lineHighlightBackground"]=i),e.colors["editor.lineHighlightBorder"]||(e.colors["editor.lineHighlightBackground"]!==i?e.colors["editor.lineHighlightBorder"]=i:e.colors["editor.lineHighlightBorder"]=h?a:l?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.1)"),e.colors["editorWhitespace.foreground"]||(e.colors["editorWhitespace.foreground"]=h?e.colors["editor.foreground"]:l?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.1)"),e.colors["editorIndentGuide.background"]||(e.colors["editorIndentGuide.background"]=e.colors["editorWhitespace.foreground"]),e.colors["editorBracketMatch.background"]||(e.colors["editorBracketMatch.background"]=i),e.colors["editorBracketMatch.border"]||(e.colors["editorBracketMatch.background"]===i?e.colors["editorBracketMatch.border"]=cs()(e.colors["editor.foreground"]).alpha(.6).css():e.colors["editorBracketMatch.border"]=i)}function y(){e.colors["terminal.background"]||(e.colors["terminal.background"]=e.colors["editor.background"]),e.colors["terminal.foreground"]||(e.colors["terminal.foreground"]=e.colors["editor.foreground"]),e.colors["terminal.selectionBackground"]||(e.colors["terminal.selectionBackground"]=e.colors["selection.background"]),e.colors["terminal.border"]||(e.colors["terminal.border"]=o===i?l?cs()(e.colors["editor.background"]).darken().css():cs()(e.colors["editor.background"]).brighten().css():o)}function C(){e.colors["editorGroupHeader.tabsBackground"]||(e.colors["editorGroupHeader.tabsBackground"]=h?i:e.colors["sideBar.background"]),e.colors["editorGroupHeader.tabsBackground"]||(e.colors["editorGroupHeader.tabsBackground"]=o),e.colors["tab.border"]||(e.colors["tab.border"]=o),e.colors["tab.activeForeground"]||(e.colors["tab.activeForeground"]=h?s:l?"rgba(51, 51, 51)":"#fff"),e.colors["tab.activeBackground"]||(e.colors["tab.activeBackground"]=e.colors["editor.background"]),e.colors["tab.inactiveForeground"]||(e.colors["tab.inactiveForeground"]=h?s:l?"rgba(51, 51, 51, 0.7)":"rgba(255, 255, 255, 0.5)"),e.colors["tab.inactiveBackground"]||(e.colors["tab.inactiveBackground"]=h?i:l?"rgb(236, 236, 236)":"rgb(45, 45, 45)"),e.colors["tab.activeBorder"]||(e.colors["tab.activeBorder"]=i),e.colors["tab.activeBorderTop"]||(e.colors["tab.activeBorderTop"]=i),e.colors["tab.hoverForeground"]||(e.colors["tab.hoverForeground"]=e.colors["tab.inactiveForeground"]),e.colors["tab.hoverBackground"]||(e.colors["tab.hoverBackground"]=i),e.colors["tab.hoverBorder"]||(e.colors["tab.hoverBorder"]=i)}function w(){e.colors["editorWidget.foreground"]||(e.colors["editorWidget.foreground"]=e.colors["editor.foreground"]),e.colors["editorWidget.background"]||(e.colors["editorWidget.background"]=h?r:l?"#eee":"rgb(37,37,38)"),e.colors["editorWidget.border"]||(e.colors["editorWidget.border"]=h?o:i),e.colors["editorSuggestWidget.foreground"]||(e.colors["editorSuggestWidget.foreground"]=e.colors["editorWidget.foreground"]),e.colors["editorSuggestWidget.background"]||(e.colors["editorSuggestWidget.background"]=e.colors["editorWidget.background"]),e.colors["editorSuggestWidget.border"]||(e.colors["editorSuggestWidget.border"]=e.colors["editorWidget.border"]),e.colors["editorSuggestWidget.border"]===i?e.colors["editorSuggestWidget.shadow"]=e.colors["widget.shadow"]:e.colors["editorSuggestWidget.shadow"]=i,e.colors["editorSuggestWidget.selectedForeground"]||(e.colors["editorSuggestWidget.selectedForeground"]=e.colors["editor.foreground"]),e.colors["editorSuggestWidget.selectedBackground"]||(e.colors["editorSuggestWidget.selectedBackground"]=e.colors["quickInputList.focusBackground"]),e.colors["editorSuggestWidget.highlightForeground"]||(e.colors["editorSuggestWidget.highlightForeground"]=e.colors["list.highlightForeground"]),e.colors["editorSuggestWidget.focusHighlightForeground"]||(e.colors["editorSuggestWidget.focusHighlightForeground"]=e.colors["list.highlightForeground"])}function x(){e.colors["input.foreground"]||(e.colors["input.foreground"]=s),e.colors["input.background"]||(e.colors["input.background"]=h?i:l?"#fff":r),e.colors["input.border"]||(e.colors["input.background"]===i?e.colors["input.border"]="#0066b8":e.colors["input.border"]=i),e.colors["inputOption.activeForeground"]||(e.colors["inputOption.activeForeground"]=s),e.colors["inputOption.activeBackground"]||(e.colors["inputOption.activeBackground"]=h?i:cs()(n).alpha(.3).css()),e.colors["inputOption.activeBorder"]||(e.colors["inputOption.activeBorder"]=i),e.colors["inputOption.hoverBackground"]||(e.colors["inputOption.hoverBackground"]=h?i:l?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)")}function T(){e.colors["toolbar.hoverBackground"]||(e.colors["toolbar.hoverBackground"]=h?i:l?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)"),e.colors["toolbar.activeBackground"]||(e.colors["toolbar.activeBackground"]=i),e.colors["toolbar.hoverOutline"]||(e.colors["toolbar.hoverOutline"]=a)}function k(){e.colors["badge.foreground"]||(e.colors["badge.foreground"]=s),e.colors["badge.backround"]||(e.colors["badge.backround"]=h?e.colors["contrastActiveBorder"]:e.colors["focusBorder"])}function L(){e.colors["gitDecoration.untrackedResourceForeground"]||(e.colors["gitDecoration.untrackedResourceForeground"]=l?"#28a745":"#73c991"),e.colors["gitDecoration.addedResourceForeground"]||(e.colors["gitDecoration.addedResourceForeground"]=l?"#28a745":"#81b88b"),e.colors["gitDecoration.conflictingResourceForeground"]||(e.colors["gitDecoration.conflictingResourceForeground"]=l?"#e36209":"#e4676b"),e.colors["gitDecoration.modifiedResourceForeground"]||(e.colors["gitDecoration.modifiedResourceForeground"]=l?"#005cc5":"#e2c08d"),e.colors["gitDecoration.renamedResourceForeground"]||(e.colors["gitDecoration.renamedResourceForeground"]=e.colors["gitDecoration.untrackedResourceForeground"]),e.colors["gitDecoration.deletedResourceForeground"]||(e.colors["gitDecoration.deletedResourceForeground"]=l?"#d73a49":"#c74e39"),e.colors["gitDecoration.ignoredResourceForeground"]||(e.colors["gitDecoration.ignoredResourceForeground"]=l?"#959da5":"#8c8c8c"),e.colors["diffEditor.removedTextBackground"]||(e.colors["diffEditor.removedTextBackground"]=l?"rgba(255, 0, 0, 0.2":"rgba(144, 39, 74, 0.44)"),e.colors["diffEditor.insertedTextBackground"]||(e.colors["diffEditor.insertedTextBackground"]=l?"rgba(155, 185, 85, 0.2)":"rgba(75, 102, 22, 0.5)")}function S(){e.colors["minimap.selectionHighlight"]||(e.colors["minimap.selectionHighlight"]=e.colors["editor.selectionBackground"]),e.colors["minimap.findMatchHighlight"]||(e.colors["minimap.findMatchHighlight"]=e.colors["editor.findMatchBackground"])}c(),d(),u(),m(),p(),g(),f(),v(),b(),y(),C(),w(),x(),T(),k(),L(),S()}};const ps=window.require("path");ke.contexts;var gs={name:"CmdPanel",components:{Menu:Re},data(){return{searchText:"",value:"",cmdList:[],visible:!1,checkable:!1,hoverCheck:!1,scrollTop:0}},watch:{searchText(){this.isCmdSearch?this.searchCmd():this.searchMenu()}},created(){this.theme=new ms,this.initEventBus()},methods:{initEventBus(){y.$on("close-menu",(()=>{this.onCancel()})),y.$on("cmd-menu-open",(e=>{this.visible=!0,this.isCmdSearch=!1,this.searchText=e.input||"",this.originCmdList=e.cmdList,this.checkable=void 0===e.checkable||e.checkable,this.hoverCheck=void 0!==e.hoverCheck&&e.hoverCheck,this.value=e.value,!this.originCmdList[0]||this.originCmdList[0]instanceof Array||(this.originCmdList=[this.originCmdList]),this.searchMenu(),requestAnimationFrame((()=>{this.$refs.input.focus()}))})),y.$on("cmd-search-open",(e=>{e=e||{},this.visible=!0,this.isCmdSearch=!0,this.checkable=!0,this.hoverCheck=!1,this.searchText=e.input||"",this.cmdList=[],this.searchCmd(1),requestAnimationFrame((()=>{this.$refs.input.focus()}))}))},searchMenu(){if(this.scrollTop=0,this.searchText){let e=[];this.originCmdList[0].forEach((t=>{let i=v.fuzzyMatch(this.searchText,t.name,!0);i&&e.push([t,i])})),e=e.sort(((e,t)=>t[1].score-e[1].score)).map((e=>e[0])),this.cmdList=[e]}else this.cmdList=this.originCmdList.slice()},searchCmd(){if(this.scrollTop=0,this.searchText.startsWith(":")){let e=H.nowEditorId&&H.$mainWin.getNowEditor();e?(this.cmdList=[{name:`Current Line：${e.nowCursorPos.line}，Type a Line number between 1 and ${e.maxLine} to navigate to`}],this.goToLine()):this.cmdList=[{name:"Open a Editor first to go to a line"}]}else this.searchFile()},searchFile(){let e=[],t=(Date.now(),v.getUUID()),i=o(this.searchText.replace(/[\\\/]/g,ps.sep));function s(t){if(t.length){let e=t.shift();e.loaded?r.call(this,e.children,t):H.$fileTree.readdir(e).then((()=>{r.call(this,e.children,t)}))}else clearTimeout(this.searchFileTimer),this.$nextTick((()=>{this.$refs.menu.setMenuList(a(e))}));this.searchFileTimer||(this.searchFileTimer=setTimeout((()=>{this.$refs.menu.setMenuList(a(e)),this.searchFileTimer=null}),e.length?60:0))}function r(e,i){t===this.searchId&&(e.forEach((e=>{"file"===e.type?n(e):H.skipSearchDirs.test(e.path)||i.push(e)})),this.searchFileTask=H.scheduler.addTask((()=>{s.call(this,i)})))}function n(t){let s=v.getIconByPath({filePath:t.path,fileType:"file"});if(s=s?`my-file-icon my-file-icon-${s}`:"",i){let r=v.fuzzyMatch(i,o(t.path),!0);if(r){let i=[],n=[];r.indexs.forEach((e=>{n.push(t.path.length-1-e),t.name.length-1-e>=0&&i.push(t.name.length-1-e)})),i.reverse(),n.reverse(),e.push({name:t.name,desc:t.path,op:"openFile",item:t,score:r.score,descIndexs:n,nameIndexs:i,icon:s})}}else e.push({name:t.name,desc:t.path,item:t,op:"openFile",score:0,icon:s})}function o(e){return e.split("").reduce(((e,t)=>t+e),"")}function a(e){return e.sort(((e,t)=>t.score-e.score))}this.searchId=t,clearTimeout(this.searchFileTimer),this.searchFileTimer=null,H.scheduler.removeTask(this.searchFileTask),s.call(this,H.fileTree.slice())},goToLine(){let e=H.nowEditorId&&H.$mainWin.getNowEditor();if(e){let t=parseInt(this.searchText.slice(1));t>0&&t<=e.maxLine&&(this.nowCursorPos=this.nowCursorPos||e.nowCursorPos,this.scrollTop=this.scrollTop||e.scrollTop,this.scrollLeft=this.scrollLeft||e.scrollLeft,e.scrollToLine(t),this.preCursorPos?this.preCursorPos=e.cursor.updateCursorPos(this.preCursorPos,t,0):this.preCursorPos=e.cursor.addCursorPos({line:t,column:0}))}},onEnter(){if(this.isCmdSearch&&this.searchText.startsWith(":")){let e=H.nowEditorId&&H.$mainWin.getNowEditor(),t=parseInt(this.searchText.slice(1));e&&t&&this.preCursorPos&&this.preCursorPos.line===t&&(e.searcher.clearSearch(),e.cursor.setCursorPos(this.preCursorPos),e.focus(),this.visible=!1)}},onCancel(){if(this.nowCursorPos){let e=H.nowEditorId&&H.$mainWin.getNowEditor();e&&(e.setStartLine(this.scrollTop),e.scrollLeft=this.scrollLeft,e.cursor.removeCursor(this.preCursorPos),e.cursor.addCursorPos(this.nowCursorPos),e.focus()),this.preCursorPos=null,this.nowCursorPos=null,this.scrollTop=0,this.scrollLeft=0}clearTimeout(this.searchFileTimer),H.scheduler.removeTask(this.searchFileTask),this.visible=!1},onChange(e){switch(e.op){case"changeTheme":this.theme.loadTheme(e),this.visible=!1;break;case"changeIconTheme":this.theme.loadIconTheme(e),this.visible=!1;break;case"selectLanguage":y.$emit("language-change",{id:H.nowEditorId,language:e.value}),this.visible=!1;break;case"changeTabSize":y.$emit("tab-size-change",e.value),this.visible=!1;break;case"changeIndent":y.$emit("indent-change",e.value),this.visible=!1;break;case"convertTabToSpace":y.$emit("convert-to-space",e.value),this.visible=!1;break;case"convertSpaceToTab":y.$emit("convert-to-tab",e.value),this.visible=!1;break;case"openFile":y.$emit("file-open",e.item),this.onCancel();break}},onScroll(e){this.scrollTop=e}}},fs=gs,vs=(0,Fe.Z)(fs,as,ls,!1,null,null,null),bs=vs.exports,ys=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-terminal"},[t("div",{ref:"terminal",staticClass:"my-width-100 my-height-100",attrs:{id:e._id},on:{contextmenu:e.onContextmenu}})])},Cs=[],ws=i(320),xs=i(617),Ts=i(511),ks=i(747);const{ipcRenderer:Ls}=window.require("electron");var Ss={name:"Terminal",props:{id:{type:Number,default:0},path:String},data(){return{}},computed:{_id(){return"terminal-"+this.id}},created(){},mounted(){this.terminal=new ws.Terminal({windowsMode:!0,fontFamily:"Consolas",cursorBlink:!0,theme:{lineHeight:20,foreground:H.colors["terminal.foreground"],background:H.colors["terminal.background"],selection:H.colors["terminal.selectionBackground"]}}),this.fitAddon=new xs.FitAddon,this.searchAddon=new ks.SearchAddon,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(this.searchAddon),this.terminal.loadAddon(new Ts.WebLinksAddon),this.terminal.open(this.$refs.terminal),this.initEvent(),this.initTerminalEvent(),this.initResizeEvent(),requestAnimationFrame((()=>{this.fitAddon.fit(),this.createTerminal()}))},destroyed(){Ls.send("terminal-destroy",{id:this.id})},methods:{setResize(e){Ls.send("terminal-resize",{id:this.id,rows:e.rows,cols:e.cols})},createTerminal(){Ls.send("terminal-add",{id:this.id,rows:this.terminal.rows,cols:this.terminal.cols,cwd:this.path})},initEvent(){y.$on("theme-changed",(()=>{this.terminal.setOption("theme",{foreground:H.colors["terminal.foreground"],background:H.colors["terminal.background"],selection:H.colors["terminal.selectionBackground"]})}))},initResizeEvent(){const e=new ResizeObserver((e=>{cancelAnimationFrame(this.fitTimer),this.fitTimer=requestAnimationFrame((()=>{this.$refs.terminal&&this.$refs.terminal.clientHeight&&this.fitAddon.fit()}))}));e.observe(this.$refs.terminal)},initTerminalEvent(){Ls.on("terminal-data",((e,t)=>{this.id===t.id&&this.terminal.write(t.text)})),this.terminal.onData((e=>{Ls.send("terminal-write",{id:this.id,text:e})})),this.terminal.onResize((e=>{this.setResize(e)})),this.terminal.attachCustomKeyEventHandler((e=>{if(e.ctrlKey&&"KeyC"===e.code&&"keydown"===e.type){const e=this.terminal.getSelection();if(e)return this.terminal.clearSelection(),v.writeClipboard(e),!1}return!0}))},onContextmenu(e){let t=terminal.terminal.getSelection();t?(this.terminal.clearSelection(),v.writeClipboard(t)):v.readClipboard().then((e=>{this.terminal.paste(e)}))}}},Ps=Ss,Es=(0,Fe.Z)(Ps,ys,Cs,!1,null,null,null),Is=Es.exports,_s=function(){var e=this,t=e._self._c;return t("div",{ref:"terminalBar",staticClass:"my-terminal-bar",on:{selectstart:function(e){e.preventDefault()}}},[t("div",{staticClass:"my-center-between my-width-100 my-height-100"},[t("div",{staticClass:"bar-scroller my-scroll-overlay my-scroll-mini"},e._l(e.terminalList,(function(i,s){return t("div",{staticClass:"bar-item my-hover",class:[i.active?"my-active":""],attrs:{title:i.path},on:{click:function(t){return e.onClickItem(i.id)},contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu(t,i.id)}}},[t("div",{staticClass:"bar-content"},[t("span",{staticClass:"bar-text"},[e._v(e._s(i.name))]),t("div",{staticClass:"bar-icon-wrap"},[t("span",{staticClass:"bar-icon",attrs:{title:"close"},on:{click:function(t){return t.stopPropagation(),e.onClose(i.id)}}},[t("i",{staticClass:"my-icon my-icon-close"})])])])])})),0),t("div",{staticClass:"my-terminal-btns"},[t("div",{staticClass:"bar-icon-wrap"},[t("span",{staticClass:"bar-icon",attrs:{title:"new"},on:{click:function(t){return t.stopPropagation(),e.onAdd()}}},[t("i",{staticClass:"my-icon my-icon-add"})])]),t("div",{staticClass:"bar-icon-wrap"},[t("span",{staticClass:"bar-icon",attrs:{title:"new"},on:{click:function(t){return t.stopPropagation(),e.onToggle()}}},[t("i",{staticClass:"my-icon my-icon-close"})])])])]),t("terminal-bar-menu",{ref:"terminalBarMenu"})],1)},Ds=[],Ms=function(){var e=this,t=e._self._c;return t("Menu",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})},$s=[],Fs={name:"TerminalBarMenu",components:{Menu:Re},data(){return{menuList:[[{name:"Close",op:"close"},{name:"Close to the Left",op:"closeToLeft"},{name:"Close to the Right",op:"closeToRight"},{name:"Close Ohter",op:"closeOther"},{name:"Close All",op:"closeAll"}]],menuVisible:!1,menuStyle:{left:"10px",top:"40px"}}},created(){this.initEventBus()},methods:{initEventBus(){y.$on("close-menu",(()=>{this.menuVisible=!1}))},show(e,t){this.tabId=t,this.menuVisible=!0,this.$nextTick((()=>{this.menuStyle=v.getMemnuPos(e,this.$refs.menu.$el,document.body)}))},onMenuChange(e){switch(e.op){case"close":y.$emit("terminal-close",this.tabId);break;case"closeToLeft":y.$emit("terminal-close-to-left",this.tabId);break;case"closeToRight":y.$emit("terminal-close-to-right",this.tabId);break;case"closeOther":y.$emit("terminal-close-other",this.tabId);break;case"closeAll":y.$emit("terminal-close-all",this.tabId);break}this.menuVisible=!1}}},Os=Fs,Bs=(0,Fe.Z)(Os,Ms,$s,!1,null,null,null),As=Bs.exports,Hs=class{constructor(){}onKeydown(e){if(e.ctrlKey)if(this.pressK)switch(this.pressK=!1,e.keyCode){}else switch(e.keyCode){}}},Ns={name:"TerminalBar",components:{TerminalBarMenu:As},props:{terminalList:{type:Array}},data(){return{list:[]}},provide(){return{rootList:this.list}},created(){this.shortcut=new Hs(this),this.initEventBus(),u()(window).on("keydown",(e=>{this.shortcut.onKeydown(e)}))},methods:{initEventBus(){y.$on("terminal-editor-changed",(e=>{this.$nextTick((()=>{let e=u()(this.$refs.terminalBar).find("div.my-active");e.length&&e[0].scrollIntoView()}))}))},onClickItem(e){y.$emit("terminal-change",e)},onClose(e){y.$emit("terminal-close",e)},onAdd(){y.$emit("terminal-new")},onToggle(){y.$emit("terminal-toggle")},onContextmenu(e,t){this.$refs.terminalBarMenu.show(e,t)}}},Rs=Ns,Ws=(0,Fe.Z)(Rs,_s,Ds,!1,null,null,null),js=Ws.exports;const Vs=window.require("path");var zs=class{constructor(){this.terminalList=H.terminalList,this.terminalId=1,this.init()}init(){y.$on("terminal-new",(e=>{let t=H.nowFileItem,i={},s="";e||(e=window.process.env.HOME,t&&(e="file"===t.type?Vs.dirname(t.path):t.path)),s=Vs.basename(e),i.name=s,i.path=e,i.id=v.getUUID(),this.terminalList.push(i),y.$emit("terminal-change",i.id)})),y.$on("terminal-close",(e=>{this.closeTerminal(e)})),y.$on("terminal-change",(e=>{this.changeTerminalTab(e)})),y.$on("terminal-close-to-left",(e=>{this.closeTerminalToLeft(e)})),y.$on("terminal-close-to-right",(e=>{this.closeTerminalToRight(e)})),y.$on("terminal-close-other",(e=>{this.closeTerminalOther(e)})),y.$on("terminal-close-all",(e=>{this.terminalList.empty(),H.views.terminal&&y.$emit("terminal-toggle")})),y.$on("terminal-loaded",(e=>{this.loadTerminal(e)}))}getTerminalTabById(e){for(let t=0;t<this.terminalList.length;t++)if(e===this.terminalList[t].id)return this.terminalList[t]}changeTerminalTab(e){this.terminalList.forEach((t=>{t.active=t.id===e})),this.terminalList.splice()}closeTerminal(e){for(let t=0;t<this.terminalList.length;t++)if(e===this.terminalList[t].id){let e=null;this.terminalList.splice(t,1),e=this.terminalList[t]||this.terminalList[t-1],e&&this.changeTerminalTab(e.id);break}0===this.terminalList.length&&H.views.terminal&&y.$emit("terminal-toggle")}closeTerminalToLeft(e){for(let t=0;t<this.terminalList.length;t++){if(e==this.terminalList[t].id)break;this.terminalList.splice(t,1),t--}}closeTerminalToRight(e){for(let t=this.terminalList.length-1;t>=0;t--){let i=this.terminalList[t];if(!i||e==i.id)break;this.terminalList.splice(t,1)}}closeTerminalOther(e){let t=this.getTerminalTabById(e);this.terminalList.empty(),this.terminalList.push(t),y.$emit("terminal-change",t.id)}loadTerminal(e){e.forEach((e=>{this.terminalList.push(e)}))}};const Ys=window.require("@electron/remote"),Ks=ke.contexts;var Us=class{constructor(){this.editorList=H.editorList,this.mode=Ys?"app":"mode",this.init()}init(){y.$on("editor-close",(e=>{this.closeTab(e)})),y.$on("editor-change",(e=>{this.changeTab(e)})),y.$on("editor-saved",(e=>{this.saveTab(e)})),y.$on("editor-close-to-left",(e=>{this.closeToLeft(e)})),y.$on("editor-close-to-right",(e=>{this.closeToRight(e)})),y.$on("editor-close-saved",(e=>{this.closeSaved(e)})),y.$on("editor-close-other",(e=>{this.closeOther(e)})),y.$on("editor-close-all",(e=>{this.closeAll()})),y.$on("editor-loaded",(e=>{this.loadEditor(e)})),y.$on("editor-content-change",(e=>{let t=v.getTabById(this.editorList,e.id);t&&(t.saved=!1,this.editorList.splice())})),y.$on("language-check",(()=>{this.checkLanguage()})),y.$on("folder-opened",(()=>{this.editorList.empty(),H.nowEditorId=null}))}changeTab(e){let t=v.getTabById(this.editorList,e);t&&!t.active?t.path&&!t.loaded?y.$emit("file-open",t):(this.editorList.forEach((e=>{e.active=!1})),t.active=!0,H.nowEditorId=e,this.changeStatus()):this.focusNowEditor()}saveTab(e){let t=v.getTabById(this.editorList,e);t.saved=!0}changeStatus(){let e=this.changeStatus.id||1;this.changeStatus.id=e,s.ZP.prototype.$nextTick((()=>{if(this.changeStatus.id!==e)return;let t=H.$mainWin.getNowEditor(),i=v.getTabById(this.editorList,H.nowEditorId);y.$emit("editor-changed",{id:i.id,path:i.path,language:t.language,tabSize:t.tabSize,indent:t.indent,line:t.nowCursorPos?t.nowCursorPos.line:"?",column:t.nowCursorPos?t.nowCursorPos.column:"?"})}))}checkLanguage(){if(H.nowEditorId){let e=v.getTabById(this.editorList,H.nowEditorId),t=/\.[^\.]+$/.exec(e.name);if(!t)return;for(let i=0;i<H.languageList.length;i++){let r=H.languageList[i];if(r.extensions&&r.extensions.indexOf(t[0])>-1){s.ZP.prototype.$nextTick((()=>{y.$emit("language-change",{id:e.id,language:r.value})}));break}}}}closeTab(e){let t=v.getTabById(this.editorList,e||H.nowEditorId),i=this.editorList.indexOf(t);return new Promise(((e,i)=>{t.saved?s.call(this,e):r.call(this,e)})).then((()=>{y.$emit("git-status-stop",t.path),y.$emit("file-watch-stop",t.path)}));function s(s){if(this.editorList.splice(i,1),Ks[e]=null,t.active){let e=this.editorList[i]||this.editorList[i-1];H.nowEditorId=null,t.active=!1,e?this.changeTab(e.id):y.$emit("editor-changed",null)}else this.focusNowEditor();s()}function r(t){y.$emit("dialog-show",{content:"文件尚未保存，是否先保存文件？",cancel:!0,icon:"my-icon-warn",iconColor:"rgba(255,196,0)",btns:[{name:"保存",callback:()=>{"app"===this.mode?y.$emit("file-save",{id:e,success:()=>{s.call(this,t),y.$emit("dialog-close")}}):(s.call(this,t),y.$emit("dialog-close"))}},{name:"不保存",callback:()=>{s.call(this,t),y.$emit("dialog-close")}}]})}}closeMultiple(e){e.length&&this.closeTab(e.pop().id).then((()=>{this.closeMultiple(e)}))}closeOther(e){let t=this.editorList.filter((t=>e!==t.id));this.closeMultiple(t)}closeAll(){let e=this.editorList.slice();this.closeMultiple(e)}closeSaved(){let e=this.editorList.filter((e=>e.saved));this.closeMultiple(e)}closeToLeft(e){let t=[];e=e||H.nowEditorId;for(let i=0;i<this.editorList.length;i++){let s=this.editorList[i];if(s.id===e)break;t.push(s)}this.closeMultiple(t)}closeToRight(e){let t=[];e=e||H.nowEditorId;for(let i=this.editorList.length-1;i>=0;i++){let s=this.editorList[i];if(s.id===e)break;t.push(s)}this.closeMultiple(t)}loadEditor(e){let t=null;e.forEach((e=>{e.active&&(t=e),e.active=!1,this.editorList.push(e),e.path&&(y.$emit("file-watch-start",e.path),y.$emit("git-status-start",e.path))})),t&&this.changeTab(t.id)}focusNowEditor(){cancelAnimationFrame(this.closeTabTimer),this.closeTabTimer=requestAnimationFrame((()=>{H.nowEditorId&&H.$mainWin.getNowEditor().focus()}))}};const{ipcRenderer:qs}=window.require("electron"),Gs=window.require("@electron/remote"),Zs=window.require("fs"),Xs=window.require("path"),Js=ke.contexts;var Qs=class{constructor(){this.titleCount=1,this.editorList=H.editorList,this.fileWatcherMap={},this.fileWatcherTimer={},this.init()}init(){y.$on("file-open",((e,t)=>{this.openFile(e,t)})),y.$on("file-save",(e=>{this.saveFile(e.id).then((()=>{e.success&&e.success()}))})),y.$on("file-save-as",(e=>{this.saveFile(e.id,!0).then((()=>{e.success&&e.success()}))})),y.$on("file-watch-start",(e=>{this.watchFile(e)})),y.$on("file-watch-stop",(e=>{this.stopWatchFile(e)})),y.$on("folder-open",(()=>{this.openFolder()})),y.$on("folder-add",(()=>{this.openFolder(!0)})),y.$on("folder-remove",(e=>{this.removeFolder(e)})),y.$on("reveal-in-file-explorer",(e=>{e&&Gs.shell.showItemInFolder(e)})),y.$on("file-copy",(e=>{this.cutPath="",this.copyFileToClip(e)})),y.$on("file-cut",(e=>{this.cutPath=e.path,this.cutFileToClip(e)})),y.$on("file-paste",(e=>{this.pasteFileFromClip(e,this.cutPath),this.cutPath=""})),y.$on("file-rename",((e,t)=>{qs.send("file-rename",e,t)})),y.$on("file-create",(e=>{qs.send("file-create",e)})),y.$on("folder-create",(e=>{qs.send("folder-create",e)})),y.$on("file-delete",(e=>{qs.send("file-delete",e.path)})),y.$on("workspace-save-as",(()=>{this.saveWorkspace(!0)})),y.$on("workspace-open",(()=>{this.openWorkspace()}))}openFolder(e){this.choseFolder().then((t=>{if(t){if(e){let e={};H.fileTree.forEach((t=>{e[t.path]=!0})),t=t.filter((t=>!e[t.path])),t.length&&H.fileTree.push(...t),y.$emit("folder-added")}else H.fileTree.forEach((e=>{y.$emit("git-status-stop",e.path)})),H.fileTree.empty(),H.fileTree.push(...t),y.$emit("folder-opened");this.saveWorkspace()}}))}removeFolder(e){for(let t=0;t<H.fileTree.length;t++)if(H.fileTree[t].path===e){H.fileTree.splice(t,1),y.$emit("folder-removed"),y.$emit("git-status-stop",e),this.saveWorkspace();break}}choseFolder(){let e=Gs.getCurrentWindow(),t={title:"选择文件夹",properties:["openDirectory","multiSelections"]};return Gs.dialog.showOpenDialog(e,t).then((e=>{let t=[];if(!e.canceled&&e.filePaths)return e.filePaths.forEach((e=>{t.push(this.createRootDirItem(e))})),t})).catch((e=>{console.log(e)}))}openFile(e,t){let i=e&&v.getTabByPath(this.editorList,e.path);if(i)s.call(this);else{let r=-1;this.editorList.length&&(i=v.getTabById(this.editorList,H.nowEditorId),r=this.editorList.indexOf(i)),t?this.choseFile().then((e=>{if(e){let t=this.getEditorMap(),n=e[0].id;if(e=e.filter((e=>!t[e.id])),e.length){let t=this.editorList.slice(0,r).concat(e).concat(this.editorList.slice(r));i=e[0],this.editorList.empty(),this.editorList.push(...t),e.forEach((e=>{this.watchFile(e.path),y.$emit("git-status-start",e.path)}))}else i=t[n];s.call(this)}})):(e?(i=Object.assign({},e),e.path&&(this.watchFile(e.path),y.$emit("git-status-start",e.path))):i=this.createEmptyTabItem(),i.saved=!0,i.active=!1,this.editorList.splice(r+1,0,i),s.call(this))}function s(){if(i&&(i.path||i.tempPath)&&!i.loaded){let t=i.tempPath||i.path;Zs.existsSync(t)&&(i.loaded=!0,v.readFile(t).then((s=>{Js[i.id].reload(s),y.$emit("file-opened",t),i.tempPath||(y.$emit("file-saved",i.path),i.saved=!0),e&&e.range&&H.$mainWin.getEditor(i.id).cursor.setCursorPos(Object.assign({},e.range.start)),i.mtimeMs=Zs.statSync(t).mtimeMs})))}else e&&e.range&&H.$mainWin.getEditor(i.id).cursor.setCursorPos(Object.assign({},e.range.start));y.$emit("editor-change",i.id),y.$emit("language-check")}}choseFile(){let e=Gs.getCurrentWindow(),t={title:"选择文件",properties:["openFile","multiSelections"]};return Gs.dialog.showOpenDialog(e,t).then((e=>{let t=[];if(!e.canceled&&e.filePaths)return e.filePaths.forEach((e=>{let i=this.createTabItem(e);t.push(i)})),t})).catch((e=>{console.log(e)}))}saveFile(e,t){let i=v.getTabById(this.editorList,e);if("web"===this.mode)return Promise.resolve();if(!i.saved||t){if(i.path&&!t)return v.writeFile(i.path,Js[e].getAllText()).then((()=>{i.saved=!0,i.mtimeMs=Zs.statSync(i.path).mtimeMs,y.$emit("file-saved",i.path)}));{let t=Gs.getCurrentWindow(),s={title:"请选择要保存的文件名",buttonLabel:"保存"};return Gs.dialog.showSaveDialog(t,s).then((t=>!t.canceled&&t.filePath?v.writeFile(t.filePath,Js[e].getAllText()).then((()=>{i.path||(i.path=t.filePath,i.mtimeMs=Zs.statSync(i.path).mtimeMs,i.name=i.path.match(/[^\\\/]+$/)[0],i.saved=!0)})):Promise.reject()))}}return Promise.resolve()}openWorkspace(){let e=Gs.getCurrentWindow(),t={title:"选择文件",properties:["openFile"]};return Gs.dialog.showOpenDialog(e,t).then((e=>{if(!e.canceled&&e.filePaths){let t=e.filePaths[0];v.loadJsonFile(t).then((e=>{let i=e.folders,s={};H.fileTree.forEach((e=>{s[e.path]=!0})),i=i.filter((e=>!s[e.path])),i=i.map((e=>this.createRootDirItem(e.path))),H.fileTree.push(...i),y.$emit("workspace-opened"),H.workSpacePath=t}))}})).catch((e=>{console.log(e)}))}saveWorkspace(e){let t=H.fileTree.map((e=>({path:e.path}))),i=JSON.stringify({folders:t});if(e){let e=Gs.getCurrentWindow(),t={title:"请选择要保存的文件名",buttonLabel:"保存"};return Gs.dialog.showSaveDialog(e,t).then((e=>!e.canceled&&e.filePath?v.writeFile(e.filePath,i):Promise.reject()))}if(H.workSpacePath)return v.writeFile(H.workSpacePath,i)}copyFileToClip(e){qs.send("file-copy",[e.path])}cutFileToClip(e){qs.send("file-cut",[e.path])}pasteFileFromClip(e,t){qs.send("file-paste",e.path,t)}createRootDirItem(e){return{id:v.getIdFromPath(e),name:e.match(/[^\\\/]+$/)[0],path:e,parentPath:"",relativePath:"",rootPath:e,type:"dir",active:!1,open:!1,deep:0,parent:null,children:[]}}createTabItem(e){let t=v.getFileItemByPath(H.fileTree,e);if(t.sort(((e,t)=>t.rootPath.length-e.rootPath.length)),t=t[0],t)t=Object.assign({},t),t.active=!1,t.saved=!0;else{let i=v.getIconByPath({filePath:e,fileType:"file"});i=i?`my-file-icon my-file-icon-${i}`:"",t={id:v.getIdFromPath(e),name:e.match(/[^\\\/]+$/)[0],path:e,parentPath:Xs.dirname(e),relativePath:"",rootPath:"",icon:i,active:!1,saved:!0}}return t}createEmptyTabItem(){let e=this.titleCount++,t=v.getIconByPath({filePath:"",fileType:"file"});return t=t?`my-file-icon my-file-icon-${t}`:"",{id:"file-"+e,name:"Untitled"+e,path:"",parentPath:"",relativePath:"",rootPath:"",icon:t,active:!1,saved:!0}}watchFile(e){this.fileWatcherMap[e]||(this.fileWatcherMap[e]=Zs.watch(e,{recursive:!0},(t=>{clearTimeout(this.fileWatcherTimer[e]),this.fileWatcherTimer[e]=setTimeout((()=>{let i=v.getTabByPath(this.editorList,e);if("rename"===t)y.$emit("file-renamed",{path:e}),this.fileWatcherMap[e].close();else if("change"===t){let t=Zs.statSync(e);i&&i.saved&&i.mtimeMs!==t.mtimeMs&&v.readFile(e).then((e=>{Js[i.id].getAllText()!==e.replace(/\r\n/g,"\n")&&(Js[i.id].reload(e),y.$emit("file-saved",i.path),i.active&&y.$emit("git-diff",i.path),i.saved=!0)}))}}),15)})))}stopWatchFile(e){this.fileWatcherMap[e]&&(this.fileWatcherMap[e].close(),clearTimeout(this.fileWatcherTimer[e]),delete this.fileWatcherMap[e],delete this.fileWatcherTimer[e])}getEditorMap(){let e={};return this.editorList.forEach((t=>{e[t.id]=t})),e}},er=class{constructor(){this.editorList=H.editorList,this.init()}init(){y.$on("icon-changed",(()=>{this.changeFileIcon()})),y.$on("theme-changed",(()=>{this.changeFileIcon()})),y.$on("cmd-menu-theme-open",(()=>{const e=H.themes.map((e=>e.map((e=>(e=Object.assign({op:"changeTheme"},e),e.active=e.value===H.nowTheme.value,e.selected=e.active,e)))));y.$emit("cmd-menu-open",{cmdList:e})})),y.$on("cmd-menu-icon-theme-open",(()=>{const e=H.iconThemes.map((e=>(e=Object.assign({op:"changeIconTheme"},e),e.active=e.value===H.nowIconTheme.value,e.selected=e.active,e)));e.push({name:"None",value:"none",op:"changeIconTheme",active:"none"===H.nowIconTheme.value,selected:"none"===H.nowIconTheme.value}),y.$emit("cmd-menu-open",{cmdList:e})}))}changeFileIcon(){this.editorList.forEach((e=>{if(H.nowIconTheme.value){let t=v.getIconByPath({filePath:e.path,fileType:"file"});e.icon=t?`my-file-icon my-file-icon-${t}`:""}else e.icon=""})),this.editorList.splice()}},tr=i(151),ir=i.n(tr);const sr=window.require("child_process"),rr=window.require("path"),nr=window.require("fs");var or=class{constructor(){this.cwd="",this.gitStatusTimer={},this.gitStautsMap={},this.gitDiffTimer={},this.init(),this.createStatusProcess()}init(){y.$on("git-status-start",(e=>{this.watchFileStatus(e)})),y.$on("git-status-stop",(e=>{this.stopWatchFileStatus(e)})),y.$on("git-ignore",(e=>{this.parseGitIgnore(e)})),y.$on("window-close",(()=>{try{this.statusProcess&&this.statusProcess.kill()}catch(Er){}}))}parseGitIgnore(e){try{nr.existsSync(e)&&nr.statSync(e).isFile()&&v.readFile(e).then((t=>{let i=t.split(/\r\n|\n/);if(i=i.filter((e=>e&&!/^\s*#/.test(e))),i.length){let t=ir()();t.add(i),y.$emit("git-ignored",{path:e,ignore:t})}}))}catch(Er){console.log(Er)}}createStatusProcess(){this.statusProcess=sr.fork(rr.join(H.dirname,"main/process/git/status.js")),this.statusProcess.on("message",(e=>{this.parseStatus(e),e.paths.forEach((e=>{y.$emit("git-statused",{path:e})}))})),this.statusProcess.on("close",(()=>{this.createStatusProcess()}))}watchFileStatus(e){this.statusProcess.send({type:"start",path:e})}stopWatchFileStatus(e){this.statusProcess.send({type:"stop",path:e}),delete H.fileStatus[e]}parseStatus(e){let t=e.gitDir,i=e.results,s={},r=[];H.fileStatus[t]=s,H.dirStatus[t]=r,i.forEach((e=>{let i=rr.dirname(e.path);s[e.path]=e.status;while(i.length>=t.length){if(s[i]){let t=v.getStatusLevel(e.status),r=v.getStatusLevel(s[i]);t>r&&(s[i]=e.status)}else s[i]=e.status;i=rr.dirname(i)}e.path[e.path.length-1]===rr.sep&&r.push({path:e.path.slice(0,-1),status:e.status})}))}},ar=class{constructor(){this.init()}init(){this.terminalEvent=new zs,this.editorEvent=new Us,this.fileEvent=new Qs,this.themeEvent=new er,this.gitEvent=new or}};const lr=window.require("@electron/remote");var hr=class{constructor(){}onKeydown(e){if(e.ctrlKey)if(e.shiftKey)switch(e.code){case"KeyS":e.preventDefault(),y.$emit("file-save-as",{id:H.nowEditorId});break;case"KeyL":e.preventDefault(),y.$emit("sidebar-toggle");break;case"KeyB":e.preventDefault(),y.$emit("statusbar-toggle");break;case"KeyM":e.preventDefault(),y.$emit("minimap-toggle");break}else switch(e.code){case"Equal":e.preventDefault(),H.zoomLevel+=.5,lr.getCurrentWindow().webContents.setZoomLevel(H.zoomLevel);break;case"Minus":e.preventDefault(),H.zoomLevel-=.5,lr.getCurrentWindow().webContents.setZoomLevel(H.zoomLevel);break;case"KeyS":e.preventDefault(),y.$emit("file-save",{id:H.nowEditorId});break;case"KeyG":e.preventDefault(),y.$emit("menu-close"),y.$emit("cmd-search-open",{input:":"});break;case"KeyP":e.preventDefault(),y.$emit("menu-close"),y.$emit("cmd-search-open");break;case"Backquote":e.preventDefault(),y.$emit("terminal-toggle");break}}};const cr=window.require("fs"),dr=window.require("path"),ur=ke.contexts;var mr=class{constructor(){this.storeTabDataTimer={},y.$on("window-close",(()=>{this.storeData()}))}storeData(){this.storeGlobalData(),this.storeFileTree(),this.storeTabData(),this.storeTerminalTabData(),this.storeTempData()}storeGlobalData(){let e={nowTheme:H.nowTheme,nowIconTheme:H.nowIconTheme,views:H.views};v.writeFileSync(H.configPath,JSON.stringify(e))}storeFileTree(){let e=H.openedFileList,t=[];for(let i=0;i<e.length;i++){let s=e[i];"dir"!==s.type||!s.open&&s.parentPath||t.push({path:s.path,parentPath:s.parentPath,rootPath:s.rootPath,open:s.open})}v.writeFileSync(H.fileTreePath,JSON.stringify(t))}loadFileTree(){cr.existsSync(H.fileTreePath)?v.loadJsonFile(H.fileTreePath).then((e=>{e=e||[],y.$emit("file-tree-loaded",e)})):y.$emit("file-tree-loaded",[])}storeTabData(){let e=H.editorList.map((e=>({id:e.id,name:e.name,path:e.path,tempPath:!e.saved&&dr.join(H.cachePath,e.id)||"",active:e.active,saved:e.saved})));v.writeFileSync(H.tabPath,JSON.stringify(e))}loadTabData(){cr.existsSync(H.tabPath)&&v.loadJsonFile(H.tabPath).then((e=>{e&&e.length&&y.$emit("editor-loaded",e)}))}storeTerminalTabData(){let e=H.terminalList.map((e=>({id:e.id,name:e.name,path:e.path,active:e.active})));v.writeFileSync(H.terminalTabPath,JSON.stringify(e))}loadTerminalTabData(){cr.existsSync(H.terminalTabPath)&&v.loadJsonFile(H.terminalTabPath).then((e=>{e&&e.length&&y.$emit("terminal-loaded",e)}))}storeTempData(){H.editorList.forEach((e=>{e.saved||e.tempSaved||(v.writeFileSync(dr.join(H.cachePath,e.id),ur[e.id].getAllText()),e.tempSaved=!0)}))}storeTempDataById(e){let t=v.getTabById(H.editorList,e);t&&(t.tempSaved=!1,clearTimeout(this.storeTabDataTimer[e]),this.storeTabDataTimer[e]=setTimeout((()=>{let t=v.getTabById(H.editorList,e);!t||t.saved||t.tempSaved||v.writeFile(dr.join(H.cachePath,e),ur[e].getAllText()).then((()=>{t.tempSaved=!0}))}),5e3))}};const pr=window.require("fs"),gr=window.require("path"),fr=window.require("@electron/remote"),vr=ke.contexts;var br={components:{Editor:Pt,EditorBar:Rt,TitleBar:Gt,StatusBar:ti,ActivityBar:Hi,FileContentSearch:es,SideBar:Mi,Dialog:os,CmdPanel:bs,Terminal:Is,TerminalBar:js},data(){return{extensionsPath:gr.join(H.dirname,"main/extensions"),statusHeight:30,topBarHeight:35,editorList:H.editorList,terminalList:H.terminalList,dialogVisible:!1,dialogTilte:"",dialogContent:"",dialogBtns:[],dialogIcon:"",dialogIconColor:"",terminalVisible:H.views.terminal,sidebarVisible:H.views.sidebar,statusbarVisible:H.views.statusbar,terminalHeight:260,themeType:"dark",activity:"files",leftWidth:400,mode:fr?"app":"mode"}},computed:{_topBarHeight(){return this.topBarHeight+"px"},_statusHeight(){if(this.statusbarVisible)return this.statusHeight+"px"}},provide(){return{getNowEditor:()=>this.getNowEditor(),getNowContext:()=>this.getNowContext()}},created(){const e=fr.getCurrentWindow();fr.screen.getPrimaryDisplay().size;window.globalData=H,H.$mainWin=this,this.commonEvent=new ar(this),this.winShorcut=new hr(this),this.persistence=new mr,this.initEvent(),this.initEventBus(),this.persistence.loadFileTree(),this.persistence.loadTabData(),this.persistence.loadTerminalTabData(),e.on("blur",(()=>{y.$emit("close-menu")})),e.on("close",(e=>{this.closeMain=!0})),window.onbeforeunload=t=>{this.preCloseDone||(y.$emit("window-close"),t.returnValue=!1,setTimeout((()=>{this.preCloseDone=!0,this.closeMain?e.close():e.reload()}),0))},fr.getCurrentWindow().webContents.setZoomLevel(H.zoomLevel)},mounted(){window.test=this;const e=new ms;e.loadTheme(H.nowTheme),this.loadExtensions().then((t=>{let i=t.languages,s=t.themes,r=t.iconThemes,n=t.scopeFileList;i.push({name:"Plain Text",value:"",checked:!0}),H.languageList.empty().push(...i),H.scopeFileList.empty().push(...n),H.themes.empty().push(...s),H.iconThemes.empty().push(...r),e.loadIconTheme(H.nowIconTheme),y.$emit("language-check")}))},methods:{initEvent(){u()(document).on("mousemove",(e=>{if(this.leftSashMouseObj){let t=this.leftWidth+=e.clientX-this.leftSashMouseObj.clientX;t=t>50?t:50,this.leftWidth=t,this.leftSashMouseObj=e}if(this.terminaSashMouseObj){let t=this.terminalHeight-=e.clientY-this.terminaSashMouseObj.clientY;t=t>0?t:0,this.terminalHeight=t,this.terminaSashMouseObj=e}})).on("mouseup",(e=>{this.leftSashMouseObj=null,this.terminaSashMouseObj=null})).on("keydown",(e=>{this.winShorcut.onKeydown(e)}))},initEventBus(){y.$on("theme-changed",(e=>{this.themeType=H.nowTheme.type})),y.$on("activity-change",(e=>{this.activity=e})),y.$on("terminal-toggle",(()=>{this.terminalVisible=!this.terminalVisible,this.terminalVisible&&!this.terminalList.length&&y.$emit("terminal-new")})),y.$on("sidebar-toggle",(()=>{this.sidebarVisible=!this.sidebarVisible})),y.$on("statusbar-toggle",(()=>{this.statusbarVisible=!this.statusbarVisible})),y.$on("dialog-show",(e=>{this.showDialog(e)})),y.$on("dialog-close",(()=>{this.closeDialog()})),y.$on("editor-changed",(e=>{e&&e.id===this.nowEditorId||(this.diffVisible=!1)})),y.$on("editor-content-change",(e=>{this.persistence.storeTempDataById(e.id)}))},onLeftSashBegin(e){this.leftSashMouseObj=e},onTerminalSashBegin(e){this.terminaSashMouseObj=e},onWindMouseDown(){y.$emit("close-menu")},showDialog(e){this.dialogTilte=e.title||"",this.dialogContent=e.content||"",this.dialogBtns=e.btns,this.dialogVisible=!0,this.dialogIconColor=e.iconColor||"",this.dialogIcon=e.icon||""},closeDialog(){this.dialogVisible=!1},onCloseDiff(){this.diffVisible=!1},loadExtensions(){let e=[],t=[],i=[[],[],[],[]],s=[];return new Promise((o=>{pr.readdir(this.extensionsPath,{encoding:"utf8"},((a,l)=>{if(a)throw a;const h=[];l.forEach(((e,t)=>{let i=gr.join(this.extensionsPath,e),s=gr.join(i,"./package.json"),o=gr.join(i,"./package.nls.json");pr.existsSync(o)?h.push(r(o).then((e=>n(s,i,e)))):pr.existsSync(s)&&h.push(n(s,i))})),Promise.all(h).then((()=>{i=i.filter((e=>e.length)),o({languages:e,scopeFileList:t,themes:i,iconThemes:s})}))}))}));function r(e){return v.loadJsonFile(e)}function n(e,t,i){return v.loadJsonFile(e).then((e=>{let s=e.contributes;o(s,t,i),a(s,t,i),l(s,t,i)}))}function o(i,s){let r=i.grammars,n=i.languages||[];n.map((i=>{for(let n=0;n<r.length;n++){let o=r[n];if(t.push({scopeName:o.scopeName,path:gr.join(s,o.path),configPath:i.configuration?gr.join(s,i.configuration):""}),i.id===o.language){let t=i.aliases&&i.aliases[0];t=t||o.language,e.push({name:t,value:o.language,language:o.language,scopeName:o.scopeName,path:gr.join(s,o.path),configPath:i.configuration?gr.join(s,i.configuration):"",extensions:i.extensions});break}}}))}function a(e,t,s){let r=e.themes||[];r.map((e=>{let r="light",n=0,o=h(e.label,s);switch(e.uiTheme){case"vs-dark":r="dark",n=1;break;case"hc-light":r="contrast light",n=2;break;case"hc-black":r="contrast dark",n=3;break}i[n].push({name:e.id||o,value:o||e.id,type:r,path:gr.join(t,e.path)})}))}function l(e,t,i){let r=e.iconThemes||[];r.map((e=>{let r=h(e.label,i);s.push({name:r||e.id,value:e.id||r,path:gr.join(t,e.path)})}))}function h(e,t){return e=e||"","%"===e[0]&&"%"===e[e.length-1]&&(e=t[e.slice(1,-1)]||e),e}},getTabById(e){for(let t=0;t<this.editorList.length;t++)if(this.editorList[t].id===e)return this.editorList[t]},getEditor(e){let t=this.$refs[`editor${e}`];return t&&t[0]},getNowEditor(){return this.getEditor(H.nowEditorId)},getContext(e){return vr[e]},getNowContext(){return this.getContext(H.nowEditorId)}}},yr=br,Cr=(0,Fe.Z)(yr,o,a,!1,null,null,null),wr=Cr.exports,xr={name:"App",components:{Window:wr}},Tr=xr,kr=(0,Fe.Z)(Tr,r,n,!1,null,null,null),Lr=kr.exports,Sr=i(669),Pr=i.n(Sr);window.require=window.require||function(){},s.ZP.config.productionTip=!1,s.ZP.prototype.$http=Pr().create({timeout:3e4,withCredentials:!0,headers:{"Content-Type":"application/json; charset=utf-8"}}),new s.ZP({render:e=>e(Lr)}).$mount("#app")}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,i),n.exports}i.m=e,function(){var e=[];i.O=function(t,s,r,n){if(!s){var o=1/0;for(c=0;c<e.length;c++){s=e[c][0],r=e[c][1],n=e[c][2];for(var a=!0,l=0;l<s.length;l++)(!1&n||o>=n)&&Object.keys(i.O).every((function(e){return i.O[e](s[l])}))?s.splice(l--,1):(a=!1,n<o&&(o=n));if(a){e.splice(c--,1);var h=r();void 0!==h&&(t=h)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,r,n]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,n,o=s[0],a=s[1],l=s[2],h=0;if(o.some((function(t){return 0!==e[t]}))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(l)var c=l(i)}for(t&&t(s);h<o.length;h++)n=o[h],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(c)},s=self["webpackChunkmy_editor"]=self["webpackChunkmy_editor"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(899)}));s=i.O(s)})();
//# sourceMappingURL=app.0980fae2.js.map