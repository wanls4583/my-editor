(function(){"use strict";var e={393:function(e,t,s){var i=s(5),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("Window")],1)},r=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"window",staticClass:"my-window",style:{"padding-top":e._topBarHeight,"padding-bottom":e._statusHeight},on:{mousedown:e.onWindMouseDown}},["app"===e.mode?s("side-bar",{ref:"sideBar"}):e._e(),s("div",{ref:"rightWrap",staticClass:"my-right-wrap",on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)}}},[s("editor-bar",{directives:[{name:"show",rawName:"v-show",value:e.editorList.length,expression:"editorList.length"}],attrs:{editorList:e.editorList},on:{change:e.onChangeTab,close:e.onCloseTab,"close-all":e.onCloseAll,"close-saved":e.onCloseSaved,"close-to-left":e.onCloseToLeft,"close-to-right":e.onCloseToRight}}),e._l(e.editorList,(function(t){return[s("editor",{directives:[{name:"show",rawName:"v-show",value:t.active,expression:"item.active"}],key:t.id,ref:"editor"+t.id,refInFor:!0,attrs:{active:t.active,id:t.id},on:{change:function(s){return e.onFileChange(t.id)},save:function(s){return e.onSaveFile(t.id)}}})]})),s("window-menu",{ref:"winMenu"})],2),s("title-bar",{ref:"titleBar",attrs:{height:e.topBarHeight},on:{change:e.onMenuChange}}),s("status-bar",{ref:"statusBar",attrs:{height:e.statusHeight,languageList:e.languageList},on:{"select-langeuage":e.onSelectLanguage}}),s("cmd-panel"),s("Dialog",{directives:[{name:"show",rawName:"v-show",value:e.dialogVisible,expression:"dialogVisible"}],attrs:{btns:e.dialogBtns,content:e.dialogContent,icon:this.dialogIcon,"icon-color":this.dialogIconColor,overlay:!0,title:e.dialogTilte},on:{close:e.onDialogClose}})],1)},l=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"editorBar",staticClass:"my-editor-bar",on:{selectstart:function(e){e.preventDefault()}}},[s("div",{staticClass:"bar-scroller my-scroll-overlay my-scroll-mini"},e._l(e.editorList,(function(t){return s("div",{staticClass:"bar-item my-hover",class:[t.active?"my-active":""],attrs:{title:t.path},on:{click:function(s){return e.onClickItem(t.id)},contextmenu:function(s){return s.preventDefault(),s.stopPropagation(),e.onContextmenu(s,t.id)}}},[s("div",{staticClass:"bar-content",class:[t.icon]},[s("span",{staticClass:"bar-text"},[e._v(e._s(t.name))]),s("div",{staticClass:"bar-icon"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.saved,expression:"item.saved"}],staticClass:"bar-close-icon iconfont icon-close",attrs:{title:"close"},on:{click:function(s){return s.stopPropagation(),e.onClose(t.id)}}}),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.saved,expression:"!item.saved"}],staticClass:"bar-dot"})])])])})),0),s("editor-bar-menu",{ref:"editorBarMenu"})],1)},h=[],c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"wrap"},[s("Menu",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})],1)},u=[],d=s(92),m=s.n(d),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"scroller",staticClass:"my-menu my-shadow my-border",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],ref:"content"},[e._l(e.myMenuList,(function(t,i){return[s("div",{staticClass:"my-menu-group"},e._l(t,(function(t){return s("div",{staticClass:"my-menu-item my-center-between my-hover",class:{"my-active":e.checkable&&t.checked,disabled:t.disabled},on:{mousedown:function(s){return e.onClick(t)},mouseover:function(s){return e.onHover(t)}}},[s("div",{staticClass:"my-menu-title"},[e._v(e._s(t.name))]),t.shortcut?s("div",{staticClass:"my-menu-shortcut"},[e._v(" "+e._s(t.shortcut)+" ")]):e._e()])})),0),i<e.myMenuList.length-1?s("div",{staticClass:"my-separator"}):e._e()]}))],2)])},g=[],f={name:"Menu",props:{menuList:{type:Array,default:[]},styles:{type:Object},checkable:{type:Boolean,default:!0},hoverCheck:{type:Boolean,default:!1},value:{type:[Number,String]}},data(){return{index:-1,itemHeight:26,myMenuList:[]}},computed:{visible(){for(let e=0;e<this.myMenuList.length;e++)if(this.myMenuList[e].length)return!0;return!1}},watch:{menuList(){this.initMenu()},value(e){this.setChecked(e)},index(){this.$nextTick((()=>{this.scrollToIndex()}))}},created(){this.initMenu()},mounted(){this.keydownFn=e=>{this.$refs.content.clientHeight&&(38===e.keyCode?this.setCheckedByIndex(this.index-1):40===e.keyCode?this.setCheckedByIndex(this.index+1):13===e.keyCode&&this.index>-1&&this.$emit("change",this.indexMap[this.index]))},m()(window).on("keydown",this.keydownFn)},destroyed(){m()(window).unbind("keydown",this.keydownFn)},methods:{initMenu(){let e=-1,t=this.menuList;this.index=-1,this.maxIndex=-1,this.indexMap={},!t[0]||t[0]instanceof Array||(t=[t]),this.myMenuList=t.map((t=>t.map((t=>(t=Object.assign({},t),t.value=void 0===t.value?t.name:t.value,t.checked=t.value===this.value,this.indexMap[++e]=t,this.maxIndex=e,t.checked&&(this.index=e),t)))))},scrollToIndex(){let e=this.$refs.scroller,t=(this.index+1)*this.itemHeight;e&&t>e.clientHeight+e.scrollTop?e.scrollTop=t-e.clientHeight:e&&t<e.scrollTop+this.itemHeight&&(e.scrollTop=t-this.itemHeight)},onClick(e){e.disabled||(this.clearChecked(),e.checked=!0,this.$emit("change",e))},onHover(e){this.hoverCheck&&this.setChecked(e.value)},setChecked(e){let t=-1;this.myMenuList.forEach((s=>{s.forEach((s=>{s.checked=s.value===e,t++,s.checked&&(this.index=t)}))})),this.myMenuList.splice()},setCheckedByIndex(e){this.clearChecked(),e<0?e=this.maxIndex:e>this.maxIndex&&(e=0),this.indexMap[e].checked=!0,this.index=e,this.myMenuList.splice()},clearChecked(){this.myMenuList.forEach((e=>{e.forEach((e=>{e.checked=!1}))}))}}},C=f,x=s(471),y=(0,x.Z)(C,p,g,!1,null,null,null),v=y.exports;const b=new i.Z;var k=b,w={name:"EditorBar",components:{Menu:v},data(){return{menuList:[[{name:"Close",op:"close",shortcut:"Ctrl+F4"},{name:"Close to the Left",op:"closeToLeft"},{name:"Close to the Right",op:"closeToRight"},{name:"Close Saved",op:"closeSaved",shortcut:"Ctrl+K U"},{name:"Close All",op:"closeAll",shortcut:"Ctrl+K W"}]],menuVisible:!1,menuStyle:{left:"10px",top:"40px"}}},created(){this.initEventBus()},methods:{initEventBus(){k.$on("close-menu",(()=>{this.menuVisible=!1}))},show(e,t){this.tabId=t,this.menuVisible=!0;let s=m()(this.$refs.wrap).parent();this.$nextTick((()=>{let t=s.offset(),i=this.$refs.menu.$el.clientWidth;i+e.clientX>t.left+s[0].clientWidth?this.menuStyle.left=e.clientX-t.left-i+"px":this.menuStyle.left=e.clientX-t.left+"px",this.menuStyle.top=e.clientY-t.top+"px"}))},onMenuChange(e){switch(e.op){case"close":this.$parent.$emit("close",this.tabId);break;case"closeToLeft":this.$parent.$emit("close-to-left",this.tabId);break;case"closeToRight":this.$parent.$emit("close-to-right",this.tabId);break;case"closeSaved":this.$parent.$emit("close-saved",this.tabId);break;case"closeAll":this.$parent.$emit("close-all",this.tabId);break}this.menuVisible=!1}}},T=w,L=(0,x.Z)(T,c,u,!1,null,null,null),P=L.exports;const E=window.require||window.parent.require||function(){},S=E("@electron/remote"),_=E("path"),I=S.app.getAppPath(),M={dirname:I,scopeIdMap:{},scopeReg:null,colors:{},nowTheme:{value:"Default Dark+",type:"dark",path:_.join(I,"main/extensions/theme-monokai/themes/monokai-color-theme.json")},nowIconTheme:{value:"vs-seti",path:_.join(I,"main/extensions/theme-seti/icons/vs-seti-icon-theme.json")},nowIconData:{},themes:[],iconThemes:[],languageList:[],scopeFileList:[],scopeTokenList:[],grammars:{},sourceWordMap:{},defaultWordPattern:"(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>/\\?\\s]+)"};var B=M,D=s(302);const F=window.require||window.parent.require||function(){},A=F("fs");class ${static readClipboard(){return window.clipboardData?new Promise((e=>{e(clipboardData.getData("Text"))})):navigator.clipboard?navigator.clipboard.readText():void 0}static writeClipboard(e){window.clipboardData?clipboardData.setData("Text",e):navigator.clipboard&&navigator.clipboard.writeText(e)}static getNum(e){e=String(e),e=e.replace(/[^0123456789\.]/g,"");var t=/^\d+(\.\d*)?$/,s=t.exec(e),i=s&&s[0]||"";return i&&(i=Number(s[0])),i}static space(e){for(var t="",s=0;s<e;s++)t+=" ";return t}static sortNum(e){e.sort((function(e,t){return Number(e)-Number(t)}))}static getCharWidth(e){var t="------------------------------------------------------------------------------------",s="一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一",i="char-width-"+$.getUUID(),n="char-width-"+$.getUUID(),r=m()(`<div class="my-line">\n        <div class="my-code"><span id="${i}">${t}</span><span id="${n}">${s}</span></div>\n        </div>`);m()(e).append(r);var o=m()("#"+i)[0],l=o.scrollWidth/t.length,a=o.clientHeight,h=window.getComputedStyle?window.getComputedStyle(o,null).fontSize:o.currentStyle.fontSize,c=m()("#"+n)[0].scrollWidth/s.length;return r.remove(),{charWidth:l,fullAngleCharWidth:c,charHight:a,fontSize:h}}static getStrWidth(e,t,s,i,n,r){i=i||4,"undefined"!=typeof n&&(e=e.substr(n)),"undefined"!=typeof r&&(e=e.substring(0,r-n));var o=e.match(this.fullAngleReg),l=e.length*t,a=e.match(/\t/g);return a=a&&a.length||0,o=o&&o.length||0,o&&(o-=a,l=o*s+(e.length-o)*t,l+=a*t*(i-1)),l}static getStrExactWidth(e,t,s){if($.getStrExactWidth.count=$.getStrExactWidth.count||0,$.getStrExactWidth.count++,!e)return 0;var i="str-width-"+$.getUUID(),n=m()(`<div class="my-line my-temp-text" style="visibility:hidden">\n        <div class="my-code" id="${i}">${l(e)}</div>\n        </div>`);m()(s).append(n);var r=m()("#"+i)[0],o=r.clientWidth;return m()(".my-temp-text").remove(),o;function l(e){let s=Math.floor(e.length/100),i=[];for(let t=0;t<s;t++){let s=100*t;i.push($.htmlTrans(e.slice(s,s+100)))}return s*=100,s<e.length&&i.push($.htmlTrans(e.slice(s))),`<span>${i.join("</span><span>").replace(/\t/g,$.space(t||4))}</span>`}}static htmlTrans(e){return e=e.replace(/\&\#/g,"&amp;#"),e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}static deepAssign(e,t,s){return i(e,t,s,new Map);function i(e,t,s,n){for(var r in s=s||[],t){var o=t[r];if(s.indexOf(r)>-1)e[r]=o;else if("object"!==typeof o||o instanceof RegExp||null===o||o.nodeName&&o.nodeType)e[r]=o;else if(n.has(o))e[r]=n.get(o);else{let t=null;o instanceof Array?(t=e[r]||[],n.set(o,t),e[r]=i(t,o,s,new Map(n))):(t=e[r]||{},n.set(o,t),e[r]=i(t,o,s,new Map(n)))}}return e}}static getUUID(e){e=e||16;for(var t="",s=0;s<e;s++)t+=(16*Math.random()|0).toString(16);return t}static comparePos(e,t){return e.line>t.line||e.line==t.line&&e.column>t.column?1:e.line==t.line&&e.column==t.column?0:-1}static createWorker(e){var t=new Blob([e]),s=window.URL.createObjectURL(t),i=new Worker(s);return i}static defineProperties(e,t,s){let i={};s.forEach((e=>{i[e]={get:function(){return"function"==typeof t[e]?t[e].bind(t):t[e]}}})),Object.defineProperties(e,i)}static getLanguageById(e,t){for(let s=0;s<e.length;s++)if(e[s].language===t)return e[s]}static getLanguageByScopeName(e,t){for(let s=0;s<e.length;s++)if(e[s].scopeName===t)return e[s]}static getWordPattern(e){let t=B.defaultWordPattern;if(e=$.getLanguageById(B.languageList,e),e){let s=B.sourceWordMap[e.scopeName];s=s&&s.pattern,t=s||t}return new RegExp(t)}static getIconByPath(e,t,s,i,n){let r=/[^\\\/]+$/.exec(t),o="",l="";return r=r&&r[0],e?(r&&(o=/(?<=\.)[^\.]+$/.exec(r),l=/(?<=\.)[^\.]+\.[^\.]+$/.exec(r),o=o&&o[0],l=l&&l[0]),"light"!==s&&"contrast light"!==s||(e=e.light),"dir"===i?n?e.folderExpanded:e.folder:e.fileNames&&e.fileNames[r]?e.fileNames[r]:e.fileExtensions&&e.fileExtensions[l]?e.fileExtensions[l]:e.fileExtensions&&e.fileExtensions[o]?e.fileExtensions[o]:e.file):""}static readFile(e){return new Promise(((t,s)=>{A.readFile(e,((e,i)=>e?s(e):t(i)))}))}static loadJsonFile(e){return $.readFile(e).then((e=>(e=e.toString(),e=(0,D.Z)(e),e=e.replaceAll(/\,(?=\s*(?:(?:\r\n|\n|\r))*\s*[\]\}])/g,""),e=JSON.parse(e),e)))}static fuzzyMatch(e,t,s){let i={},n={},r=0,o=0,l="",a="",h=!1,c={},u=0,d=[],m=null,p=t.toLowerCase();if(e===t)return s?{score:100,indexs:[]}:null;g();for(let x=0;x<t.length;x++){let e=t[x],s=p[x];if(i[s]&&(!l||n[l+s]||n[s+l]&&h))if(!c[s]||c[s]<i[s]){if(c[s]=c[s]?c[s]+1:1,d.push(x),"_"===s||"$"===s?o+=10:h&&(o+=5,n[l+s]&&(o+=1,f(a,e)&&h&&(o+=5))),C(s))return m;n[s+l]&&!n[l+s]||(l=s,a=e),h=!0}else o--,h=s===l;else!u&&o>-9?o-=3:o--,h=s===l}function g(){if($.fuzzyMatch.cache&&$.fuzzyMatch.cache.word===e)return i=$.fuzzyMatch.cache.wordMap,n=$.fuzzyMatch.cache.towMap,void(r=$.fuzzyMatch.cache.wordLength);let t="";for(let s=0;s<e.length;s++){let r=e[s].toLowerCase();i[r]=i[r]?i[r]+1:1,s>0&&(n[t+r]=!0),t=r}r=Object.keys(i).length,$.fuzzyMatch.cache={word:e,wordMap:i,towMap:n,wordLength:r}}function f(e,t){let s=e.charCodeAt(0),i=t.charCodeAt(0);return s<97&&i>=97||i<97&&s>=97}function C(e){if(c[e]===i[e]&&++u===r)return m={score:o,indexs:d},!0}}}Array.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},Array.prototype.empty=function(){return this.length=0,this},Array.prototype.insert=function(e,t){if(t&&this.length){let s=0,i=this.length-1;while(s<i){let n=Math.floor((s+i)/2);t(e,this[n])>0?s=n+1:i=n}t(e,this[s])<0&&s--,this.splice(s+1,0,e)}else this.push(e)},String.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},$.fullAngleReg=/[\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF\uFFF9-\uFFFC]|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,$.keyCode={DELETE:46,BACKSPACE:8},$.command={DELETE:"delete",INSERT:"insert",MOVEUP:"moveLineUp",MOVEDOWN:"moveLineDown",COPY_UP:"copyLineUp",COPY_DOWN:"copyLineDown",DELETE_COPY_UP:"deleteCopyLineUp",DELETE_COPY_DOWN:"deleteCopyLineDown",REPLACE:"replace",INSERT_LINE:"insertLine",DELETE_LINE:"deleteLine",REPLACE:"replace"},$.constData={LINE_COMMENT:"line-comment",BLOCK_COMMENT:"block-comment",BRACKET:"bracket",TAG:"tag"};var N=$,O=class{constructor(e){this.initProperties(e)}initProperties(e){N.defineProperties(this,e,["$emit"])}onKeyDown(e){if(e.ctrlKey)if(this.pressK)switch(this.pressK=!1,e.keyCode){case 85:e.preventDefault(),this.$emit("close-saved");break;case 87:e.preventDefault(),this.$emit("close-all");break}else switch(e.keyCode){case 75:e.preventDefault(),this.pressK=!0;break;case 115:e.preventDefault(),this.$emit("close");break}}},W={name:"EditorBar",components:{EditorBarMenu:P},props:{editorList:{type:Array}},data(){return{list:[]}},provide(){return{rootList:this.list}},created(){this.shortcut=new O(this),this.initEventBus(),m()(window).on("keydown",(e=>{this.shortcut.onKeyDown(e)}))},methods:{initEventBus(){k.$on("tab-change",(e=>{this.$nextTick((()=>{let e=m()(this.$refs.editorBar).find("div.my-active");e.length&&e[0].scrollIntoView()}))}))},onClickItem(e){this.$emit("change",e)},onClose(e){this.$emit("close",e)},onContextmenu(e,t){this.$refs.editorBarMenu.show(e,t)}}},R=W,j=(0,x.Z)(R,a,h,!1,null,null,null),H=j.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"editor",staticClass:"my-editor-wrap",on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)},selectstart:function(e){e.preventDefault()},wheel:function(t){return t.preventDefault(),e.onWheel.apply(null,arguments)}}},[e.active?s("div",{staticClass:"my-nums",style:{top:e._numTop}},[s("div",{staticClass:"my-num",staticStyle:{visibility:"hidden"}},[e._v(e._s(e.maxLine))]),e._l(e.renderHtmls,(function(t){return s("div",{key:t.num,staticClass:"my-num",class:{"my-active":e.nowCursorPos.line===t.num},style:{height:e._lineHeight,"line-height":e._lineHeight}},[s("span",{staticClass:"num"},[e._v(e._s(t.num))]),t.fold?s("span",{staticClass:"my-fold my-center-center",class:["iconfont","open"==t.fold?"my-fold-open icon-down1":"my-fold-close icon-right"],on:{click:function(s){return e.onToggleFold(t.num)}}}):e._e()])}))],2):e._e(),s("div",{staticClass:"my-content-wrap",style:{"box-shadow":e._leftShadow}},[s("div",{ref:"scroller",staticClass:"my-scroller my-scroll-overlay",on:{scroll:e.onScroll}},[s("div",{ref:"content",staticClass:"my-content",style:{minWidth:e._contentMinWidth,height:e.contentHeight},on:{mousedown:e.onContentMdown,mousemove:e.onContentMmove,mouseleave:e.onContentMLeave,selectend:function(t){return t.preventDefault(),e.onSelectend.apply(null,arguments)}}},[e.active?s("div",{ref:"render",staticClass:"my-render",style:{top:e._top}},e._l(e.renderHtmls,(function(t){return s("div",{key:t.num,staticClass:"my-line",class:{"my-active":e._activeLine(t.num)},style:{height:e._lineHeight,"line-height":e._lineHeight},attrs:{"data-line":t.num,id:"line_"+t.num}},[s("div",{staticClass:"my-code",class:[t.active?"my-active":"",t.selected?t.isFsearch?"my-search-bg":"my-select-bg":"",t.selected&&e.selectedFg?"my-select-fg":"","close"==t.fold?"fold-close":""],attrs:{"data-line":t.num},domProps:{innerHTML:e._s(t.html)}}),e.bracketMatch&&t.num==e.bracketMatch.start.line?s("div",{staticClass:"my-bracket-match",style:{left:e.bracketMatch.start.left+"px",width:e.bracketMatch.start.width+"px"}}):e._e(),e.bracketMatch&&t.num==e.bracketMatch.end.line?s("div",{staticClass:"my-bracket-match",style:{left:e.bracketMatch.end.left+"px",width:e.bracketMatch.end.width+"px"}}):e._e(),e._l(t.selectStarts,(function(e){return s("div",{staticClass:"my-line-bg my-select-bg",class:{"my-active":e.active,"my-search-bg":e.isFsearch},style:{left:e.left+"px",width:e.width+"px"}})})),e._l(t.selectEnds,(function(e){return s("div",{staticClass:"my-line-bg my-select-bg",class:{"my-active":e.active,"my-search-bg":e.isFsearch},style:{left:e.left+"px",width:e.width+"px"}})})),e._l(t.tabNum,(function(t){return s("span",{staticClass:"my-tab-line",style:{left:e._tabLineLeft(t)}})})),e._l(t.cursorList,(function(t){return s("div",{staticClass:"my-cursor",staticStyle:{top:"0px"},style:{height:e._lineHeight,left:t,visibility:e._cursorVisible}})}))],2)})),0):e._e(),s("textarea",{ref:"textarea",staticClass:"my-textarea",style:{top:e._textAreaPos.top,left:e._textAreaPos.left},on:{blur:e.onBlur,compositionend:e.onCompositionend,compositionstart:e.onCompositionstart,copy:function(t){return t.preventDefault(),e.onCopy.apply(null,arguments)},cut:function(t){return t.preventDefault(),e.onCut.apply(null,arguments)},focus:e.onFocus,input:e.onInput,keydown:e.onKeyDown,paste:function(t){return t.preventDefault(),e.onPaste.apply(null,arguments)}}}),s("auto-tip",{directives:[{name:"show",rawName:"v-show",value:e.autoTipList&&e.autoTipList.length,expression:"autoTipList && autoTipList.length"}],ref:"autoTip",attrs:{styles:e.autoTipStyle,tipList:e.autoTipList},on:{change:e.onClickAuto}})],1)]),s("search-dialog",{directives:[{name:"show",rawName:"v-show",value:e.searchVisible,expression:"searchVisible"}],ref:"searchDialog",attrs:{count:e.searchCount,now:e.searchNow},on:{close:e.onCloseSearch,next:function(t){return e.onSearchNext()},prev:function(t){return e.onSearchPrev()},replace:e.replace,replaceAll:e.replaceAll,search:e.onSearch}})],1),s("Menu",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onClickMenu}}),s("tip",{directives:[{name:"show",rawName:"v-show",value:e.tipContent,expression:"tipContent"}],ref:"tip",attrs:{content:e.tipContent,styles:e.tipStyle}})],1)},V=[],K=s(31),U=s(650);const Y=window.require||window.parent.require||function(){},q=Y("fs"),G=Y("path"),Z={stringToken:/(\.|^)string(\.|$)/};var X=class{constructor(e,t){this.currentLine=1,this.initRegistry(),this.initProperties(e,t),this.initLanguage(e.language)}initRegistry(){const e=q.readFileSync(G.join(B.dirname,"main/lib/onig.wasm")).buffer,t=U.loadWASM(e).then((()=>({createOnigScanner(e){return new U.OnigScanner(e)},createOnigString(e){return new U.OnigString(e)}})));this.registry=new K.Registry({onigLib:t,loadGrammar:e=>{let t=N.getLanguageByScopeName(B.scopeFileList,e);return t?t.configPath?N.loadJsonFile(t.configPath).then((e=>(this.sourceFoldMap[t.scopeName]={},B.sourceWordMap[t.scopeName]=e.wordPattern,this.hasTextGrammar=this.hasTextGrammar||t.scopeName.startsWith("text"),this.initLanguageConifg(this.sourceFoldMap[t.scopeName],e),N.readFile(t.path).then((e=>K.parseRawGrammar(e.toString(),t.path)))))):N.readFile(t.path).then((e=>K.parseRawGrammar(e.toString(),t.path))):null}})}initLanguage(e){if(this.language!==e){if(this.language=e,this.grammar=null,this.foldType=1,this.sourceFoldMap={},this.hasTextGrammar=!1,this.currentLine=1,e=N.getLanguageById(B.languageList,e),this.scopeName=e&&e.scopeName||"",this.scopeName){if(!B.grammars[this.scopeName])return this.registry.loadGrammar(this.scopeName).then((e=>{this.grammar=e,B.grammars[this.scopeName]={grammar:e,sourceFoldMap:this.sourceFoldMap,hasTextGrammar:this.hasTextGrammar},this.tokenizeVisibleLins()}));{let e=B.grammars[this.scopeName];this.grammar=e.grammar,this.sourceFoldMap=e.sourceFoldMap,this.hasTextGrammar=e.hasTextGrammar}}return this.tokenizeVisibleLins(),Promise.resolve()}}initProperties(e,t){N.defineProperties(this,e,["startLine","maxVisibleLines","maxLine","renderLine","folder","$nextTick"]),N.defineProperties(this,t,["htmls"])}initLanguageConifg(e,t){let s=[];e.__comments__={lineComment:"",blockComment:[]},t.comments&&(t.comments.lineComment&&(s.push(t.comments.lineComment),e[t.comments.lineComment]=0,e.__comments__.lineComment=t.comments.lineComment),t.comments.blockComment&&(s.push(t.comments.blockComment[0]),s.push(t.comments.blockComment[1]),e[t.comments.blockComment[0]]=-this.foldType,e[t.comments.blockComment[1]]=this.foldType,e.__comments__.blockComment=t.comments.blockComment,e.__endCommentReg__=new RegExp(t.comments.blockComment[1].replace(/[\{\}\(\)\[\]\&\?\+\*\\]/g,"\\$&"),"g"),this.foldType++)),t.brackets&&t.brackets.forEach((t=>{e[t[0]]?e[t[1]]||(s.push(t[1]),e[t[1]]=-e[t[0]]):e[t[1]]?e[t[0]]||(s.push(t[0]),e[t[0]]=-e[t[1]]):(s.push(t[0]),s.push(t[1]),e[t[0]]=-this.foldType,e[t[1]]=this.foldType,this.foldType++)})),s=s.join("|"),s=s.replace(/[\{\}\(\)\[\]\&\?\+\*\\]/g,"\\$&"),e.__foldReg__=new RegExp(s,"g")}onInsertContentAfter(e,t){e<=this.currentLine?(this.currentLine=e,clearTimeout(this.tokenizeLinesTimer),this.$nextTick((()=>{this.currentLine===e&&this.tokenizeLines(e)}))):this.tokenizeVisibleLins()}onDeleteContentAfter(e,t){t<=this.currentLine?(this.currentLine=t,clearTimeout(this.tokenizeLinesTimer),this.$nextTick((()=>{this.currentLine===t&&this.tokenizeLines(t)}))):this.tokenizeVisibleLins()}tokenizeVisibleLins(){let e=this.tokenizeVisibleLinsId+1||1;this.tokenizeVisibleLinsId=e,this.$nextTick((()=>{if(this.tokenizeVisibleLinsId!==e)return;let t=this.currentLine,s=this.startLine,i=this.startLine+this.maxVisibleLines;i=this.folder.getRealLine(i),this.asyncTokenizeLines(s,i).then((()=>{s=this.startLine-2e3,s=s<1?1:s,s>t?this.asyncTokenizeLines(s,i).then((()=>{this.tokenizeLines(t)})):this.tokenizeLines(t)}))}))}asyncTokenizeLines(e,t){return new Promise((s=>{this.tokenizeLines(e,t,s)}))}tokenizeLines(e,t,s){let i=0,n=Date.now();if(t=t||this.maxLine,t=t>this.maxLine?this.maxLine:t,cancelIdleCallback(this.tokenizeLinesTimer),!this.scopeName||this.grammar){while(e<=t){let t=this.htmls[e-1];if(!t.tokens){let s=this.tokenizeLine(e);if(t.tokens=s.tokens,t.folds=s.folds,t.stateFold=s.stateFold,this.checkLineVisible(e)&&(t.tokens=this.splitLongToken(t.tokens),t.html=this.createHtml(t.tokens,t.text),this.renderLine(t.lineId)),(!t.states||t.states.equals&&!t.states.equals(s.states)||t.states.toString()!==s.states.toString())&&(t.states=s.states,t=this.htmls[e],t&&(t.tokens=null,t.html="")),i++,i%5==0&&Date.now()-n>=20){e++;break}}e++}this.currentLine=e,e<=t?this.tokenizeLinesTimer=requestIdleCallback((()=>{this.tokenizeLines(e,t,s)})):s&&s()}else this.tokenizeLinesTimer=setTimeout((()=>{this.tokenizeLines(e,t,s)}))}createHtml(e,t){return e.map((e=>{let i="",n=t.substring(e.startIndex,e.endIndex);return"plain"===e.scopes[0]?i="my-plain":"selected"===e.scopes[0]?i="my-select-fg":(i=s(e),i=i&&`my-scope-${i.scopeId}`||""),`<span class="${i}" data-column="${e.startIndex}">${N.htmlTrans(n)}</span>`})).join("");function s(e){let t=null,s=e.scopes;e.scope=s.join(" ");e:for(let i=s.length-1;i>=0;i--){let n=s[i];for(let s=0;s<B.scopeTokenList.length;s++){let i=B.scopeTokenList[s],r=i.scopes.peek();if(n.indexOf(r)>-1&&i.regexp.test(e.scope)){t=i;break e}}}return t}}tokenizeLine(e){let t=this.htmls[e-1].text,s=[];if(t.length>1e4||!this.scopeName)return{tokens:[{scopes:["plain"],startIndex:0,endIndex:t.length}],folds:[],states:K.INITIAL};let i=e>1&&this.htmls[e-2].states||K.INITIAL,n=this.grammar.tokenizeLine(t,i),r=this.addFold(e,n.tokens,s);return n.tokens.peek().endIndex=t.length,{tokens:n.tokens,states:n.ruleStack,folds:s,stateFold:r}}addFold(e,t,s){let i="",n=0,r=!1,o=this.htmls[e-1].text,l=e>1?this.htmls[e-2].stateFold:null;t.forEach((e=>{Z.stringToken.test(e.scopes.join("."))&&(e.isString=!0)}));e:for(let a=0;a<t.length;a++){let h=t[a],c="",u=null;for(let r=h.scopes.length-1;r>=0;r--)if(u=this.sourceFoldMap[h.scopes[r]],u){if(c=h.scopes[r],i||a===t.length-1){if(c!==i||a===t.length-1){let c=a===t.length-1?h.endIndex:h.startIndex,d=this.addBracket({tokens:t,line:e,foldMap:u,folds:s,startIndex:n,endIndex:c,stateFold:l,lineText:o});if(d&&d.type===N.constData.LINE_COMMENT)break e;i=h.scopes[r],n=h.startIndex}}else i=h.scopes[r],n=h.startIndex;break}this.addTagFold({token:h,foldMap:u,folds:s,lineText:o})&&(r=!0)}return r&&s.sort(((e,t)=>e.startIndex-t.startIndex)),s.length?s.peek().type===N.constData.BLOCK_COMMENT?s.peek():null:l}addBracket(e){let t=e.tokens,s=e.foldMap,i=e.folds,n=e.startIndex,r=e.endIndex,o=e.stateFold,l=e.lineText.slice(n,r),a=s.__foldReg__,h=null,c=null;c=i.length?i.peek():o,c&&c.type===N.constData.BLOCK_COMMENT&&c.side<0&&(a=s.__endCommentReg__);while(h=a.exec(l)){let e=N.constData.BRACKET;if(s.__comments__.lineComment===h[0]?e=N.constData.LINE_COMMENT:s.__comments__.blockComment[0]!==h[0]&&s.__comments__.blockComment[1]!==h[0]||(e=N.constData.BLOCK_COMMENT),!u(h))if(i.push({startIndex:n+h.index,endIndex:n+h.index+h[0].length,side:s[h[0]],type:e}),e===N.constData.BLOCK_COMMENT&&s[h[0]]<0)s.__endCommentReg__.lastIndex=a.lastIndex,a.lastIndex=0,a=s.__endCommentReg__;else if(e===N.constData.LINE_COMMENT)break}return a.lastIndex=0,i.length&&i.peek();function u(e){let s=e.index;for(let i=0;i<t.length;i++){if(t[i].startIndex<=s&&t[i].endIndex>s){if(t[i].isString)return!0;break}if(t[i].startIndex>s)break}return!1}}addTagFold(e){let t=e.token,s=e.folds,i=e.foldMap,n=e.lineText;if(this.hasTextGrammar&&t.scopes.peek().startsWith("entity.name.tag")){let e=n.slice(t.startIndex,t.endIndex),r=0;return i[e]?r=i[e]:(r=this.foldType++,i[e]=r),"<"===n[t.startIndex-1]&&(r=-r),s.push({startIndex:t.startIndex,endIndex:t.endIndex,side:r,type:N.constData.TAG}),!0}}splitLongToken(e){let t=[];return e.forEach((e=>{let s=e.endIndex-e.startIndex;if(s>100){let i=e.startIndex,n=Math.floor(s/100);for(let s=0;s<n;s++){let n=100*s,r=100*(s+1);r=r>e.endIndex?e.endIndex:r,t.push({startIndex:n+i,endIndex:r,scopes:e.scopes})}n*=100,n<s&&t.push({startIndex:n+i,endIndex:e.endIndex,scopes:e.scopes})}else t.push(e)})),t}checkLineVisible(e){let t=this.startLine+this.maxVisibleLines;return t=this.folder.getRealLine(t),!this.folder.getLineInFold(e)&&(e>=this.startLine&&e<=t)}};const J=window.require||window.parent.require||function(){},Q=J("path"),ee=J("child_process");let te=null;var se=class{constructor(e,t){this.initProperties(e,t),this.initLanguage(e.language),this.initEvent()}initProperties(e,t){N.defineProperties(this,t,["htmls","getAllText"]),N.defineProperties(this,e,["setErrors"])}initLanguage(e){this.language!==e&&(this.language=e,this.setErrors([]),this.initEvent(),this.parse())}initEvent(){null===te&&setTimeout((()=>{te=ee.fork(Q.join(B.dirname,"main/process/lint/index.js")),te.on("message",(e=>{console.log(e),e.parseId===this.parseId&&this.setErrors(e.results)})),te.on("close",(()=>{te=null,this.initEvent()}))}),300)}onInsertContentAfter(e,t){clearTimeout(this.parseTimer),this.parseId="",this.parseTimer=setTimeout((()=>{this.parse()}),300)}onDeleteContentAfter(e,t){clearTimeout(this.parseTimer),this.parseId="",this.parseTimer=setTimeout((()=>{this.parse()}),300)}parse(){if(!this.language)return;const e=this.getAllText();this.parseId=N.getUUID(),te.send({text:e,parseId:this.parseId,language:this.language})}},ie=s(209),ne={TOKEN_TYPE:{TEXT:"text",SOURCE:"source",TAG_NAME:"tag-name",ATTR_NAME:"attr-name",STRING:"string",WORD:"word",CSS:"css",CSS_VALUE:"css-value",CSS_PROPERTY:"css-property",CSS_SELECTOR:"css-selector",CSS_TAG:"css-tag",CSS_CLASS:"css-class",CSS_ATTR:"css-attr",CSS_PSEUDO:"css-pseudo",EMMET_HTML:"emmet-html",EMMET_CSS:"emmet-css"}};const re=window.require||window.parent.require||function(){},oe=re("path"),le={stringToken:/(?:\.|^)(?:string|regexp)(?:\.|$)/,tagToken:/meta\.tag/,tagNameToken:/entity\.name\.tag/,tagAttrName:/attribute\-name/,cssValueToken:/property\-list|property\-value|separator/,cssPropertyToken:/meta\.property\-name/,cssSelectorToken:/meta\.selector/,cssAttributeToken:/attribute\-selector/,cssClassToken:/attribute\-name\.class/,cssPseudoToken:/pseudo\-element/,styleCss:/([^\:\;\"\'\s]+)\s*\:\s*([^\:\;]+)?$/,styleCssProperty:/(?:^|[\;\"\'])([^\:\;]+)$/};class ae{constructor(e,t){this.initProperties(e,t),this.doneMap={},this.results=[],this.wordPattern=N.getWordPattern(this.language),this.wordPattern=new RegExp(`^(${this.wordPattern.source})$`)}initProperties(e,t){N.defineProperties(this,e,["language","cursor","nowCursorPos","tokenizer","autoTipList","setAutoTip","selectAutoTip"]),N.defineProperties(this,t,["htmls","replaceTip","insertContent"])}reset(){this.currentLine=1,this.results=[],this.doneMap={}}stop(){cancelIdleCallback(this.searchTimer)}search(){this.stop(),this.searchTimer=requestIdleCallback((()=>{this._search()}))}emmet(){let e=this.htmls[this.nowCursorPos.line-1],t=this.getTokenIndex(this.nowCursorPos),s=e.tokens[t],i=s&&e.text.slice(s.startIndex,this.nowCursorPos.column),n=null,r="";if(i){let o=s.scopes.peek();if(o.startsWith("text."))n=(0,ie.Kl)(i),r=ne.TOKEN_TYPE.EMMET_HTML;else if(this._isCssToken(s)){if(this._isCssPropertyToken(s))n=(0,ie.Kl)(i,i.length,{type:"stylesheet"});else if(this._isCssValueToken(s)){let s=e.tokens[t-1];s&&this._isCssPropertyToken(s)&&(i=e.text.slice(s.startIndex,s.endIndex)+i,n=(0,ie.Kl)(i,i.length,{type:"stylesheet"}))}r=ne.TOKEN_TYPE.EMMET_CSS}}n?this.replaceTip({word:n.abbreviation,result:n.abbreviation,type:r}):this.autoTipList&&this.autoTipList.length?this.selectAutoTip():this.insertContent("\t")}_search(){let e=this.htmls[this.nowCursorPos.line-1],t=this.getTokenIndex(this.nowCursorPos),s=e.tokens[t],i=s&&e.text.slice(s.startIndex,this.nowCursorPos.column);if(this.reset(),this.setAutoTip(null),i)if(this._isTextToken(s)){let e=s.scopes.peek();if(e.startsWith("text."))this._searchEmmet(i);else if(this._isTagNameToken(s))this._searchTagName(i);else if(this._isAttrNameToken(s)){let e=this._getPreTagName(t,this.nowCursorPos.line);e&&this._searchTagAttrName(i,e)}}else if(this._isCssToken(s))if(this._isCssPropertyToken(s))this._searchCssProperty(i);else if(this._isCssValueToken(s)){let s=e.tokens[t-1];if(s&&this._isCssPropertyToken(s)){let s=e.tokens[t-1];s&&this._isCssPropertyToken(s)&&(i=e.text.slice(s.startIndex,s.endIndex)+i,this._searchCssProperty(i))}else{let e=this._getPreCssProperty(t,this.nowCursorPos.line);e&&this._searchCssValue(i,e)}}else this._isCssSelectorToken(s)?(this._isTagNameToken(s)?this._searchCssTag(i):i.indexOf(":")>-1&&this._searchCssPseudo(i),this._searchSelector(i,s)):this._isTagToken(s)&&this._searchStyle(i,s);else this._isSourceToken(s)&&this.wordPattern.test(i)&&this._searchWord(i,s)}_searchWord(e,t){this._searchDocument((s=>{s.tokens.forEach((i=>{if(i===t)return;let n=s.text.slice(i.startIndex,i.endIndex);if(this.wordPattern.test(n)){if(this._isTextToken(i)||this._isStringToken(i))return;this._addTip({word:e,value:n,type:ne.TOKEN_TYPE.WORD})}}))}))}_searchSelector(e,t){this._isCssClassToken(t)&&"."!==e&&(e="."+e),this._searchDocument((s=>{s.tokens.forEach((i=>{if(i!==t&&this._isCssSelectorToken(i)){let n=s.text.slice(i.startIndex,i.endIndex);if(!this.wordPattern.test(n))return;this._isCssClassToken(i)&&(n="."+n),"."===e?this._isCssClassToken(i)&&".."!==n&&this._addTip({word:e,value:n,type:ne.TOKEN_TYPE.CSS_CLASS,skipMatch:!0}):this._isCssClassToken(t)?this._isCssClassToken(i)&&this._addTip({word:e,value:n,type:ne.TOKEN_TYPE.CSS_CLASS}):this._addTip({word:e,value:n,type:ne.TOKEN_TYPE.CSS_SELECTOR})}}))}),!0)}_searchDocument(e,t){let s=this.currentLine,i=Date.now(),n=0;while(s<=this.htmls.length){let t=this.htmls[s-1];if(s++,t.tokens&&(e(t),n++,n%5==0&&Date.now()-i>=20))break}this.currentLine=s,this._showTip(t),s<=this.htmls.length&&(this.searchTimer=requestIdleCallback((()=>{this._searchDocument(e,t)})))}_searchTagName(e){const t=this.getHtmlData();t.tags.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.TAG_NAME})})),this.results.length||this._addTip({word:e,value:e,type:ne.TOKEN_TYPE.TAG_NAME,skipMatch:!0}),this._showTip()}_searchTagAttrName(e,t){const s=this.getHtmlData();let i=s.tagMap[t];i=i&&i.attributes,i&&i.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.ATTR_NAME,after:'=""'})})),s.globalAttributes.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.ATTR_NAME,after:'=""'})})),this._showTip()}_searchCssTag(e){const t=this.getHtmlData();t.tags.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_TAG})}))}_searchCssPseudo(e){const t=this.getCssData(),s=e.split(":").peek().trim();t.pseudoClasses.forEach((t=>{s?this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_PSEUDO}):this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_PSEUDO,skipMatch:!0})})),t.pseudoElements.forEach((t=>{s?this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_PSEUDO}):this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_PSEUDO,skipMatch:!0})}))}_searchStyle(e,t){let s=this.nowCursorPos.column,i=this.htmls[this.nowCursorPos.line-1],n=null;if(e=i.text.slice(t.startIndex,s),n=le.styleCss.exec(e),n&&n[1]){let e=n[1],t=n[2]||"";this._searchCssValue(t,e)}else n=le.styleCssProperty.exec(e),n&&n[1]&&this._searchCssProperty(n[1])}_searchCssProperty(e){const t=this.getCssData();if(t.properties.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_PROPERTY,after:": "})})),!this.results.length){const t=(0,ie.Kl)(e,e.length,{type:"stylesheet"});t&&t.abbreviation&&this._addTip({word:t.abbreviation,value:t.abbreviation,type:ne.TOKEN_TYPE.EMMET_CSS,skipMatch:!0})}this._showTip()}_searchCssValue(e,t){const s=this.getCssData();let i=s.propertyMap[t];if(i=i&&i.values,i){let t=e.trim();":"===t||""===t?(i.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_VALUE,before:" ",after:";",skipMatch:!0})})),this._showTip(!0)):(i.forEach((t=>{this._addTip({word:e,value:t.name,type:ne.TOKEN_TYPE.CSS_VALUE,after:";"})})),this._showTip())}}_searchEmmet(e){const t=(0,ie.Kl)(e);t&&t.abbreviation&&(this._addTip({word:t.abbreviation,value:t.abbreviation,type:ne.TOKEN_TYPE.EMMET_HTML,skipMatch:!0}),this._showTip())}_setTokenType(e){e.isSourceToken=!1,e.isCssToken=!1,e.isTextToken=!1,e.isTagToken=!1,e.isTagAttrNameToken=!1,e.scope=e.scope||e.scopes.join(" ");for(let t=e.scopes.length-1;t>=0;t--){let s=e.scopes[t];if(s.startsWith("source.")){e.isSourceToken=!0,s.startsWith("source.css")&&(e.isCssToken=!0);break}if(s.startsWith("text.")){e.isTextToken=!0,e.isTagAttrNameToken=le.tagAttrName.test(e.scope);break}}e.isTagToken=le.tagToken.test(e.scope),e.isTagNameToken=le.tagNameToken.test(e.scope),e.isStringToken=le.stringToken.test(e.scope),e.isCssToken&&(e.isCssValueToken=le.cssValueToken.test(e.scope),e.isCssPropertyToken=le.cssPropertyToken.test(e.scope),e.isCssSelectorToken=le.cssSelectorToken.test(e.scope),e.isCssClassToken=le.cssClassToken.test(e.scope),e.isCssAttributeToken=le.cssAttributeToken.test(e.scope),e.isCssPseudoToken=le.cssPseudoToken.test(e.scope))}_isTextToken(e){return void 0===e.isTextToken&&this._setTokenType(e),e.isTextToken}_isSourceToken(e){return void 0===e.isSourceToken&&this._setTokenType(e),e.isSourceToken}_isCssToken(e){return void 0===e.isCssToken&&this._setTokenType(e),e.isCssToken}_isCssPropertyToken(e){return void 0===e.isCssPropertyToken&&this._setTokenType(e),e.isCssPropertyToken}_isCssValueToken(e){return void 0===e.isCssValueToken&&this._setTokenType(e),e.isCssValueToken}_isCssSelectorToken(e){return void 0===e.isCssSelectorToken&&this._setTokenType(e),e.isCssSelectorToken}_isCssClassToken(e){return void 0===e.isCssClassToken&&this._setTokenType(e),e.isCssClassToken}_isCssAttributeToken(e){return void 0===e.isCssAttributeToken&&this._setTokenType(e),e.isCssAttributeToken}_isCssPseudoToken(e){return void 0===e.isCssPseudoToken&&this._setTokenType(e),e.isCssPseudoToken}_isStringToken(e){return void 0===e.isStringToken&&this._setTokenType(e),e.isStringToken}_isTagToken(e){return void 0===e.isTagToken&&this._setTokenType(e),e.isTagToken}_isTagNameToken(e){return void 0===e.isTagNameToken&&this._setTokenType(e),e.isTagNameToken}_isAttrNameToken(e){return void 0===e.isTagAttrNameToken&&this._setTokenType(e),e.isTagAttrNameToken}_getPreTagName(e,t){let s="",i=0;e:while(t>=1){let n=this.htmls[t-1];if(!n.tokens)break;e=e>-1?e:n.tokens.length;for(let t=e-1;t>=0;t--){let e=n.tokens[t];if(this._isTagNameToken(e)){s=n.text.slice(e.startIndex,e.endIndex);break e}if(i++,i>100)break e}t--,e=-1}return s}_getPreCssProperty(e,t){let s="",i=0;e:while(t>=1){let n=this.htmls[t-1];if(!n.tokens)break;e=e>-1?e:n.tokens.length;for(let t=e-1;t>=0;t--){let e=n.tokens[t];if(this._isCssPropertyToken(e)){s=n.text.slice(e.startIndex,e.endIndex);break e}if(i++,i>100||!this._isCssValueToken(e))break e}t--,e=-1}return s}_addTip(e){let t=null,s=e.fullMatch;if(s=void 0===s||s,!this.doneMap[e.value]||e.skipDone)if(t=e.skipMatch?{indexs:[],score:0}:N.fuzzyMatch(e.word.trim(),e.value,s),t){let s={result:e.value,word:e.word||"",desc:e.desc||"",type:e.type||"",before:e.before||"",after:e.after||"",icon:this.getIcon(e.scope),indexs:t.indexs,score:t.score};this.results.push(s),this.doneMap[e.value]=s}else this.doneMap[e.value]=!0}_showTip(e){let t=null,s=e?200:10;this.results.sort(((e,t)=>t.score-e.score)),t=this.results.slice(0,s),this.setAutoTip(t)}checkEmmetValid(e){let t="";if(le.invalidEmmetParen.exec(e))return!1;while(e!==(t=e.replace(le.paremEmmet,"a")))e=t;return!!le.emmet.exec(e)}getTokenIndex(e){let t=this.htmls[e.line-1].tokens;if(t)for(let s=0;s<t.length;s++)if(t[s].startIndex<e.column&&t[s].endIndex>=e.column)return s;return-1}getHtmlData(){if(this.htmlData)return this.htmlData;{const e=re(oe.join(B.dirname,"main/data/browsers.html-data"));return this.htmlData=e,e.tagMap={},e.tags.forEach((t=>{e.tagMap[t.name]=t})),this.htmlData}}getCssData(){if(this.cssData)return this.cssData;{const e=re(oe.join(B.dirname,"main/data/browsers.css-data"));return this.cssData=e,e.propertyMap={},e.properties.forEach((t=>{e.propertyMap[t.name]=t})),this.cssData}}getIcon(e){return""}}var he=ae;class ce{constructor(e){this.dataList=new Array(e+1),this.linkList=new Array(e+2),this.num=0,this.next=null,this.prev=null,this.pNode=null}}class ue{constructor(e,t){this.max=t||4,this.root=null,this.head=null,this.size=0,this.compare=e||function(e,t){return e-t}}insert(e){if(!this.root){let t=new ce(this.max);return t.dataList[0]=e,t.num++,this.root=t,this.head=t,this.size++,void(this.arrayCache=null)}let t=this._search(e,!0),s=null,i=Math.floor(this.max/2)||1,n=this.iterator(t,e);if(this.findIndex(t,e)>-1)return n;this.size++,this.arrayCache=null;while(t){let n=t.linkList,o=t.dataList;for(let s=0;s<t.num;s++){let i=o[s];if(this.compare(e,i)<0){r(o,n,s);break}s===t.num-1&&r(o,n,s+1)}if(t.num++,t.num<=this.max)break;let l=new ce(this.max),a=t.linkList[0];e=o[i],a||(t.next&&(t.next.prev=l),l.next=t.next,t.next=l,l.prev=t,l.pNode=t.pNode),s=l;for(let e=a?i+1:i,s=0;e<t.num;e++,s++)l.dataList[s]=o[e],l.linkList[s+1]=n[e+1],l.linkList[s+1]&&(l.linkList[s+1].pNode=l),o[e]=null,n[e+1]=null,l.num++;if(t.num=i,a&&(t.dataList[t.num]=null,l.linkList[0]=t.linkList[t.num+1],l.linkList[0]&&(l.linkList[0].pNode=l),t.linkList[t.num+1]=null),!t.pNode){this.root=new ce(this.max),this.root.dataList[0]=e,this.root.linkList[0]=t,this.root.linkList[1]=l,this.root.num=1,t.pNode=this.root,l.pNode=this.root;break}t=t.pNode}return n;function r(i,n,r){for(let e=t.num;e>=r+1;e--)i[e]=i[e-1],n[e+1]=n[e];i[r]=e,n[r+1]=s,s&&(s.pNode=t)}}delete(e){let t=this,s=this._search(e),i=null,n=Math.floor(this.max/2)||1;if(s){let t=s.dataList,n=this.findIndex(s,e);i=t[n];for(let e=n;e<s.num;e++)t[e]=t[e+1];if(s.num--,this.size--,this.arrayCache=null,!this.size)return this.root=null,i}while(s&&s.num<n&&s.pNode){let e=s.pNode,t=e.linkList.indexOf(s),i=e.linkList[t-1],a=e.linkList[t+1],h=s.linkList[0];i&&i.num>n?(o(s,1),h?(s.dataList[0]=e.dataList[t-1],s.linkList[0]=i.linkList[i.num],e.dataList[t-1]=i.dataList[i.num-1]):(s.dataList[0]=i.dataList[i.num-1],e.dataList[t-1]=s.dataList[0]),s.linkList[0]&&(s.linkList[0].pNode=s),e.dataList[t-1]=i.dataList[i.num-1],i.dataList[i.num-1]=null,i.linkList[i.num]=null,i.num--,s.num++):a&&a.num>n?(h?(s.dataList[s.num]=e.dataList[t],s.linkList[s.num+1]=a.linkList[0],e.dataList[t]=a.dataList[0]):(s.dataList[s.num]=a.dataList[0],e.dataList[t]=a.dataList[1]),s.linkList[s.num+1]&&(s.linkList[s.num+1].pNode=s),l(a,1),a.num--,s.num++):a?r(s.pNode,t,s,a):i&&r(s.pNode,t-1,i,s)}return i;function r(e,i,n,r){let a=n.linkList[0]?1:0;o(r,n.num+a);for(let t=0;t<n.num;t++)r.dataList[t]=n.dataList[t],r.linkList[t+1]=n.linkList[t+1],r.linkList[t+1]&&(r.linkList[t+1].pNode=r);r.linkList[0]=n.linkList[0],r.linkList[0]&&(r.linkList[0].pNode=r),a&&(r.dataList[n.num]=e.dataList[i]),l(e,1,i),r.num+=n.num+a,e.num--,a||(t.head===n?(t.head=r,t.head.prev=null):(n.prev.next=r,r.prev=n.prev)),e.num?s=e:(t.root=r,t.root.pNode=null,s=null)}function o(e,t){for(let s=e.num-1;s>=0;s--)e.dataList[t+s]=e.dataList[s],e.linkList[t+s+1]=e.linkList[s+1];e.linkList[t]=e.linkList[0]}function l(e,t,s){s=s||0;for(let i=s;i<e.num;i++)e.dataList[i]=e.dataList[i+t],e.linkList[i]=e.linkList[i+t];e.linkList[e.num]=e.linkList[e.num+t]}}search(e,t,s){let i=this._search(e,s,t);return i&&(i=this.iterator(i,e,t)),i}findIndex(e,t){for(let s=0;s<e.num;s++)if(0===this.compare(t,e.dataList[s]))return s;return-1}iterator(e,t,s){let i=e.num,n=e.num,r=e.num;s=s||this.compare;for(let a=0;a<e.num;a++){let r=e.dataList[a],o=s(t,r);if(o<=0){n=a,i=a;break}}return{next:o,prev:l,reset:function(){i=n,e=r}};function o(){return i<e.num?e.dataList[i++]:e.next?(e=e.next,i=0,e.dataList[i]):null}function l(){return i--,i>=0?e.dataList[i]:e.prev?(e=e.prev,i=e.num-1,e.dataList[i]):(i++,null)}}forEach(e){let t=this.toArray();for(let s=0;s<t.length;s++)e(t[s],s)}toArray(){if(this.arrayCache)return this.arrayCache;let e=[],t=this.head;while(t){let s=t.dataList;for(let i=0;i<t.num;i++)e.push(s[i]);t=t.next}return this.arrayCache=e,e}get(e){let t=this.head,s=-1;while(t){let i=t.dataList;for(let n=0;n<t.num;n++)if(s++,s==e)return i[n];t=t.next}return null}empty(){this.root=null,this.head=null,this.size=0,this.arrayCache=null}_search(e,t,s){let i=this.root;s=s||this.compare;while(i){let n=i.linkList,r=i.dataList;for(let o=0;o<i.num;o++){let l=s(e,r[o]);if(0===l){if(n[o+1]){i=n[o+1];break}return i}if(!(l>0)){if(n[o]){i=n[o];break}return t?i:null}if(!r[o+1]||s(e,r[o+1])<0){if(n[o+1]){i=n[o+1];break}return t?i:null}}}}}var de=ue;const me=function(e,t){return e.start.line-t.start.line},pe=["br","hr","area","base","img","input","link","meta","basefont","param","col","frame","embed","keygen","source"],ge={};pe.forEach((e=>{ge[e]=!0}));var fe=class{constructor(e,t){this.folds=new de(me),this.editorFunObj={},this.initProperties(e,t)}initProperties(e,t){N.defineProperties(this.editorFunObj,e,["unFold"]),N.defineProperties(this,e,["selecter"]),N.defineProperties(this,t,["htmls"])}onInsertContentAfter(e,t){let s=this.folds.toArray(),i=1/0;for(let n=0;n<s.length;n++){let t=s[n];if(!(t.start.line<e.line)){i=n;break}t.end.line>e.line&&this.editorFunObj.unFold(t.start.line)}if(t.line>e.line){s[i]&&s[i].start.line===e.line&&(this.editorFunObj.unFold(e.line),i++);for(let n=i;n<s.length;n++)s[n].start.line+=t.line-e.line,s[n].end.line+=t.line-e.line}}onDeleteContentAfter(e,t){let s=this.folds.toArray(),i=1/0;for(let n=0;n<s.length;n++){let r=s[n],o=r.start.line,l=r.end.line;if(!(o<=e.line)){i=n;break}o<e.line?(o>=t.line&&o<e.line||o<t.line&&l>t.line)&&this.editorFunObj.unFold(o):e.line>t.line&&this.editorFunObj.unFold(o)}if(e.line>t.line)for(let n=i;n<s.length;n++)s[n].start.line+=t.line-e.line,s[n].end.line+=t.line-e.line}foldLine(e){let t=this.getRangeFold(e);if(t){for(let e=t.start.line+1;e<t.end.line;e++){let s=this.getFoldByLine(e);s&&s.end.line>t.end.line&&this.editorFunObj.unFold(e)}this.folds.insert(t)}return t}unFold(e){let t=this.getFoldByLine(e);return t&&this.folds.delete(t),t}getFoldByLine(e){let t=this.folds.search(e,((e,t)=>e-t.start.line));return t&&t.next()}getLineInFold(e){let t=this.folds.search(e,((e,t)=>e-t.start.line),!0);if(t){let s=t.prev();if(s&&s.start.line<e&&s.end.line>e)return!0}return!1}getRangeFold(e,t){let s=[],i=e,n=this.htmls[i-1],r=null;if(n.folds&&n.folds.length)for(let o=0;o<n.folds.length;o++){let e=n.folds[o];if(e.side<=0)s.push(e);else if(e.side>0)for(let t=s.length-1;t>=0;t--)if(s[t].side+e.side===0){s.splice(t,1);break}}if(s.length){let o="";if(r=s.peek(),r=Object.assign({line:i},r),o=n.text.slice(r.startIndex,r.endIndex),ge[o])return!1;if(r.type===N.constData.LINE_COMMENT){let s=i,n=null;e=i+1;while(e<=this.htmls.length){let r=this.htmls[e-1],o=r.text.trimLeft(),l=r.text.length-o.length,a=r.folds&&r.folds[0];if(!a||a.type!==N.constData.LINE_COMMENT||a.startIndex!==l)break;if(s=e,n=a,t&&s-i>1)return!0;e++}return t?s-i>1:{start:r,end:Object.assign({line:s},n)}}return this.getRangeFoldByStartFold(r,t)}return!1}getRangeFoldByStartFold(e,t){let s=e.line,i=[],n=null;while(s<=this.htmls.length&&(!t||s-e.line<=1)){let r=this.htmls[s-1];if(r.folds&&r.folds.length)for(let o=0;o<r.folds.length;o++){let l=r.folds[o];if(!(s===e.line&&l.startIndex<=e.startIndex))if(l.side===e.side)i.push(l);else if(e.side+l.side===0){if(0===i.length)return n={start:e,end:Object.assign({line:s},l)},t?s-e.line>1:n;i.pop()}}s++}return t?s-e.line>1:n}getBracketMatch(e){let t=e.line,s=null,i=[];e:while(t>=1&&!s){let n=this.htmls[t-1].folds||[];for(let r=n.length-1;r>=0;r--){let o=n[r];if(o.type!==N.constData.TAG)if(o.side>0&&(t<e.line||o.endIndex<e.column))i.push(o);else if(o.side<0&&(t<e.line||o.startIndex<=e.column)){let e=!1;if(i.length)for(let t=i.length-1;t>=0;t--)if(i[t].side+o.side===0){i.splice(t,1),e=!0;break}if(!e){s=Object.assign({line:t},o);break e}}}t--}if(s)return this.getRangeFoldByStartFold(s)}getRealLine(e){let t=0,s=1,i=1,n=this.folds.toArray();while(t<n.length&&s<e){let r=n[t];if(!(s+r.start.line-i<e))break;s+=r.start.line+1-i,i=r.end.line,t++;while(t<n.length&&n[t].end.line<=r.end.line)t++}return i+=e-s,i}getRelativeLine(e){let t=e,s=0,i=this.folds.toArray();while(s<i.length){let n=i[s];if(!(e>=n.end.line))break;t-=n.end.line-n.start.line-1,s++;while(s<i.length&&i[s].end.line<=n.end.line)s++}return t}},Ce=class{constructor(e,t,s){this.selecter=s,this.initProperties(e,t),this.wordPattern=N.getWordPattern(this.language),this.wholeWordPattern=new RegExp(`^(${this.wordPattern.source})$`),this.wordPattern=new RegExp(this.wordPattern.source,"g")}initProperties(e,t){N.defineProperties(this,e,["language","fSearcher","searcher","nowCursorPos","cursor","$nextTick","$refs"]),N.defineProperties(this,t,["htmls","getRangeText","getAllText"])}search(e){let t=null,s=0,i=0,n=this.hasCache(),r=null;if(e=e||{},n)t=this.getFromCache(e.direct,e.increase);else{if(r=e&&e.config||this.getSearchConfig(),!r||!r.text)return{now:0,count:0};t=this._search(r)}return t&&t.result&&(this.searcher===this||e.increase?n?(this.cursor.addCursorPos(t.result.end),this.selecter.addActive(t.result.end)):(0===this.selecter.activedRanges.size?this.cursor.setCursorPos(t.result.end):this.initIndexs(),this.selecter.addRange(t.results)):n?(this.selecter.setActive(t.result.end),this.cursor.setCursorPos(t.result.end),this.searcher.clearSearch()):(this.selecter.addRange(t.results),this.clearActive()),s=t.now,i=t.results.length),{now:s,count:i}}_search(e){let t=this,s=null,i=null,n=null,r=null,o=null,l=[],a={},h=null,c=1,u=0,d=0,m=this.getAllText(),p=e.text.split(/\n/),g=e.text.replace(/\\|\.|\*|\+|\-|\?|\(|\)|\[|\]|\{|\}|\^|\$|\~|\!|\&|\|/g,"\\$&");this.wholeWordPattern.test(e.text)&&e.wholeWord&&(g="(?:\\b|(?<=[^0-9a-zA-Z]))"+g+"(?:\\b|(?=[^0-9a-zA-Z]))"),s=new RegExp("[^\n]*?("+g+")|[^\n]*?\n",e.ignoreCase?"img":"mg"),e=e||{};while(i=s.exec(m))i[1]?(n={line:c,column:u+i[0].length-i[1].length},r={line:c+p.length-1,column:p.length>1?p.peek().length:u+i[0].length},c=r.line,u=r.column,h={start:n,end:r},l.push(h),!o&&N.comparePos(r,t.nowCursorPos)>=0&&(o=h,d=l.length-1,a[l.length-1]=!0)):(c++,u=0);return l.length?(!o&&l.length&&(d=0,o=l[0]),this.cacheData={config:e,results:l,indexs:a,index:d},{now:this.cacheData.index+1,results:l,result:o}):null}initIndexs(){let e=this.selecter.activedRanges.toArray();this.cacheData.indexs={},e.forEach((e=>{for(let t=0;t<this.cacheData.results.length;t++){let s=this.cacheData.results[t];if(0===N.comparePos(e.start,s.start)){this.cacheData.index=t,this.cacheData.indexs[t]=!0;break}}}))}refreshSearch(e){if(this.hasCache()||e)return new Promise((t=>{let s=this.refreshSearch.id+1||1;this.refreshSearch.id=s,this.$nextTick((()=>{this.refreshSearch.id===s&&((this.hasCache()||e)&&(e=e||this.cacheData.config,this.clearSearch(),this.search({config:e})),t())}))}))}hasCache(){return!!this.cacheData}clearSearch(e){e?this.selecter.clearInactiveRange():this.selecter.clearRange(),this.cacheData=null}clearActive(){this.cacheData&&(this.cacheData.index=-1,this.cacheData.indexs={},this.selecter.clearActive())}setPrevActive(e){let t=this.cacheData.results,s=this.cacheData.index;this.cacheData.index=t.length-1;for(let i=t.length-1;i>=0;i--){let n=t[i],r=N.comparePos(n.end,e);if(r<0||-1===s&&0===r){this.cacheData.index=i;break}}}setNextActive(e){let t=this.cacheData.results,s=this.cacheData.index;this.cacheData.index=0;for(let i=0;i<t.length;i++){let n=t[i],r=N.comparePos(n.end,e);if(r>0||-1===s&&0===r){this.cacheData.index=i;break}}}removeNow(){this.cacheData.results.splice(this.cacheData.index,1),this.cacheData.index--}clone(e){this.cacheData=e,e&&this.selecter.addRange(e.results)}getCacheData(){return this.cacheData}getNowRange(){return this.cacheData.results[this.cacheData.index]}getFromCache(e,t){let s=this.cacheData.results,i=null,n=0;if(this.fSearcher!==this||t){let t=this.cacheData.indexs,r=0;r="up"===e?-1:1,n=this.cacheData.index+r,n==s.length?n=0:n<0&&(n=s.length-1),t[n]?n=this.cacheData.index:(i=s[n],t[n]=!0,this.cacheData.index=n)}else"up"===e?this.setPrevActive(this.nowCursorPos):this.setNextActive(this.nowCursorPos),n=this.cacheData.index,i=this.cacheData.results[n],this.cacheData.indexs={i:!0};return{now:n+1,result:i,results:s}}getConfig(){if(this.cacheData)return Object.assign({},this.cacheData.config)}getSearchConfig(){let e=null,t=!1,s="",i=this.searcher.selecter.getRangeByCursorPos(this.nowCursorPos);return this.searcher===this&&this.selecter.ranges.size>0?null:(i?s=this.getRangeText(i.start,i.end):(s=this.getNowWord().text,t=!0),s&&(e={text:s,wholeWord:t,ignoreCase:t}),e)}getNowWord(){let e=this.htmls[this.nowCursorPos.line-1].text,t="",s=this.nowCursorPos.column,i=s,n=s,r=null;while(r=this.wordPattern.exec(e)){if(r.index<=s&&r.index+r[0].length>=s){i=r.index,n=r.index+r[0].length,t=r[0];break}if(r.index>s)break}return this.wordPattern.lastIndex=0,{text:t,range:{start:{line:this.nowCursorPos.line,column:i},end:{line:this.nowCursorPos.line,column:n}}}}};const xe=function(e,t){let s=N.comparePos(e.start,t.start);return 0===s?N.comparePos(e.end,t.end):s};var ye=class{constructor(e,t){this.initProperties(e,t),this.ranges=new de(xe),this.activedRanges=new de(xe)}initProperties(e,t){N.defineProperties(this,e,["cursor","renderSelectedBg","clearSelectionToken"]),N.defineProperties(this,t,["htmls"]),this.setContextData=(e,s)=>{t.setData(e,s)},this.setEditorData=(t,s)=>{e.setData(t,s)}}getRange(e){let t=this.ranges.search(e);return t&&t.next()}getRangeByLine(e){let t=[],s=this.ranges.search({line:e,column:0},((e,t)=>e-t.start.line),!0);if(s){let i=s.next();while(i){if(i.start===e||i.end.line===e)t.push(i);else if(i.start.line>e)break;i=s.next()}}return t}getRangeByCursorPos(e){let t=this.ranges.search(e,((e,t)=>0===N.comparePos(e,t.start)||0===N.comparePos(e,t.end)?0:N.comparePos(e,t.start)));return t&&t.next()}getRangeWithCursorPos(e){let t=this.ranges.search(e,((e,t)=>N.comparePos(e,t.start)),!0);if(t){let s=t.prev();if(s&&N.comparePos(s.end,e)>=0)return s;if(t.reset(),s=t.next(),s&&0==N.comparePos(s.start,e))return s}return!1}select(e,t){this.cursor.multiCursorPos.forEach((s=>{let i=this.getRangeByCursorPos(s);if(i){let n=i.start,r=i.end;this.cursor.moveCursor(s,e,t),"left"===e?N.comparePos(s,i.start)<0?n=s:r=s:N.comparePos(s,i.end)>0?r=s:n=s,this.updateRange(i,{start:n,end:r})}else{let n=Object.assign({},s),r=this.cursor.moveCursor(s,e,t);i=this.createRange(n,r),i&&this.addRange({start:n,end:r})}})),this.renderSelectedBg()}selectAll(){let e={line:this.htmls.length,column:this.htmls.peek().text.length};this.setEditorData("forceCursorView",!1),this.cursor.setCursorPos(e),this.setRange({line:1,column:0},e),this.renderSelectedBg()}selectAllOccurence(){this.cursor.clearCursorPos(),this.ranges.forEach((e=>{this.cursor.addCursorPos(e.end),e.active||(e.active=!0,this.activedRanges.insert(e))})),this.renderSelectedBg()}addActive(e){let t=this.getRangeByCursorPos(e);t&&!t.active&&(t.active=!0,this.activedRanges.insert(t)),this.renderSelectedBg()}addRange(e){let t=[],s=e instanceof Array?e:[e];return s.forEach((e=>{let s=e.start,i=e.end,n=N.comparePos(s,i);if(n>0){let e=s;s=i,i=e}else if(!n)return;let r=this.cursor.getCursorsByLineColumn(s.line,s.column)||this.cursor.getCursorsByLineColumn(i.line,i.column);e={start:{line:s.line,column:s.column},end:{line:i.line,column:i.column},active:!!r};let o=this.getRange(e);o?(o.active||(o.active=r,this.activedRanges.insert(o)),t.push(o)):(this.ranges.insert(e),r&&this.activedRanges.insert(e),t.push(e),this.filterRange(e))})),this.renderSelectedBg(),e instanceof Array?t:t[0]}removeRange(e){e=this.ranges.delete(e),e&&(e.active&&this.activedRanges.delete(e),this.cursor.removeCursor(e.start),this.cursor.removeCursor(e.end),this.renderSelectedBg())}setRange(e,t){let s=N.comparePos(e,t);if(s>0){let s=e;e=t,t=s}else if(!s)return;let i=this.cursor.getCursorsByLineColumn(e.line,e.column)||this.cursor.getCursorsByLineColumn(t.line,t.column),n={start:Object.assign({},e),end:Object.assign({},t),active:!!i};return this.clearRange(),this.ranges.insert(n),i&&this.activedRanges.insert(n),this.renderSelectedBg(),n}setActive(e){let t=this.getRangeByCursorPos(e);this.activedRanges.forEach((e=>{e.active=!1})),this.activedRanges.empty(),t&&(t.active=!0,this.activedRanges.insert(t)),this.renderSelectedBg()}updateRange(e,t){let s=t.start,i=t.end,n=N.comparePos(s,i);if(n>0){let e=s;s=i,i=e}else if(!n)return!1;this.ranges.delete(e),e.start.line=s.line,e.start.column=s.column,e.end.line=i.line,e.end.column=i.column,this.ranges.insert(e),this.filterRange(e),this.renderSelectedBg()}filterRange(e){let t=this.ranges.search(e),s=[],i=t.prev();i&&N.comparePos(i.end,e.start)>0&&s.push(i),t.reset(),t.next(),i=t.next(),i&&N.comparePos(e.end,i.start)>0&&s.push(i),s.forEach((e=>{this.ranges.delete(e),this.activedRanges.delete(e),this.cursor.removeCursor(e.start),this.cursor.removeCursor(e.end)}))}createRange(e,t){let s=N.comparePos(e,t);if(s>0){let s=e;e=t,t=s}return 0===s?null:{start:e,end:t}}clearRange(){this.ranges.empty(),this.activedRanges.empty(),this.renderSelectedBg()}clearActive(){this.activedRanges.forEach((e=>{e.active=!1})),this.activedRanges.empty(),this.renderSelectedBg()}clearInactiveRange(){this.activedRanges.size?(this.ranges.forEach((e=>{e.active||this.ranges.delete(e)})),this.renderSelectedBg()):this.clearRange()}clone(e,t){t=t||[];let s={start:Object.assign({},e.start),end:Object.assign({},e.end)};return t.forEach((t=>{s[t]=e[t]})),s}};const ve={word:/[a-zA-Z0-9_]/,dWord:N.fullAngleReg,space:/\s/};var be=class{constructor(e,t){this.initProperties(e,t),this.multiCursorPos=new de(N.comparePos),this.multiKeyCode="ctrl",this.wordPattern=N.getWordPattern(this.language),this.rightWrodPattern=new RegExp(`^(${this.wordPattern.source})`),this.leftWrodPattern=new RegExp(`(${this.wordPattern.source})$`)}initProperties(e,t){N.defineProperties(this,e,["language","nowCursorPos","searcher","selecter","setNowCursorPos","renderCursor","getColumnByWidth","getStrWidth"]),N.defineProperties(this,t,["htmls"])}addCursorPos(e){let t=this.getCursorsByLineColumn(e.line,e.column);return t?(this.setNowCursorPos(t),t):(e={line:e.line,column:e.column},this.multiCursorPos.insert(e),this.setNowCursorPos(e),e)}addCursorAbove(){this.multiCursorPos.forEach((e=>{if(e.line>1){let t=e.moveWidth||this.getStrWidth(this.htmls[e.line-1].text,0,e.column),s=this.getColumnByWidth(this.htmls[e.line-2].text,t),i=this.addCursorPos({line:e.line-1,column:s});i.moveWidth=t,this.setNowCursorPos(i)}}))}addCursorBelow(){this.multiCursorPos.forEach((e=>{if(e.line<this.htmls.length){let t=e.moveWidth||this.getStrWidth(this.htmls[e.line-1].text,0,e.column),s=this.getColumnByWidth(this.htmls[e.line].text,t),i=this.addCursorPos({line:e.line+1,column:s});i.moveWidth=t,this.setNowCursorPos(i)}}))}addCursorLineEnds(){this.selecter.activedRanges.size&&(this.clearCursorPos(),this.selecter.activedRanges.forEach((e=>{let t=e.start.line,s=e.end.line;while(t<s)this.addCursorPos({line:t,column:this.htmls[t-1].text.length}),t++;this.setNowCursorPos(this.addCursorPos({line:s,column:this.htmls[s-1].text.length}))})),this.searcher.clearSearch())}setCursorPos(e){if(e={line:e.line,column:e.column},1==this.multiCursorPos.size){let t=this.multiCursorPos.get(0);if(0===N.comparePos(t,e))return t}return this.multiCursorPos.empty(),this.multiCursorPos.insert(e),this.setNowCursorPos(e),e}updateCursorPos(e,t,s){let i=this.getCursorsByLineColumn(e.line,e.column);return i===e&&this.multiCursorPos.delete(e),e.line=t,e.column=s,this.multiCursorPos.insert(e),e===this.nowCursorPos?this.setNowCursorPos(this.nowCursorPos):this.renderCursor(),e}removeCursor(e){e=this.getCursorsByLineColumn(e.line,e.column),e&&(e.del=!0,this.multiCursorPos.delete(e),e===this.nowCursorPos&&this.setNowCursorPos(null),this.renderCursor())}removeCursorInRange(e){let t=this.multiCursorPos.search(e.start,null,!0);if(t){let s=null,i=[];while(s=t.next()){let t=N.comparePos(s,e.end);if(t>=0)break;N.comparePos(s,e.start)>0&&i.push(s)}i.forEach((e=>{e.del=!0,this.multiCursorPos.delete(e)})),this.renderCursor()}}clearCursorPos(){this.multiCursorPos.forEach((e=>{e.del=!0})),this.multiCursorPos.empty(),this.setNowCursorPos(null)}getCursorsByLine(e){let t=[],s=null,i=this.multiCursorPos.search({line:e,column:0},null,!0);if(i)while(s=i.next())if(s.line===e)t.push(s);else if(s.line>e)break;return t}getCursorsByLineColumn(e,t){let s=this.multiCursorPos.search({line:e,column:t});return s&&s.next()}moveCursor(e,t,s){let i=this.htmls[e.line-1].text,n=e.line,r=e.column;if("up"!==t&&"down"!==t&&(e.moveWidth=0),"home"===t)r=0;else if("end"===t)r=this.htmls[n-1].text.length;else if("up"===t){if(n>1){let t=e.moveWidth||this.getStrWidth(i,0,r);e.moveWidth=t,n--,i=this.htmls[n-1].text,r=this.getColumnByWidth(i,t)}}else if("down"===t){if(n<this.htmls.length){let t=e.moveWidth||this.getStrWidth(i,0,r);e.moveWidth=t,n++,i=this.htmls[n-1].text,r=this.getColumnByWidth(i,t)}}else if("left"===t){while(0===r&&n>1)n--,i=this.htmls[n-1].text,r=i.length;if(r>0)if(s){while(r&&i[r-1].match(ve.space))r--;if(r>0){let e=null,t=r;r--,i=i.slice(0,t),e=this.leftWrodPattern.exec(i),e&&(r=e.index)}}else e.line===n&&r--}else{while(r===i.length&&n<this.htmls.length)n++,r=0,i=this.htmls[n-1].text;if(r<i.length)if(s){while(r<i.length&&i[r].match(ve.space))r++;r<i.length&&(i=i.slice(r),i=this.rightWrodPattern.exec(i),i&&0==i.index?r+=i[0].length:r++)}else e.line===n&&r++}return this.updateCursorPos(e,n,r),{line:n,column:r}}switchMultiKeyCode(){this.multiKeyCode="ctrl"===this.multiKeyCode?"alt":"ctrl"}},ke=class{constructor(e,t){this.history=[],this.initProperties(e,t)}initProperties(e,t){N.defineProperties(this,e,["cursor"]),N.defineProperties(this,t,["insertContent","deleteContent","moveLineUp","moveLineDown","copyLineUp","copyLineDown","deleteCopyLineUp","deleteCopyLineDown","insertLine","deleteLine","replace"])}undo(){if(this.history.index>0){let e=this.history[this.history.index-1];if(this.doCommand(e),this.history.index--,e.serial){let t=this.history[this.history.index-1];t&&t.serial===e.serial&&this.undo()}}}redo(){if(this.history.index<this.history.length){let e=this.history[this.history.index];if(this.history.index++,this.doCommand(e),e.serial){let t=this.history[this.history.index];t&&t.serial===e.serial&&this.redo()}}}doCommand(e){let t=e.type||(e instanceof Array?e[0].type:e.type);switch(t){case N.command.DELETE:this.cursor.clearCursorPos(),this.deleteContent(N.keyCode.BACKSPACE,e);break;case N.command.INSERT:if(this.cursor.clearCursorPos(),e instanceof Array){var s=[];e.forEach((e=>{s.push(e.text)})),this.insertContent(s,e)}else this.insertContent(e.text,e);break;case N.command.DELETE_LINE:this.cursor.clearCursorPos(),this.deleteLine(e);break;case N.command.INSERT_LINE:this.cursor.clearCursorPos(),this.insertLine(e);break;case N.command.MOVEUP:this.cursor.clearCursorPos(),this.moveLineUp(e);break;case N.command.MOVEDOWN:this.cursor.clearCursorPos(),this.moveLineDown(e);break;case N.command.COPY_DOWN:this.cursor.clearCursorPos(),this.copyLineDown(e);break;case N.command.DELETE_COPY_DOWN:this.cursor.clearCursorPos(),this.deleteCopyLineDown(e);break;case N.command.COPY_UP:this.cursor.clearCursorPos(),this.copyLineUp(e);break;case N.command.DELETE_COPY_UP:this.cursor.clearCursorPos(),this.deleteCopyLineUp(e);break;case N.command.REPLACE:this.cursor.clearCursorPos(),this.replace(e.text,e.cursorPos,e);break}}pushHistory(e){while(this.history.length>this.history.index)this.history.pop();let t=this,s=this.history[this.history.index-1];if(e=this.sortComand(e),s instanceof Array&&e instanceof Array&&s.length===e.length&&Date.now()-this.pushHistoryTime<2e3)if(i(s)&&i(e)&&n(s[0],e[0]))for(let o=0;o<s.length;o++)r(s[o],e[o]);else this.history.push(e);else n(s,e)?r(s,e):this.history.push(e);function i(e){for(let t=1;t<e.length;t++)if(e[t].type!==e[t-1].type)return!1;return!0}function n(e,s){if((s.type==N.command.DELETE||s.type==N.command.INSERT)&&e&&e.type==s.type&&e.preCursorPos.line==s.cursorPos.line&&Date.now()-t.pushHistoryTime<2e3){if(e.type==N.command.DELETE&&0==N.comparePos(e.cursorPos,s.preCursorPos))return!0;if(e.type==N.command.INSERT&&(0==N.comparePos(e.cursorPos,s.preCursorPos)||0==N.comparePos(e.cursorPos,s.cursorPos)))return!0}}function r(e,t){e.type===N.command.DELETE?(t.preCursorPos.column-=e.cursorPos.column-e.preCursorPos.column,e.preCursorPos=t.preCursorPos,e.cursorPos=t.cursorPos):(e.cursorPos=t.cursorPos,t.keyCode===N.keyCode.DELETE?e.text=e.text+t.text:e.text=t.text+e.text)}this.history.index=this.history.length,this.pushHistoryTime=Date.now()}updateHistory(e){let t=this.history.index;e instanceof Array?e.forEach(((e,s)=>{e.keyCode=this.history[t-1][s].keyCode})):e.keyCode=this.history[t-1].keyCode,this.history[t-1]=this.sortComand(e)}sortComand(e){return e instanceof Array&&e.sort(((e,t)=>(e=e.cursorPos,t=t.cursorPos,e.line===t.line?e.column-t.column:e.line-t.line))),e}};const we={word:/[a-zA-Z0-9_]/,emmetWord:/^[a-zA-Z][a-zA-Z0-9\-]*/,emmetAttr:/^[\.\#]([^\.\#\>\<\+\*\(\)]*)/,emmetNum:/^\*(\d+)/,dWord:N.fullAngleReg,endTag:/(?=\<\/)/,space:/\s/};class Te{constructor(e){this.lineId=Number.MIN_SAFE_INTEGER,this.serial=1,this.htmls=[],this.fgLines=[],this.lineIdMap=new Map,this.renderedIdMap=new Map,this.renderedLineMap=new Map,this.initProperties(e),this.initData()}initProperties(e){N.defineProperties(this,e,["language","tabSize","nowCursorPos","maxLine","maxWidthObj","cursor","history","tokenizer","lint","folder","selecter","searcher","fSelecter","fSearcher","autocomplete","render","unFold","setNowCursorPos","setErrors","setAutoTip","getStrWidth","$emit"]),this.setEditorData=(t,s)=>{e.setData(t,s)}}initData(){this.htmls.push({lineId:this.lineId++,text:"",html:"",width:0,tokens:[],folds:[],states:[],stateFold:null}),this.lineIdMap.set(this.htmls[0].lineId,this.htmls[0])}setData(e,t){"function"!==typeof this[e]&&(this[e]=t)}insertContent(e,t){let s=null,i=[],n=!1;if(t)t.forEach((e=>{i.push(e.cursorPos)}));else{if(this.selecter.activedRanges.size){let e=this.deleteContent();e.serial=this.serial++,n=e.serial}i=this.cursor.multiCursorPos.toArray()}return s=this._insertMultiContent(e,i,t),s.serial=n,t?(this.history.updateHistory(s),s.serial=t.serial):this.history.pushHistory(s),this.setNowCursorPos(this.cursor.multiCursorPos.get(0)),this.fSearcher.refreshSearch(),s}_insertMultiContent(e,t,s){let i=null,n=null,r=[],o=e instanceof Array?e:e.split(/\r\n|\n/),l=0,a=0;return this.cursor.clearCursorPos(),"\n"===e&&(o=["\n"]),t.forEach(((h,c)=>{let u=o.length===t.length?o[c]:e,d=s&&s[c]||{},m=d.margin||"right",p=d.active||!1,g={line:h.line,column:h.column};g.line+=l,i&&g.line===i.line?g.column+=a:a=0,n=this._insertContent(u,g,!s),r.push(n),i=n.cursorPos,n.margin=m,n.active=p,l+=n.cursorPos.line-n.preCursorPos.line,a+=n.cursorPos.column-n.preCursorPos.column,"right"===m?this.cursor.addCursorPos(n.cursorPos):this.cursor.addCursorPos(n.preCursorPos),p&&this.selecter.addRange({start:n.preCursorPos,end:n.cursorPos})})),r}_insertContent(e,t,s){let i=this.htmls[t.line-1],n=i.text,r=Object.assign({},t);if(t.moveWidth=0,e=e.split(/\r\n|\n/),e=e.map((e=>(e={lineId:this.lineId++,text:e,html:"",width:0,tokens:null,folds:null,states:null,stateFold:null},this.lineIdMap.set(e.lineId,e),e))),e.length>1){if(!e[0].text&&s){let s=l.call(this,n,this.folder.getRangeFold(t.line,!0));s&&(e[1].text=s+e[1].text.trimLeft())}r.column=e[e.length-1].text.length,e[0].text=n.slice(0,t.column)+e[0].text,e[e.length-1].text=e[e.length-1].text+n.slice(t.column),this.htmls=this.htmls.slice(0,t.line-1).concat(e).concat(this.htmls.slice(t.line))}else r.column+=e[0].text.length,e[0].text=n.slice(0,t.column)+e[0].text+n.slice(t.column),this.htmls.splice(t.line-1,1,e[0]);r.line+=e.length-1,this.setEditorData("maxLine",this.htmls.length),this.lint.onInsertContentAfter(t.line,r.line),this.tokenizer.onInsertContentAfter(t.line,r.line),this.folder.onInsertContentAfter(Object.assign({},t),Object.assign({},r)),this.setLineWidth(e),this.setErrors([]),this.setAutoTip(null),this.render(!0),this.$emit("change");let o={type:N.command.DELETE,cursorPos:Object.assign({},r),preCursorPos:Object.assign({},t)};return o;function l(e,t){let s=0,i="",n=/^\s+/.exec(e);n&&(s=/\t+/.exec(n[0]),s=s&&s[0].length||0,s+=Math.ceil((n[0].length-s)/this.tabSize)),s+=t?1:0;for(let r=0;r<s;r++)i+="\t";return i}}deleteContent(e,t){let s=[],i=[];return t?i=t.map((e=>{let t={start:e.preCursorPos,end:e.cursorPos,margin:e.margin,active:e.active};return t})):this.cursor.multiCursorPos.forEach((e=>{let t=this.selecter.getRangeByCursorPos(e);t?(0===N.comparePos(t.start,e)?t.margin="left":t.margin="right",i.push(t)):i.push(e)})),s=this._deleteMultiContent(i,e),t?(s.serial=t.serial,this.history.updateHistory(s),s.forEach((e=>{this.cursor.addCursorPos(e.cursorPos)}))):s.length&&this.history.pushHistory(s),this.setNowCursorPos(this.cursor.multiCursorPos.get(0)),this.searcher.clearSearch(),this.fSearcher.refreshSearch(),s}_deleteMultiContent(e,t){let s=this,i=[],n=null,r=null,o=0,l=0;return this.cursor.clearCursorPos(),e.forEach((e=>{e.start&&e.end?h(e):a(e)})),i;function a(e){let a={line:e.line,column:e.column};a.line-=o,r&&a.line===r.line?a.column-=l:l=0,n=s._deleteContent(a,t),n.text&&i.push(n),r=n.cursorPos,o+=n.preCursorPos.line-r.line,l+=n.preCursorPos.column-r.column,s.cursor.addCursorPos({line:r.line,column:r.column})}function h(e){let a=e.start,h=e.end;a.line-=o,h.line-=o,r&&a.line===r.line?(a.column-=l,a.line===h.line?h.column-=l:l=0):l=0,n=s._deleteContent(e,t),n.text&&i.push(n),r=n.cursorPos,o+=n.preCursorPos.line-r.line,l+=n.preCursorPos.column-r.column,s.cursor.addCursorPos({line:r.line,column:r.column})}}_deleteContent(e,t){let s=null,i=t===N.keyCode.DELETE?"left":"right";e.moveWidth=0,e.start&&e.end&&(s=e,e=s.end,i=s.margin);let n=null,r=this.htmls[e.line-1],o=r.text,l="",a=[r.lineId],h=Object.assign({},e),c=Object.assign({},e);if(s){let e=s.end,t=this.htmls[e.line-1];n=s.start,r=this.htmls[n.line-1],o=r.text,l=this.getRangeText(s.start,s.end),1==n.line&&e.line==this.maxLine?(a=[this.maxWidthObj.lineId],this.lineIdMap.clear()):a=this.htmls.slice(n.line-1,e.line).map((e=>(this.lineIdMap.delete(e.lineId),e.lineId))),this.lineIdMap.set(r.lineId,r),n.line==e.line?(o=o.slice(0,n.column)+o.slice(e.column),r.text=o):(o=o.slice(0,n.column),r.text=o,o=t.text,o=o.slice(e.column),r.text+=o,this.htmls.splice(n.line,e.line-n.line)),c.line=n.line,c.column=n.column}else if(N.keyCode.DELETE==t)e.column==o.length?e.line<this.htmls.length&&(this.lineIdMap.delete(this.htmls[e.line].lineId),o=r.text+this.htmls[e.line].text,this.htmls.splice(e.line,1),l="\n",h={line:e.line-1,column:0}):(l=o[e.column],o=o.slice(0,e.column)+o.slice(e.column+1),h={line:e.line,column:e.column+1}),r.text=o;else{if(0==e.column){if(e.line>1){let t=this.htmls[e.line-2].text.length;this.lineIdMap.delete(this.htmls[e.line-2].lineId),o=this.htmls[e.line-2].text+o,this.htmls.splice(e.line-2,1),l="\n",c.line=e.line-1,c.column=t}}else l=o[e.column-1],o=o.slice(0,e.column-1)+o.slice(e.column),c.column=e.column-1;r.text=o}r.width=this.getStrWidth(r.text),r.html="",r.tokens=null,r.folds=null,r.states=null,r.stateFold=null,this.setEditorData("maxLine",this.htmls.length),this.lint.onDeleteContentAfter(h.line,c.line),this.tokenizer.onDeleteContentAfter(h.line,c.line),this.folder.onDeleteContentAfter(Object.assign({},h),Object.assign({},c)),this.setErrors([]),this.setAutoTip(null),this.render(!0),this.$emit("change"),r.width>=this.maxWidthObj.width?this.setEditorData("maxWidthObj",{lineId:r.lineId,text:r.text,width:r.width}):a.indexOf(this.maxWidthObj.lineId)>-1&&this.setMaxWidth();let u={type:N.command.INSERT,cursorPos:Object.assign({},c),preCursorPos:Object.assign({},h),text:l,keyCode:t,margin:i,active:s&&s.active};return u}setMaxWidth(){let e=this,t=0,s=Date.now(),i={line:this.htmls[0].lineId,width:0};function n(){while(t<e.htmls.length){let n=e.htmls[t];if(n.width>i.width&&(i={lineId:n.lineId,text:n.text,width:n.width}),t++,Date.now()-s>20)break}t<e.htmls.length?e.setMaxWidthTimer=setTimeout((()=>{n()}),20):e.setEditorData("maxWidthObj",i)}clearTimeout(this.setMaxWidthTimer),n()}setLineWidth(e){let t=this,s=0,i=Date.now(),n=this.maxWidthObj;function r(){while(s<e.length){let r=e[s];if(t.lineIdMap.has(r.lineId)){let e=t.getStrWidth(r.text);r.width=e,e>n.width&&(n={lineId:r.lineId,text:r.text,width:e})}if(s++,Date.now()-i>20)break}s<e.length?t.setLineWidthTimer=setTimeout((()=>{r()}),20):t.setEditorData("maxWidthObj",n)}clearTimeout(this.setLineWidthTimer),r()}moveLineUp(e){this.moveLine(e,"up")}moveLineDown(e){this.moveLine(e,"down")}moveLine(e,t){let s=[],i=[],n=0,r=null,o=null;e?(o=e.searchConifg,s=e.cursorPos):(o=this.searcher.getConfig(),s=[],this.cursor.multiCursorPos.toArray().forEach((e=>{let i=this.selecter.getRangeByCursorPos(e),n=!0,o=i?i.start.line:e.line;if(r){let e=r.end?r.end.line:r.line;e+1!==o&&e!==o||(i&&this.selecter.removeRange(i),n=!1)}if(n){var l=i&&i.end.line||o;1===o&&"up"===t||l===this.maxLine&&"down"===t?n=!1:(i?(i.margin=0===N.comparePos(i.start,e)?"left":"right",r=i):r=e,s.push(r))}})));while(n<s.length){let e=s[n],r=e.start?e:null;this._moveLine(e,t);let o="down"===t?1:-1;r?(r.start.line=r.start.line+o,r.end.line=r.end.line+o):e.line=e.line+o,i.push(r?this.selecter.clone(r,["margin"]):Object.assign({},e)),n++}if(!i.length)return;this.searcher.clearSearch(),this.cursor.clearCursorPos(),i.forEach((e=>{e.start?(this.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.selecter.addRange(e)):this.cursor.addCursorPos(e)}));let l={type:"down"===t?N.command.MOVEUP:N.command.MOVEDOWN,cursorPos:i,searchConifg:o};e?(this.history.updateHistory(l),this.searcher.refreshSearch(e.searchConifg)):(this.history.pushHistory(l),this.searcher.refreshSearch(o)),this.fSearcher.refreshSearch()}_moveLine(e,t){let s=e.start?e:null,i=0,n=0,r="";s?(r=this.htmls.slice(s.start.line-1,s.end.line).map((e=>e.text)).join("\n"),"down"===t?(i=s.start.line,n=s.end.line+1,r=this.htmls[n-1].text+"\n"+r):(i=s.start.line-1,n=s.end.line,r=r+"\n"+this.htmls[i-1].text)):(i=e.line-("down"===t?0:1),n=i+1,r=this.htmls[n-1].text+"\n"+this.htmls[i-1].text);let o={line:i,column:0},l={line:n,column:this.htmls[n-1].text.length};this._deleteContent({start:o,end:l}),this._insertContent(r,o)}copyLineUp(e){this.copyLine(e,"up")}copyLineDown(e){this.copyLine(e,"down")}copyLine(e,t){let s=[],i=[],n=[],r=null,o=[],l=null;e?(l=e.searchConifg,s=e.cursorPos):(l=this.searcher.getConfig(),s=[],this.cursor.multiCursorPos.toArray().forEach((e=>{let t=this.selecter.getRangeByCursorPos(e),i=t&&t.start.line||e.line,n=!0;if(r){let e=r.end?r.end.line:r.line;e===i&&(n=!1)}n&&(t?(t.margin=0===N.comparePos(t.start,e)?"left":"right",r=t):r=e,s.push(r))}))),s.forEach((e=>{let t=0,s="";e.end?(t=e.start.line-1,s=this.htmls.slice(e.start.line-1,e.end.line).map((e=>e.text)).join("\n")):(t=e.line-1,s=this.htmls[e.line-1].text),t=t<1?1:t,s="\n"+s,o.push(s),i.push({line:t,column:this.htmls[t-1].text.length})})),this._insertMultiContent(o,i).forEach(((e,i)=>{let r=0,o=s[i];if(r=e.cursorPos.line,"down"===t&&(r+=o.start?o.end.line-o.start.line+1:1),o.start){let e=o.end.line-o.start.line;o.end.line=r,o.start.line=r-e}else o.line=r;n.push(o.start?this.selecter.clone(o,["margin"]):Object.assign({},o))})),this.searcher.clearSearch(),this.cursor.clearCursorPos(),n.forEach((e=>{e.start?(this.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.selecter.addRange(e)):this.cursor.addCursorPos(e)}));let a={type:"down"===t?N.command.DELETE_COPY_DOWN:N.command.DELETE_COPY_UP,cursorPos:n,searchConifg:l};e?(this.history.updateHistory(a),this.searcher.refreshSearch(e.searchConifg)):(this.history.pushHistory(a),this.searcher.refreshSearch(l)),this.fSearcher.refreshSearch()}deleteCopyLineUp(e){this.deleteCopyLine(e,"up")}deleteCopyLineDown(e){this.deleteCopyLine(e,"down")}deleteCopyLine(e,t){let s=[],i=[],n=[];s=e.cursorPos,s.forEach((e=>{let t=0,s=0,n=null,r=0,o=0;e.end?(t=e.start.line-1,s=e.end.line):(t=e.line-1,s=e.line),o=this.htmls[s-1].text.length,t<1?(t=1,s<this.maxLine&&(s++,o=0)):r=this.htmls[t-1].text.length,n={start:{line:t,column:r},end:{line:s,column:o}},i.push(n)})),this._deleteMultiContent(i).forEach(((e,i)=>{let r=s[i];if(r.start){let s=r.end.line-r.start.line;"up"===t?(r.start.line=e.cursorPos.line+(1===r.start.line?0:1),r.end.line=r.start.line+s):(r.end.line=e.cursorPos.line,r.start.line=r.end.line-s)}else r.line="up"===t?e.cursorPos.line+(1===r.line?0:1):e.cursorPos.line;n.push(r.start?this.selecter.clone(r,["margin"]):Object.assign({},r))})),this.searcher.clearSearch(),this.cursor.clearCursorPos(),n.forEach((e=>{e.start?(this.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.selecter.addRange(e)):this.cursor.addCursorPos(e)}));let r={type:"down"===t?N.command.COPY_UP:N.command.COPY_DOWN,cursorPos:n,searchConifg:e.searchConifg};this.history.updateHistory(r),this.searcher.refreshSearch(e.searchConifg),this.fSearcher.refreshSearch()}insertLine(e){let t=e.searchConifg,s=e.cursorPos,i=e.text,n=[];s.forEach((e=>{let t=e.start?e.start.line-1:e.line-1;t=t<1?1:t,n.push({line:t,column:this.htmls[t-1].text.length})})),this._insertMultiContent(i,n),this.searcher.clearSearch(),this.cursor.clearCursorPos(),s.forEach((e=>{e.start?(this.cursor.addCursorPos("left"===e.margin?e.start:e.end),this.selecter.addRange(e)):this.cursor.addCursorPos(e)}));let r={type:N.command.DELETE_LINE,cursorPos:s,searchConifg:t};this.history.updateHistory(r),this.searcher.refreshSearch(e.searchConifg),this.fSearcher.refreshSearch()}deleteLine(e){let t=[],s=[],i=[],n=null,r=[],o=null;e?(o=e.searchConifg,t=e.cursorPos):(o=this.searcher.getConfig(),this.cursor.multiCursorPos.forEach((e=>{let s=this.selecter.getRangeByCursorPos(e),i=s&&s.start.line||e.line,r=!0;if(n){let e=n.end?n.end.line:n.line;e===i&&(r=!1)}r&&(s?(s.margin=0===N.comparePos(s.start,e)?"left":"right",n=s):n=e,t.push(n))}))),t.forEach((e=>{let t=0,i=0,n=null,o=0,l=0;e.end?(t=e.start.line-1,i=e.end.line):(t=e.line-1,i=e.line),l=this.htmls[i-1].text.length,t<1?(t=1,i<this.maxLine&&(i++,l=0)):o=this.htmls[t-1].text.length,n={start:{line:t,column:o},end:{line:i,column:l}},r.push(this.getRangeText(n.start,n.end)),s.push(n)})),this._deleteMultiContent(s).forEach(((e,s)=>{let n=t[s],r=e.cursorPos.line,o=t[s].column;n.start&&(o="left"===n.margin?n.start.column:n.end.column),o=o>this.htmls[r-1].text.length?this.htmls[r-1].text.length:o,i.push({line:r,column:o})})),this.searcher.clearSearch(),this.cursor.clearCursorPos(),i.forEach((e=>{this.cursor.addCursorPos(e)}));let l={type:N.command.INSERT_LINE,cursorPos:t,text:r,searchConifg:o};e?(this.history.updateHistory(l),this.searcher.refreshSearch(e.searchConifg)):this.history.pushHistory(l),this.fSearcher.refreshSearch()}replace(e,t){let s=null,i=this.serial++;return s=this._deleteMultiContent(t),s.serial=i,this.history.pushHistory(s),s=this._insertMultiContent(e,this.cursor.multiCursorPos.toArray()),s.serial=i,this.history.pushHistory(s),this.fSearcher.refreshSearch()}replaceTip(e){let t=e.word||"",s=e.after||"",i=e.before||"",n=i+o(e)+s,r=null;function o(e){let t="";if(e.type===ne.TOKEN_TYPE.EMMET_HTML||e.type===ne.TOKEN_TYPE.EMMET_CSS)try{const s={};e.type===ne.TOKEN_TYPE.EMMET_CSS&&(s.type="stylesheet"),t=(0,ie.ZP)(e.result,s)}catch(s){t=e.result}else e.type===ne.TOKEN_TYPE.TAG_NAME?t+=e.result+`></${e.result}>`:t=e.result;return t}function l(){let e=[];return this.cursor.multiCursorPos.forEach((s=>{let i=null;i={start:{line:s.line,column:s.column-t.length},end:{line:s.line,column:s.column}},e.push(i)})),e}function a(){if(e.type===ne.TOKEN_TYPE.TAG_NAME||e.type===ne.TOKEN_TYPE.EMMET_HTML){let e=we.endTag.exec(n);if(e){let t=n.slice(e.index),s=t.split("\n"),i=this.cursor.multiCursorPos.toArray();for(let e=i.length-1;e>=0;e--){let t=h.call(this,s,i[e]);this.cursor.updateCursorPos(i[e],t.line,t.column)}}}else e.type===ne.TOKEN_TYPE.ATTR_NAME&&this.cursor.multiCursorPos.forEach((e=>{this.cursor.moveCursor(e,"left")}))}function h(e,t){let s=t.line,i=t.column;return 1===e.length?i-=e[0].length:(s-=e.length-1,i=this.htmls[s-1].text.length-e[0].length),{line:s,column:i}}n!==t&&(r=l.call(this),this.replace(n,r),a.call(this),e.type===ne.TOKEN_TYPE.CSS_PROPERTY&&this.autocomplete.search())}getRangeText(e,t){var s=this.htmls[e.line-1].text;if(e.line!=t.line){let i=[];s=s.slice(e.column),i=this.htmls.slice(e.line,t.line-1),i=i.map((e=>e.text)),s+=i.length?"\n"+i.join("\n"):"",t.line<=this.maxLine&&(s+="\n"+this.htmls[t.line-1].text.slice(0,t.column))}else s=s.slice(e.column,t.column);return s}getCopyText(e){let t="",s=null,i=[];return this.cursor.multiCursorPos.forEach((e=>{let t=this.selecter.getRangeByCursorPos(e),n=null;t?i.push(t):s&&e.line===s.line||(n=e.line>1?{line:e.line-1,column:this.htmls[e.line-2].text.length}:{line:e.line,column:0},t={start:n,end:{line:e.line,column:this.htmls[e.line-1].text.length}},i.push(t),s=e)})),i.forEach((e=>{let s=this.getRangeText(e.start,e.end);t="\n"===s[0]?t+=s:t+="\n"+s})),e&&(this.history.pushHistory(this._deleteMultiContent(i)),this.searcher.clearSearch(),this.fSearcher.refreshSearch()),t.slice(1)}getAllText(){return this.htmls.map((e=>e.text)).join("\n")}}Te.contexts={};var Le=Te,Pe=class{constructor(e,t){this.initProperties(e,t)}initProperties(e,t){N.defineProperties(this,e,["nowCursorPos","cursor","selecter","searcher","autocomplete","fSearcher","history","autoTipList","setAutoTip","prevAutoTip","nextAutoTip","selectAutoTip","searchWord","openSearch","$emit"]),N.defineProperties(this,t,["htmls","insertContent","deleteContent","moveLineUp","moveLineDown","copyLineUp","copyLineDown","deleteLine"]),this.setEditorData=(t,s)=>{e.setData(t,s)}}onKeyDown(e){let t=this;if(e.ctrlKey&&e.shiftKey){switch(e.preventDefault(),e.keyCode){case 37:this.selecter.select("left",!0);break;case 38:this.moveLineUp();break;case 39:this.selecter.select("right",!0);break;case 40:this.moveLineDown();break;case 68:this.copyLineUp();break;case 75:this.deleteLine();break;case 76:e.preventDefault(),this.cursor.addCursorLineEnds();break}return!1}if(e.ctrlKey&&e.altKey)switch(e.keyCode){case 38:e.preventDefault(),this.cursor.addCursorAbove();break;case 40:e.preventDefault(),this.cursor.addCursorBelow();break}else if(e.altKey&&e.shiftKey)switch(e.keyCode){case 40:e.preventDefault(),this.copyLineDown();break}else if(e.ctrlKey)switch(e.keyCode){case 37:s("left",!0);break;case 39:s("right",!0);break;case 65:e.preventDefault(),this.selecter.selectAll();break;case 68:e.preventDefault(),this.searchWord("down");break;case 70:e.preventDefault(),this.openSearch();break;case 72:e.preventDefault(),this.openSearch(!0);break;case 83:this.$emit("save");break;case 90:case 122:e.preventDefault(),this.history.undo();break;case 89:case 121:e.preventDefault(),this.history.redo();break}else if(e.shiftKey)switch(e.keyCode){case 37:this.selecter.select("left");break;case 38:this.selecter.select("up");break;case 39:this.selecter.select("right");break;case 40:this.selecter.select("down");break}else switch(e.keyCode){case 9:e.preventDefault(),this.autocomplete.emmet();break;case 37:s("left");break;case 35:s("end");break;case 36:s("home");break;case 38:this.autoTipList&&this.autoTipList.length?t.prevAutoTip():s("up");break;case 39:s("right");break;case 40:this.autoTipList&&this.autoTipList.length?t.nextAutoTip():s("down");break;case 13:case 100:this.autoTipList&&this.autoTipList.length&&(e.preventDefault(),this.selectAutoTip());break;case N.keyCode.DELETE:this.deleteContent(N.keyCode.DELETE),this.autocomplete.search();break;case N.keyCode.BACKSPACE:this.deleteContent(N.keyCode.BACKSPACE),this.autocomplete.search();break}function s(e,s){t.selecter.getRangeByCursorPos(t.nowCursorPos)||t.cursor.multiCursorPos.forEach((i=>{t.cursor.moveCursor(i,e,s)})),t.setAutoTip(null),t.searcher.clearSearch(),t.fSearcher.clearActive()}}},Ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-search",on:{contextmenu:[function(e){e.preventDefault()},function(e){e.stopPropagation()}],mousedown:function(e){e.stopPropagation()},selectstart:function(e){e.stopPropagation()}}},[s("div",{staticClass:"my-search-left active-click",staticStyle:{"border-radius":"0"},attrs:{tabindex:"-1"},on:{click:e.showReplace}},[s("span",{staticClass:"iconfont",class:{"icon-down1":e.replaceVisible,"icon-right":!e.replaceVisible},staticStyle:{"font-size":"14px"},attrs:{title:"Toggle Replace mode"}})]),s("div",{staticStyle:{"flex-grow":"1"}},[s("div",{staticClass:"my-search-top"},[s("div",{staticClass:"my-search-input",class:{"my-active":e.input1Focus}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],ref:"input1",style:{height:e.input1Height+"px"},attrs:{type:"text",spellcheck:"false"},domProps:{value:e.text},on:{blur:function(t){e.input1Focus=!1},focus:function(t){e.input1Focus=!0},keydown:e.onKeyDown,input:[function(t){t.target.composing||(e.text=t.target.value)},e.onInput]}}),s("span",{staticClass:"my-search-suffix",class:{"my-active":e.ignoreCase},attrs:{title:"Match Case(Alt+C)"},on:{click:e.changeCase}},[e._v("Aa")]),s("span",{staticClass:"my-search-suffix iconfont icon-whole-word",class:{"my-active":e.wholeWord},attrs:{title:"Match Whole Word(Alt+W)"},on:{click:e.changeWhole}})]),e.count?s("div",[s("span",[e._v(e._s(e.now))]),s("span",[e._v(" of ")]),s("span",[e._v(e._s(e.count))])]):s("span",{staticClass:"no-result",class:{"my-active":e.text}},[e._v("No results")])]),e.replaceVisible?s("div",{staticClass:"my-search-bottom",staticStyle:{"margin-top":"5px"}},[s("div",{staticClass:"my-search-input",class:{"my-active":e.input2Focus}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.replaceText,expression:"replaceText"}],ref:"input2",style:{height:e.input2Height+"px"},attrs:{type:"text",spellcheck:"false"},domProps:{value:e.replaceText},on:{blur:function(t){e.input2Focus=!1},focus:function(t){e.input2Focus=!0},keydown:e.onKeyDown2,input:function(t){t.target.composing||(e.replaceText=t.target.value)}}})]),s("span",{staticClass:"iconfont icon-replace active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{title:"Replace(Enter)",tabindex:"-1"},on:{click:e.replace}}),s("span",{staticClass:"iconfont icon-replace-all active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{title:"Replace All(Ctrl+Alt+Enter)",tabindex:"-1"},on:{click:e.replaceAll}})]):e._e()]),s("div",{staticClass:"my-search-right"},[s("span",{staticClass:"iconfont icon-up active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{title:"Previous Match(Shift Enter)",tabindex:"-1"},on:{click:e.searchPrev,focus:function(t){e.preFocus=!0},blur:function(t){e.preFocus=!1}}}),s("span",{staticClass:"iconfont icon-down active-click",class:{"enabled-color":e.count>0,"disabled-color":0==e.count},staticStyle:{"margin-right":"5px"},attrs:{title:"Next Match(Enter)",tabindex:"-1"},on:{click:e.searchNext,focus:function(t){e.nextFocus=!0},blur:function(t){e.nextFocus=!1}}}),s("span",{staticClass:"iconfont icon-close active-click",attrs:{title:"Close"},on:{click:e.close}})])])},Se=[],_e={name:"Search",props:{now:{type:Number,default:1},count:{type:Number,default:0}},data(){return{text:"",replaceText:"",replaceVisible:!1,wholeWord:!1,ignoreCase:!1,searchPrevActive:!1,searchNextActive:!1,input1Focus:!1,input2Focus:!1,preFocus:!1,nextFocus:!1,input1Height:30,input2Height:30}},watch:{text(){let e=this.text.split(/\n/);this.input1Height=20*e.length+10},replaceText(){let e=this.replaceText.split(/\n/);this.input2Height=20*e.length+10}},created(){m()(document).on("keydown",(e=>{13!==e.keyCode&&100!==e.keyCode||(this.preFocus?this.searchPrev():this.nextFocus&&this.searchNext())}))},methods:{initData(e){for(let t in e)this[t]=e[t]},getData(){return{text:this.text,wholeWord:this.wholeWord,ignoreCase:this.ignoreCase}},search(){let e=this.search.id||1;this.search.id=e,this.$nextTick((()=>{this.search.id===e&&this.$emit("search",{text:this.text,ignoreCase:this.ignoreCase,wholeWord:this.wholeWord})}))},changeCase(){this.ignoreCase=!this.ignoreCase,this.focus(),this.onInput()},changeWhole(){this.wholeWord=!this.wholeWord,this.focus(),this.onInput()},showReplace(){this.replaceVisible=!this.replaceVisible},searchNext(){this.count&&this.$emit("next")},searchPrev(){this.count&&this.$emit("prev")},replace(){this.count&&this.$emit("replace",{text:this.replaceText})},replaceAll(){this.count&&this.$emit("replaceAll",{text:this.replaceText})},close(){this.$emit("close")},focus(){this.$refs.input1.focus(),requestAnimationFrame((()=>{this.$refs.input1.focus()}))},directBlur(){this.searchPrevActive=!1,this.searchNextActive=!1},onKeyDown(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.$emit("next"))},onKeyDown2(e){13!==e.keyCode&&100!==e.keyCode||(e.preventDefault(),this.count&&(e.ctrlKey&&e.altKey?this.replaceAll():this.replace()))},onInput(){clearTimeout(this.searchTimer),this.searchTimer=setTimeout((()=>{this.search()}),100)}}},Ie=_e,Me=(0,x.Z)(Ie,Ee,Se,!1,null,null,null),Be=Me.exports,De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"auto",staticClass:"my-auto my-shadow my-border my-scroll-overlay my-scroll-mini",style:e.styles,on:{mousedown:function(e){e.stopPropagation()},wheel:function(e){e.stopPropagation()}}},[s("div",e._l(e.tipList,(function(t){return s("div",{staticClass:"my-auto-item my-center-between",class:{"my-active":t.active},on:{mousedown:function(s){return e.onClick(t)}}},[s("div",{staticClass:"my-center-between"},[s("div",{staticClass:"my-auto-icon my-center-center iconfont",class:[t.icon]}),s("div",{staticClass:"my-auto-content"},[s("span",{domProps:{innerHTML:e._s(e._html(t))}})])]),s("div",{staticClass:"my-auto-desc"},[e._v(e._s(t.desc))])])})),0)])},Fe=[],Ae={name:"AutoTip",props:{tipList:{type:Array,default:[]},styles:{type:Object}},data(){return{nowIndex:0,itemHeight:25}},computed:{_html(){return e=>{let t=0,s="";return e.indexs.forEach((i=>{s+=e.result.slice(t,i),s+=`<span class="match-char">${e.result[i]}</span>`,t=i+1})),s+e.result.slice(t)}}},watch:{nowIndex(){let e=this.$refs.auto,t=(this.nowIndex+1)*this.itemHeight;e&&t>e.clientHeight+e.scrollTop?e.scrollTop=t-e.clientHeight:e&&t<e.scrollTop+this.itemHeight&&(e.scrollTop=t-this.itemHeight)}},created(){},methods:{onClick(e){this.$emit("change",e)},prev(){let e=this.getActiveIndex();this.tipList[e].active=!1,e-=1,e=e<0?this.tipList.length-1:e,this.tipList[e].active=!0,this.nowIndex=e},next(){let e=this.getActiveIndex();this.tipList[e].active=!1,e+=1,e=e>this.tipList.length-1?0:e,this.tipList[e].active=!0,this.nowIndex=e},getActiveIndex(){for(let e=0;e<this.tipList.length;e++)if(this.tipList[e].active)return e}}},$e=Ae,Ne=(0,x.Z)($e,De,Fe,!1,null,"378f7506",null),Oe=Ne.exports,We=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-tip",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},[s("div",{staticClass:"my-tip-content"},[s("div",{domProps:{innerHTML:e._s(e.content)}})])])},Re=[],je={name:"Tip",props:{content:String,styles:{type:Object}},data(){return{}},created(){},methods:{}},He=je,ze=(0,x.Z)(He,We,Re,!1,null,null,null),Ve=ze.exports;const Ke=Le.contexts;var Ue={name:"Editor",components:{SearchDialog:Be,Menu:v,AutoTip:Oe,Tip:Ve},props:{id:{type:Number},active:{type:Boolean,default:!1}},data(){return{charObj:{charWidth:7.15,fullAngleCharWidth:15,charHight:19},nowCursorPos:{line:1,column:0},cursorVisible:!0,cursorFocus:!0,language:"",theme:"",tabSize:4,renderHtmls:[],startLine:1,top:0,cursorLeft:0,scrollLeft:0,scrollTop:0,maxVisibleLines:1,maxLine:1,contentHeight:"100%",scrollerArea:{},bracketMatch:{start:{},end:{}},maxWidthObj:{lineId:null,text:"",width:0},menuList:[[{name:"Cut",op:"cut",shortcut:"Ctrl+X"},{name:"Copy",op:"copy",shortcut:"Ctrl+C"},{name:"Paste",op:"paste",shortcut:"Ctrl+V"}]],menuStyle:{top:"0px",left:"0px","min-width":"200px"},tipStyle:{top:"0px",left:"0px"},autoTipStyle:{top:"50%",left:"50%"},errorMap:{},errors:[],autoTipList:[],tipContent:null,menuVisible:!1,searchVisible:!1,selectedFg:!1,activeLineBg:!0,searchNow:1,searchCount:0}},computed:{_numTop(){return this.top-this.charObj.charHight+"px"},_leftShadow(){return this.scrollLeft?"17px 0 16px -16px rgba(0, 0, 0, 0.8) inset":"none"},_top(){return(this.folder.getRelativeLine(this.startLine)-1)*this.charObj.charHight+"px"},_lineHeight(){return this.charObj.charHight+"px"},_cursorVisible(){return this.cursorVisible&&this.cursorFocus?"visible":"hidden"},_hScrollWidth(){return this._contentMinWidth},_contentMinWidth(){let e=0;return this.$refs.content&&(e=N.getStrExactWidth(this.maxWidthObj.text,this.tabSize,this.$refs.content),e+=this.charObj.fullAngleCharWidth),e=this.scrollerArea.width>e?this.scrollerArea.width:e,e+"px"},_textAreaPos(){let e=this.cursorLeft,t=this.top;if(this.nowCursorPos){let e=this.nowCursorPos.line<this.startLine?this.startLine:this.nowCursorPos.line;t=this.folder.getRelativeLine(e)*this.charObj.charHight,t>this.scrollTop+this.scrollerArea.height-2*this.charObj.charHight&&(t=this.scrollTop+this.scrollerArea.height-2*this.charObj.charHight)}return{top:t+"px",left:e+"px"}},_tabLineLeft(){return e=>(e-1)*this.tabSize*this.charObj.charWidth+"px"},_activeLine(){return e=>this.nowCursorPos.line==e&&this.activeLineBg},space(){return N.space(this.tabSize)},myContext(){return Ke[this.id]}},watch:{language:function(e){this.myContext.htmls.forEach((e=>{e.tokens=null,e.folds=null,e.stateFold=null,e.states=null,e.html=""})),this.lint.initLanguage(e),this.tokenizer.initLanguage(e)},theme:function(){this.myContext.htmls.forEach((e=>{e.html=""})),this.render()},tabSize:function(e){this.render(),this.maxWidthObj={lineId:null,text:"",width:0},this.myContext.setLineWidth(this.myContext.htmls)},maxLine:function(e){this.setContentHeight()},startLine:function(e){this.render(),this.tokenizer.tokenizeVisibleLins()},nowCursorPos:{handler:function(e){k.$emit("cursor-change",{line:e?e.line:"?",column:e?e.column:"?"}),this.renderBracketMatch()},deep:!0},active:function(e){e?this.showEditor():this.autocomplete.stop()}},created(){this.initData(),this.initEventBus(),this.initEvent()},mounted(){this.selectedFg=!!B.colors["editor.selectionForeground"],this.showEditor(),this.initResizeEvent()},destroyed(){this.unbindEvent()},methods:{initData(){this.editorId=this.id,Ke[this.editorId]=new Le(this),this.maxWidthObj.lineId=this.myContext.htmls[0].lineId,this.tokenizer=new X(this,this.myContext),this.lint=new se(this,this.myContext),this.autocomplete=new he(this,this.myContext),this.folder=new fe(this,this.myContext),this.history=new ke(this,this.myContext),this.selecter=new ye(this,this.myContext),this.searcher=new Ce(this,this.myContext,this.selecter),this.fSelecter=new ye(this,this.myContext),this.fSearcher=new Ce(this,this.myContext,this.fSelecter),this.shortcut=new Pe(this,this.myContext),this.cursor=new be(this,this.myContext),this.cursor.addCursorPos(this.nowCursorPos),this.wordPattern=N.getWordPattern(this.language),this.wordPattern=new RegExp(`^(${this.wordPattern.source})`)},initEvent(){this.initEvent.fn1=e=>{this.active&&this.onDocumentMmove(e)},this.initEvent.fn2=e=>{this.active&&this.onDocumentMouseUp(e)},m()(document).on("mousemove",this.initEvent.fn1),m()(document).on("mouseup",this.initEvent.fn2)},initResizeEvent(){const e=new ResizeObserver((e=>{this.$refs.editor&&this.showEditor()}));e.observe(this.$refs.editor)},initEventBus(){k.$on("language-change",this.initEventBus.fn1=e=>{this.active&&(this.language=e),this._language=e}),k.$on("tab-size-change",this.initEventBus.fn2=e=>{this.active&&(this.tabSize=e)}),k.$on("close-menu",this.initEventBus.fn3=()=>{this.menuVisible=!1,this.autoTipList=null,this.autocomplete.stop()}),k.$on("theme-change",this.initEventBus.fn4=e=>{this.selectedFg=!!B.colors["editor.selectionForeground"],this.active&&(this.theme=e),this._theme=e})},unbindEvent(){m()(document).unbind("mousemove",this.initEvent.fn1),m()(document).unbind("mouseup",this.initEvent.fn2),k.$off("language-change",this.initEventBus.fn1),k.$off("tab-size-change",this.initEventBus.fn2),k.$off("close-menu",this.initEventBus.fn3),k.$off("theme-change",this.initEventBus.fn4)},showEditor(){this.active&&this.$nextTick((()=>{this.language=this._language||"",this.theme=this._theme||"",this.charObj=N.getCharWidth(this.$refs.content),this.maxVisibleLines=Math.ceil(this.$refs.scroller.clientHeight/this.charObj.charHight)+1,this.render(),this.focus()}))},showCursor(){if(this.cursorFocus=!0,!this.cursor.multiCursorPos.size)return void(this.showCursor.show=!1);if(this.showCursor.show)return;this.showCursor.show=!0,this.cursorVisible=!0;let e=()=>{clearTimeout(this.curserTimer),this.curserTimer=setTimeout((()=>{this.cursorVisible=!this.cursorVisible,e()}),500)};e()},hideCursor(){clearTimeout(this.curserTimer),this.showCursor.show=!1,this.cursorFocus=!1},focus(){this.$refs.textarea.focus(),requestAnimationFrame((()=>{this.$refs.textarea.focus()}))},render(e){let t=this.renderId+1||1;this.renderId=t,this.$nextTick((()=>{this.renderId===t&&(this.renderLine(),this.renderSelectedBg(),this.renderSelectionToken(),this.renderError(),this.renderCursor(e),this.$nextTick((()=>{this.scrollerArea={height:this.$refs.scroller.clientHeight,width:this.$refs.scroller.clientWidth}})))}))},renderLine(e){let t=this;if(e){if(this.myContext.renderedIdMap.has(e)){let t=this.myContext.lineIdMap.get(e),i=this.myContext.renderedIdMap.get(e);this.myContext.htmls[i.num-1]&&this.myContext.htmls[i.num-1].lineId===e&&(Object.assign(i,s(t,i.num)),this.renderCursor(),this.renderSelectedBg(),this.renderSelectionToken(i.line),this.renderError(i.line))}}else{this.myContext.renderedIdMap.clear(),this.myContext.renderedLineMap.clear(),this.renderHtmls=[];for(let e=0,t=this.startLine;e<this.maxVisibleLines&&t<=this.myContext.htmls.length;e++){let e=this.myContext.htmls[t-1],i=e.lineId,n=s(e,t),r=this.folder.getFoldByLine(t);this.renderHtmls.push(n),this.myContext.renderedIdMap.set(i,n),this.myContext.renderedLineMap.set(t,n),r?t=r.end.line:t++}}function s(e,s){let n=i(s),r="";t.folder.getFoldByLine(s)?r="close":t.folder.getRangeFold(s,!0)&&(r="open");let o=e.html;return o||(e.tokens&&e.tokens.length?(e.tokens=t.tokenizer.splitLongToken(e.tokens),e.html=t.tokenizer.createHtml(e.tokens,e.text),o=e.html):o=N.htmlTrans(e.text)),o=o.replace(/\t/g,t.space),{html:o,num:s,tabNum:n,selectStarts:[],selectEnds:[],selected:!1,isFsearch:!1,fold:r,cursorList:[]}}function i(e){let s=t.myContext.htmls[e-1].text,n=/[^\s]/,r=0;if(t.myContext.renderedLineMap.has(e))return t.myContext.renderedLineMap.get(e).tabNum;if(n.exec(s)){let e=/^\s+/.exec(s);e&&(r=/\t+/.exec(e[0]),r=r&&r[0].length||0,r+=Math.ceil((e[0].length-r)/t.tabSize))}else{let s=e-1;while(s>=1){if(n.exec(t.myContext.htmls[s-1].text)){r=i(s),t.folder.getRangeFold(s,!0)&&r++;break}s--}}return r}},renderSelectedBg(){let e=this.renderSelectedBgId+1||1;this.renderSelectedBgId=e,this.activeLineBg=!0,this.$nextTick((()=>{this.renderSelectedBgId==e&&(this.renderHtmls.length?(this.clearSelectionToken(),this.renderHtmls.forEach((e=>{e.selected=!1,e.selectStarts=[],e.selectEnds=[]})),this.fSelecter.ranges.forEach((e=>{this._renderSelectedBg(e,!0)})),this.selecter.ranges.forEach((e=>{let t=this.fSelecter.getRangeByCursorPos(e.start);this.searchVisible?!t&&e.active&&this._renderSelectedBg(e):this._renderSelectedBg(e)}))):requestAnimationFrame((()=>{this.renderSelectedBg()})))}))},_renderSelectedBg(e,t){let s=this.renderHtmls[0].num,i=this.renderHtmls.peek().num,n=e.start,r=e.end,o=this.myContext.htmls[n.line-1].text,l=o.length;n.left=this.getStrWidth(o,0,n.column),n.line==r.line?n.width=this.getStrWidth(o,n.column,r.column)||10:(n.width=this.getStrWidth(o,n.column)||10,r.left=0,o=this.myContext.htmls[r.line-1].text,r.width=this.getStrWidth(o,0,r.column)||10),s=s>n.line+1?s:n.line+1,i=i<r.line-1?i:r.line-1;for(let a=s;a<=i;a++)if(this.myContext.renderedLineMap.has(a)){let s=this.myContext.renderedLineMap.get(a);s.selected=!0,s.isFsearch=t,s.active=e.active}this.myContext.renderedLineMap.has(n.line)&&(this.myContext.renderedLineMap.get(n.line).selectStarts.push({left:n.left,width:n.width,active:e.active,isFsearch:t}),r.line==n.line&&(l=r.column),e.active&&this._renderSelectionToken(n.line,n.column,l)),r.line>n.line&&this.myContext.renderedLineMap.has(r.line)&&(this.myContext.renderedLineMap.get(r.line).selectEnds.push({left:r.left,width:r.width,active:e.active,isFsearch:t}),e.active&&this._renderSelectionToken(r.line,0,r.column)),n.line!==this.nowCursorPos.line&&r.line!==this.nowCursorPos.line||(this.activeLineBg=!1)},renderSelectionToken(e){if(!B.colors["editor.selectionForeground"])return;let t=this.selecter.getRangeByLine(e);t.forEach((t=>{if(t.active){let s=t.start.column,i=t.end.column;t.start.line===e?t.end.line>t.start.line&&(i=this.myContext.htmls[t.start.line-1].text.length):s=0,this._renderSelectionToken(e,s,i)}}))},_renderSelectionToken(e,t,s){if(!B.colors["editor.selectionForeground"])return;let i=this.myContext.htmls[e-1],n=i.tokens,r=["selected"],o=[];this.myContext.fgLines.push(e);for(let l=0;l<n.length;l++){let e=n[l];if(e.startIndex<=t&&e.endIndex>t){if(e.startIndex<t&&o.push({startIndex:e.startIndex,endIndex:t,scopes:e.scopes}),e.endIndex>s){o.push({startIndex:t,endIndex:s,scopes:r}),o.push({startIndex:s,endIndex:e.endIndex,scopes:e.scopes}),o=o.concat(n.slice(l+1));break}o.push({startIndex:t,endIndex:e.endIndex,scopes:r})}else if(e.startIndex>t&&e.endIndex<=s)o.push({startIndex:e.startIndex,endIndex:e.endIndex,scopes:r});else{if(e.startIndex<s&&e.endIndex>s){o.push({startIndex:e.startIndex,endIndex:s,scopes:r}),o.push({startIndex:s,endIndex:e.endIndex,scopes:e.scopes}),o=o.concat(n.slice(l+1));break}if(e.startIndex>=s){o=o.concat(n.slice(l));break}o.push(e)}}i.html=this.tokenizer.createHtml(o,i.text),this.myContext.renderedIdMap.get(i.lineId).html=i.html,this.$nextTick((()=>{i.fgTokens=o}))},renderBracketMatch(){if(this.bracketMatch=this.folder.getBracketMatch(this.nowCursorPos),this.bracketMatch){let e=null,t=null;e=this.myContext.htmls[this.bracketMatch.start.line-1],t=this.bracketMatch.start,this.bracketMatch.start.width=this.getStrWidth(e.text,t.startIndex,t.endIndex),this.bracketMatch.start.left=this.getStrWidth(e.text,0,t.startIndex),e=this.myContext.htmls[this.bracketMatch.end.line-1],t=this.bracketMatch.end,this.bracketMatch.end.width=this.getStrWidth(e.text,t.startIndex,t.endIndex),this.bracketMatch.end.left=this.getStrWidth(e.text,0,t.startIndex)}},clearSelectionToken(){this.myContext.fgLines.forEach((e=>{this._clearSelectionToken(e)})),this.myContext.fgLines.empty()},_clearSelectionToken(e){let t=this.myContext.htmls[e-1];t&&t.fgTokens&&(t.fgTokens=null,this.myContext.renderedLineMap.has(e)&&(this.myContext.renderedIdMap.get(t.lineId).html=this.tokenizer.createHtml(t.tokens,t.text)),t.html="")},renderCursor(e){let t=this,s=this.renderCursorId+1||1;function i(e){let s=[];t.cursor.getCursorsByLine(e.num).forEach((e=>{s.push(n(e))})),e.cursorList=s}function n(s){let i=0;if(!s.del)return i=t.getExactLeft(s),e&&s===t.nowCursorPos&&(i>t.scrollerArea.width+t.scrollLeft-t.charObj.fullAngleCharWidth?t.$refs.scroller.scrollLeft=i+t.charObj.fullAngleCharWidth-t.scrollerArea.width:i<t.scrollLeft&&(t.$refs.scroller.scrollLeft=i-1)),s===t.nowCursorPos&&(t.cursorLeft=i),i+"px"}this.renderCursorId=s,this.$nextTick((()=>{this.renderCursorId===s&&this.renderHtmls.length&&(this.renderHtmls.forEach((e=>{i(e)})),this.cursorVisible=!0)}))},renderError(e){function t(){let t=m()(this.$refs.render),n={};t.find("span.my-token-error").remove(),this.errors.forEach((t=>{let r=t.line+","+t.originColumn,o=null;if(!(e&&t.line!==e||n[r])){if(n[r]=!0,o=this.myContext.htmls[t.line-1],t.endLine||(t.endLine=t.line),t.column>=o.text.length&&(t.column=o.text.length-1),!t.endColumn){let e=null;(e=this.wordPattern.exec(o.text.slice(t.column)))?t.endColumn=t.column+e[0].length:t.endColumn=t.column+1}if(t.endColumn>o.text.length&&(t.endColumn=o.text.length),t.line===t.endLine)s.call(this,t.line,t.column,t.endColumn,r);else{s.call(this,t.line,t.column,o.text.length,r),s.call(this,t.endLine,0,t.endColumn,r);for(let e=t.line+1;e<t.endLine;e++)i.call(this,e,r)}}}))}function s(e,t,s,i){if(e<this.startLine||e>this.startLine+this.maxVisibleLines)return;let n=m()(this.$refs.render),r=this.myContext.htmls[e-1],o=this.getToken(e,t),l=0;if(o){let s=n.find(`div.my-code[data-line="${e}"]`).find(`span[data-column="${o.startIndex}"]`);l=s[0].offsetLeft+this.getStrWidth(r.text,o.startIndex,t)}let a=this.getStrWidth(r.text,t,s)||this.charObj.charWidth,h=`<span class="my-token-error" style="width:${a}px;left:${l}px" data-key="${i}"></span>`;n.find(`div.my-code[data-line="${e}"]`).append(h)}function i(e,t){if(e<this.startLine||e>this.startLine+this.maxVisibleLines)return;let s=m()(this.$refs.render),i=`<span class="my-token-error" style="width:100%;left:0px" data-key="${t}"></span>`;s.find(`div.my-code[data-line="${e}"]`).append(i)}this.$nextTick((()=>{t.call(this)}))},foldLine(e){let t=this.folder.foldLine(e);this.focus(),t&&(this.cursor.multiCursorPos.forEach((s=>{if(s.line>e&&s.line<t.end.line){let t=this.myContext.htmls[e-1];s.line=e,s.column=t.text.length}})),this.setContentHeight(),this.render())},unFold(e){this.focus(),this.folder.unFold(e)&&(this.setContentHeight(),this.render())},openSearch(e){let t=this.$refs.searchDialog;if(!this.searchVisible||!this.fSelecter.activedRanges.size&&this.cursorFocus){if(this.cursorFocus){let e=this.fSearcher.getSearchConfig();if(e)t.initData({ignoreCase:e.ignoreCase,wholeWord:e.wholeWord,text:e.text});else if(this.searchVisible)return}this.searchVisible=!0,this.fSearcher.clearSearch(),this.searchText({config:t.getData()}),t.initData({replaceVisible:!!e}),t.focus()}},searchWord(e){let t=null;if(this.searcher.search({direct:e}),this.searchVisible){if(0===this.fSelecter.activedRanges.size){let s=this.fSearcher.getSearchConfig();s&&(this.fSearcher.clearSearch(),t=this.fSearcher.search({direct:e,increase:!0}))}else t=this.fSearcher.search({direct:e,increase:!0});t&&(this.searchNow=t.now,this.searchCount=t.count)}},searchText(e){let t=this.fSearcher.search(e);t?(this.searchNow=t.now,this.searchCount=t.count):this.searchCount=0},replace(e){if(this.fSelecter.activedRanges.size){let t=this.fSearcher.getNowRange();this.myContext.replace(e.text,[t]).then((()=>{this.searchText()}))}else this.searchText()},replaceAll(e){this.fSelecter.ranges.size&&this.myContext.replace(e.text,this.fSelecter.ranges.toArray()).then((()=>{this.fSearcher.clearSearch(),this.searchCount=0}))},prevAutoTip(){this.$refs.autoTip.prev()},nextAutoTip(){this.$refs.autoTip.next()},selectAutoTip(){let e=this.$refs.autoTip.getActiveIndex();this.onClickAuto(this.autoTipList[e])},setData(e,t){"function"!==typeof this[e]&&(this[e]=t)},setNowCursorPos(e){if(this.nowCursorPos=e||{line:1,column:0},e){let t=this.setNowCursorPosId+1||1;this.setNowCursorPosId=t,this.$nextTick((()=>{if(this.setNowCursorPosId!=t)return;let s=this.folder.getRelativeLine(e.line)*this.charObj.charHight;s+this.charObj.charHight>this.scrollTop+this.scrollerArea.height?requestAnimationFrame((()=>{this.setStartLine(s+this.charObj.charHight-this.scrollerArea.height),this.$refs.scroller.scrollTop=s+this.charObj.charHight-this.scrollerArea.height})):e.line<=this.startLine&&requestAnimationFrame((()=>{e.line<=this.startLine&&(this.startLine=e.line,this.$refs.scroller.scrollTop=(this.folder.getRelativeLine(e.line)-1)*this.charObj.charHight)})),this.renderCursor(!0)}))}},setContentHeight(){let e=this.myContext.htmls.length,t=0;e=this.folder.getRelativeLine(e),t=e*this.charObj.charHight,this.scrollerArea&&(t+=this.scrollerArea.height-this.charObj.charHight),this.contentHeight=t+"px"},setStartLine(e){let t=1;t=Math.floor(e/this.charObj.charHight),t++,this.startLine=this.folder.getRealLine(t),this.top=-e%this.charObj.charHight},setErrors(e){function t(e,t){let s=0;while(s<t.length){let i=t[s].line,n=[];while(s<t.length&&t[s].line===i){let r=i+","+t[s].column;t[s].originColumn=t[s].column,n.push(t[s].reason),e[r]?e[r]+="<br>"+t[s].reason:e[r]=t[s].reason,s++}i=i||this.htmls.length,e[i]=n.join("<br>")}}this.errorMap={},this.errors=e,t.call(this,this.errorMap,e),this.renderError()},setAutoTip(e){clearTimeout(this.setAutoTip.hideTimer),e&&e.length?(e.forEach((e=>{e.active=!1})),this.autoTipList=e,this.autoTipList[0].active=!0,this.$nextTick((()=>{let e=this.$refs.autoTip.$el.clientWidth,t=this.$refs.autoTip.$el.clientHeight;this.autoTipStyle.top=this.folder.getRelativeLine(this.nowCursorPos.line)*this.charObj.charHight,this.autoTipStyle.left=this.getExactLeft(this.nowCursorPos),this.autoTipStyle.top+t>N.getNum(this._top)+this.$refs.scroller.clientHeight&&(this.autoTipStyle.top-=t+this.charObj.charHight),this.autoTipStyle.left+e>this.scrollLeft+this.scrollerArea.width&&(this.autoTipStyle.left-=e),this.autoTipStyle.top+="px",this.autoTipStyle.left+="px"}))):this.setAutoTip.hideTimer=setTimeout((()=>{this.autoTipList=null}),60)},getStrWidth(e,t,s){return N.getStrWidth(e,this.charObj.charWidth,this.charObj.fullAngleCharWidth,this.tabSize,t,s)},getStrWidthByLine(e,t,s){return this.getStrWidth(this.myContext.htmls[e-1].text,t,s)},getColumnByWidth(e,t){let s,i,n,r,o=0,l=e.length;while(o<l){if(s=Math.floor((o+l)/2),i=this.getStrWidth(e,0,s),n=e[s-1]&&this.getStrWidth(e[s-1])/2,r=e[s]&&this.getStrWidth(e[s])/2||n,i>=t&&i-t<n||t>=i&&t-i<r){o=s;break}i>t?l=s:o=s+1}return o},getPosByEvent(e){let t=m()(e.target),s=(t.attr("data-line")||t.parent().attr("data-line"))-0,i=t.attr("data-column");if(!s){if(e.target!==this.$refs.content)return null;s=this.myContext.htmls.length}let n=this.myContext.htmls[s-1],r=n.fgTokens||n.tokens;if(i){i-=0;for(let t=0;t<r.length;t++){let s=r[t];if(r[t].startIndex==i){i+=this.getColumnByWidth(n.text.slice(s.startIndex,s.endIndex),e.offsetX);break}}}else i=n.text.length;return{line:s,column:i}},getExactLeft(e){let t=this.myContext.htmls[e.line-1];if(!t.tokens||!t.tokens.length)return 0;let s=t.fgTokens||t.tokens,i=s[0];for(let o=1;o<s.length;o++){if(!(s[o].startIndex<e.column))break;i=s[o]}let n=m()("#line_"+e.line).children(".my-code").children('span[data-column="'+i.startIndex+'"]');if(!n.length)return 0;let r=t.text.slice(i.startIndex,e.column);return n[0].offsetLeft+this.getStrWidth(r)},getToken(e,t){let s=this.myContext.htmls[e-1];if(s&&s.tokens){if(t>s.tokens.peek().startIndex)return s.tokens.peek();for(let e=0;e<s.tokens.length;e++)if(s.tokens[e].startIndex<=t&&s.tokens[e].endIndex>t)return s.tokens[e]}return null},onContextmenu(e){let t=0,s=0,i=m()(this.$refs.editor),n=i.offset();this.menuVisible=!0,this.$nextTick((()=>{t=this.$refs.menu.$el.clientWidth,s=this.$refs.menu.$el.clientHeight,s+e.clientY>n.top+this.scrollerArea.height?this.menuStyle.top=e.clientY-n.top-s+"px":this.menuStyle.top=e.clientY-n.top+"px",t+e.clientX>n.left+i[0].clientWidth?this.menuStyle.left=e.clientX-n.left-t+"px":this.menuStyle.left=e.clientX-n.left+"px",this.focus()}))},onClickMenu(e){switch(e.op){case"cut":case"copy":N.writeClipboard(this.myContext.getCopyText("cut"===e.op));break;case"paste":this.$refs.textarea.focus(),N.readClipboard().then((e=>{this.myContext.insertContent(e)}));break}this.menuVisible=!1,this.focus()},onClickAuto(e){this.myContext.replaceTip(e),this.autoTipList=null,this.focus()},onToggleFold(e){this.folder.getFoldByLine(e)?this.unFold(e):this.foldLine(e)},onContentMdown(e){if(3==e.which)return;let t=this.getPosByEvent(e),s=null;if(this.mouseStartObj={time:Date.now(),start:t},e.ctrlKey&&"ctrl"===this.cursor.multiKeyCode||e.altKey&&"alt"===this.cursor.multiKeyCode){let e=this.selecter.getRangeWithCursorPos(t);e&&this.selecter.removeRange(e),s=this.cursor.addCursorPos(t)}else s=this.cursor.setCursorPos(t),3!==e.which&&this.searcher.clearSearch();3!=e.which&&(this.fSearcher.clearActive(),this.mouseUpTime&&Date.now()-this.mouseUpTime<200&&(this.mouseStartObj.doubleClick=!0,this.searchWord())),this.mouseStartObj.cursorPos=s,this.searcher.clearSearch(!0),this.focus()},onErrorMousemove(e,t){let s=m()(`div.my-code[data-line=${t}]`).children("span.my-token-error"),i=e.clientX-m()(this.$refs.render).offset().left;for(let r=0;r<s.length;r++){let t=s.eq(r),o=t.width(),l=t[0].offsetLeft;if(i>=l&&i<=l+o){n.call(this,e,t.attr("data-key"));break}}function n(e,t){let s=m()(this.$refs.editor),i=m()(this.$refs.tip.$el),n=s.offset(),r=e.clientY-n.top,o=e.clientX-n.left;this.tipContent=this.errorMap[t],this.$nextTick((()=>{r+i[0].clientHeight>this.scrollerArea.height&&(r=this.scrollerArea.height-i[0].clientHeight),this.tipStyle={left:o+10+"px",top:r+10+"px"}}))}},onContentMmove(e){if(this.mouseStartObj&&Date.now()-this.mouseStartObj.time>100){let t=this.getPosByEvent(e);if(t&&N.comparePos(t,this.mouseStartObj.cursorPos)){let e=this.selecter.getRangeWithCursorPos(t);e&&this.selecter.removeRange(e),this.cursor.removeCursor(this.mouseStartObj.cursorPos),this.mouseStartObj.cursorPos=this.cursor.addCursorPos({line:t.line,column:t.column}),this.mouseStartObj.preRange?this.selecter.updateRange(this.mouseStartObj.preRange,{start:this.mouseStartObj.start,end:t}):this.mouseStartObj.preRange=this.selecter.addRange({start:this.mouseStartObj.start,end:t}),this.cursor.removeCursorInRange(this.mouseStartObj.preRange)}}function t(e){let t=m()(e.target),s=t.parent().attr("data-line");this.tipContent="",s&&this.onErrorMousemove(e,s)}t.call(this,e)},onContentMLeave(){this.tipContent=""},onDocumentMmove(e){let t=this,s=m()(this.$refs.scroller).offset();if(this.mouseStartObj&&Date.now()-this.mouseStartObj.time>100){let t=Math.ceil((this.scrollTop+e.clientY-s.top)/this.charObj.charHight);t=t<1?1:t,t=t>this.maxLine?this.maxLine:t,cancelAnimationFrame(this.selectMoveTimer),e.clientY>s.top+this.scrollerArea.height?i("down",e.clientY-s.top-this.scrollerArea.height):e.clientY<s.top?i("up",s.top-e.clientY):e.clientX<s.left?i("left",s.left-e.clientX,t):e.clientX>s.left+this.scrollerArea.width&&i("right",e.clientX-s.left-this.scrollerArea.width,t)}function i(e,s,i){let n=i||t.folder.getRelativeLine(t.nowCursorPos.line),r=t.nowCursorPos.column,o=0;function l(e,s){let i=n,a=r;switch(e){case"up":o+=s,i=Math.floor(o/t.charObj.charHight),i=n-i,a=0;break;case"down":o+=s,i=Math.floor(o/t.charObj.charHight),i=n+i;break;case"left":o+=s,a=Math.floor(o/t.charObj.charWidth),a=r-a;break;case"right":o+=s,a=Math.floor(o/t.charObj.charWidth),a=r+a;break}i=t.folder.getRealLine(i),i=i<1?1:i>t.maxLine?t.maxLine:i,a="down"===e?t.myContext.htmls[i-1].text.length:a<0?0:a>t.myContext.htmls[i-1].text.length?t.myContext.htmls[i-1].text.length:a,t.mouseStartObj.cursorPos=t.cursor.setCursorPos({line:i,column:a}),t.mouseStartObj.preRange=t.selecter.setRange(t.mouseStartObj.start,{line:i,column:a}),t.selectMoveTimer=requestAnimationFrame((()=>{l(e,s)}))}l(e,s)}},onDocumentMouseUp(e){cancelAnimationFrame(this.selectMoveTimer),this.mouseStartObj=null,this.mouseUpTime=Date.now(),this.$refs.searchDialog&&this.$refs.searchDialog.directBlur()},onScroll(e){this.setStartLine(e.target.scrollTop),this.scrollTop=e.target.scrollTop,this.scrollLeft=e.target.scrollLeft,this.$refs.scroller.scrollLeft=this.scrollLeft},onWheel(e){this.$refs.scroller.scrollTop=this.scrollTop+e.deltaY,this.$refs.scroller.scrollLeft=this.scrollLeft+e.deltaX},onCompositionstart(){clearTimeout(this.compositionendTimer),this.compositionstart=!0},onCompositionend(){if(this.compositionstart){let e=this.$refs.textarea.value||"";e&&(this.myContext.insertContent(e),this.autocomplete.search(),this.$refs.textarea.value="")}this.compositionendTimer=setTimeout((()=>{this.compositionstart=!1}),100)},onInput(){if(!this.compositionstart){let e=this.$refs.textarea.value||"";e&&(this.myContext.insertContent(e),this.autocomplete.search(),this.$refs.textarea.value="")}},onCopy(e){let t=window.clipboardData?"Text":"text/plain",s=e.clipboardData||window.clipboardData;s.setData(t,this.myContext.getCopyText())},onCut(e){let t=window.clipboardData?"Text":"text/plain",s=e.clipboardData||window.clipboardData;s.setData(t,this.myContext.getCopyText(!0))},onPaste(e){let t=window.clipboardData?"Text":"text/plain",s=e.clipboardData||window.clipboardData,i="";i=s.getData(t),this.myContext.insertContent(i)},onFocus(){this.showCursor()},onBlur(){this.hideCursor()},onKeyDown(e){this.shortcut.onKeyDown(e)},onSearch(e){this.fSearcher.clearSearch(),this.searchText({config:e})},onSearchNext(){this.searchText({direct:"next"})},onSearchPrev(){this.searchText({direct:"up"})},onCloseSearch(){this.focus(),this.fSelecter.activedRanges.size&&this.searcher.clone(this.fSearcher.getCacheData()),this.fSearcher.clearSearch(),this.searchVisible=!1}}},Ye=Ue,qe=(0,x.Z)(Ye,z,V,!1,null,null,null),Ge=qe.exports,Ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-title-bar my-width-100",style:{height:e.height+"px"},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[s("div",{staticClass:"my-height-100 my-center-between"},[s("div",{staticClass:"menu-bar"},[s("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("fileMenuVisible")}}},[s("span",[e._v("File")]),e.fileMenuVisible?s("Menu",{attrs:{hoverCheck:!0,menuList:e.fileMenuList,styles:{left:0,top:e._top}},on:{change:e.onFileMenuChange}}):e._e()],1),s("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("editMenuVisible")}}},[s("span",[e._v("Edit")]),e.editMenuVisible?s("Menu",{attrs:{hoverCheck:!0,menuList:e.editMenuList,styles:{left:0,top:e._top}},on:{change:e.onEditMenuChange}}):e._e()],1),s("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("selectionMenuVisible")}}},[s("span",[e._v("Selection")]),e.selectionMenuVisible?s("Menu",{attrs:{hoverCheck:!0,menuList:e.selectionMenuList,styles:{left:0,top:e._top}},on:{change:e.onSelectionMenuChange}}):e._e()],1),s("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showMemu("preferenceMenuVisible")}}},[s("span",[e._v("Preference")]),e.preferenceMenuVisible?s("Menu",{attrs:{hoverCheck:!0,menuList:e.preferenceMenuList,styles:{left:0,top:e._top}},on:{change:e.onPreferenceMenuChange}}):e._e()],1)]),"app"===e.mode?s("div",{staticClass:"bar-right"},[s("div",{staticClass:"bar-item my-hover",staticStyle:{width:"35px",height:"35px"},on:{click:e.onMinimize}},[s("span",{staticClass:"iconfont icon-zuixiaohua"})]),e.maximize?s("div",{staticClass:"bar-item my-hover",staticStyle:{width:"35px",height:"35px"},on:{click:e.onUnmaximize}},[s("span",{staticClass:"iconfont icon-huanyuan"})]):s("div",{staticClass:"bar-item my-hover",staticStyle:{width:"35px",height:"35px"},on:{click:e.onMaximize}},[s("span",{staticClass:"iconfont icon-zuidahua"})]),s("div",{staticClass:"bar-item my-hover-danger",staticStyle:{width:"35px",height:"35px"},on:{click:e.onClose}},[s("span",{staticClass:"iconfont icon-close",staticStyle:{"font-size":"18px"}})])]):e._e()])])},Xe=[],Je=class{constructor(e){this.initProperties(e)}initProperties(e){N.defineProperties(this,e,["openFile","openFolder"])}onKeyDown(e){if(e.ctrlKey)if(this.pressK)switch(this.pressK=!1,e.keyCode){case 79:e.preventDefault(),this.openFolder();break}else switch(e.keyCode){case 75:e.preventDefault(),this.pressK=!0;break;case 78:e.preventDefault(),this.openFile();break;case 79:e.preventDefault(),this.openFile(null,!0);break}}};const Qe=window.require||window.parent.require||function(){},et=Qe("@electron/remote"),tt=et&&et.getCurrentWindow();var st={name:"TitleBar",props:{height:{type:Number,default:25}},components:{Menu:v},data(){return{fileMenuVisible:!1,editMenuVisible:!1,selectionMenuVisible:!1,preferenceMenuVisible:!1,maximize:!1,mode:et?"app":"web",fileMenuList:[[{name:"New File",op:"newFile",shortcut:"Ctrl+N"}]],editMenuList:[[{name:"Undo",op:"undo",shortcut:"Ctrl+Z"},{name:"Redo",op:"redo",shortcut:"Ctrl+Y"}],[{name:"Cut",op:"cut",shortcut:"Ctrl+X"},{name:"Copy",op:"copy",shortcut:"Ctrl+C"},{name:"Paste",op:"paste",shortcut:"Ctrl+V"}],[{name:"Delete Line",op:"deleteLine",shortcut:"Ctrl+Shift+K"}],[{name:"Find",op:"find",shortcut:"Ctrl+F"},{name:"Replace",op:"replace",shortcut:"Ctrl+H"}]],selectionMenuList:[[{name:"Select All",op:"selectAll",shortcut:"Ctrl+A"}],[{name:"Copy Line Up",op:"copyLineUp",shortcut:"Ctrl+Shift+D"},{name:"Copy Line Down",op:"copyLineDown",shortcut:"Alt+Shift+Down"},{name:"Move Line Up",op:"moveLineUp",shortcut:"Ctrl+Shift+Up"},{name:"Move Line Down",op:"moveLineDown",shortcut:"Ctrl+Shift+Down"}],[{name:"Add Cursor Above",op:"addCursorAbove",shortcut:"Ctrl+Alt+Up"},{name:"Add Cursor Below",op:"addCursorBelow",shortcut:"Ctrl+Alt+Down"},{name:"Add Cursor to Line Ends",op:"addCursorLineEnds",shortcut:"Ctrl+Shift+L"},{name:"Add Next Occurence",op:"addNextOccurence",shortcut:"Ctrl+D"},{name:"Add Previous Occurence",op:"addPrevOccurence",shortcut:"Shift+D"},{name:"Select All Occurence",op:"selectAllOccurence"}],[{name:"Switch Alt+Click to Multi-Cursor",op:"switchMultiKeyCode",keyCode:"ctrl"}]],preferenceMenuList:[[{name:"Color Theme",op:"changeTheme"},{name:"Icon Theme",op:"changeIconTheme"}]]}},computed:{_top(){return this.height+2+"px"},editor(){return this.getNowEditor()},context(){return this.getNowContext()}},inject:["getNowEditor","getNowContext","openFile","openFolder"],created(){"app"===this.mode&&this.fileMenuList.push([{name:"Open File",op:"openFile",shortcut:"Ctrl+O"},{name:"Open Folder",op:"openFolder",shortcut:"Ctrl+K Ctrl+O"}]),this.shortcut=new Je(this),this.initEventBus(),m()(window).on("keydown",(e=>{this.shortcut.onKeyDown(e)}))},mounted(){"app"===this.mode&&(this.maximize=tt.isMaximized())},methods:{initEventBus(){k.$on("close-menu",(()=>{this.fileMenuVisible=!1,this.editMenuVisible=!1,this.selectionMenuVisible=!1,this.preferenceMenuVisible=!1}))},showMemu(e){k.$emit("close-menu"),this[e]=!0},onMinimize(){tt.minimize()},onMaximize(){tt.maximize(),this.maximize=!0},onUnmaximize(){tt.unmaximize(),this.maximize=!1},onClose(){tt.close()},onFileMenuChange(e){switch(e.op){case"newFile":this.openFile();break;case"openFile":this.openFile(null,!0);break;case"openFolder":this.openFolder();break}this.fileMenuVisible=!1},onEditMenuChange(e){if(this.editor){switch(e.op){case"undo":this.editor.history.undo();break;case"redo":this.editor.history.redo();break;case"cut":N.writeClipboard(this.context.getCopyText(!0));break;case"copy":N.writeClipboard(this.context.getCopyText());break;case"paste":N.readClipboard().then((e=>{this.context.insertContent(e)}));break;case"deleteLine":this.context.deleteLine();break;case"find":this.editor.openSearch();break;case"replace":this.editor.openSearch(!0);break}this.editor.focus(),this.editMenuVisible=!1}else this.editMenuVisible=!1},onSelectionMenuChange(e){if(this.editor){switch(e.op){case"selectAll":this.editor.selecter.selectAll();break;case"copyLineUp":this.context.copyLineUp();break;case"copyLineDown":this.context.copyLineDown();break;case"moveLineUp":this.context.moveLineUp();break;case"moveLineDown":this.context.moveLineDown();break;case"addCursorAbove":this.editor.cursor.addCursorAbove();break;case"addCursorBelow":this.editor.cursor.addCursorBelow();break;case"addCursorLineEnds":this.editor.cursor.addCursorLineEnds();break;case"addNextOccurence":this.editor.searchWord("down");break;case"addPrevOccurence":this.editor.searchWord("up");break;case"selectAllOccurence":this.editor.selecter.selectAllOccurence();break;case"switchMultiKeyCode":this.editor.cursor.switchMultiKeyCode(),e.keyCode=this.editor.cursor.multiKeyCode,e.name=`Switch ${"alt"===e.keyCode?"Ctrl":"Alt"}+Click to Multi-Cursor`;break}this.editor.focus(),this.selectionMenuVisible=!1}else this.selectionMenuVisible=!1},onPreferenceMenuChange(e){switch(e.op){case"changeTheme":this.$emit("change",e);break;case"changeIconTheme":this.$emit("change",e)}this.preferenceMenuVisible=!1}}},it=st,nt=(0,x.Z)(it,Ze,Xe,!1,null,null,null),rt=nt.exports,ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-status-bar my-width-100",style:{height:e.height+"px"},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[s("div",{staticClass:"my-height-100 my-center-between"},[s("div",{staticClass:"bar-left"},[e.hasEditor?s("div",{staticClass:"bar-item"},[s("span",[e._v("Line "+e._s(e.line)+", Column "+e._s(e.column))])]):e._e()]),s("div",{staticClass:"bar-right"},[e.hasEditor?s("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showTabsize.apply(null,arguments)}}},[s("span",[e._v("Tab Size:"+e._s(e.tabSize))]),s("div",{staticClass:"my-list",staticStyle:{position:"absolute",bottom:"30px"}},[e.tabsizeVisible?s("Menu",{attrs:{menuList:e.tabSizeList,styles:{position:"relative"},value:e.tabSize},on:{change:e.onTabsizeChange}}):e._e()],1)]):e._e(),e.hasEditor?s("div",{staticClass:"bar-item my-hover",on:{mousedown:function(t){return t.stopPropagation(),e.showLanguage.apply(null,arguments)}}},[s("span",[e._v(e._s(e.nowLanguage))])]):e._e()])])])},lt=[],at={name:"StatusBar",props:{height:{type:Number,default:25},languageList:Array},components:{Menu:v},data(){return{line:1,column:0,tabSize:4,language:"",tabsizeVisible:!1,hasEditor:!1,tabSizeList:[],languages:[[]],languageMap:{}}},watch:{languageList(){let e={};this.languageList.forEach((t=>{e[t.value]=t.name})),this.languages=[this.languageList],this.languageMap=e}},computed:{nowLanguage(){return this.languageMap[this.language]}},created(){this.initEventBus();for(let e=1;e<=8;e++)this.tabSizeList.push({name:`Tab Width：${e}`,value:e})},mounted(){},methods:{initEventBus(){k.$on("tab-change",(e=>{e?(this.language=e.language,this.tabSize=e.tabSize,this.line=e.line,this.column=e.column,this.hasEditor=!0):this.hasEditor=!1})),k.$on("cursor-change",(e=>{this.line=e.line,this.column=e.column})),k.$on("language-change",(e=>{this.language=e})),k.$on("close-menu",(e=>{this.tabsizeVisible=!1}))},showTabsize(){let e=this.tabsizeVisible;k.$emit("close-menu"),this.tabsizeVisible=!e},showLanguage(){k.$emit("close-menu"),this.$emit("select-langeuage")},onTabsizeChange(e){this.tabSize!=e.value&&(k.$emit("tab-size-change",e.value),this.tabSize=e.value),this.tabsizeVisible=!1}}},ht=at,ct=(0,x.Z)(ht,ot,lt,!1,null,null,null),ut=ct.exports,dt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"sideBar",staticClass:"my-side-bar",style:{width:e.width+"px"},on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.onContextmenu.apply(null,arguments)},selectstart:function(e){e.preventDefault()}}},[s("div",{staticClass:"my-height-100",staticStyle:{overflow:"hidden"}},[s("div",{staticClass:"side-bar-title my-shadow"},[e._v("EXPLORER")]),s("side-tree",{attrs:{list:e.list}})],1),s("SideBarMenu",{ref:"sideBarMenu"}),s("div",{staticClass:"my-sash-v",on:{mousedown:e.onSashBegin}})],1)},mt=[],pt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"wrap",staticClass:"side-tree-warp my-scroll-overlay",on:{scroll:e.onScroll}},[s("div",{staticStyle:{width:"100%",overflow:"hidden"}},[s("div",{staticClass:"side-tree",style:{height:e._scrollHeight}},[s("div",{staticClass:"side-tree-content",style:{top:e._top}},e._l(e.renderList,(function(t){return s("div",{staticClass:"tree-item",on:{click:function(s){return s.stopPropagation(),e.onClickItem(t)}}},[s("div",{staticClass:"tree-item-title my-center-start",class:[t.active?"my-active":""],style:{"padding-left":e._paddingLeft(t)},attrs:{title:t.path},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},["dir"===t.type?[t.open?s("span",{staticClass:"left-icon iconfont icon-down1"}):s("span",{staticClass:"left-icon iconfont icon-right"})]:e._e(),s("div",{staticClass:"tree-item-content my-center-start",class:[t.icon]},[s("span",{staticClass:"tree-item-text",staticStyle:{"margin-left":"4px"}},[e._v(e._s(t.name))])])],2)])})),0)])])])},gt=[];const ft=window.require||window.parent.require||function(){};let Ct=null;var xt={name:"SideTree",props:{list:{type:Array}},inject:["openFile"],data(){return{itemHeight:30,itemPadding:16,openedList:[],renderList:[],startLine:1,maxVisibleLines:100}},computed:{_top(){return(this.startLine-1)*this.itemHeight+"px"},_scrollHeight(){return this.openedList.length*this.itemHeight+"px"},_paddingLeft(){return function(e){return e.deep*this.itemPadding+"px"}}},watch:{list(){this.openedList=[],this.renderList=[],this.openedList=this.getRenderList(this.list,0),this.render()}},created(){this.openedList=this.getRenderList(this.list,0),this.initEventBus()},mounted(){this.maxVisibleLines=Math.ceil(this.$refs.wrap.clientHeight/this.itemHeight)+1,this.render()},methods:{initEventBus(){k.$on("icon-change",(()=>{this.openedList.forEach((e=>{e.icon=""})),this.render()})),k.$on("theme-change",(()=>{this.openedList.forEach((e=>{e.icon=""})),this.render()})),k.$on("tab-change",(e=>{let t=e&&e.path;t&&Ct&&Ct.path!==t?(Ct.active=!1,this.focusItem(t)):!t&&Ct&&(Ct.active=!1,Ct=null)}))},render(){this.renderList=this.openedList.slice(this.startLine-1,this.startLine-1+this.maxVisibleLines),this.renderList.forEach((e=>{B.nowIconData&&(e.icon=N.getIconByPath(B.nowIconData,e.path,B.nowTheme.type,e.type,e.open),e.icon=e.icon?`my-file-icon my-file-icon-${e.icon}`:"")}))},readdir(e){const t=ft("fs"),s=ft("path");return new Promise((i=>{let n=[];t.readdir(e,{encoding:"utf8"},((r,o)=>{if(r)throw r;o.forEach(((r,l)=>{let a=s.join(e,r),h=t.statSync(a),c={name:r,path:a,parentPath:e,active:!1,children:[]};h.isFile()?c.type="file":(c.type="dir",c.open=!1),n.push(c),l===o.length-1&&i(this.sortFileList(n))}))}))}))},sortFileList(e){return e.sort(((e,t)=>"dir"===e.type&&"file"===t.type?-1:"file"===e.type&&"dir"===t.type||e.name>t.name?1:e.name<t.name?-1:0)),e},getRenderList(e,t){let s=[];return i(e,t),s;function i(e,t){e.forEach((e=>{e.deep=t+1,s.push(e),e.open&&e.children.length&&i(e.children,e.deep)}))}},focusItem(e){let t=0;function s(e){for(let i=t;i<this.openedList.length;i++){let n=this.openedList[i];if(n.path===e){let e=this.$refs.wrap,t=e.scrollTop,s=e.clientHeight,r=(i+1)*this.itemHeight;t+s<r?e.scrollTop=r-s:t+this.itemHeight>r&&(e.scrollTop=r-this.itemHeight),n.active||this.onClickItem(n);break}if(e.startsWith(n.path)&&!n.open){t=i+1,this.onClickItem(n).then((()=>{s.call(this,e)}));break}}}s.call(this,e)},onClickItem(e){if(e.active)"dir"===e.type&&(e.open=!e.open,t.call(this,e));else if(Ct&&(Ct.active=!1),e.active=!0,Ct=e,"dir"===e.type){if(e.open=!e.open,!e.loaded)return this.readdir(e.path).then((s=>{e.children=s,e.loaded=!0,s.forEach((t=>{t.deep=e.deep+1})),t.call(this,e)}));t.call(this,e)}else this.openFile(e);return Promise.resolve();function t(e){if(e.children.length){if(e.open){let t=this.openedList.indexOf(e);this.openedList=this.openedList.slice(0,t+1).concat(this.getRenderList(e.children,e.deep)).concat(this.openedList.slice(t+1))}else{let t=this.openedList.indexOf(e)+1,s=t;while(s<this.openedList.length&&this.openedList[s].parentPath!=e.parentPath)s++;this.openedList.splice(t,s-t)}this.render()}}},onScroll(e){let t=e.target.scrollTop;this.startLine=Math.floor(t/this.itemHeight)+1,this.render()}}},yt=xt,vt=(0,x.Z)(yt,pt,gt,!1,null,null,null),bt=vt.exports,kt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"wrap"},[s("Menu",{ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})],1)},wt=[],Tt={components:{Menu:v},data(){return{list:[],menuList:[],menuVisible:!1,menuStyle:{left:"10px",top:"40px"}}},provide(){return{rootList:this.list}},created(){this.initEventBus()},methods:{initEventBus(){k.$on("close-menu",(()=>{this.menuVisible=!1})),k.$on("open-side-menu",(()=>{this.menuVisible=!0}))},show(e){let t=m()(this.$refs.wrap).parent();this.$nextTick((()=>{let s=0,i=0;s=this.$refs.menu.$el.clientWidth,i=this.$refs.menu.$el.clientHeight;let n=t.offset();i+e.clientY>n.top+t.height()?this.menuStyle.top=e.clientY-n.top-i+"px":this.menuStyle.top=e.clientY-n.top+"px",this.menuStyle.left=e.clientX-n.left+"px"}))},onMenuChange(e){switch(e.op){}this.menuVisible=!1}}},Lt=Tt,Pt=(0,x.Z)(Lt,kt,wt,!1,null,null,null),Et=Pt.exports,St={components:{SideTree:bt,SideBarMenu:Et},data(){return{width:300,list:[]}},provide(){return{getRootList:()=>this.list}},mounted(){this.initEvent()},methods:{initEvent(){m()(document).on("mousemove",(e=>{if(this.mouseObj){let t=this.width+=e.clientX-this.mouseObj.clientX,s=m()(this.$refs.sideBar).parent().width();t=t<10?10:t,t=t>s-10?s-10:t,this.width=t,this.mouseObj=e}})).on("mouseup",(e=>{this.mouseObj=null}))},onContextmenu(e){},onSashBegin(e){this.originMouseObj=e,this.mouseObj=e}}},_t=St,It=(0,x.Z)(_t,dt,mt,!1,null,null,null),Mt=It.exports,Bt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.overlay?s("div",{staticClass:"my-dialog-overlay"}):e._e(),s("div",{staticClass:"my-dialog",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},[s("div",{staticClass:"dialog-title"},[s("div",{domProps:{innerHTML:e._s(e.title)}}),s("span",{staticClass:"dialog-close iconfont icon-close",on:{click:e.onClose}})]),s("div",{staticClass:"dialog-content"},[e.icon?s("span",{class:[e.icon],staticStyle:{"margin-right":"5px",width:"30px",height:"30px"}}):e._e(),s("div",[s("div",{domProps:{innerHTML:e._s(e.content)}})])]),s("div",{staticClass:"dialog-btns"},[e._l(e.btns,(function(t){return s("div",{staticClass:"dialog-btn",on:{click:function(s){return e.onClickBtn(t)}}},[e._v(e._s(t.name))])})),s("div",{staticClass:"dialog-btn",on:{click:function(t){return e.onClose()}}},[e._v("取消")])],2)])])},Dt=[],Ft={name:"Dialog",props:{title:String,content:String,btns:Array,overlay:Boolean,styles:Object,icon:String,iconColor:String},data(){return{}},created(){},methods:{onClickBtn(e){e.callback()},onClose(){this.$emit("close")}}},At=Ft,$t=(0,x.Z)(At,Bt,Dt,!1,null,null,null),Nt=$t.exports,Ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],ref:"wrap"},[s("Menu",{ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onMenuChange}})],1)},Wt=[],Rt={name:"WindowMenu",components:{Menu:v},props:{styles:{type:Object}},data(){return{menuList:[],menuVisible:!1,menuStyle:{left:"50%",top:"50%"}}},created(){this.initEventBus()},methods:{initEventBus(){k.$on("close-menu",(()=>{this.menuVisible=!1})),k.$on("open-win-menu",(()=>{this.menuVisible=!0}))},onMenuChange(e){switch(e.op){}this.menuVisible=!1},show(e){this.menuVisible=!0,this.$nextTick((()=>{let t=m()(this.$refs.wrap).parent(),s=t.offset(),i=this.$refs.menu.$el.clientWidth,n=this.$refs.menu.$el.clientHeight;n+e.clientY>s.top+t[0].clientHeight?this.menuStyle.top=e.clientY-s.top-n+"px":this.menuStyle.top=e.clientY-s.top+"px",i+e.clientX>s.left+t[0].clientWidth?this.menuStyle.left=e.clientX-s.left-i+"px":this.menuStyle.left=e.clientX-s.left+"px"}))},hide(){this.menuVisible=!1}}},jt=Rt,Ht=(0,x.Z)(jt,Ot,Wt,!1,null,null,null),zt=Ht.exports,Vt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.visible?s("div",{staticClass:"my-cmd-panel my-list",on:{mousedown:function(e){e.stopPropagation()}}},[s("div",[s("div",{staticClass:"my-cmd-search"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],ref:"input",attrs:{type:"text"},domProps:{value:e.searchText},on:{input:function(t){t.target.composing||(e.searchText=t.target.value)}}})]),s("div",[s("Menu",{staticClass:"my-scroll-overlay my-scroll-mini",staticStyle:{position:"relative"},attrs:{checkable:!0,menuList:e.cmdList,value:e.value,spellcheck:"false"},on:{change:e.onChange}})],1)])]):e._e()},Kt=[],Ut=s(266),Yt=s.n(Ut);const qt=window.require||window.parent.require||function(){},Gt=qt("path"),Zt={foreground:"color",background:"background-color",fontStyle:"font-style"};var Xt=class{constructor(){}loadTheme(e){let t={tokenColors:[],colors:{}};return s.call(this,e.path).then((()=>{let s="";this.setDefaultColor(t,e.type),s=this.parseCss(t),this.insertCss(s),B.nowTheme={value:e.value,type:e.type,path:e.path},k.$emit("theme-change",e.value)}));function s(e){return N.loadJsonFile(e).then((t=>{if(t.include)return s.call(this,Gt.join(e,"../"+t.include)).then((()=>{i(t)}));i(t)}))}function i(e){e.tokenColors&&t.tokenColors.push(...e.tokenColors),e.colors&&Object.assign(t.colors,e.colors)}}loadIconTheme(e){if(!e.path)return B.nowIconTheme={value:e.value},B.nowIconData=null,k.$emit("icon-change"),Promise.resolve();let t=B.languageList,s={};return t.forEach((e=>{e.extensions&&(s[e.value]=e.extensions.map((e=>e.slice(1))))})),i.call(this,e.path);function i(t){return N.loadJsonFile(t).then((s=>{let i=s.fonts||[],r="";i.forEach((e=>{let s="@font-face{\nsrc:";e.src.forEach(((i,n)=>{let r=Gt.join(t,"../"+i.path);r=r.replace(/\\/g,"/"),s+=`url('my-file://${r}')`,s+=` format('${i.format}')`,s+=n<e-i.length-1?", ":""})),s+=";\n",s+=`font-family:${e.id};\n`,s+=`font-style:${e.style};\n`,s+=`font-weight:${e.weight};\n`,s+="}\n",r+=s,r+=".my-file-icon::before{\n",r+=`font-family:${e.id};\n`,r+=`font-size:${e.size};\n`,r+="}\n"}));for(let e in s.iconDefinitions){if(r+=`.my-file-icon-${e}::before{\n`,e=s.iconDefinitions[e],e.fontCharacter)r+="margin-top:3px;",r+=`content:"${e.fontCharacter}";\n`,r+=`color:${e.fontColor};\n`;else if(e.iconPath){let s=Gt.join(t,"../"+e.iconPath);s=s.replace(/\\/g,"/"),r+='content:"";',r+=`background-image:url(my-file://${s})`}r+="}\n"}this.insertFont(r),s.fileNames=s.fileNames||{},s.fileExtensions=s.fileExtensions||{},n(s),B.nowIconTheme={value:e.value,path:e.path},B.nowIconData=s,k.$emit("icon-change",e.value)}))}function n(e){if(e.languageIds&&r(e.languageIds,e.fileExtensions),e.light){e.light.fileExtensions=e.light.fileExtensions||{},e.light.fileNames=e.light.fileNames||{},e.light.languageIds&&r(e.light.languageIds,e.light.fileExtensions);for(let t in e.fileExtensions)e.light.fileExtensions[t]=e.light.fileExtensions[t]||e.fileExtensions[t];for(let t in e.fileNames)e.light.fileNames[t]=e.light.fileNames[t]||e.fileNames[t]}else e.light={fileExtensions:e.fileExtensions,fileNames:e.fileNames}}function r(e,t){for(let i in e){let n=s[i],r=e[i];n&&n.forEach((e=>{t[e]=r}))}}}parseCss(e){let t="",s=1,i=[],n=/\./g,r=/\s+/g;if(e.colors){t+=":root{\n";for(let s in e.colors)t+=`--my-${s.replace(/\./g,"-")}: ${e.colors[s]};\n`;t+="}\n"}return e.tokenColors&&e.tokenColors.forEach((e=>{if(!e.scope)return;let n=[],r=e.scope instanceof Array?e.scope.join(","):e.scope;r=r.replace(/\s+/g," "),r=r.split(/\s*\,\s*/),r.forEach(((e,t)=>{n.push(`.my-scope-${s}`),i.push({scopeId:s,scope:e,scopes:e.split(" "),level:o(e)}),s++})),n=n.join(","),t+=`${n}{\n`;for(let s in e.settings)t+=`${Zt[s]}:${e.settings[s]};\n`;t+="}\n"})),i.sort(((e,t)=>t.level-e.level)),i.forEach((e=>{e.scopes.length>1?e.regexp=e.scopes.join("(?:\\.[^\\.\\s]+)*?(?:\\s[^\\s]+)*? "):e.regexp=e.scope,e.regexp=new RegExp(e.regexp)})),B.scopeTokenList=i,B.colors=e.colors,t;function o(e){let t=e.match(n),s=e.match(r);return t=t&&t.length||0,s=s&&1e3*s.length||0,t+s}}insertCss(e){B.themeStyle&&B.themeStyle.remove(),B.themeStyle=document.createElement("style"),B.themeStyle.type="text/css",B.themeStyle.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(B.themeStyle)}insertFont(e){B.iconStyle&&B.iconStyle.remove(),B.iconStyle=document.createElement("style"),B.iconStyle.type="text/css",B.iconStyle.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(B.iconStyle)}setDefaultColor(e,t){let s="transparent",i="",n="",r="",o="",l="",a="light"===t||"contrast light"===t,h="contrast light"===t||"contrast dark"===t;function c(){e.colors["foreground"]||(e.colors["editor.foreground"]?e.colors["foreground"]=Yt()(e.colors["editor.foreground"]).alpha(.8).css():e.colors["foreground"]=a?"#575757":"rgb(221, 221, 221)"),e.colors["errorForeground"]||(e.colors["errorForeground"]="#ff0000"),e.colors["background"]||(e.colors["editor.background"]?e.colors["background"]=Yt()(e.colors["editor.background"]).alpha(.8).css():e.colors["background"]=a?"#fff":h?"#000":"rgba(60,60,60)"),e.colors["focusBorder"]||(e.colors["focusBorder"]=h?a?"#0f4a85":"#f38518":"#0066b8"),e.colors["contrastBorder"]||(e.colors["contrastBorder"]=h?a?"#0f4a85":"#6fc3df":s),e.colors["contrastActiveBorder"]||(e.colors["contrastActiveBorder"]=h?e.colors["focusBorder"]:s),e.colors["widget.shadow"]||(e.colors["widget.shadow"]=h?s:a?"rgba(0,0,0,0.16)":"rgba(0,0,0,0.36)"),e.colors["sash.hoverBorder"]||(e.colors["sash.hoverBorder"]=h?e.colors["contrastActiveBorder"]:e.colors["focusBorder"]),e.colors["selection.background"]||(e.colors["selection.background"]=e.colors["focusBorder"]),n=e.colors["background"],i=e.colors["foreground"],r=e.colors["focusBorder"],o=e.colors["contrastBorder"],l=e.colors["contrastActiveBorder"]}function u(){e.colors["scrollbar.shadow"]||(e.colors["scrollbar.shadow"]=s),e.colors["scrollbarSlider.background"]||(e.colors["scrollbarSlider.background"]=h?Yt()(o).alpha(.6).css():a?"rgba(100, 100, 100, 0.4)":"rgba(121, 121, 121, 0.4);"),e.colors["scrollbarSlider.hoverBackground"]||(e.colors["scrollbarSlider.hoverBackground"]=h?Yt()(o).alpha(.8).css():a?"rgba(100, 100, 100, 0.7)":"rgba(100, 100, 100, 0.7);"),e.colors["scrollbarSlider.activeBackground"]||(e.colors["scrollbarSlider.activeBackground"]=h?o:a?"rgba(0, 0, 0, 0.6)":"rgba(191, 191, 191, 0.4);")}function d(){e.colors["titleBar.border"]||(e.colors["titleBar.border"]=o),e.colors["titleBar.activeForeground"]||(e.colors["titleBar.activeForeground"]=i),e.colors["titleBar.activeBackground"]||(h?e.colors["titleBar.activeBackground"]=s:a&&(e.colors["titleBar.activeBackground"]="rgb(221, 221, 221)")),e.colors["menubar.selectionForeground"]||(e.colors["menubar.selectionForeground"]=i),e.colors["menubar.selectionBackground"]||(e.colors["menubar.selectionBackground"]=h?s:a?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)"),e.colors["menubar.selectionBorder"]||(e.colors["menubar.selectionBorder"]=h?l:s)}function m(){e.colors["dropdown.background"]||(e.colors["dropdown.background"]=h?n:a?"#eee":"rgba(37,37,38)"),e.colors["dropdown.foreground"]||(e.colors["dropdown.foreground"]=i),e.colors["dropdown.border"]||(e.colors["dropdown.border"]=o)}function p(){e.colors["list.highlightForeground"]||(e.colors["list.highlightForeground"]=h?o:i),e.colors["list.activeSelectionBackground"]||(h?e.colors["list.activeSelectionBackground"]=s:(e.colors["list.activeSelectionBackground"]="#0066b8",e.colors["list.activeSelectionForeground"]="#fff")),e.colors["list.activeSelectionForeground"]||(e.colors["list.activeSelectionForeground"]=h?i:a?"rgba(51, 51, 51)":"rgba(255, 255, 255)"),e.colors["list.hoverForeground"]||(e.colors["list.hoverForeground"]=i),e.colors["list.hoverBackground"]||(e.colors["list.hoverBackground"]=h?s:a?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)"),e.colors["quickInputList.focusBackground"]||(e.colors["list.inactiveFocusBackground"]?e.colors["quickInputList.focusBackground"]=e.colors["list.inactiveFocusBackground"]:h?e.colors["quickInputList.focusBackground"]=s:(e.colors["quickInputList.focusBackground"]="#0066b8",e.colors["quickInputList.focusForeground"]="#fff")),e.colors["quickInputList.focusForeground"]||(e.colors["list.inactiveFocusForeground"]?e.colors["quickInputList.focusForeground"]=e.colors["list.inactiveFocusForeground"]:e.colors["quickInputList.focusForeground"]=e.colors["list.activeSelectionForeground"])}function g(){e.colors["menu.foreground"]||(e.colors["menu.foreground"]=h?i:a?"rgba(51, 51, 51)":"rgba(255, 255, 255)"),e.colors["menu.background"]||(e.colors["menu.background"]=e.colors["dropdown.background"]),e.colors["menu.border"]||(e.colors["menu.border"]=o),e.colors["menu.selectionForeground"]||(e.colors["menu.selectionForeground"]=e.colors["list.activeSelectionForeground"]),e.colors["menu.selectionBackground"]||(e.colors["menu.selectionBackground"]=e.colors["list.activeSelectionBackground"]),e.colors["menu.selectionBorder"]||(e.colors["menu.selectionBorder"]=l),e.colors["menu.separatorBackground"]||(e.colors["menu.separatorBackground"]=h?o:a?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.2)")}function f(){e.colors["statusBar.foreground"]||(e.colors["statusBar.foreground"]=h?i:"#fff"),e.colors["statusBar.background"]||(e.colors["statusBar.background"]=a&&!h?"rgb(0, 122, 204)":s),e.colors["statusBar.border"]||(e.colors["statusBar.border"]=o),e.colors["statusBarItem.hoverBackground"]||(e.colors["statusBarItem.hoverBackground"]=s),e.colors["statusBarItem.activeBackground"]||(e.colors["statusBarItem.activeBackground"]=s)}function C(){e.colors["sideBar.foreground"]||(e.colors["sideBar.foreground"]=i),e.colors["sideBarTitle.foreground"]||(e.colors["sideBarTitle.foreground"]=i),e.colors["sideBar.background"]||(e.colors["sideBar.background"]=h?s:a?"#eee":"rgba(37,37,38)"),e.colors["sideBar.border"]||(e.colors["sideBar.border"]=o)}function x(){e.colors["editor.foreground"]||(e.colors["editor.foreground"]=i),e.colors["editor.background"]||(e.colors["editor.background"]=h?n:a?"#fff":"rgb(30,30,30)"),e.colors["editorLineNumber.foreground"]||(e.colors["editorLineNumber.foreground"]=Yt()(e.colors["editor.foreground"]).alpha(.5).css()),e.colors["editorLineNumber.activeForeground"]||(e.colors["editorLineNumber.activeForeground"]=e.colors["editor.foreground"]),e.colors["editorCursor.foreground"]||(e.colors["editorCursor.foreground"]=e.colors["editor.foreground"]),e.colors["editor.selectionForeground"]||h&&(e.colors["editor.selectionForeground"]=i),e.colors["editor.selectionBackground"]||(e.colors["editor.selectionBackground"]=h?r:Yt()(r).alpha(.8).css()),e.colors["editor.selectionHighlightBackground"]||(e.colors["editor.selectionHighlightBackground"]=s),e.colors["editor.selectionHighlightBorder"]||(h?e.colors["editor.selectionHighlightBorder"]=l:e.colors["editor.selectionHighlightBackground"]===s&&(e.colors["editor.selectionHighlightBorder"]=r)),e.colors["editor.findMatchBackground"]||(e.colors["editor.findMatchBackground"]=e.colors["editor.selectionBackground"]),e.colors["editor.findMatchBorder"]||(e.colors["editor.findMatchBorder"]=s),e.colors["editor.findMatchHighlightBackground"]||(e.colors["editor.findMatchHighlightBackground"]=e.colors["editor.selectionHighlightBackground"]),e.colors["editor.findMatchHighlightBorder"]||(e.colors["editor.findMatchHighlightBorder"]=e.colors["editor.selectionHighlightBorder"]),e.colors["editor.lineHighlightBackground"]||(e.colors["editor.lineHighlightBackground"]=s),e.colors["editor.lineHighlightBorder"]||(e.colors["editor.lineHighlightBackground"]!==s?e.colors["editor.lineHighlightBorder"]=s:e.colors["editor.lineHighlightBorder"]=h?l:a?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.1)"),e.colors["editorWhitespace.foreground"]||(e.colors["editorWhitespace.foreground"]=h?e.colors["editor.foreground"]:a?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.1)"),e.colors["editorIndentGuide.background"]||(e.colors["editorIndentGuide.background"]=e.colors["editorWhitespace.foreground"]),e.colors["editorBracketMatch.background"]||(e.colors["editorBracketMatch.background"]=s),e.colors["editorBracketMatch.border"]||(e.colors["editorBracketMatch.background"]===s?e.colors["editorBracketMatch.border"]=Yt()(e.colors["editor.foreground"]).alpha(.6).css():e.colors["editorBracketMatch.border"]=s)}function y(){e.colors["editorGroupHeader.tabsBackground"]||(e.colors["editorGroupHeader.tabsBackground"]=h?s:e.colors["sideBar.background"]),e.colors["editorGroupHeader.tabsBackground"]||(e.colors["editorGroupHeader.tabsBackground"]=o),e.colors["tab.border"]||(e.colors["tab.border"]=o),e.colors["tab.activeForeground"]||(e.colors["tab.activeForeground"]=h?i:a?"rgba(51, 51, 51)":"#fff"),e.colors["tab.activeBackground"]||(e.colors["tab.activeBackground"]=e.colors["editor.background"]),e.colors["tab.inactiveForeground"]||(e.colors["tab.inactiveForeground"]=h?i:a?"rgba(51, 51, 51, 0.7)":"rgba(255, 255, 255, 0.5)"),e.colors["tab.inactiveBackground"]||(e.colors["tab.inactiveBackground"]=h?s:a?"rgb(236, 236, 236)":"rgb(45, 45, 45)"),e.colors["tab.activeBorder"]||(e.colors["tab.activeBorder"]=s),e.colors["tab.activeBorderTop"]||(e.colors["tab.activeBorderTop"]=s),e.colors["tab.hoverForeground"]||(e.colors["tab.hoverForeground"]=e.colors["tab.inactiveForeground"]),e.colors["tab.hoverBackground"]||(e.colors["tab.hoverBackground"]=s),e.colors["tab.hoverBorder"]||(e.colors["tab.hoverBorder"]=s)}function v(){e.colors["editorWidget.foreground"]||(e.colors["editorWidget.foreground"]=e.colors["editor.foreground"]),e.colors["editorWidget.background"]||(e.colors["editorWidget.background"]=h?n:a?"#eee":"rgb(37,37,38)"),e.colors["editorWidget.border"]||(e.colors["editorWidget.border"]=h?o:s),e.colors["editorSuggestWidget.foreground"]||(e.colors["editorSuggestWidget.foreground"]=e.colors["editorWidget.foreground"]),e.colors["editorSuggestWidget.background"]||(e.colors["editorSuggestWidget.background"]=e.colors["editorWidget.background"]),e.colors["editorSuggestWidget.border"]||(e.colors["editorSuggestWidget.border"]=e.colors["editorWidget.border"]),e.colors["editorSuggestWidget.border"]===s?e.colors["editorSuggestWidget.shadow"]=e.colors["widget.shadow"]:e.colors["editorSuggestWidget.shadow"]=s,e.colors["editorSuggestWidget.selectedForeground"]||(e.colors["editorSuggestWidget.selectedForeground"]=e.colors["editor.foreground"]),e.colors["editorSuggestWidget.selectedBackground"]||(e.colors["editorSuggestWidget.selectedBackground"]=e.colors["quickInputList.focusBackground"]),e.colors["editorSuggestWidget.highlightForeground"]||(e.colors["editorSuggestWidget.highlightForeground"]=e.colors["list.highlightForeground"]),e.colors["editorSuggestWidget.focusHighlightForeground"]||(e.colors["editorSuggestWidget.focusHighlightForeground"]=e.colors["list.highlightForeground"])}function b(){e.colors["input.foreground"]||(e.colors["input.foreground"]=i),e.colors["input.background"]||(e.colors["input.background"]=h?s:a?"#fff":n),e.colors["input.border"]||(e.colors["input.background"]===s?e.colors["input.border"]="#0066b8":e.colors["input.border"]=s),e.colors["inputOption.activeForeground"]||(e.colors["inputOption.activeForeground"]=i),e.colors["inputOption.activeBackground"]||(e.colors["inputOption.activeBackground"]=h?s:Yt()(r).alpha(.3).css()),e.colors["inputOption.activeBorder"]||(e.colors["inputOption.activeBorder"]=s),e.colors["inputOption.hoverBackground"]||(e.colors["inputOption.hoverBackground"]=h?s:a?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)")}function k(){e.colors["toolbar.hoverBackground"]||(e.colors["toolbar.hoverBackground"]=h?s:a?"rgba(0,0,0,0.1)":"rgba(255,255,255,0.1)"),e.colors["toolbar.activeBackground"]||(e.colors["toolbar.activeBackground"]=s),e.colors["toolbar.hoverOutline"]||(e.colors["toolbar.hoverOutline"]=l)}c(),u(),d(),m(),p(),g(),f(),C(),x(),y(),v(),b(),k()}},Jt={name:"CmdPanel",components:{Menu:v},data(){return{searchText:"",cmdList:[],visible:!1}},watch:{searchText(){this.searchMenu()}},created(){this.theme=new Xt,this.initEventBus()},methods:{initEventBus(){k.$on("close-menu",(()=>{this.visible=!1})),k.$on("open-cmd-menu",(e=>{this.visible=!0,this.searchText="",this.originCmdList=e.cmdList,this.value=e.value,!this.originCmdList[0]||this.originCmdList[0]instanceof Array||(this.originCmdList=[this.originCmdList]),this.searchMenu(),requestAnimationFrame((()=>{this.$refs.input.focus()}))}))},searchMenu(){if(this.searchText){let e=[];this.originCmdList[0].forEach((t=>{let s=N.fuzzyMatch(this.searchText,t.name,!0);s&&e.push([t,s])})),e=e.sort(((e,t)=>t[1].score-e[1].score)).map((e=>e[0])),this.cmdList=[e]}else this.cmdList=this.originCmdList.slice()},onChange(e){switch(e.op){case"changeTheme":this.theme.loadTheme(e);break;case"changeIconTheme":this.theme.loadIconTheme(e);break;case"selectLanguage":k.$emit("language-change",e.value);break}this.visible=!1}}},Qt=Jt,es=(0,x.Z)(Qt,Vt,Kt,!1,null,null,null),ts=es.exports;const ss=window.require||window.parent.require||function(){},is=ss("fs"),ns=ss("path"),rs=ss("@electron/remote"),os=Le.contexts;var ls={components:{Editor:Ge,EditorBar:H,TitleBar:rt,StatusBar:ut,SideBar:Mt,Dialog:Nt,WindowMenu:zt,CmdPanel:ts},data(){return{extensionsPath:ns.join(B.dirname,"main/extensions"),languageList:[],statusHeight:30,topBarHeight:35,nowId:null,idCount:1,titleCount:1,editorList:[],dialogTilte:"",dialogContent:"",dialogVisible:!1,dialogBtns:[],dialogIcon:"",dialogIconColor:"",mode:rs?"app":"mode"}},computed:{_topBarHeight(){return this.topBarHeight+"px"},_statusHeight(){return this.statusHeight+"px"}},provide(){return{getNowEditor:()=>this.getNowEditor(),getNowContext:()=>this.getNowContext(),openFile:(e,t)=>{this.openFile(e,t)},openFolder:()=>{this.openFolder()}}},created(){if(window.globalData=B,"app"===this.mode){const e=rs.getCurrentWindow();e.on("blur",(()=>{k.$emit("close-menu")}))}this.initEventBus()},mounted(){window.test=this;const e=new Xt;e.loadTheme(B.nowTheme),e.loadIconTheme(B.nowIconTheme),this.openFile(),this.loadExtensions().then((e=>{let t=e.languages,s=e.themes,i=e.iconThemes,n=e.scopeFileList;t.push({name:"Plain Text",value:"",checked:!0}),B.languageList=t.slice(),B.scopeFileList=n.slice(),B.themes=s.slice(),B.iconThemes=i.slice(),this.languageList=t,this.checkLanguage()}))},methods:{initEventBus(){let e=e=>{this.editorList.forEach((t=>{if(e){let e=N.getIconByPath(B.nowIconData,t.path,B.nowTheme.type);t.icon=e?`my-file-icon my-file-icon-${e}`:""}else t.icon=""})),this.editorList.splice()};k.$on("icon-change",e),k.$on("theme-change",e)},onContextmenu(e){},onWindMouseDown(){k.$emit("close-menu")},onChangeTab(e){let t=this.getTabById(e);t.active?this.getNowEditor().focus():(this.editorList.forEach((e=>{e.active=!1})),t.active=!0,this.nowId=e,this.changeStatus())},onCloseTab(e){if(!this.nowId)return;let t=this.getTabById(e||this.nowId),s=this.editorList.indexOf(t);function i(){this.editorList.splice(s,1),os[e]=null,t.active?(t.active=!1,t=this.editorList[s]||this.editorList[s-1],t?this.onChangeTab(t.id):(this.nowId=null,k.$emit("tab-change",null))):this.getNowEditor().focus()}t.saved?i.call(this):this.showDialog({content:"文件尚未保存，是否先保存文件？",cancel:!0,icon:"my-icon-warn",iconColor:"rgba(255,196,0)",btns:[{name:"保存",callback:()=>{"app"===this.mode?this.onSaveFile(e).then((()=>{i.call(this),this.onDialogClose()})):(i.call(this),this.onDialogClose())}},{name:"不保存",callback:()=>{i.call(this),this.onDialogClose()}}]})},onCloseAll(){this.editorList=this.editorList.filter((e=>!e.saved)),this.editorList.forEach((e=>{this.onCloseTab(e.id)})),this.nowId=null},onCloseSaved(){this.editorList.slice().forEach((e=>{e.saved&&this.onCloseTab(e.id)}))},onCloseToLeft(e){let t=null;e=e||this.nowId;while(t=this.editorList[0]){if(t.id===e)break;this.onCloseTab(t.id)}},onCloseToRight(e){let t=null;e=e||this.nowId;while(t=this.editorList.peek()){if(t.id===e)break;this.onCloseTab(t.id)}},onMenuChange(e){let t=null;switch(e.op){case"changeTheme":t=B.themes.map((e=>e.map((e=>Object.assign({op:"changeTheme"},e))))),k.$emit("open-cmd-menu",{cmdList:t,value:B.nowTheme.value});break;case"changeIconTheme":t=B.iconThemes.map((e=>Object.assign({op:"changeIconTheme"},e))),t.push({name:"None",value:"none",op:"changeIconTheme"}),k.$emit("open-cmd-menu",{cmdList:t,value:B.nowIconTheme.value});break}},onSelectLanguage(){let e=B.languageList.map((e=>({op:"selectLanguage",name:e.name+(e.language?`（${e.language}）`:""),value:e.value})));k.$emit("open-cmd-menu",{cmdList:e,value:this.nowId&&this.getNowEditor().language})},onFileChange(e){let t=this.getTabById(e);t.saved=!1},onSaveFile(e){let t=this.getTabById(e);if("web"===this.mode)return Promise.resolve();if(!t.saved){if(t.path)return this.writeFile(t.path,os[e].getAllText()),t.saved=!0,Promise.resolve();{let s=rs.getCurrentWindow(),i={title:"请选择要保存的文件名",buttonLabel:"保存"};return rs.dialog.showSaveDialog(s,i).then((s=>{if(s.canceled||!s.filePath)return Promise.reject();t.path=s.filePath,t.name=t.path.match(/[^\\\/]+$/)[0],this.writeFile(t.path,os[e].getAllText()),t.saved=!0}))}}},onDialogClose(){this.dialogVisible=!1},openFolder(){this.choseFolder().then((e=>{e&&(this.$refs.sideBar.list=e,this.editorList=[],this.nowId=null)}))},choseFolder(){let e=rs.getCurrentWindow(),t={title:"选择文件夹",properties:["openDirectory","multiSelections"]};return rs.dialog.showOpenDialog(e,t).then((e=>{let t=[];if(!e.canceled&&e.filePaths)return e.filePaths.forEach((e=>{let s={name:e.match(/[^\\\/]+$/)[0],path:e,type:"dir",active:!1,open:!1,children:[]};t.push(Object.assign({},s))})),t})).catch((e=>{console.log(e)}))},openFile(e,t){let s=e&&this.getTabByPath(e.path);if(s)i.call(this);else{let n=-1,r=e&&e.name||"Untitled"+this.titleCount++;if(this.editorList.length&&(s=this.getTabById(this.nowId),n=this.editorList.indexOf(s)),t)this.choseFile().then((e=>{e&&(s=e[0],this.editorList=this.editorList.slice(0,n).concat(e).concat(this.editorList.slice(n)),i.call(this))}));else{if(s={id:this.idCount++,name:r,path:e&&e.path||"",icon:e&&e.icon||"",saved:!0,active:!1},!s.icon){let e=N.getIconByPath(B.nowIconData,"",B.nowTheme.type);s.icon=e?`my-file-icon my-file-icon-${e}`:""}this.editorList.splice(n+1,0,s),i.call(this)}}function i(){this.$nextTick((()=>{s&&s.path&&!s.loaded&&is.readFile(s.path,{encoding:"utf8"},((e,t)=>{if(e)throw e;this.getContext(s.id).insertContent(t),s.saved=!0,s.loaded=!0})),this.onChangeTab(s.id),this.checkLanguage()}))}},choseFile(){let e=rs.getCurrentWindow(),t={title:"选择文件",properties:["openFile","multiSelections"]};return rs.dialog.showOpenDialog(e,t).then((e=>{let t=[];if(!e.canceled&&e.filePaths)return e.filePaths.forEach((e=>{let s=N.getIconByPath(B.nowIconData,e,B.nowTheme.type);s=s?`my-file-icon my-file-icon-${s}`:"";let i={id:this.idCount++,name:e.match(/[^\\\/]+$/)[0],path:e,icon:s,saved:!0,active:!1};t.push(Object.assign({},i))})),t})).catch((e=>{console.log(e)}))},sortFileList(){this.list.sort(((e,t)=>e.type===t.type?e.name===t.name?0:e.name>t.name?1:-1:"dir"===e.type?-1:1))},showDialog(e){this.dialogTilte=e.title||"",this.dialogContent=e.content||"",this.dialogBtns=e.btns,this.dialogVisible=!0,this.dialogIconColor=e.iconColor||"",this.dialogIcon=e.icon||""},writeFile(e,t){is.writeFileSync(e,t,{encoding:"utf-8"})},changeStatus(){let e=this.changeStatus.id||1;this.changeStatus.id=e,this.$nextTick((()=>{if(this.changeStatus.id!==e)return;let t=this.getNowEditor(),s=this.getTabById(this.nowId);k.$emit("tab-change",{path:s.path,language:t.language,tabSize:t.tabSize,line:t.nowCursorPos?t.nowCursorPos.line:"?",column:t.nowCursorPos?t.nowCursorPos.column:"?"})}))},checkLanguage(){if(this.nowId){let e=this.getTabById(this.nowId),t=/\.[^\.]+$/.exec(e.name);if(!t)return;for(let s=0;s<this.languageList.length;s++){let e=this.languageList[s];if(e.extensions&&e.extensions.indexOf(t[0])>-1){this.$nextTick((()=>{k.$emit("language-change",e.value)}));break}}}},loadExtensions(){let e=[],t=[],s=[[],[],[],[]],i=[],n={};return new Promise((n=>{is.readdir(this.extensionsPath,{encoding:"utf8"},((l,a)=>{if(l)throw l;const h=[];a.forEach(((e,t)=>{let s=ns.join(this.extensionsPath,e),i=ns.join(s,"./package.json"),n=ns.join(s,"./package.nls.json");is.existsSync(n)?h.push(r(n).then((()=>o(i,s)))):is.existsSync(i)&&h.push(o(i,s))})),Promise.all(h).then((()=>{s=s.filter((e=>e.length)),n({languages:e,scopeFileList:t,themes:s,iconThemes:i})}))}))}));function r(e){return N.loadJsonFile(e).then((e=>{n=e}))}function o(e,t){return N.loadJsonFile(e).then((e=>{let s=e.contributes;l(s,t),a(s,t),h(s,t)}))}function l(s,i){let n=s.grammars,r=s.languages||[];r.map((s=>{for(let r=0;r<n.length;r++){let o=n[r];if(t.push({scopeName:o.scopeName,path:ns.join(i,o.path),configPath:s.configuration?ns.join(i,s.configuration):""}),s.id===o.language){let t=s.aliases&&s.aliases[0];t=t||o.language,e.push({name:t,value:o.language,language:o.language,scopeName:o.scopeName,path:ns.join(i,o.path),configPath:s.configuration?ns.join(i,s.configuration):"",extensions:s.extensions});break}}}))}function a(e,t){let i=e.themes||[];i.map((e=>{let i="light",n=0,r=c(e.label);switch(e.uiTheme){case"vs-dark":i="dark",n=1;break;case"hc-light":i="contrast light",n=2;break;case"hc-black":i="contrast dark",n=3;break}s[n].push({name:e.id||r,value:r||e.id,type:i,path:ns.join(t,e.path)})}))}function h(e,t){let s=e.iconThemes||[];s.map((e=>{let s=c(e.label);i.push({name:s||e.id,value:e.id||s,path:ns.join(t,e.path)})}))}function c(e){return e=e||"","%"===e[0]&&"%"===e[e.length-1]&&(e=n[e.slice(1,-1)]||e),e}},getTabById(e){for(let t=0;t<this.editorList.length;t++)if(this.editorList[t].id===e)return this.editorList[t]},getTabByPath(e){for(let t=0;t<this.editorList.length;t++)if(this.editorList[t].path===e)return this.editorList[t]},getEditor(e){let t=this.$refs[`editor${e}`];return t&&t[0]},getNowEditor(){return this.getEditor(this.nowId)},getContext(e){return os[e]},getNowContext(){return this.getContext(this.nowId)}}},as=ls,hs=(0,x.Z)(as,o,l,!1,null,null,null),cs=hs.exports,us={name:"App",components:{Window:cs}},ds=us,ms=(0,x.Z)(ds,n,r,!1,null,null,null),ps=ms.exports,gs=s(459),fs=s.n(gs);i.Z.config.productionTip=!1,i.Z.prototype.$http=fs().create({timeout:3e4,withCredentials:!0,headers:{"Content-Type":"application/json; charset=utf-8"}}),new i.Z({render:e=>e(ps)}).$mount("#app")}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,s),r.exports}s.m=e,function(){var e=[];s.O=function(t,i,n,r){if(!i){var o=1/0;for(c=0;c<e.length;c++){i=e[c][0],n=e[c][1],r=e[c][2];for(var l=!0,a=0;a<i.length;a++)(!1&r||o>=r)&&Object.keys(s.O).every((function(e){return s.O[e](i[a])}))?i.splice(a--,1):(l=!1,r<o&&(o=r));if(l){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[i,n,r]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,r,o=i[0],l=i[1],a=i[2],h=0;if(o.some((function(t){return 0!==e[t]}))){for(n in l)s.o(l,n)&&(s.m[n]=l[n]);if(a)var c=a(s)}for(t&&t(i);h<o.length;h++)r=o[h],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(c)},i=self["webpackChunkmy_editor"]=self["webpackChunkmy_editor"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(393)}));i=s.O(i)})();
//# sourceMappingURL=app.99eba9fd.js.map