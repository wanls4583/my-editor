(function(e){function t(t){for(var s,a,o=t[0],l=t[1],h=t[2],c=0,p=[];c<o.length;c++)a=o[c],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&p.push(n[a][0]),n[a]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);u&&u(t);while(p.length)p.shift()();return r.push.apply(r,h||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],s=!0,o=1;o<i.length;o++){var l=i[o];0!==n[l]&&(s=!1)}s&&(r.splice(t--,1),e=a(a.s=i[0]))}return e}var s={},n={app:0},r=[];function a(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=s,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(i,s,function(t){return e[t]}.bind(null,s));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var h=0;h<o.length;h++)t(o[h]);var u=l;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var s=i("2b0e"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("keep-alive",[i("router-view")],1)],1)},r=[],a={name:"App"},o=a,l=i("2877"),h=Object(l["a"])(o,n,r,!1,null,null,null),u=h.exports,c=i("ac56"),p=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"editor",staticClass:"my-editor-wrap",style:{"padding-bottom":e._statusHeight},on:{contextmenu:function(t){return t.preventDefault(),e.onContextmenu.apply(null,arguments)},mousedown:e.onClickEditor,selectstart:function(e){e.preventDefault()},wheel:function(t){return t.preventDefault(),e.onWheel.apply(null,arguments)}}},[i("div",{staticClass:"my-editor-nums",style:{top:e._numTop}},[i("div",{staticClass:"my-editor-num",staticStyle:{visibility:"hidden"}},[e._v(e._s(e.maxLine))]),e._l(e.renderHtmls,(function(t){return i("div",{key:t.num,staticClass:"my-editor-num",class:{"my-editor-num-active":e.cursorPos.line==t.num},style:{height:e._lineHeight,"line-height":e._lineHeight}},[i("span",{staticClass:"my-editor-icon my-editor-center",class:[e.errorMap[t.num]?"my-editor-icon-error":""],on:{mouseleave:e.onIconMouseLeave,mouseover:function(i){return e.onIconMouseOver(t.num,i)}}}),i("span",[e._v(e._s(t.num))]),t.fold?i("span",{staticClass:"my-editor-fold my-editor-center",class:["open"==t.fold?"my-editor-fold-open":"my-editor-fold-close"],on:{click:function(i){return e.onToggleFold(t.num)}}}):e._e()])}))],2),i("div",{staticClass:"my-editor-content-wrap",style:{"box-shadow":e._leftShadow}},[i("div",{ref:"scroller",staticClass:"my-editor-content-scroller",on:{mousedown:e.onScrollerMdown}},[i("div",{ref:"content",staticClass:"my-editor-content",style:{top:e._top,minWidth:e._contentMinWidth},on:{selectend:function(t){return t.preventDefault(),e.onSelectend.apply(null,arguments)}}},[e._l(e.renderHtmls,(function(t){return i("div",{key:t.num,staticClass:"my-editor-line",class:{active:e.cursorPos.line==t.num},style:{height:e._lineHeight,"line-height":e._lineHeight},attrs:{"data-line":t.num,id:"line_"+t.num}},[i("div",{staticClass:"my-editor-code",class:[t.selected?"my-editor-bg-color":"","close"==t.fold?"fold-close":""],attrs:{"data-line":t.num},domProps:{innerHTML:e._s(t.html)}}),e._startBgLineVisible(t.num)?i("div",{staticClass:"my-editor-line-bg my-editor-bg-color",style:{left:e.selectedRange.start.left+"px",width:e.selectedRange.start.width+"px"}}):e._e(),e._endBgLineVisible(t.num)?i("div",{staticClass:"my-editor-line-bg my-editor-bg-color",style:{left:e.selectedRange.end.left+"px",width:e.selectedRange.end.width+"px"}}):e._e(),e._l(t.tabNum,(function(t){return i("span",{staticClass:"my-editor-tab-line",style:{left:e._tabLineLeft(t)}})}))],2)})),i("div",{directives:[{name:"show",rawName:"v-show",value:e.cursorPos.show,expression:"cursorPos.show"}],staticClass:"my-editor-cursor",style:{height:e._lineHeight,top:e.cursorRealPos.top,left:e.cursorRealPos.left,visibility:e._cursorVisible}})],2)]),i("div",{ref:"hScroller",staticClass:"my-editor-h-scroller-wrap",on:{mousedown:function(e){e.stopPropagation()},mouseup:function(e){e.stopPropagation()},scroll:e.onHscroll}},[i("div",{staticClass:"my-editor-h-scroller",style:{width:e._hScrollWidth}})]),i("div",{ref:"vScroller",staticClass:"my-editor-v-scroller-wrap",on:{mousedown:function(e){e.stopPropagation()},mouseup:function(e){e.stopPropagation()},scroll:e.onVscroll}},[i("div",{staticClass:"my-editor-v-scroller",style:{height:e.scrollerHeight}})]),i("textarea",{ref:"textarea",staticClass:"my-editor-textarea",style:{top:e._textAreaPos.top,left:e._textAreaPos.left},on:{blur:e.onBlur,compositionend:e.onCompositionend,compositionstart:e.onCompositionstart,copy:function(t){return t.preventDefault(),e.onCopy.apply(null,arguments)},cut:function(t){return t.preventDefault(),e.onCut.apply(null,arguments)},focus:e.onFocus,input:e.onInput,keydown:e.onKeyDown,paste:function(t){return t.preventDefault(),e.onPaste.apply(null,arguments)}}})]),i("status-bar",{ref:"statusBar",attrs:{column:e.cursorPos.column+1,height:e.statusHeight,language:e.language,line:e.cursorPos.line,tabSize:e.tabSize},on:{"update:language":function(t){e.language=t},"update:tabSize":function(t){e.tabSize=t},"update:tab-size":function(t){e.tabSize=t}}}),i("panel",{directives:[{name:"show",rawName:"v-show",value:e.menuVisble,expression:"menuVisble"}],ref:"menu",attrs:{checkable:!1,menuList:e.menuList,styles:e.menuStyle},on:{change:e.onClickMenu}}),i("tip",{directives:[{name:"show",rawName:"v-show",value:e.tipContent,expression:"tipContent"}],attrs:{content:e.tipContent,styles:e.tipStyle}})],1)},d=[],f=i("ade3"),m=(i("4ec9"),i("d3b7"),i("3ca3"),i("ddb0"),i("d81d"),i("e6e1"),i("a9e3"),i("ac1f"),i("5319"),i("1276"),i("fb6a"),i("99af"),i("a434"),i("a15b"),i("53ca")),g=i("d4ec"),k=i("bee2"),v=(i("4d63"),i("c607"),i("2c3e"),i("25f0"),i("466d"),i("b0c0"),i("4de4"),"[\\$_a-zA-Z][\\$_a-zA-Z0-9]*?"),x=function(e){var t=e.value;return"end"!==e.side||"\\"!==t[0]||t.length%2!==0},y={},b={start:/`/,end:/\\*?`/,token:"js-string",plainToken:"js-string",foldName:"js-string",valid:x,childRule:{rules:[{start:/\$\{/,end:/\}/,foldName:"js-string-expr",level:1,childRule:y}]}},T={start:/(?<=^|[\(\{\[\;\,\:\?\!\+\-\*\%\=\>\<\&\|]\s*?)\//,end:/(?<=(?:\\[\s\S]|[^\\])+?)\/(?:i|m|g|im|mi|ig|gi|mg|gm|img|igm|mig|mgi|gim|gmi)?|$/i,childRule:{rules:[{regex:/\\b/,token:"js-regex-ctrl"},{regex:/\\[\s\S]/,token:"js-regex-escape"},{regex:/\?\=|\?\<\=|\?\!|\?\<\!/,token:"js-regex"},{regex:/\*|\^|\$|\?/,token:"js-regex-ctrl"},{start:/\[/,end:/(?<!\\)\]/,token:"js-regex-bracket",childRule:{rules:[{regex:/\^/,token:"js-regex-ctrl",valid:function(e){var t=e.text,i=e.index;return"["===t[i-1]&&"\\"!==t[i-2]}}]}}]},token:"js-regex"},w=[b,{start:/'/,end:/\\*?'|[^\\]$|^$/,token:"js-string",foldName:"js-single-string",valid:x},{start:/"/,end:/\\*?"|[^\\]$|^$/,token:"js-string",foldName:"js-double-string",valid:x},{start:/\/\*/,end:/\*\//,token:"js-comment",foldName:"js-comment"},{regex:/\/\/[\s\S]*$/,token:"js-comment"},T,{regex:/\bvar\b|\blet\b|\bconst\b/,token:"js-type"},{regex:/\bcontinue\b|\bbreak\b|\bswitch\b|\bcase\b|\bdo\b|\bwhile\b|\belse\b|\bfor\b|\bif\b|\bnew\b|\breturn\b|\bfrom\b|\btypeof|\beach\b|\bin\b|\bimport\b|\bexport\b|\bdefault\b|\bwith\b|\bthrow\b|\btry\b|\bcatch\b|\bfinally\b/,token:"js-key"},{regex:/\bclass\b/,token:"js-class"},{regex:/\b[A-Z][\\$_a-zA-Z0-9]*?(?=\.)/,token:"js-function-class"},{regex:/\bfunction\b/,token:"js-function"},{regex:new RegExp("(".concat(v,")\\s*?(?=\\([^\\(\\)]*?\\)\\s*?\\{)")),token:"js-function-name"},{regex:new RegExp("(?<=\\bfunction\\s+?)".concat(v)),token:"js-function-name"},{regex:new RegExp("(?<=\\bnew\\s+?)".concat(v,"(?=\\s*?\\()")),token:"js-new-class"},{regex:/(\{)|(\[)|(\()/,token:["js-lbraces","js-lbracket","js-lparen"],foldType:-1,foldName:["js-braces","js-bracket","js-paren"]},{regex:/(\})|(\])|(\))/,token:["js-rbraces","js-rbracket","js-rparen"],foldType:1,foldName:["js-braces","js-bracket","js-paren"]},{regex:/(?<=\.)(?:prototype\b|toString\b|valueOf\b|toLocaleString\b|hasOwnProperty\b|isPrototypeOf\b|propertyIsEnumerable\b)/,token:"js-local"},{regex:/\bwindow\b|\bdocument\b|\bmodule\b|\bexports\b/,token:"js-local"},{regex:/\bthis\b|\bself\b/,token:"js-this"},{regex:/\+|\-|\*|\/|\=|\!|>|<|\&|\||\?/,token:"js-oprator"},{regex:new RegExp("\\b\\d+\\b|\\b0[xX][a-zA-Z0-9]*?\\b|\\bundefined\\b|\\bnull\\b|\\btrue\\b|\\bfalse\\b|\\bNaN\\b"),token:"js-number"},{regex:new RegExp("(".concat(v,")(?=\\()")),token:"js-function-exec"},{regex:new RegExp("(?<=\\s*?class\\s*?)".concat(v,"(?=\\s*?\\{)")),token:"js-class-name"}];y.rules=w;var S={rules:w},E={start:/\/\*/,end:/\*\//,token:"css-comment",foldName:"css-comment"},I={start:/\{/,end:/\}/,token:["css-lbraces","css-rbraces"],foldName:"css-braces",childRule:{rules:[E,null,{regex:/;/,token:"css-split"},{regex:/:/,token:"css-value-start"},{regex:/[a-zA-Z][^;\:\s\}]*?(?=\s*?\:)/,token:"css-property"},{regex:/(?<=\:\s*?)[^;\:\}]+?(?=;|}|$)/,token:"css-value"},{regex:/(?:\d+(?:\.\d*)?|\.\d+)%/,token:"css-percent"}]}};I.childRule.rules[1]=I;var M={rules:[E,I,{regex:/[#\.]?[^\s\,\:\{]+/,token:function(e){return"."==e[0]?"css-selector-class":"#"==e[0]?"css-selector-id":"css-selector-tag"}},{regex:/(?<=\:)[^\s\,\:]+/,token:"css-pseudo"}]},R=[{regex:/(?<=\:(?:\s*?\w+?\s*?){0,})\d+/,token:"html-style-number"},{regex:/(?<=\:\s*?\d+)px\b/,token:"html-style-px"},{regex:/(?<=(?:\;|'|")\s*?)[^\<\>\:\;'"]+/,token:"html-style-name"},{regex:/(?<=\:\s*?)[^\<\>\:\;'"]+/,token:"html-style-value"}],P=[{start:/(?<=style\s*?\=\s*?)'/,end:/'/,token:"xml-attr-value",level:1,childRule:{rules:R}},{start:/(?<=style\s*?\=\s*?)"/,end:/"/,token:"xml-attr-value",level:1,childRule:{rules:R}},{start:/(?<=\=\s*?)"/,end:/"/,level:1,token:"xml-attr-value"},{start:/(?<=\=\s*?)'/,end:/'/,level:1,token:"xml-attr-value"},{regex:/(?<=\<\/?)\w+\b/,token:"xml-tag-name",foldName:j,foldType:D},{regex:/(?<=\=)\s*?[^\<\>\s\'\"]+\b/,token:"xml-attr-value"},{regex:/\b[^'"=\s\>\<]+\b/,token:"xml-attr-name"}],C={start:/\<(?=script\b)/,end:/\>/,token:N,childRule:{rules:P}},L={start:/\<\/(?=script\>)/,end:/\>/,token:N,childRule:{rules:[{regex:/(?<=\<\/?)\w+\b/,token:"xml-tag-name",foldName:j,foldType:D}]}},O={start:/\<(?=style\b)/,end:/\>/,token:N,childRule:{rules:P}},A={start:/\<\/(?=style\s*?\>)/,end:/\>/,token:N,childRule:{rules:[{regex:/(?<=\<\/?)\w+\b/,token:"xml-tag-name",foldName:j,foldType:D}]}};function N(e){return"start"==e.side?"/"==e.value[1]?"xml-end-tag-open":"xml-tag-open":"end"===e.side?"xml-tag-close":void 0}function j(e){return/hr|br|meta|img|link|input/i.exec(e.value)?"":e.value}function D(e){return"/"==e.text[e.index-1]?1:-1}var F={rules:[{start:C,end:L,childRule:S},{start:O,end:A,childRule:M},{start:/\<\/?(?=\w+\b)/,end:/\/?\>/,token:N,childRule:{rules:P}},{start:/\<\!\-\-/,end:/\-\-\>/,token:"xml-comment",foldName:"xml-comment"}]},_=(i("4e82"),i("2b3d"),i("9861"),i("c65b")),B=i.n(_),W=function(){function e(){Object(g["a"])(this,e)}return Object(k["a"])(e,null,[{key:"readClipboard",value:function(){return window.clipboardData?new Promise((function(e){e(clipboardData.getData("Text"))})):navigator.clipboard?navigator.clipboard.readText():void 0}},{key:"writeClipboard",value:function(e){window.clipboardData?clipboardData.setData("Text",e):navigator.clipboard&&navigator.clipboard.writeText(e)}},{key:"getNum",value:function(e){e=String(e),e=e.replace(/[^0123456789\.]/g,"");var t=/^\d+(\.\d*)?$/,i=t.exec(e),s=i&&i[0]||"";return s&&(s=Number(i[0])),s}},{key:"space",value:function(e){for(var t="",i=0;i<e;i++)t+=" ";return t}},{key:"sortNum",value:function(e){e.sort((function(e,t){return Number(e)-Number(t)}))}},{key:"getCharWidth",value:function(t){var i="------------------------------------------------------------------------------------",s="一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一",n="char-width-"+e.getUUID(),r="char-width-"+e.getUUID(),a=B()('<div class="my-editor-line">\n        <div class="my-editor-code"><span id="'.concat(n,'">').concat(i,'</span><span id="').concat(r,'">').concat(s,"</span></div>\n        </div>"));B()(t).append(a);var o=B()("#"+n)[0],l=o.scrollWidth/i.length,h=o.clientHeight,u=window.getComputedStyle?window.getComputedStyle(o,null).fontSize:o.currentStyle.fontSize,c=B()("#"+r)[0].scrollWidth/s.length;return a.remove(),{charWidth:l,fullAngleCharWidth:c,charHight:h,fontSize:u}}},{key:"getStrWidth",value:function(e,t,i,s,n,r){s=s||4,"undefined"!=typeof n&&(e=e.substr(n)),"undefined"!=typeof r&&(e=e.substring(0,r-n));var a=e.match(this.fullAngleReg),o=e.length*t,l=e.match(/\t/g);return l=l&&l.length||0,a=a&&a.length||0,a&&(a-=l,o=a*i+(e.length-a)*t,o+=l*t*(s-1)),o}},{key:"getStrExactWidth",value:function(t,i,s){if(e.getStrExactWidth.count=e.getStrExactWidth.count||0,e.getStrExactWidth.count++,!t)return 0;var n="str-width-"+e.getUUID(),r=B()('<div class="my-editor-line my-editor-temp-text" style="visibility:hidden">\n        <div class="my-editor-code" id="'.concat(n,'">').concat(l(t),"</div>\n        </div>"));B()(s).append(r);var a=B()("#"+n)[0],o=a.clientWidth;return e.getStrExactWidth.count>5?B()(".my-editor-temp-text").remove():(clearTimeout(e.getStrExactWidth.timer),e.getStrExactWidth.timer=setTimeout((function(){B()(".my-editor-temp-text").remove()}),500)),o;function l(t){for(var s=Math.floor(t.length/100),n=[],r=0;r<s;r++){var a=100*r;n.push(e.htmlTrans(t.slice(a,a+100)))}return s*=100,s<t.length&&n.push(e.htmlTrans(t.slice(s))),"<span>".concat(n.join("</span><span>").replace(/\t/g,e.space(i||4)),"</span>")}}},{key:"htmlTrans",value:function(e){return e=e.replace(/\&\#/g,"&amp;#"),e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{key:"deepAssign",value:function(e,t,i){return s(e,t,i,new Map);function s(e,t,i,n){for(var r in i=i||[],t){var a=t[r];if(!(i.indexOf(r)>-1))if("object"!==Object(m["a"])(a)||a instanceof RegExp||null===a||a.nodeName&&a.nodeType)e[r]=a;else if(n.has(a))e[r]=n.get(a);else{var o=null;a instanceof Array?(o=e[r]||[],n.set(a,o),e[r]=s(o,a,i,new Map(n))):(o=e[r]||{},n.set(a,o),e[r]=s(o,a,i,new Map(n)))}}return e}}},{key:"getUUID",value:function(e){e=e||16;for(var t="",i=0;i<e;i++)t+=(16*Math.random()|0).toString(16);return t}},{key:"comparePos",value:function(e,t){return e.line>t.line||e.line==t.line&&e.column>t.column?1:e.line==t.line&&e.column==t.column?0:-1}},{key:"createWorker",value:function(e){var t=new Blob([e]),i=window.URL.createObjectURL(t),s=new Worker(i);return s}},{key:"defineProperties",value:function(e,t,i){var s={};i.map((function(e){s[e]={get:function(){return"function"==typeof t[e]?t[e].bind(t):t[e]}}})),Object.defineProperties(e,s)}}]),e}();Array.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},String.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},W.fullAngleReg=/[\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF\uFFF9-\uFFFC]|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,W.keyCode={DELETE:46,BACKSPACE:8},W.command={DELETE:"delete",INSERT:"insert"},W.constData={PAIR_START:-1,PAIR_START_END:0,PAIR_END:1,FOLD_OPEN:1,FOLD_CLOSE:-1,DEFAULT:"default"};var z=W,H=function(){function e(t,i){Object(g["a"])(this,e),this.currentLine=1,this.languageMap=[],this.initProperties(t,i),this.initLanguage(t.language)}return Object(k["a"])(e,[{key:"initLanguage",value:function(e){switch(this.language=e,clearTimeout(this.tokenizeLines.timer),e){case"JavaScript":this.initRules(S);break;case"HTML":this.initRules(F);break;case"CSS":this.initRules(M);break;default:this.language="plain"}}},{key:"initProperties",value:function(e,t){z.defineProperties(this,e,["startLine","maxVisibleLines","maxLine","renderLine"]),z.defineProperties(this,t,["htmls"])}},{key:"initRules",value:function(e){var t=this;if(this.languageMap[this.language]){var i=this.languageMap[this.language];return this.rules=i.rules,this.ruleIdMap=i.ruleIdMap,void(this.regexMap=i.regexMap)}this.ruleId=1,this.ruleIdMap={},this.regexMap={},this.rules=z.deepAssign({},e),this.rules.rules.map((function(e){t.setRuleId(e)})),this.languageMap[this.language]={rules:this.rules,ruleIdMap:this.ruleIdMap,regexMap:this.regexMap}}},{key:"setRuleId",value:function(e){var t=this;e.ruleId=this.ruleId++,e.level=e.level||0,e.token=e.token||"",this.ruleIdMap[e.ruleId]=e,"object"!==Object(m["a"])(e.start)||e.start instanceof RegExp||(this.setRuleId(e.start),e.start.startBy=e.ruleId),"object"!==Object(m["a"])(e.end)||e.end instanceof RegExp||(this.setRuleId(e.end),e.end.endBy=e.ruleId),e.childRule&&e.childRule.rules&&(e.childRule.rules.map((function(e){!e.ruleId&&t.setRuleId(e)})),e.rules=e.childRule.rules)}},{key:"getCombRegex",value:function(e){var t=this;e=e||[];var i=e+""||"0",s=[],n={},r=[],a=0,o=null;if(this.regexMap[i])return this.regexMap[i];if(e.length>1){var l=[];while(a<e.length-1)o=this.ruleIdMap[e[a+1]],o.startBy!==e[a]&&o.endBy!==e[a]?(l.push(e[a]),a++):a++;l.push(e[a]),e=l}a=e.length-1,o=e.length&&this.ruleIdMap[e.peek()]||this.rules;while(a>=0&&this.ruleIdMap[e[a]].level>=o.level)r.push(this.getEndRegex(this.ruleIdMap[e[a]])),a--;return r.reverse(),o.rules&&o.rules.map((function(e){r.push(t.getStartRegex(e))})),r.map((function(e){var t=-1===e.side?"start":"end";n[e.ruleId]&&n[e.ruleId]===t||(s.push("?<".concat(t,"_").concat(e.ruleId,">").concat(e.regex.source)),n[e.ruleId]=t)})),this.regexMap[i]=new RegExp("(".concat(s.join(")|("),")"),"g"),this.regexMap[i]}},{key:"getStartRegex",value:function(e){return e.regex instanceof RegExp?{ruleId:e.ruleId,regex:e.regex,side:-1}:e.start instanceof RegExp?{ruleId:e.ruleId,regex:e.start,side:-1}:e.start.startBy?this.getStartRegex(e.start):void 0}},{key:"getEndRegex",value:function(e,t){return e.regex instanceof RegExp?{ruleId:e.ruleId,regex:e.regex,side:t||1}:e.end instanceof RegExp?{ruleId:e.ruleId,regex:e.end,side:t||1}:e.end.endBy?this.getStartRegex(e.end,-1):void 0}},{key:"onInsertContentBefore",value:function(e){this.onInsertContentBefore.nowLine=e}},{key:"onInsertContentAfter",value:function(e){e=this.onInsertContentBefore.nowLine,"plain"!=this.language&&(e<=this.currentLine?this.tokenizeLines(e):this.tokenizeVisibleLins())}},{key:"onDeleteContentBefore",value:function(e){}},{key:"onDeleteContentAfter",value:function(e){"plain"!=this.language&&(e<=this.currentLine?this.tokenizeLines(e):this.tokenizeVisibleLins())}},{key:"onScroll",value:function(){"plain"!=this.language&&this.tokenizeVisibleLins()}},{key:"tokenizeVisibleLins",value:function(){var e=this.currentLine;this.tokenizeLines(this.startLine),this.currentLine=e}},{key:"tokenizeLines",value:function(e,t){var i=this,s=0,n=Date.now();t=t||this.maxLine;while(e<=t){var r=this.htmls[e-1];if(!r.tokens){var a=this.tokenizeLine(e);if(r.tokens=a.tokens,r.folds=a.folds,r.html=a.tokens.map((function(e){var t=i.ruleIdMap[e.ruleId];return t&&"function"===typeof t.value?t.value(e.value):'<span class="'.concat(e.type.split(".").join(" "),'" data-column="').concat(e.column,'">').concat(z.htmlTrans(e.value),"</span>")})).join(""),this.renderLine(r.lineId),r.states+""!=a.states+""&&(r.states=a.states,r=this.htmls[e],r&&(r.tokens=null)),s++,s%10==0&&Date.now()-n>=20){e++;break}}e++}this.currentLine=e,e<=t&&(this.tokenizeLines.timer=setTimeout((function(){i.tokenizeLines(e,t)}),20))}},{key:"tokenizeLine",value:function(e){var t=null,i=null,s=0,n=0,r=[],a=(e>1&&this.htmls[e-2].states||[]).slice(0),o=this.htmls[e-1],l=this.getRegex(a),h={tokens:[],folds:[]};if(o.text.length>1e4)return{tokens:this.splitLongToken([{type:"plain",column:0,value:o.text}]),folds:[],states:a};while(t=l.exec(o.text)){var u=null,c=null,p=!0,d="";for(var f in t.groups)if(void 0!=t.groups[f]){if(d=f.split("_")[0],f=f.split("_")[1]-0,i=this.ruleIdMap[f],n<t.index){var m=o.text.slice(n,t.index);h.tokens.push({value:m,column:n,type:this.getTokenType({rule:this.ruleIdMap[a.peek()],index:n,value:m,text:o.text})}),n=t.index}if("function"===typeof i.valid&&(p=i.valid({index:t.index,text:o.text,value:t[0],side:d}),!p))break;c=this.getFold(i,t,a,h,o.text),u=this.getToken(i,t,a,r,h,o.text,d),h.tokens.push(u),c&&h.folds.push(c),n=t.index+t[0].length;break}if(!t[0])break;p&&(s=l.lastIndex,l.lastIndex=0,l=this.getRegex(a,i.ruleId),l.lastIndex=s)}if(!h.tokens.length&&a.length)h.tokens.push({value:o.text,column:0,type:this.getTokenType({rule:this.ruleIdMap[a.peek()],value:o.text,text:o.text})});else if(n<o.text.length){var g=o.text.slice(n);h.tokens.push({value:g,column:n,type:this.getTokenType({rule:this.ruleIdMap[a.peek()],index:n,value:g,text:o.text})})}return l.lastIndex=0,{tokens:this.splitLongToken(h.tokens),folds:h.folds,states:a}}},{key:"splitLongToken",value:function(e){var t=[];return e.map((function(e){if(e.value.length>100){for(var i=e.column,s=Math.floor(e.value.length/100),n=0;n<s;n++){var r=100*n;t.push({column:r+i,value:e.value.slice(r,r+100),type:e.type})}s*=100,s<e.value.length&&t.push({column:s+i,value:e.value.slice(s),type:e.type})}else t.push(e)})),t}},{key:"getToken",value:function(e,t,i,s,n,r,a){var o=t[0],l={ruleId:e.ruleId,value:o,column:t.index};if(e.start&&e.end)if("end"===a){while(i.peek()!=e.ruleId)i.pop();if(i.pop(),!e.rules)if(s.indexOf(e.ruleId)>-1){var h="";l=n.tokens.pop(),h=l.value,l.ruleId!==e.ruleId&&(l=n.tokens.pop(),h=l.value+h),l.value=h+o}else n.tokens.pop(),l.value=r.slice(0,t.index+o.length),l.column=0}else i.push(e.ruleId),s.push(e.ruleId);return l.type=this.getTokenType({rule:e,index:t.index,value:l.value,text:r,match:t,side:a}),l}},{key:"getTokenType",value:function(e){var t=e.rule,i=e.index||0,s=e.value||e.text,n=e.text,r=e.match,a=e.side||(t&&t.start&&t.end?"start":""),o="";if(!t)return"plain";if("function"==typeof t.token)o=t.token({value:s,index:i,text:n,side:a});else if(t.token instanceof Array)if(t.start&&t.end)o="start"==a?t.token[0]:t.token[1];else{var l=r&&this.getChildExpIndex(r)||-1;o=l>-1?t.token[l]:t.token.join(".")}else o=t.token;return o}},{key:"getFold",value:function(e,t,i,s,n){var r=t[0],a="",o=null;if(e.start&&e.end?(a="start",i.indexOf(e.ruleId)>-1&&(a="end"),e.foldName&&(o={start:t.index,end:t.index+r.length,value:r})):e.foldName&&e.foldType&&(o={start:t.index,end:t.index+r.length,value:r}),o){var l=this.getFoldName(e,t,n,a);if(!l)return null;o.name=l,o.type=this.getFoldType(e,t,n,a),1==o.type&&(o=h(s,o))}return o;function h(e,t){var i=e.folds;if(i)for(var s=i.length-1;s>=0;s--)if(i[s].name==t.name&&-1==i[s].type){e.folds=i.slice(0,s),t=null;break}return t}}},{key:"getFoldName",value:function(e,t,i,s){var n="";if(e.foldName instanceof Array)if(e.start&&e.end)n="start"==s?e.foldName[0]:e.foldName[1];else{var r=this.getChildExpIndex(t);r=-1==r?0:r,n=e.foldName[r]}else n="function"===typeof e.foldName?e.foldName({value:t[0],text:i,index:t.index,side:s}):e.foldName;return n}},{key:"getFoldType",value:function(e,t,i,s){var n="";if(e.foldType instanceof Array)if(e.start&&e.end)n="start"==s?e.foldType[0]:e.foldType[1];else{var r=this.getChildExpIndex(t);r=-1==r?0:r,n=e.foldType[r]}else n="function"===typeof e.foldType?e.foldType({value:t[0],text:i,index:t.index,side:s}):e.start&&e.end?"start"==s?-1:1:e.foldType;return n}},{key:"getChildExpIndex",value:function(e){if(void 0!==e.childExpIndex)return e.childExpIndex;var t=e.slice(1),i=t.filter((function(e){return e})).length>1;if(i){for(var s=0;s<t.length;s++)if(void 0!=t[s]){t=t.slice(s+1);break}for(var n=0;n<t.length;n++)if(void 0!=t[n])return e.childExpIndex=n,n}return e.childExpIndex=-1,-1}},{key:"getRegex",value:function(e,t){var i=this.ruleIdMap[t];while(i&&-1==e.indexOf(i.ruleId)&&i.endBy){while(e.peek()!=i.endBy)e.pop();e.pop(),i=this.ruleIdMap[i.endBy]}return i&&-1==e.indexOf(i.ruleId)&&i.startBy&&e.push(i.startBy),this.getCombRegex(e)}}]),e}(),$=function(){Array.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},Array.prototype._isArray=!0,String.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]};var e=["if","in","do","var","for","new","try","let","this","else","case","void","with","enum","while","break","catch","throw","const","yield","class","super","return","typeof","delete","switch","export","import","default","finally","extends","function","continue","debugger","instanceof","async","await"],t=["=",">>>=",">>=","<<=","+=","-=","*=","/=","%=","&=","|=","^="],i=["+","-","*","/","%","&","|","^","&&","||","===","==","!=","!==",">",">=","<","<=",">>",">>>","<<","instanceof","in"],s=["+","-","~","!","typeof","delete","void"],n=["{","}","[","]","(",")"],r={space:/^\s+/,number:/^(?:\d+(?:\.\d*)?|\.\d+?|0x[a-z0-9]+?)(?:e[\+\-]?\d+(?:\.\d*)?)?\b/i,identifier:/^[a-zA-Z_$][a-zA-Z0-9_$]*/,comment:/\*\//,string1:/\\*'/,string2:/\\*"/,string3:/(\\*`)|(\$\{)/,regex:/^\/(?:\\[\s\S]|[^\\])+?\//,other:/^[^\s+\-\*\/%&\|\^\=\!\>\<\~\{\}\(\)]+/},a={i:!0,m:!0,g:!0,gi:!0,gm:!0,im:!0,gim:!0},o=100;function l(e,t){this.type=e,this.label=t,this._isTokenType=!0}function h(e){this.type=e}function u(e,t,i){e=e||{},this.type=t,this.param=i,this.line=e.line,this.column=e.column,this.value=e.value,this.error=this.toString()}function c(){this.init()}function p(e){this.lexer=e,this.cacheList=[],this.backs=[],this.parseList=[],this.preToken=null,u.errors=[]}l.prototype.toString=function(){return this.label},l.NUMBER=new l(1,"number"),l.BOOLEAN=new l(2,"boolean"),l.STRING=new l(3,"string"),l.IDENTIFIER=new l(4,"identifier"),l.KEYWORD=new l(5,"keyword"),l.OPERATOR=new l(6,"operator"),l.BRACKET=new l(7,"bracket"),l.PUNCTUATOR=new l(8,"punctuator"),l.REGEXP=new l(9,"regexp"),l.OTHER=new l(10,"other"),h.UNEXPECTED=new h(1),h.EXPECTED=new h(2),h.MISS=new h(3),h.UNMATCH=new h(4),u.prototype.toString=function(){var e="",t=this.param instanceof Array?this.param:[this.param];switch(t="".concat(1===t.length?"a ":"","'").concat(t.join("'、'"),"'"),this.type){case h.UNEXPECTED:e="unexpected '".concat(this.value,"'");break;case h.EXPECTED:e="expected ".concat(t),this.value&&(e+=" and instead saw '".concat(this.value,"'"));break;case h.MISS:e="missing ".concat(t),this.value&&(e+=" before '".concat(this.value,"'"));break;case h.UNMATCH:e="unmatched '".concat(this.value,"'");break}return e},u.push=function(e){u.errors.push(e)},u.expectedIdentifier=function(e){u.push(new u(e,h.EXPECTED,l.IDENTIFIER))},u.expectedSemicolon=function(e){u.push(new u(e,h.MISS,";"))},u.expected=function(e,t){u.push(new u(e,h.EXPECTED,t))},u.unexpected=function(e){u.push(new u(e,h.UNEXPECTED))},u.unmatch=function(e){u.push(new u(e,h.UNMATCH))},c.prototype.init=function(){var r=this;u.errors=[],this.lines=[""],this.line=1,this.column=0,this.input="",this.assignOperatorMap={},this.unitOperatorMap={},this.binaryOperatorMap={},this.keywordsMap=new Map,this.bracketsMap=new Map,t.map((function(e){r.assignOperatorMap[e]=!0})),s.map((function(e){r.unitOperatorMap[e]=!0})),i.map((function(e){r.binaryOperatorMap[e]=!0})),e.map((function(e){r.keywordsMap.set(e,!0)})),n.map((function(e){r.bracketsMap.set(e,!0)}))},c.prototype.reset=function(e){this.lines=e.texts,this.line=e.line||1,this.column=e.column||0,this.input=this.lines[this.line-1].slice(this.column)},c.prototype.skip=function(e){this.input=e?this.input.slice(e):this.input,this.column+=e},c.prototype.skipLine=function(e){this.line+=e,this.column=0,this.input=this.lines[this.line-1]||""},c.prototype.hasNext=function(){return!(u.errors.length>o)&&(this.line<this.lines.length||this.line==this.lines.length&&this.lines.peek().length>this.column)},c.prototype.isVariable=function(e){return e.type==l.IDENTIFIER||"this"==e.value},c.prototype.isValue=function(e){return this.isScalar(e)||this.isVariable(e)},c.prototype.isScalar=function(e){return e.type==l.NUMBER||e.type==l.STRING||e.type==l.BOOLEAN||e.type==l.REGEXP},c.prototype.isDotAble=function(e){return e.type===l.IDENTIFIER||e.type===l.KEYWORD},c.prototype.isPostOp=function(e){return"++"===e.value||"--"===e.value},c.prototype.isPreOp=function(e){return"++"===e.value||"--"===e.value},c.prototype.isAssignOperator=function(e){return this.assignOperatorMap[e.value]},c.prototype.isUnitOperator=function(e){return this.unitOperatorMap[e.value]},c.prototype.isBinaryOperator=function(e){return this.binaryOperatorMap[e.value]},c.prototype.isKeyWord=function(e){return this.keywordsMap.has(e)},c.prototype.isBracket=function(e){return this.bracketsMap.has(e)},c.prototype.isTokenType=function(e){return e._isTokenType},c.prototype.craeteToken=function(e,t){var i=this.line,s=this.column;return i>this.lines.length&&(i=this.lines.length,s=this.lines.peek().length),{type:t,line:i,column:s,value:e}},c.prototype.scanSpace=function(){var e=null;while(!this.input.length&&this.line<this.lines.length)this.skipLine(1);e=r.space.exec(this.input),e&&(this.skip(e.index+e[0].length),e.index>=this.input.length-1&&this.scanSpace())},c.prototype.scanComment=function(){var e=null,t=null,i=null,s=null;if(this.scanSpace(),t=this.input[0],i=this.input[1],"/"===t&&"/"==i)this.skipLine(1),this.scanComment();else if("/"===t&&"*"===i){s=this.craeteToken("/*"),this.skip(2);while(this.hasNext()&&!(e=r.comment.exec(this.input)))this.skipLine(1);e?this.skip(e.index+e[0].length):u.unmatch(s)}},c.prototype.scanString=function(){var e=this,t=null,i=null,s=null;if("'"===this.input[0])return s=this.craeteToken("'",l.STRING),this.skip(1),t=n(r.string1),i=this.craeteToken("'",l.STRING),t||(u.unmatch(s),this.skipLine(1)),i;if('"'===this.input[0])return s=this.craeteToken('"',l.STRING),this.skip(1),t=n(r.string2),i=this.craeteToken('"',l.STRING),t||(u.unmatch(s),this.skipLine(1)),i;if("`"===this.input[0]){s=this.craeteToken("`",l.STRING),this.skip(1);while(this.hasNext())if(t=r.string3.exec(this.input),t&&t[2])a(t);else{if(t&&t[0].length%2!==0){this.skip(t.index+t[0].length);break}this.skipLine(1)}i=this.craeteToken("`",l.STRING),t&&t[0].length%2===1||u.unmatch(s)}return i;function n(i){return(t=i.exec(e.input))?(e.skip(t.index+t[0].length),t[0].length%2!==0||n(i)):"\\"===e.input.peek()&&(e.skipLine(1),n(i))}function a(t){var i=e.parser.preToken,s=e.parser.backs.slice(0),n=e.parser.parseList.slice(0);e.skip(t.index+t[2].length),e.parser.preToken=null,e.parser.backs=[],e.parser.parseList=[],e.parser.parseExprStmt(),e.parser.peekMatch("}"),e.parser.preToken=i,e.parser.backs=s,e.parser.parseList=n}},c.prototype.scanNunmber=function(){var e=null,t=null;return(e=r.number.exec(this.input))&&(t=this.craeteToken(e[0],l.NUMBER),this.skip(e.index+e[0].length)),t},c.prototype.scanIdentifier=function(){var e=null,t=null;return(e=r.identifier.exec(this.input))&&(t=this.craeteToken(e[0],this.isKeyWord(e[0])?l.KEYWORD:l.IDENTIFIER),"true"!==t.value&&"false"!==t.value||(t.type=l.BOOLEAN),"null"===t.value&&(t.type=l.NUMBER),this.skip(e.index+e[0].length)),t},c.prototype.scanBracket=function(){var e=null,t=this.input[0];return this.isBracket(t)&&(e=this.craeteToken(t,l.BRACKET),this.skip(1)),e},c.prototype.scanOperator=function(){var e=this.input[0],t=this.input[1],i=this.input[2],s=this.input[3],n=null;return"."==e&&"."===t&&"."===i?n=this.craeteToken("...",l.OPERATOR):">"===e&&">"===t&&">"===i&&"="===s?n=this.craeteToken(">>>=",l.OPERATOR):"="===e&&"="===t&&"="===i?n=this.craeteToken("===",l.OPERATOR):"!"===e&&"="===t&&"="===i?n=this.craeteToken("!==",l.OPERATOR):">"===e&&">"===t&&">"===i?n=this.craeteToken(">>>",l.OPERATOR):"<"===e&&"<"===t&&"="===i?n=this.craeteToken("<<=",l.OPERATOR):">"===e&&">"===t&&"="===i?n=this.craeteToken(">>=",l.OPERATOR):"="===e&&">"===t?n=this.craeteToken("=>",l.OPERATOR):e===t&&"+-<>&|*".indexOf(e)>=0?n="*"===e&&"="===i?this.craeteToken(e+t+i,l.OPERATOR):this.craeteToken(e+t,l.OPERATOR):"<>=!+-*%&|^/".indexOf(e)>=0?n="="===t?this.craeteToken(e+t,l.OPERATOR):this.craeteToken(e,l.OPERATOR):"?:.;,~".indexOf(e)>-1&&(n=this.craeteToken(e,l.OPERATOR)),n&&this.skip(n.value.length),n},c.prototype.scanOther=function(){var e=null,t=null;return(e=r.other.exec(this.input))&&(t=this.craeteToken(e[0],l.OTHER),this.skip(e.index+e[0].length)),t},c.prototype.next=function(){var e=null,t=this;return this.scanComment(),this.hasNext()&&(e=this.scanIdentifier()||this.scanBracket()||this.scanNunmber()||this.scanString()||i(),!e)?(e=this.scanOther(),e&&u.unexpected(e),this.next()):(this.preToken=e,e);function i(){var e=null;if("/"!==t.input[0]||t.preToken&&t.preToken.type!==l.OPERATOR&&"{"!==t.preToken.value&&"["!==t.preToken.value&&"("!==t.preToken.value&&"return"!==t.preToken.value)e=t.scanOperator();else{var i=r.regex.exec(t.input);if(i)e=t.craeteToken(i[0],l.REGEXP),t.skip(i.index+i[0].length);else if(e=t.craeteToken(t.input,l.REGEXP),t.skipLine(1),"/"!==e.value.peek()){var s=Object.assign({},e);s.value="/",u.unmatch(s)}}return e}},p.prototype.reset=function(e){this.backs=[],this.parseList=[],this.preToken=null,this.recovery(e),u.errors=[]},p.prototype.cache=function(){this.cacheList.length&&this.cacheList.peek().line==this.lexer.line&&this.cacheList.pop(),this.preToken&&this.cacheList.push({line:this.preToken.line,column:this.preToken.column,parseList:this.parseList.slice(0)})},p.prototype.recovery=function(e){var t=0,i=e.split("\n")||[""],s=!1;while(t<i.length&&t<this.lexer.lines.length&&i[t]===this.lexer.lines[t])t++;if(t>0){for(var n=-1,r=0;r<this.cacheList.length;r++){if(!(this.cacheList[r].line<=t))break;n=r}if(n>-1){var a=this.cacheList[n];this.parseList=a.parseList,this.cacheList=this.cacheList.slice(0,n+1),this.lexer.reset({texts:i,line:a.line,column:a.column}),this.next(),s=!0}}s||(this.cacheList=[],this.lexer.reset({texts:i}))},p.prototype.match=function(e,t){for(var i=!1,s=0;s<t.length;s++)if(this.lexer.isTokenType(t[s])){if(t[s]===e.type){i=!0;break}}else if(t[s]===e.value){i=!0;break}return i},p.prototype.next=function(e){var t=null;e=e||1;while(e>0)t=this.backs.length?this.backs.shift():this.lexer.next(),this.pre2Token=this.preToken,this.preToken=t||this.preToken,e--;return this.puted=!1,t},p.prototype.nextMatch=function(e){var t=this.next()||{},i=!1;return e=e._isArray?e:[e],i=t.value&&this.match(t,e),i||(t.value&&this.match(this.peek(),e)?u.unexpected(t):u.expected(t,e)),i},p.prototype.peek=function(e){var t=null;if(e=e||1,this.backs.length&&(t=this.backs[e-1]),!t){e-=this.backs.length;while(e>0)e--,t=this.lexer.next(),t&&this.backs.push(t)}return t||{}},p.prototype.peekMatch=function(e){var t=this.peek()||{},i=!1;return e=e._isArray?e:[e],i=t.value&&this.match(t,e),i?this.next():t.value&&this.match(this.peek(),e)?u.unexpected(t):u.expected(t,e),i},p.prototype.hasNext=function(){var e=this.peek();return e.value},p.prototype.putBack=function(){this.preToken&&!this.puted&&(this.backs.unshift(this.preToken),this.preToken=this.pre2Token,this.puted=!0)},p.prototype.skipSemicolon=function(e){e=e||1/0;while(";"===this.peek().value&&e>0)this.next(),e--},p.prototype.parse=function(){var e=this,t=0,i=Date.now();while(this.hasNext())if(this.parseStmt(),!u.errors.length&&this.cache(),++t%10===0&&Date.now()-i>200){this.parseTimer=setTimeout((function(){e.parseStmt()}),10);break}},p.prototype.parseStmt=function(e){var t=this.peek();if(e){if(";"===t.value)return}else this.preToken&&this.preToken.line==t.line&&"{"!=this.preToken.value&&"}"!=this.preToken.value&&";"!=t.value&&u.expectedSemicolon(t);switch(this.skipSemicolon(),t=this.peek(),t.type===l.IDENTIFIER&&":"===this.peek(2).value&&(this.next(2),t=this.peek()),t.value){case"var":case"let":case"const":this.parseDeclareStmt();break;case"{":":"===this.peek(3).value?this.parseObjectStmt():this.parseBlockStmt();break;case"import":this.parseImportStmt();break;case"export":this.parseExportStmt();break;case"if":this.parseIfStmt();break;case"switch":this.parseSwitchStmt();break;case"with":this.parseWithStmt();break;case"while":this.parseWhileStmt();break;case"do":this.parseDoStmt();break;case"try":this.parseTryStmt();break;case"for":this.parseForStmt();break;case"class":this.parseClassStmt();break;case"continue":case"break":this.parseControlStmt();break;case"return":this.parseReturnStmt();break;case"throw":this.parseThrowStmt();break;case"function":this.parseFunctionStmt(!0);break;default:this.parseExprStmt();break}},p.prototype.parseBlockStmt=function(e){var t=this.peek();this.peekMatch("{");while(this.hasNext()){this.skipSemicolon();var i=this.peek();if("}"===i.value||e&&e.indexOf(i.value)>-1)break;this.parseStmt(!0)}this.peekMatch("}")||"{"!==t.value||u.unmatch(t)},p.prototype.parseObjectStmt=function(){var e=this.peek(),t=null;this.peekMatch("{");while(this.hasNext()&&"}"!=this.peek().value){if("..."===this.peek().value)this.next(),"{"===this.peek().value?this.parseObjectStmt():this.nextMatch(l.IDENTIFIER);else{if("["===this.peek().value)this.next(),this.parseExpr(),this.peekMatch("]");else if(this.peek().type===l.OPERATOR)u.unexpected(this.next());else{if(!this.hasNext())break;this.next()}t=this.peek(),":"===t.value||"]"===this.preToken.value?(this.peekMatch(":"),this.parseExpr()):(this.preToken.type!==l.IDENTIFIER&&u.expected(t,":"),"("===t.value?(this.parseFunArgsStmt(),this.parseBlockStmt()):"("===this.peek(2).value&&("get"!==this.preToken.value&&"static"!==this.preToken.value&&u.expected(this.preToken,["get","static"]),this.nextMatch(l.IDENTIFIER),this.parseFunArgsStmt(),this.parseBlockStmt()))}if("}"!=this.peek().value&&!this.peekMatch(","))break}this.peekMatch("}")||"{"!==e.value||u.unmatch(e)},p.prototype.parseDeclareStmt=function(){var e=this;this.nextMatch(["var","let","const"]),i(),"="===this.peek().value&&t();while(this.hasNext()&&","===this.peek().value)this.next(),i(),"="===this.peek().value&&t();function t(){e.next(),e.parseExpr()}function i(){var t=e.peek();if("{"===t.value||"["===t.value){var i=e.next(),s="{"===t.value?"}":"]";e.nextMatch(l.IDENTIFIER);while(e.hasNext()&&e.peek().value!==s)if(e.peekMatch(","),!e.peekMatch(l.IDENTIFIER))break;e.peekMatch(s)||u.unmatch(i)}else e.nextMatch(l.IDENTIFIER)}},p.prototype.parseAssignStmt=function(e){e=e||"=",this.nextMatch(e);while(this.hasNext()){if("="===this.peek(2).value){!this.lexer.isVariable(this.next())&&u.expected(l.IDENTIFIER),this.parseAssignStmt("=");break}if(this.parseExpr(),","!==this.peek().value)break;this.next()}},p.prototype.parseImportStmt=function(){var e=null;if(this.nextMatch("import"),e=this.peek(),e.type===l.STRING)this.next();else{if("{"===e.value){this.next(),this.nextMatch(l.IDENTIFIER);while(this.hasNext()&&"}"!=this.peek().value){if(this.peekMatch(","),!this.peekMatch(l.IDENTIFIER))break;"as"===this.peek().value&&(this.next(),this.nextMatch(l.IDENTIFIER))}this.peekMatch("}")||u.unmatch(e)}else"*"===e.value?(this.next(),this.nextMatch("as"),this.nextMatch(l.IDENTIFIER)):this.nextMatch(l.IDENTIFIER);this.nextMatch("from"),this.nextMatch(l.STRING)}},p.prototype.parseExportStmt=function(){var e=null;if(this.nextMatch("export"),e=this.peek(),"function"===e.value)this.next(),this.parseFunctionStmt();else if("default"===e.value)this.next(),e=this.peek(),"function"==e.value?this.parseFunctionStmt():"class"===e.value?this.parseClassStmt():this.parseExprStmt();else if("{"===e.value){this.next(),this.nextMatch(l.IDENTIFIER);while(this.hasNext()&&"}"!=this.peek().value){if(this.peekMatch(","),!this.peekMatch(l.IDENTIFIER))break;"as"===this.peek().value&&(this.next(),this.nextMatch(l.IDENTIFIER))}this.peekMatch("}")||u.unmatch(e),"from"===this.peek().value&&(this.next(),this.nextMatch(l.STRING))}else"*"===e.value?(this.next(),"as"===this.peek().value&&(this.nextMatch("as"),this.nextMatch(l.IDENTIFIER)),this.nextMatch("from"),this.nextMatch(l.STRING)):this.parseDeclareStmt()},p.prototype.parseIfStmt=function(){var e=this,t=null;function i(){e.peekMatch("("),e.parseExprStmt(),e.peekMatch(")")}function s(){if("{"!==e.peek().value)return e.parseStmt(!0),!0;e.parseBlockStmt(["else"])}this.nextMatch("if"),this.parseList.push("if"),i(),t=s()&&";"===this.peek().value?this.peek(2):this.peek(),"else"===t.value&&(";"===this.next().value&&this.next(),"if"===this.peek().value?this.parseIfStmt():s()),this.parseList.pop()},p.prototype.parseSwitchStmt=function(){var e=null,t=null;this.parseList.push("switch"),this.nextMatch("switch"),this.peekMatch("("),this.parseExprStmt(),this.peekMatch(")"),e=this.peek(),this.peekMatch("{");while(this.hasNext()&&"}"!=this.peek().value){"default"===this.peek().value?this.nextMatch("default"):(this.nextMatch("case"),this.parseExprStmt()),this.peekMatch(":");while(this.hasNext()){if(this.skipSemicolon(),t=this.peek(),"}"===t.value||"break"===t.value||"case"===t.value||"default"===t.value)break;this.parseStmt(!0)}if("break"===this.peek().value){var i={"}":!0,case:!0,default:!0};if(this.next(),this.skipSemicolon(),t=this.peek(),!i[t.value]){u.expected(t,["case","default"]);while(this.hasNext()&&!i[this.peek().value])this.next()}}}this.peekMatch("}")||"{"!==e.value||u.unmatch(e),this.parseList.pop()},p.prototype.parseWithStmt=function(){this.nextMatch("with"),this.peekMatch("("),this.parseExprStmt(),this.peekMatch(")"),this.parseBlockStmt()},p.prototype.parseWhileStmt=function(){this.parseList.push("while"),this.nextMatch("while"),this.peekMatch("("),this.parseExprStmt(),this.peekMatch(")"),"{"===this.peek().value?this.parseBlockStmt():this.parseStmt(!0),this.parseList.pop()},p.prototype.parseDoStmt=function(){this.parseList.push("do"),this.nextMatch("do"),"{"===this.peek().value?this.parseBlockStmt():(this.parseStmt(!0),this.skipSemicolon(1)),this.nextMatch("while"),this.peekMatch("("),this.parseExprStmt(),this.peekMatch(")"),this.parseList.pop()},p.prototype.parseTryStmt=function(){var e=null;this.nextMatch("try"),this.parseBlockStmt(),e=this.peek(),"catch"!==e.value&&"finally"!==e.value?u.expected(e,["catch","finally"]):("catch"===e.value&&(this.nextMatch("catch"),this.peekMatch("("),this.nextMatch(l.IDENTIFIER),this.peekMatch(")"),this.parseBlockStmt()),"finally"===this.peek().value&&(this.next(),this.parseBlockStmt()))},p.prototype.parseForStmt=function(){this.parseList.push("for"),this.nextMatch("for"),this.peekMatch("("),"in"===this.peek(2).value||"of"===this.peek(2).value||"in"===this.peek(3).value||"of"===this.peek(3).value?("in"!==this.peek(3).value&&"of"!==this.peek(3).value||this.nextMatch(["var","let","const"]),this.nextMatch(l.IDENTIFIER),this.nextMatch(["in","of"]),this.parseExprStmt()):(["var","let","const"].indexOf(this.peek().value)>-1?this.parseDeclareStmt():";"!=this.peek().value&&this.parseExprStmt(),this.nextMatch(";"),";"!=this.peek().value&&this.parseExprStmt(),this.nextMatch(";"),")"!=this.peek().value&&this.parseExprStmt()),this.peekMatch(")"),"{"===this.peek().value?this.parseBlockStmt():this.parseStmt(!0),this.parseList.pop()},p.prototype.parseFunctionStmt=function(e){this.nextMatch("function"),(this.peek().type===l.IDENTIFIER||e)&&this.nextMatch(l.IDENTIFIER),this.parseFunArgsStmt(),this.parseBlockStmt()},p.prototype.parseClassStmt=function(){var e=null,t=!this.preToken||-1==["(","=","default"].indexOf(this.preToken.value);this.nextMatch("class"),(this.peek().type===l.IDENTIFIER||t)&&this.nextMatch(l.IDENTIFIER),"extends"===this.peek().value&&(this.next(),this.nextMatch(l.IDENTIFIER)),e=this.peek(),this.peekMatch("{");while(this.hasNext()&&"}"!=this.peek().value)"="===this.peek(2).value?(this.nextMatch(l.IDENTIFIER),this.parseAssignStmt("=")):("static"!==this.peek().value&&"get"!==this.peek().value||this.next(),this.nextMatch(l.IDENTIFIER),this.parseFunArgsStmt(),this.parseBlockStmt());this.peekMatch("}")||"{"!==e.value||u.unmatch(e)},p.prototype.parseFunArgsStmt=function(){var e=this;this.peekMatch("("),")"!=this.peek().value&&this.nextMatch(l.IDENTIFIER),"="===this.peek().value&&t();while(this.hasNext()&&","===this.peek().value)this.next(),this.nextMatch(l.IDENTIFIER),"="===this.peek().value&&t();function t(){e.next(),e.parseExpr()}this.peekMatch(")")},p.prototype.parseControlStmt=function(){var e=this.next();this.checkIn(["for","while","do","if"])?this.peek().type===l.IDENTIFIER&&this.next():u.unexpected(e)},p.prototype.parseReturnStmt=function(){var e=null;this.nextMatch("return"),e=this.peek(),";"!==e.value&&"}"!==e.value&&e.line===this.preToken.line&&this.parseExprStmt()},p.prototype.parseThrowStmt=function(){var e=null;this.nextMatch("throw"),e=this.peek(),e.line!==this.preToken.line?u.expected(e,"expression"):this.parseExprStmt()},p.prototype.checkIn=function(e){e=e instanceof Array?e:[e];for(var t=this.parseList.length;t>=0;t--)if(e.indexOf(this.parseList[t])>-1)return!0;return!1},p.prototype.parseRegex=function(){if(this.next(),this.peek().type===l.IDENTIFIER){var e=this.peek().value.toLowerCase();a[e.split("").sort().join("")]&&this.next()}},p.prototype.parseExprStmt=function(){while(this.hasNext()){if(this.parseExpr(),","!=this.peek().value)break;this.next()}},p.prototype.parseExpr=function(){this.peek();var e=null;if(this.hasNext())while(1){var t=this.parseLeftHand();if(t.end)break;if(e=this.peek(),"."===e.value&&this.preToken.type!==l.NUMBER&&(this.parseDot(),e=this.peek(),t.assignAble=!0),"["===e.value&&this.preToken.type!==l.NUMBER&&(this.parseProperty(),e=this.peek(),t.assignAble=!0),this.lexer.isPostOp(e)&&(!t.assignAble&&u.expectedIdentifier(e),t.assignAble=!1,this.next(),e=this.peek()),"?"!==e.value){if(this.lexer.isAssignOperator(e)&&t.assignAble){this.parseAssignStmt(this.peek().value);break}if(!this.lexer.isBinaryOperator(e))break;if(this.next(),!this.hasNext()){u.unexpected(this.preToken);break}}else this.nextMatch("?"),this.parseExpr(),this.peekMatch(":")}else u.expected(null,"expression")},p.prototype.parseLeftHand=function(){var e=this.preToken,t=this.next(),i=null,s=!1,n=!1,r=!1,a=!1;if(this.lexer.isUnitOperator(t)){if("!"===t.value||"delete"===t.value||"void"===t.value){var o=t.value;while(t&&t.value===o)
//!!!...
e=t,t=this.next()}else e=t,t=this.next();a=!0}return t&&this.lexer.isPreOp(t)&&(e=t,t=this.next(),t&&!this.lexer.isVariable(t)&&u.expectedIdentifier(t),r=!0),i=this.peek(),t?"function"===t.value?(this.putBack(),this.parseFunctionStmt(),"("===this.peek().value&&this.parseCallArgs()):"("===t.value?(this.putBack(),this.parseParen(),s=!0):"["===t.value?(this.putBack(),this.parseArray()):"new"===t.value?(this.putBack(),this.parseNew()):"{"==t.value?(this.putBack(),this.parseObjectStmt()):t.type===l.REGEXP?(this.putBack(),this.parseRegex()):"("!==i.value||r?"=>"!==i.value||r||a||!this.lexer.isVariable(t)?r||a||!this.lexer.isVariable(t)?this.lexer.isValue(t)||(u.expectedIdentifier(t),n=!0):s=!0:(this.parseArrorwFunction(e&&":"===e.value),n=!0):this.parseCallArgs():(u.expectedIdentifier(),n=!0),{assignAble:s,end:n}},p.prototype.parseParen=function(){var e=1,t=this.peek(),i=this.preToken;this.nextMatch("(");var s=this.peek();while(s.value&&")"!=s.value)e++,s=this.peek(e);")"===s.value&&"=>"===this.peek(e+1).value?(this.putBack(),this.parseFunArgsStmt(),this.parseArrorwFunction(i&&":"===i.value)):(this.parseExprStmt(),!this.peekMatch(")")&&u.unmatch(t),"("===this.peek().value&&this.parseCallArgs())},p.prototype.parseArray=function(){var e=null;this.nextMatch("[");while(this.hasNext()&&"]"!==this.peek().value){if("..."===this.peek().value&&this.next(),this.parseExpr(),e=this.peek(),","!==e.value)break;this.next()}this.nextMatch("]")},p.prototype.parseNew=function(){this.nextMatch("new"),"("===this.peek().value?this.parseParen():this.nextMatch([l.IDENTIFIER,l.KEYWORD]),"("===this.peek().value&&this.parseCallArgs()},p.prototype.parseArrorwFunction=function(e){this.nextMatch("=>"),"{"===this.peek().value?this.parseBlockStmt():e?this.parseExpr():this.parseExprStmt()},p.prototype.parseCallArgs=function(){if(this.peekMatch("("),")"!==this.peek().value)while(this.hasNext()){if("..."===this.peek().value?(this.next(),"{"===this.peek().value?this.parseObjectStmt():this.nextMatch(l.IDENTIFIER)):this.parseExpr(),")"===this.peek().value)break;this.peekMatch(",")}this.peekMatch(")"),"("===this.peek().value&&this.parseCallArgs()},p.prototype.parseDot=function(){var e=null;this.preToken.type!==l.NUMBER&&this.preToken.type!==l.BOOLEAN?(this.nextMatch("."),e=this.peek(),this.lexer.isDotAble(e)?(this.next(),e=this.peek(),"("===e.value&&this.parseCallArgs(),e=this.peek(),"["===e.value?this.parseProperty():"."===e.value&&this.parseDot()):u.expected(e,l.IDENTIFIER)):u.unexpected(this.next())},p.prototype.parseProperty=function(){var e=null;this.nextMatch("["),this.parseExprStmt(),this.nextMatch("]"),e=this.peek(),"("===e.value&&this.parseCallArgs(),e=this.peek(),"["===e.value?this.parseProperty():"."===e.value&&this.parseDot()};var d=new c,f=new p(d);return d.parser=f,{parse:function(e){var t=null;return clearTimeout(f.parseTimer),f.reset(e),f.parse(),t=u.errors.map((function(e){var t=e.line,i=e.column;return(!e.line||e.line>d.lines.length)&&(t=d.lines.length,i=d.lines.peek().length),{line:t,column:i,error:e.error}})).sort((function(e,t){return e.line===t.line?e.column-t.column:e.line-t.line})),console.log(t),t}}},V=function(){Array.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]},Array.prototype._isArray=!0,String.prototype.peek=function(e){if(this.length)return this[this.length-(e||1)]};var e=["{","}","[","]","(",")"],t={space:/^\s+/,tag:/^@?[a-zA-Z_\-][a-zA-Z0-9_\-]*/,propertyName:/^[\*]?[a-zA-Z_$][a-zA-Z0-9_\-$]*/,numValue:/^(?:\d+(?:\.\d*)?|\.\d+)(?:[sS%]|px|PX)?/,propertyValue:/^[+\-]?[a-zA-Z0-9_\-$%]+|^#[a-zA-Z0-9]+/,punctuator:/^[\+\-\*\~\,\:\;\.\#\=\!]/,comment:/\*\//,string1:/\\*'/,string2:/\\*"/,other:/^[\s\S]/},i=100;function s(e,t){this.type=e,this.label=t,this._isTokenType=!0}function n(e){this.type=e}function r(e,t,i){e=e||{},this.type=t,this.param=i,this.line=e.line,this.column=e.column,this.value=e.value,this.error=this.toString()}function a(){this.init()}function o(e){this.lexer=e,this.cacheList=[],this.backs=[],this.parseList=[],this.preToken=null,r.errors=[]}s.prototype.toString=function(){return this.label},s.STRING=new s(2,"string"),s.SELECTOR=new s(3,"selector"),s.PROPERTY=new s(4,"property"),s.VALUE=new s(5,"value"),s.NUM_VALUE=new s(6,"numValue"),s.BRACKET=new s(7,"bracket"),s.PUNCTUATOR=new s(8,"punctuator"),s.OTHER=new s(10,"other"),n.UNEXPECTED=new n(1),n.EXPECTED=new n(2),n.MISS=new n(3),n.UNMATCH=new n(4),r.prototype.toString=function(){var e="",t=this.param instanceof Array?this.param:[this.param];switch(t="".concat(1===t.length?"a ":"","'").concat(t.join("'、'"),"'"),this.type){case n.UNEXPECTED:e="unexpected '".concat(this.value,"'");break;case n.EXPECTED:e="expected ".concat(t),this.value&&(e+=" and instead saw '".concat(this.value,"'"));break;case n.MISS:e="missing ".concat(t),this.value&&(e+=" before '".concat(this.value,"'"));break;case n.UNMATCH:e="unmatched '".concat(this.value,"'");break}return e},r.push=function(e){r.errors.push(e)},r.expected=function(e,t){r.push(new r(e,n.EXPECTED,t))},r.unexpected=function(e){r.push(new r(e,n.UNEXPECTED))},r.unmatch=function(e){r.push(new r(e,n.UNMATCH))},a.prototype.init=function(){var t=this;r.errors=[],this.lines=[""],this.line=1,this.column=0,this.input="",this.bracketsMap=new Map,e.map((function(e){t.bracketsMap.set(e,!0)}))},a.prototype.reset=function(e){this.lines=e.texts,this.line=e.line||1,this.column=e.column||0,this.input=this.lines[this.line-1].slice(this.column)},a.prototype.skip=function(e){this.input=e?this.input.slice(e):this.input,this.column+=e},a.prototype.skipLine=function(e){this.line+=e,this.column=0,this.input=this.lines[this.line-1]||""},a.prototype.hasNext=function(){return!(r.errors.length>i)&&(this.line<this.lines.length||this.line==this.lines.length&&this.lines.peek().length>this.column)},a.prototype.isBracket=function(e){return this.bracketsMap.has(e)},a.prototype.isTokenType=function(e){return e._isTokenType},a.prototype.isProp=function(e){return e.type===s.SELECTOR||e.type===s.PROPERTY},a.prototype.isValue=function(e){return e.type===s.VALUE||e.type===s.NUM_VALUE||e.type===s.SELECTOR||e.type===s.PROPERTY||e.type===s.STRING},a.prototype.craeteToken=function(e,t){var i=this.line,s=this.column;return i>this.lines.length&&(i=this.lines.length,s=this.lines.peek().length),{type:t,line:i,column:s,value:e}},a.prototype.scanSpace=function(){var e=null;while(!this.input.length&&this.line<this.lines.length)this.skipLine(1);e=t.space.exec(this.input),e&&(this.skip(e.index+e[0].length),e.index>=this.input.length-1&&this.scanSpace())},a.prototype.scanComment=function(){var e=null,i=null,s=null,n=null;if(this.scanSpace(),i=this.input[0],s=this.input[1],"/"===i&&"*"===s){n=this.craeteToken("/*"),this.skip(2);while(this.hasNext()&&!(e=t.comment.exec(this.input)))this.skipLine(1);e?this.skip(e.index+e[0].length):r.unmatch(n)}},a.prototype.scanString=function(){var e=this,i=null,n=null,a=null;return"'"===this.input[0]?(a=this.craeteToken("'",s.STRING),this.skip(1),i=o(t.string1),n=this.craeteToken("'",s.STRING),i||(r.unmatch(a),this.skipLine(1)),n):'"'===this.input[0]?(a=this.craeteToken('"',s.STRING),this.skip(1),i=o(t.string2),n=this.craeteToken('"',s.STRING),i||(r.unmatch(a),this.skipLine(1)),n):n;function o(t){return!!e.hasNext()&&((i=t.exec(e.input))?(e.skip(i.index+i[0].length),i[0].length%2!==0||o(t)):(e.skipLine(1),o(t)))}},a.prototype.scanIdentifier=function(){var e=null,i=null;return(e=t.tag.exec(this.input))?(i=this.craeteToken(e[0],s.SELECTOR),this.skip(e.index+e[0].length)):(e=t.propertyName.exec(this.input))?(i=this.craeteToken(e[0],s.PROPERTY),this.skip(e.index+e[0].length)):(e=t.numValue.exec(this.input))?(i=this.craeteToken(e[0],s.NUM_VALUE),this.skip(e.index+e[0].length)):(e=t.propertyValue.exec(this.input))&&(i=this.craeteToken(e[0],s.VALUE),this.skip(e.index+e[0].length)),i},a.prototype.scanBracket=function(){var e=null,t=this.input[0];return this.isBracket(t)&&(e=this.craeteToken(t,s.BRACKET),this.skip(1)),e},a.prototype.scanPunctuator=function(){var e=null;return(exec=t.punctuator.exec(this.input))&&(e=this.craeteToken(exec[0],s.PUNCTUATOR),this.skip(exec.index+exec[0].length)),e},a.prototype.scanOther=function(){var e=null,i=null;return(e=t.other.exec(this.input))&&(i=this.craeteToken(e[0],s.OTHER),this.skip(e.index+e[0].length)),i},a.prototype.next=function(){var e=null;return this.scanComment(),this.hasNext()&&(e=this.scanIdentifier()||this.scanBracket()||this.scanString()||this.scanPunctuator(),!e)?(e=this.scanOther(),e&&r.unexpected(e),this.next()):(this.preToken=e,e)},o.prototype.reset=function(e){this.backs=[],this.parseList=[],this.preToken=null,this.recovery(e),r.errors=[]},o.prototype.cache=function(){this.cacheList.length&&this.cacheList.peek().line==this.lexer.line&&this.cacheList.pop(),this.preToken&&this.cacheList.push({line:this.preToken.line,column:this.preToken.column,parseList:this.parseList.slice(0)})},o.prototype.recovery=function(e){var t=0,i=e.split("\n")||[""],s=!1;while(t<i.length&&t<this.lexer.lines.length&&i[t]===this.lexer.lines[t])t++;if(t>0){for(var n=-1,r=0;r<this.cacheList.length;r++){if(!(this.cacheList[r].line<=t))break;n=r}if(n>-1){var a=this.cacheList[n];this.parseList=a.parseList,this.cacheList=this.cacheList.slice(0,n+1),this.lexer.reset({texts:i,line:a.line,column:a.column}),this.next(),s=!0}}s||(this.cacheList=[],this.lexer.reset({texts:i}))},o.prototype.match=function(e,t){for(var i=!1,s=0;s<t.length;s++)if(this.lexer.isTokenType(t[s])){if(t[s]===e.type){i=!0;break}}else if(t[s]===e.value){i=!0;break}return i},o.prototype.next=function(e){var t=null;e=e||1;while(e>0)t=this.backs.length?this.backs.shift():this.lexer.next(),this.pre2Token=this.preToken,this.preToken=t||this.preToken,e--;return this.puted=!1,t},o.prototype.nextMatch=function(e){var t=this.next()||{},i=!1;return e=e._isArray?e:[e],i=t.value&&this.match(t,e),i||(t.value&&this.match(this.peek(),e)?r.unexpected(t):r.expected(t,e)),i},o.prototype.peek=function(e){var t=null;if(e=e||1,this.backs.length&&(t=this.backs[e-1]),!t){e-=this.backs.length;while(e>0)e--,t=this.lexer.next(),t&&this.backs.push(t)}return t||{}},o.prototype.peekMatch=function(e){var t=this.peek()||{},i=!1;return e=e._isArray?e:[e],i=t.value&&this.match(t,e),i?this.next():t.value&&this.match(this.peek(),e)?r.unexpected(t):r.expected(t,e),i},o.prototype.hasNext=function(){var e=this.peek();return e.value},o.prototype.putBack=function(){this.preToken&&!this.puted&&(this.backs.unshift(this.preToken),this.preToken=this.pre2Token,this.puted=!0)},o.prototype.skipSemicolon=function(e){e=e||1/0;while(";"===this.peek().value&&e>0)this.next(),e--},o.prototype.parse=function(){var e=this,t=0,i=Date.now();while(this.hasNext())if(this.parseStmt(),!r.errors.length&&this.cache(),++t%10===0&&Date.now()-i>200){this.parseTimer=setTimeout((function(){e.parseStmt()}),10);break}},o.prototype.parseStmt=function(){var e=this.peek();"@import"!==e.value?"@charset"!==e.value?"@keyframes"!==e.value&&"@-webkit-keyframes"!==e.value?"@media"!==e.value?(this.parseSelector(),"{"===this.peek().value&&this.parseBlock()):this.parseMedia():this.parseKeyFrames():this.parseCharset():this.parseImport()},o.prototype.parseImport=function(){this.nextMatch("@import"),this.nextMatch(s.STRING),["all","print","screen","speech"].indexOf(this.peek().value)>-1&&this.parseMedia(!0),this.peekMatch(";")},o.prototype.parseCharset=function(){this.nextMatch("@charset"),this.nextMatch(s.STRING),this.peekMatch(";")},o.prototype.parseMedia=function(e){var t=null;!e&&this.nextMatch("@media"),t=this.peek(),"not"!==t.value&&"only"!==t.value||this.next(),this.nextMatch(["all","print","screen","speech"]);while(this.hasNext()){if(t=this.peek(),"and"!==t.value&&"or"!==t.value)break;this.next(),this.nextMatch("("),t=this.next()||{},this.lexer.isProp(t)||r.expected(t,s.PROPERTY),")"!=this.peek().value&&(this.peekMatch(":"),t=this.next()||{},this.lexer.isValue(t)||r.expected(t,s.VALUE),this.peekMatch(")"))}e||(this.peekMatch("{"),this.parseStmt(),this.peekMatch("}"))},o.prototype.parseKeyFrames=function(){var e=null;this.nextMatch(["@keyframes","@-webkit-keyframes"]),e=this.next(),e.type!==s.SELECTOR&&r.expected(e,"name"),this.peekMatch("{");while(this.hasNext()){if("}"===this.peek().value)break;this.nextMatch(s.NUM_VALUE),this.parseBlock()}this.peekMatch("}")},o.prototype.parseSelector=function(){var e=this.next()||{};"."===e.value||"#"===e.value?this.nextMatch(s.SELECTOR):"["===e.value?(this.nextMatch(s.SELECTOR),"]"!==this.peek().value?(this.nextMatch("="),e=this.peek(),this.lexer.isValue(e)?this.next():r.expected(e,"value"),this.peekMatch("]")):this.next()):":"===e.value?(":"===this.peek().value&&this.next(),this.nextMatch(s.SELECTOR),"("===this.peek().value&&(this.next(),this.parseSelector(),this.peekMatch(")"))):"*"!==e.value&&(this.putBack(),this.nextMatch(s.SELECTOR)),this.hasNext()&&"{"!==this.peek().value&&(e=this.peek(),("+"===e.value||"~"===e.value||","===e.value)&&this.next(),this.parseSelector())},o.prototype.parseBlock=function(){var e=this;this.nextMatch("{");while(this.hasNext()){if("}"===this.peek().value)break;t(),this.peekMatch(":"),i(),"}"!==this.peek().value&&this.peekMatch(";")}function t(){var t=e.next();t.type!==s.SELECTOR&&t.type!==s.PROPERTY&&r.expected(s.PROPERTY)}function i(){var t=!1;while(e.hasNext()){var n=e.peek();if(";"===n.value||"}"===n.value||")"===n.value)break;if(n=e.next(),e.lexer.isValue(n))t=!0;else if("("===n.value){var a=1;while(e.hasNext()&&a){var o=e.next()||{};")"===o.value?a--:"("===o.value&&a++}a&&e.peekMatch(")")}else{if(t&&","===n.value){i();break}if(t&&"!"===n.value){e.peekMatch("important");break}r.expected(n,s.VALUE)}}return t||r.expected(null,s.VALUE),t}this.peekMatch("}")};var l=new a,h=new o(l);return l.parser=h,{parse:function(e){var t=null;return clearTimeout(h.parseTimer),h.reset(e),h.parse(),t=r.errors.map((function(e){var t=e.line,i=e.column;return(!e.line||e.line>l.lines.length)&&(t=l.lines.length,i=l.lines.peek().length),{line:t,column:i,error:e.error}})).sort((function(e,t){return e.line===t.line?e.column-t.column:e.line-t.line})),console.log(t),t}}};function U(){var e={js:/(?<!\<[^\>]*?['"][^\>]*?)(\<script(?:\s[^\>]*?)?\>)([\s\S]*?)\<\/script\>/,css:/(?<!\<[^\>]*?['"][^\>]*?)(\<style(?:\s[^\>]*?)?\>)([\s\S]*?)\<\/style\>/,enter:/\n/g,column:/\n[^\n]*?$/,comment:/\<\!--[\s\S]*?--\>/};function t(){}t.prototype.reset=function(e){this.text=e,this.comments=[]},t.prototype.parseComentRange=function(){var t=null,i={line:1,column:0,index:0},s=this.text,n=null,r=null;while(t=e.comment.exec(s))this.setLineColumn(s.slice(0,t.index),i),i.index+=t.index,n=Object.assign({},i),this.setLineColumn(t[0],i),i.index+=t[0].length,r=Object.assign({},i),s=this.text.slice(i.index),this.comments.push({start:n,end:r})},t.prototype.setLineColumn=function(t,i){var s=t.match(e.enter);s=s&&s.length||0,i.line+=s,s?i.column=e.column.exec(t)[0].length:i.column+=t.length},t.prototype.parse=function(){return this.parseComentRange(),i.parseJs().concat(i.parseCss())},t.prototype.parseJs=function(){var t=jsParser().parse;return this._parse(e.js,t)},t.prototype.parseCss=function(){var t=cssParser().parse;return this._parse(e.css,t)},t.prototype._parse=function(e,t){var i=null,s={line:1,column:0,index:0},n=this.text,r=[];while(i=e.exec(n))if(this.setLineColumn(n.slice(0,i.index),s),s.index+=i.index,this.checkInComment(s)){if(this.setLineColumn(i[1],s),s.index+=i[1].length,i[2]){var a=t(i[2]);a.map((function(e){1==e.line&&(e.column+=s.column),e.line+=s.line-1})),r=r.concat(a)}this.setLineColumn(i[0].slice(i[1].length),s),s.index+=i[0].slice(i[1].length).length,n=this.text.slice(s.index)}else n=this.text.slice(s.index);return r},t.prototype.checkInComment=function(e){for(var t=0;t<this.comments.length;t++){var i=this.comments[t];if(s(i.start,e)<0&&s(i.end,e)>0)return e.line=i.end.line,e.column=i.end.column,e.index=i.end.index,!1}return!0;function s(e,t){return e.line===t.line?e.column-t.column:e.line-t.line}};var i=new t;return{parse:function(e){var t=null;return i.reset(e),t=i.parse(),t.sort((function(e,t){return e.line===t.line?e.column-t.column:e.line-t.line})),t}}}var X=new Function("function jsParser".concat($.toString().slice(8),"\nfunction cssParser").concat(V.toString().slice(8),"\n").concat(U.toString(),"\nreturn htmlLint();\n")),G=function(){function e(t,i){Object(g["a"])(this,e),this.parseId=1,this.initProperties(t,i),this.initLanguage(t.language)}return Object(k["a"])(e,[{key:"initProperties",value:function(e,t){z.defineProperties(this,t,["htmls"]),z.defineProperties(this,e,["setErrorMap"])}},{key:"initLanguage",value:function(e){var t=this;if(this.language!==e){switch(this.language=e,this.worker&&this.worker.terminate(),this.worker=null,this.setErrorMap({}),e){case"HTML":this.worker=this.createWorker(X);break;case"JavaScript":this.worker=this.createWorker($);break;case"CSS":this.worker=this.createWorker(V);break}this.worker&&(this.worker.onmessage=function(e){var i=e.data.parseId,s=e.data.errors,n=0,r={};if(t.parseId==i){while(n<s.length){var a=s[n].line,o=[];while(n<s.length&&s[n].line===a)o.push(s[n].error),n++;a=a||t.htmls.length,r[a]=o.join("<br>")}t.setErrorMap(r)}},this.parse())}}},{key:"createWorker",value:function(e){var t=e.toString().replace(/^[^\)]+?\)/,""),i="function fun()".concat(t,"\n            let parser = fun();\n            self.onmessage = function(e) {\n                var parseId = e.data.parseId;\n                var errors = parser.parse(e.data.text);\n                self.postMessage({\n                    errors: errors,\n                    parseId: parseId\n                });\n            }");return z.createWorker(i)}},{key:"onInsertContentBefore",value:function(e){}},{key:"onInsertContentAfter",value:function(e){var t=this;this.worker&&(clearTimeout(this.parseTimer),this.parseTimer=setTimeout((function(){t.parse()}),300))}},{key:"onDeleteContentBefore",value:function(e){}},{key:"onDeleteContentAfter",value:function(e){var t=this;this.worker&&(clearTimeout(this.parseTimer),this.parseTimer=setTimeout((function(){t.parse()}),300))}},{key:"parse",value:function(){var e=this.htmls.map((function(e){return e.text})).join("\n");this.parseId++,this.worker.postMessage({text:e,parseId:this.parseId})}}]),e}(),Y=function(){function e(t,i){Object(g["a"])(this,e),this.editorFunObj={},this.initProperties(t,i)}return Object(k["a"])(e,[{key:"initProperties",value:function(e,t){z.defineProperties(this.editorFunObj,e,["unFold"]),z.defineProperties(this,e,["selectedRange"]),z.defineProperties(this,t,["htmls","folds","foldMap"])}},{key:"onInsertContentBefore",value:function(e){var t=this;if(this.folds.length){var i=this.findFoldIndex(e),s=[];while(i<this.folds.length&&this.folds[i].start.line<e&&this.folds[i].end.line>e)s.push(this.folds[i].start.line),i++;s.map((function(e){t.editorFunObj.unFold(e)}))}}},{key:"onInsertContentAfter",value:function(e){}},{key:"onDeleteContentBefore",value:function(e){if(this.selectedRange)for(var t=this.selectedRange.start,i=this.selectedRange.end,s=t.line;s<i.line;s++)this.editorFunObj.unFold(s)}},{key:"onDeleteContentAfter",value:function(e){var t=this;if(this.folds.length){var i=this.findFoldIndex(e),s=[];while(i<this.folds.length&&this.folds[i].start.line<e&&this.folds[i].end.line>e)s.push(this.folds[i].start.line),i++;s.map((function(e){t.editorFunObj.unFold(e)}))}}},{key:"findFoldIndex",value:function(e){var t=0,i=this.folds.length-1;while(t<i){var s=Math.floor((t+i)/2),n=this.folds[s];n.start.line<e?n.end.line<=e?t=s+1:i=s:n.start.line==e?t=s+1:i=s-1}return t}},{key:"foldLine",value:function(e){var t=e,i=this.getRangeFold(e);if(i){for(var s=i.start.line;s<i.end.line;s++)this.foldMap.has(s)&&this.foldMap.get(s).end.line>i.end.line&&this.unFold(s);this.foldMap.set(t,i),this.folds.push(i),this.folds.sort((function(e,t){return e.start.line-t.start.line}))}return i}},{key:"unFold",value:function(e){var t=0,i=this.folds.length;if(!this.foldMap.has(e))return!1;while(t<=i){var s=Math.floor((t+i)/2);if(this.folds[s].start.line==e){this.folds.splice(s,1);break}this.folds[s].start.line>e?i=s-1:t=s+1}return this.foldMap.delete(e),!0}},{key:"getRangeFold",value:function(e,t){var i=[],s=e,n=this.htmls[s-1],r=null;if(e++,n.folds&&n.folds.length)for(var a=0;a<n.folds.length;a++){var o=n.folds[a];-1==o.type&&(i.length&&i.peek().name!=o.name||i.push(o))}while(i.length&&e<=this.htmls.length&&(!t||e-s<=1)){if(n=this.htmls[e-1],n.folds&&n.folds.length)for(var l=0;l<n.folds.length;l++){var h=n.folds[l];if(-1==h.type)i.peek().name==h.name&&i.push(h);else if(i.peek().name==h.name){if(1==i.length){if(t)return e-s>1;r={start:{line:s,start:i.peek().start},end:{line:e,end:h.end},name:h.name},i.pop();break}i.pop()}}e++}return t?e-s>1:r}},{key:"getRealLine",value:function(e){var t=0,i=1,s=1;while(t<this.folds.length&&i<e){var n=this.folds[t];if(!(i+n.start.line-s<e))break;i+=n.start.line+1-s,s=n.end.line,t++;while(t<this.folds.length&&this.folds[t].end.line<=n.end.line)t++}return s+=e-i,s}},{key:"getRelativeLine",value:function(e){var t=e,i=0;while(i<this.folds.length){var s=this.folds[i];if(!(e>=s.end.line))break;t-=s.end.line-s.start.line-1,i++;while(i<this.folds.length&&this.folds[i].end.line<=s.end.line)i++}return t}}]),e}(),K=function(){function e(t,i){Object(g["a"])(this,e),this.initProperties(t,i)}return Object(k["a"])(e,[{key:"initProperties",value:function(e,t){z.defineProperties(this,e,["insertContent","deleteContent","setCursorPos","setSelectedRange"]),z.defineProperties(this,t,["history"])}},{key:"undo",value:function(){if(this.history.index>0){var e=this.history[this.history.index-1];this.doCommand(e),this.history.index--}}},{key:"redo",value:function(){if(this.history.index<this.history.length){var e=this.history[this.history.index];this.history.index++,this.doCommand(e)}}},{key:"doCommand",value:function(e){switch(e.type){case z.command.DELETE:this.setSelectedRange(e.start,e.end),this.deleteContent(z.keyCode.BACKSPACE,!0);break;case z.command.INSERT:this.setCursorPos(e.cursorPos.line,e.cursorPos.column),this.insertContent(e.text,!0);break}}},{key:"pushHistory",value:function(e){var t=this.history[this.history.index-1];while(this.history.length>this.history.index)this.history.pop();t&&t.type==e.type&&Date.now()-this.pushHistoryTime<2e3?t.type==z.command.DELETE&&e.end.line==e.start.line&&0==z.comparePos(t.end,e.start)?t.end=e.end:t.type==z.command.INSERT&&e.preCursorPos.line==e.cursorPos.line&&0==z.comparePos(t.cursorPos,e.preCursorPos)?(t.text=e.text+t.text,t.cursorPos=e.cursorPos):this.history.push(e):this.history.push(e),this.history.index=this.history.length,this.pushHistoryTime=Date.now()}},{key:"updateHistory",value:function(e,t){this.history[e-1]=t}}]),e}(),Z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"my-editor-status-bar",style:{height:e.height+"px"},on:{contextmenu:function(e){e.stopPropagation(),e.preventDefault()}}},[i("div",{staticClass:"my-editor-status-left"},[i("div",{staticClass:"my-editor-status-item"},[i("span",[e._v("Line "+e._s(e.line)+", Column "+e._s(e.column))])])]),i("div",{staticClass:"my-editor-status-right"},[i("div",{staticClass:"my-editor-status-item clickable",on:{mousedown:function(t){return t.stopPropagation(),e.showTabsize.apply(null,arguments)}}},[i("span",[e._v("Tab Size:"+e._s(e._tabSize))]),i("panel",{directives:[{name:"show",rawName:"v-show",value:e.tabsizeVisible,expression:"tabsizeVisible"}],attrs:{menuList:e.tabSizeList,styles:{right:0,bottom:e.height+"px"}},on:{change:e.onTabsizeChange}})],1),i("div",{staticClass:"my-editor-status-item clickable",on:{mousedown:function(t){return t.stopPropagation(),e.showLanguage.apply(null,arguments)}}},[i("span",[e._v(e._s(e._language))]),i("panel",{directives:[{name:"show",rawName:"v-show",value:e.languageVisible,expression:"languageVisible"}],attrs:{menuList:e.languageList,styles:{right:0,bottom:e.height+"px"}},on:{change:e.onLnaguageChange}})],1)])])},J=[],q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"my-editor-panel",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},e._l(e.menuList,(function(t){return i("div",{staticClass:"my-editor-menu-group"},e._l(t,(function(s){return i("div",{staticClass:"my-editor-menu-item",class:{checked:e.checkable&&s.checked,disabled:s.disabled},on:{mousedown:function(i){return e.onClick(s,t)}}},[i("div",{staticClass:"my-editor-menu-content"},[e._v(e._s(s.name))]),s.shortcut?i("div",{staticClass:"my-editor-menu-shortcut"},[e._v(e._s(s.shortcut))]):e._e()])})),0)})),0)},Q=[],ee={name:"Panel",props:{menuList:{type:Array,default:[]},styles:{type:Object},checkable:{type:Boolean,default:!0}},data:function(){return{}},created:function(){},methods:{onClick:function(e,t){e.disabled||(t.map((function(e){e.checked=!1})),e.checked=!0,this.$emit("change",e))}}},te=ee,ie=Object(l["a"])(te,q,Q,!1,null,null,null),se=ie.exports,ne={name:"StatusBar",props:{height:{type:Number,default:25},line:{type:Number,default:1},column:{type:Number,default:1},language:{type:String,default:"JavaScript"},tabSize:{type:Number,default:4}},components:{Panel:se},data:function(){return{_tabSize:0,_language:"",tabsizeVisible:!1,languageVisible:!1,tabSizeList:[[]],languageList:[[{name:"JavaScript"},{name:"HTML"},{name:"CSS"}]]}},created:function(){for(var e=1;e<=8;e++)this.tabSizeList[0].push({name:"Tab Width：".concat(e),size:e});this._tabSize=this.tabSize,this._language=this.language,this.setDefault()},methods:{setDefault:function(){var e=this;this.tabSizeList[0].map((function(t){t.checked=t.size==e._tabSize})),this.languageList[0].map((function(t){t.checked=t.name==e._language}))},showTabsize:function(){var e=this.tabsizeVisible;this.closeAllPanel(),this.tabsizeVisible=!e},showLanguage:function(){var e=this.languageVisible;this.closeAllPanel(),this.languageVisible=!e},closeAllPanel:function(){this.languageVisible=!1,this.tabsizeVisible=!1},onTabsizeChange:function(e){this._tabSize!=e.size&&(this._tabSize=e.size,this.$emit("update:tabSize",e.size)),this.tabsizeVisible=!1},onLnaguageChange:function(e){this._language!=e.name&&(this._language=e.name,this.$emit("update:language",e.name)),this.languageVisible=!1}}},re=ne,ae=Object(l["a"])(re,Z,J,!1,null,null,null),oe=ae.exports,le=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"my-editor-tip",style:e.styles,on:{mousedown:function(e){e.stopPropagation()}}},[i("div",{domProps:{innerHTML:e._s(e.content)}})])},he=[],ue={name:"Tip",props:{content:String,styles:{type:Object}},data:function(){return{}},created:function(){},methods:{}},ce=ue,pe=Object(l["a"])(ce,le,he,!1,null,null,null),de=pe.exports,fe={htmls:[],folds:[],history:[],lineIdMap:new Map,renderedIdMap:new Map,foldMap:new Map},me={name:"Home",components:{StatusBar:oe,Panel:se,Tip:de},data:function(){return Object(f["a"])({charObj:{charWidth:7.15,fullAngleCharWidth:15,charHight:19},cursorPos:{line:1,column:0,top:0,left:0,show:!1,visible:!0},cursorRealPos:{top:"0px",left:"0px"},language:"HTML",statusHeight:23,tabSize:4,renderHtmls:[],startLine:1,startToEndToken:null,top:0,scrollLeft:0,scrollTop:0,maxVisibleLines:1,maxLine:1,scrollerHeight:"auto",scrollerArea:{},selectedRange:null,maxWidthObj:{lineId:null,text:"",width:0},menuList:[[{name:"Cut",op:"cut",shortcut:"Ctrl+X"},{name:"Copy",op:"copy",shortcut:"Ctrl+C"},{name:"Paste",op:"paste",shortcut:"Ctrl+V"}]],menuStyle:{top:"0px",left:"0px","min-width":"200px"},tipStyle:{top:"0px",left:"0px"},errorMap:{},menuVisble:!1,tipContent:!1},"tipContent","")},computed:{_numTop:function(){return this.top-this.charObj.charHight+"px"},_leftShadow:function(){return this.scrollLeft?"17px 0 16px -16px rgba(0, 0, 0, 0.8) inset":"none"},_top:function(){return this.top+"px"},_lineHeight:function(){return this.charObj.charHight+"px"},_statusHeight:function(){return this.statusHeight+4+"px"},_cursorVisible:function(){return this.cursorPos.visible?"visible":"hidden"},_hScrollWidth:function(){return this._contentMinWidth},_contentMinWidth:function(){var e=0;return this.$content&&(e=z.getStrExactWidth(this.maxWidthObj.text,this.tabSize,this.$content),e+=this.charObj.fullAngleCharWidth),e=this.scrollerArea.width>e?this.scrollerArea.width:e,e+"px"},_textAreaPos:function(){var e=this.cursorRealPos,t=z.getNum(e.left),i=z.getNum(e.top)+this.top;return t-=this.scrollLeft,t=t<this.charObj.charWidth?this.charObj.charWidth:t,t=t>this.scrollerArea.width-this.charObj.charWidth?this.scrollerArea.width-this.charObj.charWidth:t,i+=this.charObj.charHight,i>this.scrollerArea.height-2*this.charObj.charHight&&(i=this.scrollerArea.height-2*this.charObj.charHight),{top:i+"px",left:t+"px"}},_startBgLineVisible:function(){var e=this;return function(t){return e.selectedRange&&t==e.selectedRange.start.line}},_endBgLineVisible:function(){var e=this;return function(t){return e.selectedRange&&t==e.selectedRange.end.line&&e.selectedRange.end.line>e.selectedRange.start.line}},_tabLineLeft:function(){var e=this;return function(t){return(t-1)*e.tabSize*e.charObj.charWidth+"px"}},space:function(){return z.space(this.tabSize)}},watch:{language:function(e){fe.htmls.map((function(e){e.tokens=null,e.folds=null,e.states=null,e.html=""})),this.render(),this.tokenizer.initLanguage(e),this.tokenizer.tokenizeVisibleLins(),this.tokenizer.tokenizeLines(1),this.lint.initLanguage(e)},tabSize:function(e){this.render(),this.maxWidthObj={lineId:null,text:"",width:0},this.setLineWidth(fe.htmls)},maxLine:function(e){this.setScrollerHeight()}},created:function(){window.editor=this,window.context=fe,this.initData(),this.initEvent()},mounted:function(){this.$editor=this.$refs.editor,this.$scroller=this.$refs.scroller,this.$content=this.$refs.content,this.$textarea=this.$refs.textarea,this.$vScroller=this.$refs.vScroller,this.$hScroller=this.$refs.hScroller,this.charObj=z.getCharWidth(this.$content),this.maxVisibleLines=Math.ceil(this.$scroller.clientHeight/this.charObj.charHight)+1,this.render(),this.focus()},methods:{initData:function(){this.lineId=Number.MIN_SAFE_INTEGER,fe.htmls.push({lineId:this.lineId++,text:"",html:"",width:0,tokens:[],folds:[],states:[]}),fe.lineIdMap.set(fe.htmls[0].lineId,fe.htmls[0]),this.maxWidthObj.lineId=fe.htmls[0].lineId,this.tokenizer=new H(this,fe),this.lint=new G(this,fe),this.folder=new Y(this,fe),this.history=new K(this,fe)},initEvent:function(){var e=this;B()(document).on("mousemove",(function(t){e.onScrollerMmove(t)})),B()(document).on("mouseup",(function(t){e.onScrollerMup(t)}))},showCursor:function(){var e=this;if(!this.cursorPos.show){this.cursorPos.show=!0,this.cursorPos.visible=!0;var t=function t(){clearTimeout(e.curserTimer),e.curserTimer=setTimeout((function(){e.cursorPos.visible=!e.cursorPos.visible,t()}),500)};t()}},hideCursor:function(){clearTimeout(this.curserTimer),this.cursorPos.show=!1},focus:function(){var e=this;this.$textarea.focus(),setTimeout((function(){setTimeout((function(){e.$textarea.focus()}),100)}),100)},render:function(){var e=this;this.renderLine(),this.$nextTick((function(){e.scrollerArea={height:e.$scroller.clientHeight,width:e.$scroller.clientWidth}}))},renderLine:function(e){var t=this;if(e){if(fe.renderedIdMap.has(e)){var i=fe.lineIdMap.get(e),s=fe.renderedIdMap.get(e);Object.assign(s,u(i,s.num))}}else{fe.renderedIdMap.clear(),this.renderHtmls=[];for(var n=0,r=this.startLine;n<this.maxVisibleLines&&r<=fe.htmls.length;n++){var a=fe.htmls[r-1],o=a.lineId,l=u(a,r);if(this.renderHtmls.push(l),fe.renderedIdMap.set(o,l),fe.foldMap.has(r)){var h=fe.foldMap.get(r);r=h.end.line}else r++}}function u(e,i){var s=!1,n=/^\s+/.exec(e.text),r=0,a="";n&&(r=/\t+/.exec(n[0]),r=r&&r[0].length||0,r+=Math.ceil((n[0].length-r)/t.tabSize)),t.selectedRange&&i>t.selectedRange.start.line&&i<t.selectedRange.end.line&&(s=!0),fe.foldMap.has(i)?a="close":t.folder.getRangeFold(i,!0)&&(a="open");var o=e.html||z.htmlTrans(e.text);return o=o.replace(/\t/g,t.space),{html:o,num:i,tabNum:r,selected:s,fold:a}}},renderSelectedBg:function(e){if(this.selectedRange){var t=this.selectedRange.start,i=this.selectedRange.end,s=z.comparePos(t,i);if(this.setCursorPos(i.line,i.column,e),s>0){var n=t;t=i,i=n}else if(!s)return void this.clearRnage();var r=fe.htmls[t.line-1].text;t.left=this.getStrWidth(r,0,t.column),t.line==i.line?t.width=this.getStrWidth(r,t.column,i.column):(t.width=this.getStrWidth(r,t.column),i.left=0,r=fe.htmls[i.line-1].text,i.width=this.getStrWidth(r,0,i.column),this.renderHtmls.map((function(e){e.selected=e.num>t.line&&e.num<i.line}))),this.setSelectedRange(t,i)}},clearRnage:function(){this.selectedRange=null,this.renderHtmls.map((function(e){e.selected=!1}))},insertContent:function(e,t){var i=this;this.selectedRange&&this.deleteContent();var s=fe.htmls[this.cursorPos.line-1].text,n=this.cursorPos.column,r=this.cursorPos.line,a=r,o=n;this.tokenizer.onInsertContentBefore(r),this.lint.onInsertContentBefore(r),this.folder.onInsertContentBefore(r),e=e.split(/\r\n|\n/),e=e.map((function(e){return e={lineId:i.lineId++,text:e,html:"",width:0,tokens:null,folds:null,states:null},fe.lineIdMap.set(e.lineId,e),e})),e.length>1?(o=e[e.length-1].text.length,e[0].text=s.slice(0,n)+e[0].text,e[e.length-1].text=e[e.length-1].text+s.slice(n),fe.htmls=fe.htmls.slice(0,this.cursorPos.line-1).concat(e).concat(fe.htmls.slice(this.cursorPos.line))):(o+=e[0].text.length,e[0].text=s.slice(0,n)+e[0].text+s.slice(this.cursorPos.column),fe.htmls.splice(this.cursorPos.line-1,1,e[0])),a+=e.length-1,this.maxLine=fe.htmls.length,this.render(),this.tokenizer.onInsertContentAfter(a),this.lint.onInsertContentAfter(a),this.folder.onInsertContentAfter(a),this.setLineWidth(e),fe.foldMap.has(r)&&e.length>1&&this.unFold(r),this.setCursorPos(a,o);var l={type:z.command.DELETE,start:{line:r,column:n},end:{line:a,column:o}};t?this.history.updateHistory(fe.history.index,l):this.history.pushHistory(l)},deleteContent:function(e,t){var i=null,s=fe.htmls[this.cursorPos.line-1],n=s.text,r={line:this.cursorPos.line,column:this.cursorPos.column},a="",o=[],l=this.cursorPos.line,h=this.cursorPos.column;if(this.tokenizer.onDeleteContentBefore(this.cursorPos.line),this.lint.onDeleteContentBefore(this.cursorPos.line),this.folder.onDeleteContentBefore(this.cursorPos.line),this.selectedRange){var u=this.selectedRange.end,c=fe.htmls[u.line-1];i=this.selectedRange.start,s=fe.htmls[i.line-1],r={line:u.line,column:u.column},n=s.text,a=this.getRangeText(this.selectedRange.start,this.selectedRange.end),1==i.line&&u.line==this.maxLine?(o=[this.maxWidthObj.lineId],fe.lineIdMap.clear()):o=fe.htmls.slice(i.line-1,u.line).map((function(e){return fe.lineIdMap.delete(e.lineId),e.lineId})),fe.lineIdMap.set(s.lineId,s),i.line==u.line?(n=n.slice(0,i.column)+n.slice(u.column),s.text=n):(n=n.slice(0,i.column),s.text=n,n=c.text,n=n.slice(u.column),s.text+=n,fe.htmls.splice(i.line,u.line-i.line)),l=i.line,h=i.column}else if(z.keyCode.DELETE==e)this.cursorPos.column==n.length?this.cursorPos.line<fe.htmls.length&&(fe.lineIdMap.delete(fe.htmls[this.cursorPos.line].lineId),n=s.text+fe.htmls[this.cursorPos.line].text,fe.htmls.splice(this.cursorPos.line,1),a="\n"):(a=n[this.cursorPos.column],n=n.slice(0,this.cursorPos.column)+n.slice(this.cursorPos.column+1)),s.text=n;else{if(0==this.cursorPos.column){if(this.cursorPos.line>1){var p=fe.htmls[this.cursorPos.line-2].text.length;fe.lineIdMap.delete(fe.htmls[this.cursorPos.line-2].lineId),n=fe.htmls[this.cursorPos.line-2].text+n,fe.htmls.splice(this.cursorPos.line-2,1),a="\n",l=this.cursorPos.line-1,h=p}}else a=n[this.cursorPos.column-1],n=n.slice(0,this.cursorPos.column-1)+n.slice(this.cursorPos.column),h=this.cursorPos.column-1;s.text=n}s.width=this.getStrWidth(s.text),s.tokens=null,s.folds=null,s.states=null,this.maxLine=fe.htmls.length,this.render(),this.clearRnage(),this.tokenizer.onDeleteContentAfter(l),this.lint.onDeleteContentAfter(l),this.folder.onDeleteContentAfter(l),l==this.cursorPos.line&&this.cursorPos.column==h||this.setCursorPos(l,h),s.width>=this.maxWidthObj.width?this.maxWidthObj={lineId:s.lineId,text:s.text,width:s.width}:o.indexOf(this.maxWidthObj.lineId)>-1&&this.setMaxWidth();var d={type:z.command.INSERT,keyCode:e,cursorPos:z.deepAssign({},this.cursorPos),preCursorPos:r,text:a};t?this.history.updateHistory(fe.history.index,d):a&&this.history.pushHistory(d)},foldLine:function(e){var t=this.folder.foldLine(e);if(this.focus(),t){if(this.cursorPos.line>e&&this.cursorPos.line<t.end.line){var i=fe.htmls[e-1];this.setCursorPos(e,i.text.length)}this.setScrollerHeight(),this.setCursorRealPos(),this.render()}},unFold:function(e){this.focus(),this.folder.unFold(e)&&(this.setScrollerHeight(),this.setCursorRealPos(),this.render())},setCursorPos:function(e,t,i){var s=this;this.cursorPos.line=e,this.cursorPos.column=t,this.cursorPos.visible=!0,this.forceCursorView=void 0===i||i,cancelAnimationFrame(this.setCursorPos.timer),this.setCursorPos.timer=requestAnimationFrame((function(){s.$nextTick((function(){s.setCursorRealPos()}))}))},setCursorRealPos:function(){var e=this,t=0,i=fe.htmls[e.cursorPos.line-1];t=B()("#line_"+this.cursorPos.line).length&&i.tokens&&i.tokens.length?r():this.getStrWidthByLine(this.cursorPos.line,0,this.cursorPos.column);var s=(this.folder.getRelativeLine(this.cursorPos.line)-this.folder.getRelativeLine(this.startLine))*this.charObj.charHight,n=this.folder.getRelativeLine(this.cursorPos.line)*this.charObj.charHight;function r(){for(var t=fe.htmls[e.cursorPos.line-1],i=t.tokens[0],s=1;s<t.tokens.length;s++){if(!(t.tokens[s].column<e.cursorPos.column))break;i=t.tokens[s]}var n=B()("#line_"+e.cursorPos.line).children(".my-editor-code").children('span[data-column="'+i.column+'"]'),r=i.value.slice(0,e.cursorPos.column-i.column);return n[0].offsetLeft+e.getStrWidth(r)}this.forceCursorView&&(n>this.scrollTop+this.scrollerArea.height-this.charObj.charHight?this.$vScroller.scrollTop=n+this.charObj.charHight-this.scrollerArea.height:(s<0||0==s&&this.top<0)&&(this.$vScroller.scrollTop=(this.cursorPos.line-1)*this.charObj.charHight),t>this.scrollerArea.width+this.scrollLeft-this.charObj.fullAngleCharWidth?this.$hScroller.scrollLeft=t+this.charObj.fullAngleCharWidth-this.scrollerArea.width:t<this.scrollLeft&&(this.$hScroller.scrollLeft=t-1)),this.cursorRealPos={top:s+"px",left:t+"px"}},setMaxWidth:function(){var e={line:fe.htmls[0].lineId,width:0};fe.htmls.map((function(t){t.width>e.width&&(e={lineId:t.lineId,text:t.text,width:t.width})})),this.maxWidthObj=e},setLineWidth:function(e){var t=0,i=this,s=Date.now();function n(){while(t<e.length){var r=e[t];if(fe.lineIdMap.has(r.lineId)){var a=i.getStrWidth(r.text);r.width=a,a>i.maxWidthObj.width&&(i.maxWidthObj={lineId:r.lineId,text:r.text,width:a})}if(t++,Date.now()-s>20)break}t<e.length&&(i.setLineWidth.timer=setTimeout((function(){n()}),20))}clearTimeout(this.setLineWidth.timer),n()},setScrollerHeight:function(){var e=fe.htmls.length;e=this.folder.getRelativeLine(e),this.scrollerHeight=e*this.charObj.charHight+"px"},setSelectedRange:function(e,t){this.selectedRange={start:e,end:t}},setErrorMap:function(e){this.errorMap=e},getStrWidth:function(e,t,i){return z.getStrWidth(e,this.charObj.charWidth,this.charObj.fullAngleCharWidth,this.tabSize,t,i)},getStrWidthByLine:function(e,t,i){return this.getStrWidth(fe.htmls[e-1].text,t,i)},getColumnByWidth:function(e,t){var i,s,n,r,a=0,o=e.length;while(a<o){if(i=Math.floor((a+o)/2),s=this.getStrWidth(e,0,i),n=e[i-1]&&this.getStrWidth(e[i-1])/2,r=e[i]&&this.getStrWidth(e[i])/2||n,s>=t&&s-t<n||t>=s&&t-s<r){a=i;break}s>t?o=i:a=i+1}return a},getPosByEvent:function(e){var t=this,i=B()(e.target);if(i.attr("data-line")||i.attr("data-column"))return h(e);var s=B()(this.$scroller),n=s.offset(),r=0,a=e.clientX<0?0:e.clientX,o=e.clientY<0?0:e.clientY,l=Math.ceil((o+this.scrollTop-n.top)/this.charObj.charHight)||1;return l=this.folder.getRealLine(l),l>fe.htmls.length?(l=fe.htmls.length,r=fe.htmls[l-1].text.length):r=this.getColumnByWidth(fe.htmls[l-1].text,a+this.scrollLeft-n.left),{line:l,column:r};function h(e){var i=B()(e.target),s=i.attr("data-line")-0,n=i.attr("data-column");s||(s=i.parent().attr("data-line")-0);var r=fe.htmls[s-1];if(n){n-=0;for(var a=0;a<r.tokens.length;a++)if(r.tokens[a].column==n){n+=t.getColumnByWidth(r.tokens[a].value,e.offsetX);break}}else n=r.text.length;return{line:s,column:n}}},getRangeText:function(e,t){var i=fe.htmls[e.line-1].text;if(e.line!=t.line){var s=[];i=i.slice(e.column),s=fe.htmls.slice(e.line,t.line-1),s=s.map((function(e){return e.text})),i+=s.length?"\n"+s.join("\n"):"",i+="\n"+fe.htmls[t.line-1].text.slice(0,t.column)}else i=i.slice(e.column,t.column);return i},onContextmenu:function(e){var t=this,i=0,s=0,n=B()(this.$editor),r=n.offset();this.menuVisble=!0,this.$nextTick((function(){i=t.$refs.menu.$el.clientWidth,s=t.$refs.menu.$el.clientHeight,s+e.clientY>r.top+t.scrollerArea.height?t.menuStyle.top=e.clientY-r.top-s+"px":t.menuStyle.top=e.clientY-r.top+"px",i+e.clientX>r.left+n[0].clientWidth?t.menuStyle.left=e.clientX-r.left-i+"px":t.menuStyle.left=e.clientX-r.left+"px"}))},onClickMenu:function(e){var t=this;switch(e.op){case"cut":case"copy":if(this.selectedRange){var i=this.getRangeText(this.selectedRange.start,this.selectedRange.end);"cut"==e.op&&this.deleteContent(),z.writeClipboard(i)}else{var s=fe.htmls[this.cursorPos.line-1].text;"cut"===e.op&&(s&&this.setSelectedRange({line:this.cursorPos.line,column:0},{line:this.cursorPos.line,column:s.length}),s&&this.deleteContent()),z.writeClipboard(s)}break;case"paste":this.selectedRange&&this.deleteContent(),this.$textarea.focus(),z.readClipboard().then((function(e){t.insertContent(e)}));break}this.menuVisble=!1,this.focus()},onIconMouseOver:function(e,t){var i=B()(this.$editor),s=i.offset();this.tipStyle={left:t.clientX-s.left+10+"px",top:t.clientY-s.top+10+"px"},this.tipContent=this.errorMap[e]},onIconMouseLeave:function(){this.tipContent=""},onToggleFold:function(e){fe.foldMap.has(e)?this.unFold(e):this.foldLine(e)},onClickEditor:function(){this.$refs.statusBar.closeAllPanel(),this.menuVisble=!1},onScrollerMdown:function(e){if(this.focus(),3!=e.which){var t=this.getPosByEvent(e);this.setCursorPos(t.line,t.column),this.mouseStartObj={time:Date.now(),start:t}}},onScrollerMmove:function(e){var t=this;if(this.mouseStartObj&&Date.now()-this.mouseStartObj.time>100){var i=B()(this.$scroller).offset();this.setSelectedRange(Object.assign({},this.mouseStartObj.start),this.getPosByEvent(e)),this.renderSelectedBg(),cancelAnimationFrame(this.selectMoveTimer),e.clientY>i.top+this.scrollerArea.height?s("down",e.clientY-i.top-this.scrollerArea.height):e.clientY<i.top?s("up",i.top-e.clientY):e.clientX<i.left?s("left",i.left-e.clientX):e.clientX>i.left+this.scrollerArea.width&&s("right",e.clientX-i.left-this.scrollerArea.width)}function s(e,i){var s=t.cursorPos.line,n=t.cursorPos.column,r=0;function a(e,i){var o=s,l=n;switch(e){case"up":r+=i,o=Math.floor(r/t.charObj.charHight),o=s-o;break;case"down":r+=i,o=Math.floor(r/t.charObj.charHight),o=s+o;break;case"left":r+=i,l=Math.floor(r/t.charObj.charWidth),l=n-l;break;case"right":r+=i,l=Math.floor(r/t.charObj.charWidth),l=n+l;break}o=o<1?1:o>fe.htmls.length?fe.htmls.length:o,l=l<0?0:l>fe.htmls[s-1].text.length?fe.htmls[s-1].text.length:l,t.setCursorPos(o,l),t.setSelectedRange(t.mouseStartObj.start,{line:o,column:l}),t.renderSelectedBg(),t.selectMoveTimer=requestAnimationFrame((function(){a(e,i)}))}a(e,i)}},onScrollerMup:function(e){if(this.mouseStartObj&&Date.now()-this.mouseStartObj.time>100){var t=this.getPosByEvent(e);this.setSelectedRange(this.mouseStartObj.start,t),this.renderSelectedBg(),this.setCursorPos(t.line,t.column)}else 3!=e.which&&this.clearRnage();cancelAnimationFrame(this.selectMoveTimer),this.mouseStartObj=null},onHscroll:function(e){this.scrollLeft=e.target.scrollLeft,this.$scroller.scrollLeft=this.scrollLeft,this.forceCursorView=!1},onVscroll:function(e){var t=1;this.scrollTop=e.target.scrollTop,t=Math.floor(this.scrollTop/this.charObj.charHight),t++,this.startLine=this.folder.getRealLine(t),this.top=-this.scrollTop%this.charObj.charHight,this.forceCursorView=!1,this.tokenizer.onScroll(),this.render(),this.setCursorRealPos()},onWheel:function(e){this.$vScroller.scrollTop=this.scrollTop+e.deltaY,this.$hScroller.scrollLeft=this.scrollLeft+e.deltaX},onCompositionstart:function(){clearTimeout(this.compositionendTimer),this.compositionstart=!0},onCompositionend:function(){var e=this;if(this.compositionstart){var t=this.$textarea.value||"";t&&(this.insertContent(t),this.$textarea.value="")}this.compositionendTimer=setTimeout((function(){e.compositionstart=!1}),100)},onInput:function(){if(!this.compositionstart){var e=this.$textarea.value||"";e&&(this.insertContent(e),this.$textarea.value="")}},onCopy:function(e){var t=window.clipboardData?"Text":"text/plain",i=e.clipboardData||window.clipboardData;if(this.selectedRange){var s=this.getRangeText(this.selectedRange.start,this.selectedRange.end);i.setData(t,s)}else i.setData(t,fe.htmls[this.cursorPos.line-1].text)},onCut:function(e){var t=window.clipboardData?"Text":"text/plain",i=e.clipboardData||window.clipboardData;if(this.selectedRange){var s=this.getRangeText(this.selectedRange.start,this.selectedRange.end);i.setData(t,s),this.deleteContent()}else{var n=fe.htmls[this.cursorPos.line-1].text;n&&i.setData(t,fe.htmls[this.cursorPos.line-1].text),n&&this.setSelectedRange({line:this.cursorPos.line,column:0},{line:this.cursorPos.line,column:n.length}),this.deleteContent()}},onPaste:function(e){var t=window.clipboardData?"Text":"text/plain",i=e.clipboardData||window.clipboardData,s="";s=i.getData(t),this.insertContent(s)},onFocus:function(){this.showCursor()},onBlur:function(){this.hideCursor(),this.menuVisble=!1},onKeyDown:function(e){if(e.ctrlKey)switch(e.keyCode){case 65:e.preventDefault(),this.setSelectedRange({line:1,column:0},{line:fe.htmls.length,column:fe.htmls.peek().text.length}),this.renderSelectedBg(!1);break;case 90:case 122:e.preventDefault(),this.history.undo();break;case 89:case 121:e.preventDefault(),this.history.redo();break}else switch(e.keyCode){case 9:e.preventDefault(),this.insertContent("\t");break;case 37:this.cursorPos.column>0?this.setCursorPos(this.cursorPos.line,this.cursorPos.column-1):this.cursorPos.line>1&&this.setCursorPos(this.cursorPos.line-1,fe.htmls[this.cursorPos.line-2].text.length),this.clearRnage();break;case 38:if(this.cursorPos.line>1){var t=fe.htmls[this.cursorPos.line-1].text,i=this.getStrWidth(t,0,this.cursorPos.column);t=fe.htmls[this.cursorPos.line-2].text;var s=this.getColumnByWidth(t,i);this.setCursorPos(this.cursorPos.line-1,s)}this.clearRnage();break;case 39:var n=fe.htmls[this.cursorPos.line-1].text;this.cursorPos.column<n.length?this.setCursorPos(this.cursorPos.line,this.cursorPos.column+1):this.cursorPos.line<fe.htmls.length&&this.setCursorPos(this.cursorPos.line+1,0),this.clearRnage();break;case 40:if(this.cursorPos.line<fe.htmls.length){var r=fe.htmls[this.cursorPos.line-1].text,a=this.getStrWidth(r,0,this.cursorPos.column);r=fe.htmls[this.cursorPos.line].text;var o=this.getColumnByWidth(r,a);this.setCursorPos(this.cursorPos.line+1,o)}this.clearRnage();break;case z.keyCode.DELETE:this.deleteContent(z.keyCode.DELETE);break;case z.keyCode.BACKSPACE:this.deleteContent(z.keyCode.BACKSPACE);break}}}},ge=me,ke=Object(l["a"])(ge,p,d,!1,null,null,null),ve=ke.exports;s["a"].use(c["a"]);var xe=new c["a"]({routes:[{path:"/home",name:"Home",component:ve,meta:{title:"my-editor"}},{path:"*",redirect:"/home"}]}),ye=xe;i("6295"),i("a970"),i("a205"),i("6b7e");s["a"].config.productionTip=!1,new s["a"]({router:ye,render:function(e){return e(u)}}).$mount("#app")},6295:function(e,t,i){},"6b7e":function(e,t,i){},a205:function(e,t,i){},a970:function(e,t,i){}});
//# sourceMappingURL=app.41e75a26.js.map